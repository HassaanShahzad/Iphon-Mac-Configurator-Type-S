(function(){const D=document.createElement("link").relList;if(D&&D.supports&&D.supports("modulepreload"))return;for(const W of document.querySelectorAll('link[rel="modulepreload"]'))K(W);new MutationObserver(W=>{for(const re of W)if(re.type==="childList")for(const ue of re.addedNodes)ue.tagName==="LINK"&&ue.rel==="modulepreload"&&K(ue)}).observe(document,{childList:!0,subtree:!0});function p(W){const re={};return W.integrity&&(re.integrity=W.integrity),W.referrerPolicy&&(re.referrerPolicy=W.referrerPolicy),W.crossOrigin==="use-credentials"?re.credentials="include":W.crossOrigin==="anonymous"?re.credentials="omit":re.credentials="same-origin",re}function K(W){if(W.ep)return;W.ep=!0;const re=p(W);fetch(W.href,re)}})();var B_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},U_={exports:{}};(function(ee,D){(function(p,K){K(D)})(B_,function(p){/**
* @license
* threepipe v0.0.33
* Copyright 2022-2024 repalash <palash@shaders.app>
* Apache-2.0 License
* See ./dependencies.txt for bundled third-party dependencies and licenses.
*//**
* @license
* Copyright 2010-2023 Three.js Authors
* SPDX-License-Identifier: MIT
*/var K,W,re,ue,de,ve;const Ze="153",Xe={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},tt={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},vi=0,yt=1,zt=2,_t=1,Nt=2,Ci=3,Ie=0,$e=1,dt=2,Qt=0,ii=1,Oi=2,Si=3,Rr=4,$s=5,Da=100,Td=101,jg=102,Id=103,gr=104,Vt=200,Hg=201,Wg=202,Xg=203,Fn=204,Ic=205,Ri=206,xr=207,hu=208,qg=209,uu=210,Pd=0,pu=1,Zn=2,gl=3,du=4,mu=5,_o=6,Nn=7,vs=0,Yg=1,fu=2,$n=0,Rd=1,Dd=2,Bd=3,bo=4,gu=5,wo=300,ys=301,Ba=302,_s=303,ea=304,xo=306,Ar=1e3,ai=1001,bs=1002,Ai=1003,es=1004,Gn=1005,Et=1006,Eo=1007,Er=1008,Al=1008,oi=1009,Ld=1010,Ud=1011,Pc=1012,vl=1013,un=1014,qt=1015,di=1016,ts=1017,Au=1018,En=1020,Od=1021,mi=1023,vu=1024,yu=1025,ta=1026,Co=1027,Mo=1028,kd=1029,La=1030,Fd=1031,Nd=1033,ia=33776,Rc=33777,_u=33778,So=33779,bu=35840,Ua=35841,Dc=35842,wu=35843,Gd=36196,Bc=37492,xu=37496,Oa=37808,zd=37809,Qd=37810,Eu=37811,Cu=37812,Mu=37813,Su=37814,Vd=37815,To=37816,jd=37817,Tu=37818,Iu=37819,Hd=37820,Wd=37821,Lc=36492,Kg=36283,Pu=36284,Xd=36285,qd=36286,Ru=2200,Du=2201,yl=2202,Kr=2300,Cn=2301,ka=2302,Fa=2400,ws=2401,Io=2402,Bu=2500,Po=2501,Yd=0,Kd=1,Uc=2,Oc=3e3,ra=3001,xs=3200,Jd=3201,pn=0,Lu=1,Xi="",it="srgb",wi="srgb-linear",Uu="display-p3",_l="rgbm-16",na=7680,Ro=519,Jg=512,bl=513,Zg=514,Ou=515,Zd=516,$g=517,eA=518,tA=519,kc=35044,iA="100",ku="300 es",Fu=1035,Es=2e3,Fc=2001;class zi{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const n=i.indexOf(t);n!==-1&&i.splice(n,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const t=this._listeners[e.type];if(t!==void 0){e.target=this;const i=t.slice(0);for(let n=0,s=i.length;n<s;n++)i[n].call(this,e);e.target=null}}}const Dr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let $d=1234567;const Na=Math.PI/180,Do=180/Math.PI;function dn(){const r=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Dr[r&255]+Dr[r>>8&255]+Dr[r>>16&255]+Dr[r>>24&255]+"-"+Dr[e&255]+Dr[e>>8&255]+"-"+Dr[e>>16&15|64]+Dr[e>>24&255]+"-"+Dr[t&63|128]+Dr[t>>8&255]+"-"+Dr[t>>16&255]+Dr[t>>24&255]+Dr[i&255]+Dr[i>>8&255]+Dr[i>>16&255]+Dr[i>>24&255]).toLowerCase()}function ki(r,e,t){return Math.max(e,Math.min(t,r))}function Nu(r,e){return(r%e+e)%e}function rA(r,e,t,i,n){return i+(r-e)*(n-i)/(t-e)}function nA(r,e,t){return r!==e?(t-r)/(e-r):0}function Bo(r,e,t){return(1-t)*r+t*e}function sA(r,e,t,i){return Bo(r,e,1-Math.exp(-t*i))}function Cs(r,e=1){return e-Math.abs(Nu(r,e*2)-e)}function em(r,e,t){return r<=e?0:r>=t?1:(r=(r-e)/(t-e),r*r*(3-2*r))}function aA(r,e,t){return r<=e?0:r>=t?1:(r=(r-e)/(t-e),r*r*r*(r*(r*6-15)+10))}function Cr(r,e){return r+Math.floor(Math.random()*(e-r+1))}function oA(r,e){return r+Math.random()*(e-r)}function Nc(r){return r*(.5-Math.random())}function tm(r){r!==void 0&&($d=r);let e=$d+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function Gu(r){return r*Na}function wl(r){return r*Do}function Br(r){return(r&r-1)===0&&r!==0}function Lo(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function Mn(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function lA(r,e,t,i,n){const s=Math.cos,a=Math.sin,o=s(t/2),l=a(t/2),c=s((e+i)/2),h=a((e+i)/2),d=s((e-i)/2),m=a((e-i)/2),f=s((i-e)/2),v=a((i-e)/2);switch(n){case"XYX":r.set(o*h,l*d,l*m,o*c);break;case"YZY":r.set(l*m,o*h,l*d,o*c);break;case"ZXZ":r.set(l*d,l*m,o*h,o*c);break;case"XZX":r.set(o*h,l*v,l*f,o*c);break;case"YXY":r.set(l*f,o*h,l*v,o*c);break;case"ZYZ":r.set(l*v,l*f,o*h,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function Jr(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function Gt(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}const Zt={DEG2RAD:Na,RAD2DEG:Do,generateUUID:dn,clamp:ki,euclideanModulo:Nu,mapLinear:rA,inverseLerp:nA,lerp:Bo,damp:sA,pingpong:Cs,smoothstep:em,smootherstep:aA,randInt:Cr,randFloat:oA,randFloatSpread:Nc,seededRandom:tm,degToRad:Gu,radToDeg:wl,isPowerOfTwo:Br,ceilPowerOfTwo:Lo,floorPowerOfTwo:Mn,setQuaternionFromProperEuler:lA,normalize:Gt,denormalize:Jr};class ne{constructor(e=0,t=0){ne.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(ki(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),n=Math.sin(t),s=this.x-e.x,a=this.y-e.y;return this.x=s*i-a*n+e.x,this.y=s*n+a*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Bt{constructor(e,t,i,n,s,a,o,l,c){Bt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,n,s,a,o,l,c)}set(e,t,i,n,s,a,o,l,c){const h=this.elements;return h[0]=e,h[1]=n,h[2]=o,h[3]=t,h[4]=s,h[5]=l,h[6]=i,h[7]=a,h[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,s=this.elements,a=i[0],o=i[3],l=i[6],c=i[1],h=i[4],d=i[7],m=i[2],f=i[5],v=i[8],w=n[0],b=n[3],y=n[6],E=n[1],_=n[4],C=n[7],M=n[2],S=n[5],R=n[8];return s[0]=a*w+o*E+l*M,s[3]=a*b+o*_+l*S,s[6]=a*y+o*C+l*R,s[1]=c*w+h*E+d*M,s[4]=c*b+h*_+d*S,s[7]=c*y+h*C+d*R,s[2]=m*w+f*E+v*M,s[5]=m*b+f*_+v*S,s[8]=m*y+f*C+v*R,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],l=e[6],c=e[7],h=e[8];return t*a*h-t*o*c-i*s*h+i*o*l+n*s*c-n*a*l}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],l=e[6],c=e[7],h=e[8],d=h*a-o*c,m=o*l-h*s,f=c*s-a*l,v=t*d+i*m+n*f;if(v===0)return this.set(0,0,0,0,0,0,0,0,0);const w=1/v;return e[0]=d*w,e[1]=(n*c-h*i)*w,e[2]=(o*i-n*a)*w,e[3]=m*w,e[4]=(h*t-n*l)*w,e[5]=(n*s-o*t)*w,e[6]=f*w,e[7]=(i*l-c*t)*w,e[8]=(a*t-i*s)*w,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,s,a,o){const l=Math.cos(s),c=Math.sin(s);return this.set(i*l,i*c,-i*(l*a+c*o)+a+e,-n*c,n*l,-n*(-c*a+l*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(qi.makeScale(e,t)),this}rotate(e){return this.premultiply(qi.makeRotation(-e)),this}translate(e,t){return this.premultiply(qi.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let n=0;n<9;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const qi=new Bt;function zu(r){for(let e=r.length-1;e>=0;--e)if(r[e]>=65535)return!0;return!1}const Sn={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Uo(r,e){return new Sn[r](e)}function Ms(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}const Gc={};function xl(r){r in Gc||(Gc[r]=!0,console.warn(r))}function Oo(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function El(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}const cA=new Bt().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),Qu=new Bt().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]);function Cl(r){return r.convertSRGBToLinear().applyMatrix3(Qu)}function zc(r){return r.applyMatrix3(cA).convertLinearToSRGB()}const im={[wi]:r=>r,[it]:r=>r.convertSRGBToLinear(),[Uu]:Cl},sa={[wi]:r=>r,[it]:r=>r.convertLinearToSRGB(),[Uu]:zc},cr={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(r){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!r},get workingColorSpace(){return wi},set workingColorSpace(r){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(r,e,t){if(this.enabled===!1||e===t||!e||!t)return r;const i=im[e],n=sa[t];if(i===void 0||n===void 0)throw new Error(`Unsupported color space conversion, "${e}" to "${t}".`);return n(i(r))},fromWorkingColorSpace:function(r,e){return this.convert(r,this.workingColorSpace,e)},toWorkingColorSpace:function(r,e){return this.convert(r,e,this.workingColorSpace)}};let aa;class Qc{static getDataURL(e,t=!1){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{aa===void 0&&(aa=Ms("canvas")),aa.width=e.width,aa.height=e.height;const n=aa.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),i=aa}return!t&&(i.width>2048||i.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),i.toDataURL("image/jpeg",.6)):i.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Ms("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const n=i.getImageData(0,0,e.width,e.height),s=n.data;for(let a=0;a<s.length;a++)s[a]=Oo(s[a]/255)*255;return i.putImageData(n,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Oo(t[i]/255)*255):t[i]=Oo(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Vc=0;class Zr{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Vc++}),this.uuid=dn(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let a=0,o=n.length;a<o;a++)n[a].isDataTexture?s.push(oa(n[a].image)):s.push(oa(n[a]))}else s=oa(n);i.url=s}return t||(e.images[this.uuid]=i),i}}function oa(r){if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap)return Qc.getDataURL(r);if(r.data){let e=[];try{e=Array.from(r.data)}catch(t){t.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(t),e=r.data}return{data:e,width:r.width,height:r.height,type:r.data.constructor.name}}else return r.url!==void 0?r.url:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let jc=0;class Ti extends zi{constructor(e=Ti.DEFAULT_IMAGE,t=Ti.DEFAULT_MAPPING,i=ai,n=ai,s=Et,a=Er,o=mi,l=oi,c=Ti.DEFAULT_ANISOTROPY,h=Xi){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:jc++}),this.uuid=dn(),this.name="",this.source=new Zr(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=n,this.magFilter=s,this.minFilter=a,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=l,this.offset=new ne(0,0),this.repeat=new ne(1,1),this.center=new ne(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Bt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof h=="string"?this.colorSpace=h:(xl("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=h===ra?it:Xi),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,encoding:this.colorSpace===it?ra:Oc,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),!t&&e.textures&&(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==wo)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ar:e.x=e.x-Math.floor(e.x);break;case ai:e.x=e.x<0?0:1;break;case bs:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Ar:e.y=e.y-Math.floor(e.y);break;case ai:e.y=e.y<0?0:1;break;case bs:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0,this.dispatchEvent({type:"update"}))}get encoding(){return xl("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===it?ra:Oc}set encoding(e){xl("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===ra?it:Xi}}Ti.DEFAULT_IMAGE=null,Ti.DEFAULT_MAPPING=wo,Ti.DEFAULT_ANISOTROPY=1;class bt{constructor(e=0,t=0,i=0,n=1){bt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,s=this.w,a=e.elements;return this.x=a[0]*t+a[4]*i+a[8]*n+a[12]*s,this.y=a[1]*t+a[5]*i+a[9]*n+a[13]*s,this.z=a[2]*t+a[6]*i+a[10]*n+a[14]*s,this.w=a[3]*t+a[7]*i+a[11]*n+a[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,n,s;const a=e.elements,o=a[0],l=a[4],c=a[8],h=a[1],d=a[5],m=a[9],f=a[2],v=a[6],w=a[10];if(Math.abs(l-h)<.01&&Math.abs(c-f)<.01&&Math.abs(m-v)<.01){if(Math.abs(l+h)<.1&&Math.abs(c+f)<.1&&Math.abs(m+v)<.1&&Math.abs(o+d+w-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const y=(o+1)/2,E=(d+1)/2,_=(w+1)/2,C=(l+h)/4,M=(c+f)/4,S=(m+v)/4;return y>E&&y>_?y<.01?(i=0,n=.707106781,s=.707106781):(i=Math.sqrt(y),n=C/i,s=M/i):E>_?E<.01?(i=.707106781,n=0,s=.707106781):(n=Math.sqrt(E),i=C/n,s=S/n):_<.01?(i=.707106781,n=.707106781,s=0):(s=Math.sqrt(_),i=M/s,n=S/s),this.set(i,n,s,t),this}let b=Math.sqrt((v-m)*(v-m)+(c-f)*(c-f)+(h-l)*(h-l));return Math.abs(b)<.001&&(b=1),this.x=(v-m)/b,this.y=(c-f)/b,this.z=(h-l)/b,this.w=Math.acos((o+d+w-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Gr extends zi{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new bt(0,0,e,t),this.scissorTest=!1,this.viewport=new bt(0,0,e,t);const n={width:e,height:t,depth:1};i.encoding!==void 0&&(xl("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),i.colorSpace=i.encoding===ra?it:Xi),this.texture=new Ti(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Et,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Zr(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Hc extends Ti{constructor(e=null,t=1,i=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=Ai,this.minFilter=Ai,this.wrapR=ai,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Ga extends Gr{constructor(e=1,t=1,i=1){super(e,t),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new Hc(null,e,t,i),this.texture.isRenderTargetTexture=!0}}class Wc extends Ti{constructor(e=null,t=1,i=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=Ai,this.minFilter=Ai,this.wrapR=ai,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class hA extends Gr{constructor(e=1,t=1,i=1){super(e,t),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new Wc(null,e,t,i),this.texture.isRenderTargetTexture=!0}}class rm extends Gr{constructor(e=1,t=1,i=1,n={}){super(e,t,n),this.isWebGLMultipleRenderTargets=!0;const s=this.texture;this.texture=[];for(let a=0;a<i;a++)this.texture[a]=s.clone(),this.texture[a].isRenderTargetTexture=!0}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let n=0,s=this.texture.length;n<s;n++)this.texture[n].image.width=e,this.texture[n].image.height=t,this.texture[n].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}class Ct{constructor(e=0,t=0,i=0,n=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=n}static slerpFlat(e,t,i,n,s,a,o){let l=i[n+0],c=i[n+1],h=i[n+2],d=i[n+3];const m=s[a+0],f=s[a+1],v=s[a+2],w=s[a+3];if(o===0){e[t+0]=l,e[t+1]=c,e[t+2]=h,e[t+3]=d;return}if(o===1){e[t+0]=m,e[t+1]=f,e[t+2]=v,e[t+3]=w;return}if(d!==w||l!==m||c!==f||h!==v){let b=1-o;const y=l*m+c*f+h*v+d*w,E=y>=0?1:-1,_=1-y*y;if(_>Number.EPSILON){const M=Math.sqrt(_),S=Math.atan2(M,y*E);b=Math.sin(b*S)/M,o=Math.sin(o*S)/M}const C=o*E;if(l=l*b+m*C,c=c*b+f*C,h=h*b+v*C,d=d*b+w*C,b===1-o){const M=1/Math.sqrt(l*l+c*c+h*h+d*d);l*=M,c*=M,h*=M,d*=M}}e[t]=l,e[t+1]=c,e[t+2]=h,e[t+3]=d}static multiplyQuaternionsFlat(e,t,i,n,s,a){const o=i[n],l=i[n+1],c=i[n+2],h=i[n+3],d=s[a],m=s[a+1],f=s[a+2],v=s[a+3];return e[t]=o*v+h*d+l*f-c*m,e[t+1]=l*v+h*m+c*d-o*f,e[t+2]=c*v+h*f+o*m-l*d,e[t+3]=h*v-o*d-l*m-c*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const i=e._x,n=e._y,s=e._z,a=e._order,o=Math.cos,l=Math.sin,c=o(i/2),h=o(n/2),d=o(s/2),m=l(i/2),f=l(n/2),v=l(s/2);switch(a){case"XYZ":this._x=m*h*d+c*f*v,this._y=c*f*d-m*h*v,this._z=c*h*v+m*f*d,this._w=c*h*d-m*f*v;break;case"YXZ":this._x=m*h*d+c*f*v,this._y=c*f*d-m*h*v,this._z=c*h*v-m*f*d,this._w=c*h*d+m*f*v;break;case"ZXY":this._x=m*h*d-c*f*v,this._y=c*f*d+m*h*v,this._z=c*h*v+m*f*d,this._w=c*h*d-m*f*v;break;case"ZYX":this._x=m*h*d-c*f*v,this._y=c*f*d+m*h*v,this._z=c*h*v-m*f*d,this._w=c*h*d+m*f*v;break;case"YZX":this._x=m*h*d+c*f*v,this._y=c*f*d+m*h*v,this._z=c*h*v-m*f*d,this._w=c*h*d-m*f*v;break;case"XZY":this._x=m*h*d-c*f*v,this._y=c*f*d-m*h*v,this._z=c*h*v+m*f*d,this._w=c*h*d+m*f*v;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],n=t[4],s=t[8],a=t[1],o=t[5],l=t[9],c=t[2],h=t[6],d=t[10],m=i+o+d;if(m>0){const f=.5/Math.sqrt(m+1);this._w=.25/f,this._x=(h-l)*f,this._y=(s-c)*f,this._z=(a-n)*f}else if(i>o&&i>d){const f=2*Math.sqrt(1+i-o-d);this._w=(h-l)/f,this._x=.25*f,this._y=(n+a)/f,this._z=(s+c)/f}else if(o>d){const f=2*Math.sqrt(1+o-i-d);this._w=(s-c)/f,this._x=(n+a)/f,this._y=.25*f,this._z=(l+h)/f}else{const f=2*Math.sqrt(1+d-i-o);this._w=(a-n)/f,this._x=(s+c)/f,this._y=(l+h)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ki(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,n=e._y,s=e._z,a=e._w,o=t._x,l=t._y,c=t._z,h=t._w;return this._x=i*h+a*o+n*c-s*l,this._y=n*h+a*l+s*o-i*c,this._z=s*h+a*c+i*l-n*o,this._w=a*h-i*o-n*l-s*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,n=this._y,s=this._z,a=this._w;let o=a*e._w+i*e._x+n*e._y+s*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=i,this._y=n,this._z=s,this;const l=1-o*o;if(l<=Number.EPSILON){const f=1-t;return this._w=f*a+t*this._w,this._x=f*i+t*this._x,this._y=f*n+t*this._y,this._z=f*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),h=Math.atan2(c,o),d=Math.sin((1-t)*h)/c,m=Math.sin(t*h)/c;return this._w=a*d+this._w*m,this._x=i*d+this._x*m,this._y=n*d+this._y*m,this._z=s*d+this._z*m,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),n=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(n),i*Math.sin(s),i*Math.cos(s),t*Math.sin(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class P{constructor(e=0,t=0,i=0){P.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(nm.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(nm.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,n=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*n,this.y=s[1]*t+s[4]*i+s[7]*n,this.z=s[2]*t+s[5]*i+s[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,s=e.elements,a=1/(s[3]*t+s[7]*i+s[11]*n+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*n+s[12])*a,this.y=(s[1]*t+s[5]*i+s[9]*n+s[13])*a,this.z=(s[2]*t+s[6]*i+s[10]*n+s[14])*a,this}applyQuaternion(e){const t=this.x,i=this.y,n=this.z,s=e.x,a=e.y,o=e.z,l=e.w,c=l*t+a*n-o*i,h=l*i+o*t-s*n,d=l*n+s*i-a*t,m=-s*t-a*i-o*n;return this.x=c*l+m*-s+h*-o-d*-a,this.y=h*l+m*-a+d*-s-c*-o,this.z=d*l+m*-o+c*-a-h*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,n=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*n,this.y=s[1]*t+s[5]*i+s[9]*n,this.z=s[2]*t+s[6]*i+s[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,n=e.y,s=e.z,a=t.x,o=t.y,l=t.z;return this.x=n*l-s*o,this.y=s*a-i*l,this.z=i*o-n*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return Vu.copy(this).projectOnVector(e),this.sub(Vu)}reflect(e){return this.sub(Vu.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(ki(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Vu=new P,nm=new Ct;class Yi{constructor(e=new P(1/0,1/0,1/0),t=new P(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(Ss.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(Ss.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Ss.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){if(e.updateWorldMatrix(!1,!1),e.boundingBox!==void 0)e.boundingBox===null&&e.computeBoundingBox(),Ts.copy(e.boundingBox),Ts.applyMatrix4(e.matrixWorld),this.union(Ts);else{const n=e.geometry;if(n!==void 0)if(t&&n.attributes!==void 0&&n.attributes.position!==void 0){const s=n.attributes.position;for(let a=0,o=s.count;a<o;a++)Ss.fromBufferAttribute(s,a).applyMatrix4(e.matrixWorld),this.expandByPoint(Ss)}else n.boundingBox===null&&n.computeBoundingBox(),Ts.copy(n.boundingBox),Ts.applyMatrix4(e.matrixWorld),this.union(Ts)}const i=e.children;for(let n=0,s=i.length;n<s;n++)this.expandByObject(i[n],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Ss),Ss.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Tn),Xc.subVectors(this.max,Tn),ko.subVectors(e.a,Tn),Fo.subVectors(e.b,Tn),za.subVectors(e.c,Tn),la.subVectors(Fo,ko),zn.subVectors(za,Fo),kt.subVectors(ko,za);let t=[0,-la.z,la.y,0,-zn.z,zn.y,0,-kt.z,kt.y,la.z,0,-la.x,zn.z,0,-zn.x,kt.z,0,-kt.x,-la.y,la.x,0,-zn.y,zn.x,0,-kt.y,kt.x,0];return!Ps(t,ko,Fo,za,Xc)||(t=[1,0,0,0,1,0,0,0,1],!Ps(t,ko,Fo,za,Xc))?!1:(qc.crossVectors(la,zn),t=[qc.x,qc.y,qc.z],Ps(t,ko,Fo,za,Xc))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Ss).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Ss).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(is[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),is[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),is[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),is[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),is[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),is[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),is[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),is[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(is),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const is=[new P,new P,new P,new P,new P,new P,new P,new P],Ss=new P,Ts=new Yi,ko=new P,Fo=new P,za=new P,la=new P,zn=new P,kt=new P,Tn=new P,Xc=new P,qc=new P,Is=new P;function Ps(r,e,t,i,n){for(let s=0,a=r.length-3;s<=a;s+=3){Is.fromArray(r,s);const o=n.x*Math.abs(Is.x)+n.y*Math.abs(Is.y)+n.z*Math.abs(Is.z),l=e.dot(Is),c=t.dot(Is),h=i.dot(Is);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>o)return!1}return!0}const Qa=new Yi,Ml=new P,$r=new P;class zr{constructor(e=new P,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):Qa.setFromPoints(e).getCenter(i);let n=0;for(let s=0,a=e.length;s<a;s++)n=Math.max(n,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Ml.subVectors(e,this.center);const t=Ml.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),n=(i-this.radius)*.5;this.center.addScaledVector(Ml,n/i),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):($r.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Ml.copy(e.center).add($r)),this.expandByPoint(Ml.copy(e.center).sub($r))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const rs=new P,Yc=new P,Sl=new P,Rs=new P,Kc=new P,Tl=new P,Jc=new P;class Va{constructor(e=new P,t=new P(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,rs)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=rs.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(rs.copy(this.origin).addScaledVector(this.direction,t),rs.distanceToSquared(e))}distanceSqToSegment(e,t,i,n){Yc.copy(e).add(t).multiplyScalar(.5),Sl.copy(t).sub(e).normalize(),Rs.copy(this.origin).sub(Yc);const s=e.distanceTo(t)*.5,a=-this.direction.dot(Sl),o=Rs.dot(this.direction),l=-Rs.dot(Sl),c=Rs.lengthSq(),h=Math.abs(1-a*a);let d,m,f,v;if(h>0)if(d=a*l-o,m=a*o-l,v=s*h,d>=0)if(m>=-v)if(m<=v){const w=1/h;d*=w,m*=w,f=d*(d+a*m+2*o)+m*(a*d+m+2*l)+c}else m=s,d=Math.max(0,-(a*m+o)),f=-d*d+m*(m+2*l)+c;else m=-s,d=Math.max(0,-(a*m+o)),f=-d*d+m*(m+2*l)+c;else m<=-v?(d=Math.max(0,-(-a*s+o)),m=d>0?-s:Math.min(Math.max(-s,-l),s),f=-d*d+m*(m+2*l)+c):m<=v?(d=0,m=Math.min(Math.max(-s,-l),s),f=m*(m+2*l)+c):(d=Math.max(0,-(a*s+o)),m=d>0?s:Math.min(Math.max(-s,-l),s),f=-d*d+m*(m+2*l)+c);else m=a>0?-s:s,d=Math.max(0,-(a*m+o)),f=-d*d+m*(m+2*l)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,d),n&&n.copy(Yc).addScaledVector(Sl,m),f}intersectSphere(e,t){rs.subVectors(e.center,this.origin);const i=rs.dot(this.direction),n=rs.dot(rs)-i*i,s=e.radius*e.radius;if(n>s)return null;const a=Math.sqrt(s-n),o=i-a,l=i+a;return l<0?null:o<0?this.at(l,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,n,s,a,o,l;const c=1/this.direction.x,h=1/this.direction.y,d=1/this.direction.z,m=this.origin;return c>=0?(i=(e.min.x-m.x)*c,n=(e.max.x-m.x)*c):(i=(e.max.x-m.x)*c,n=(e.min.x-m.x)*c),h>=0?(s=(e.min.y-m.y)*h,a=(e.max.y-m.y)*h):(s=(e.max.y-m.y)*h,a=(e.min.y-m.y)*h),i>a||s>n||((s>i||isNaN(i))&&(i=s),(a<n||isNaN(n))&&(n=a),d>=0?(o=(e.min.z-m.z)*d,l=(e.max.z-m.z)*d):(o=(e.max.z-m.z)*d,l=(e.min.z-m.z)*d),i>l||o>n)||((o>i||i!==i)&&(i=o),(l<n||n!==n)&&(n=l),n<0)?null:this.at(i>=0?i:n,t)}intersectsBox(e){return this.intersectBox(e,rs)!==null}intersectTriangle(e,t,i,n,s){Kc.subVectors(t,e),Tl.subVectors(i,e),Jc.crossVectors(Kc,Tl);let a=this.direction.dot(Jc),o;if(a>0){if(n)return null;o=1}else if(a<0)o=-1,a=-a;else return null;Rs.subVectors(this.origin,e);const l=o*this.direction.dot(Tl.crossVectors(Rs,Tl));if(l<0)return null;const c=o*this.direction.dot(Kc.cross(Rs));if(c<0||l+c>a)return null;const h=-o*Rs.dot(Jc);return h<0?null:this.at(h/a,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class et{constructor(e,t,i,n,s,a,o,l,c,h,d,m,f,v,w,b){et.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,n,s,a,o,l,c,h,d,m,f,v,w,b)}set(e,t,i,n,s,a,o,l,c,h,d,m,f,v,w,b){const y=this.elements;return y[0]=e,y[4]=t,y[8]=i,y[12]=n,y[1]=s,y[5]=a,y[9]=o,y[13]=l,y[2]=c,y[6]=h,y[10]=d,y[14]=m,y[3]=f,y[7]=v,y[11]=w,y[15]=b,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new et().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,n=1/ja.setFromMatrixColumn(e,0).length(),s=1/ja.setFromMatrixColumn(e,1).length(),a=1/ja.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*a,t[9]=i[9]*a,t[10]=i[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,n=e.y,s=e.z,a=Math.cos(i),o=Math.sin(i),l=Math.cos(n),c=Math.sin(n),h=Math.cos(s),d=Math.sin(s);if(e.order==="XYZ"){const m=a*h,f=a*d,v=o*h,w=o*d;t[0]=l*h,t[4]=-l*d,t[8]=c,t[1]=f+v*c,t[5]=m-w*c,t[9]=-o*l,t[2]=w-m*c,t[6]=v+f*c,t[10]=a*l}else if(e.order==="YXZ"){const m=l*h,f=l*d,v=c*h,w=c*d;t[0]=m+w*o,t[4]=v*o-f,t[8]=a*c,t[1]=a*d,t[5]=a*h,t[9]=-o,t[2]=f*o-v,t[6]=w+m*o,t[10]=a*l}else if(e.order==="ZXY"){const m=l*h,f=l*d,v=c*h,w=c*d;t[0]=m-w*o,t[4]=-a*d,t[8]=v+f*o,t[1]=f+v*o,t[5]=a*h,t[9]=w-m*o,t[2]=-a*c,t[6]=o,t[10]=a*l}else if(e.order==="ZYX"){const m=a*h,f=a*d,v=o*h,w=o*d;t[0]=l*h,t[4]=v*c-f,t[8]=m*c+w,t[1]=l*d,t[5]=w*c+m,t[9]=f*c-v,t[2]=-c,t[6]=o*l,t[10]=a*l}else if(e.order==="YZX"){const m=a*l,f=a*c,v=o*l,w=o*c;t[0]=l*h,t[4]=w-m*d,t[8]=v*d+f,t[1]=d,t[5]=a*h,t[9]=-o*h,t[2]=-c*h,t[6]=f*d+v,t[10]=m-w*d}else if(e.order==="XZY"){const m=a*l,f=a*c,v=o*l,w=o*c;t[0]=l*h,t[4]=-d,t[8]=c*h,t[1]=m*d+w,t[5]=a*h,t[9]=f*d-v,t[2]=v*d-f,t[6]=o*h,t[10]=w*d+m}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(sm,e,uA)}lookAt(e,t,i){const n=this.elements;return en.subVectors(e,t),en.lengthSq()===0&&(en.z=1),en.normalize(),Ds.crossVectors(i,en),Ds.lengthSq()===0&&(Math.abs(i.z)===1?en.x+=1e-4:en.z+=1e-4,en.normalize(),Ds.crossVectors(i,en)),Ds.normalize(),Il.crossVectors(en,Ds),n[0]=Ds.x,n[4]=Il.x,n[8]=en.x,n[1]=Ds.y,n[5]=Il.y,n[9]=en.y,n[2]=Ds.z,n[6]=Il.z,n[10]=en.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,s=this.elements,a=i[0],o=i[4],l=i[8],c=i[12],h=i[1],d=i[5],m=i[9],f=i[13],v=i[2],w=i[6],b=i[10],y=i[14],E=i[3],_=i[7],C=i[11],M=i[15],S=n[0],R=n[4],U=n[8],T=n[12],B=n[1],Q=n[5],Z=n[9],q=n[13],X=n[2],te=n[6],me=n[10],se=n[14],he=n[3],_e=n[7],ge=n[11],Oe=n[15];return s[0]=a*S+o*B+l*X+c*he,s[4]=a*R+o*Q+l*te+c*_e,s[8]=a*U+o*Z+l*me+c*ge,s[12]=a*T+o*q+l*se+c*Oe,s[1]=h*S+d*B+m*X+f*he,s[5]=h*R+d*Q+m*te+f*_e,s[9]=h*U+d*Z+m*me+f*ge,s[13]=h*T+d*q+m*se+f*Oe,s[2]=v*S+w*B+b*X+y*he,s[6]=v*R+w*Q+b*te+y*_e,s[10]=v*U+w*Z+b*me+y*ge,s[14]=v*T+w*q+b*se+y*Oe,s[3]=E*S+_*B+C*X+M*he,s[7]=E*R+_*Q+C*te+M*_e,s[11]=E*U+_*Z+C*me+M*ge,s[15]=E*T+_*q+C*se+M*Oe,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],n=e[8],s=e[12],a=e[1],o=e[5],l=e[9],c=e[13],h=e[2],d=e[6],m=e[10],f=e[14],v=e[3],w=e[7],b=e[11],y=e[15];return v*(+s*l*d-n*c*d-s*o*m+i*c*m+n*o*f-i*l*f)+w*(+t*l*f-t*c*m+s*a*m-n*a*f+n*c*h-s*l*h)+b*(+t*c*d-t*o*f-s*a*d+i*a*f+s*o*h-i*c*h)+y*(-n*o*h-t*l*d+t*o*m+n*a*d-i*a*m+i*l*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],l=e[6],c=e[7],h=e[8],d=e[9],m=e[10],f=e[11],v=e[12],w=e[13],b=e[14],y=e[15],E=d*b*c-w*m*c+w*l*f-o*b*f-d*l*y+o*m*y,_=v*m*c-h*b*c-v*l*f+a*b*f+h*l*y-a*m*y,C=h*w*c-v*d*c+v*o*f-a*w*f-h*o*y+a*d*y,M=v*d*l-h*w*l-v*o*m+a*w*m+h*o*b-a*d*b,S=t*E+i*_+n*C+s*M;if(S===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const R=1/S;return e[0]=E*R,e[1]=(w*m*s-d*b*s-w*n*f+i*b*f+d*n*y-i*m*y)*R,e[2]=(o*b*s-w*l*s+w*n*c-i*b*c-o*n*y+i*l*y)*R,e[3]=(d*l*s-o*m*s-d*n*c+i*m*c+o*n*f-i*l*f)*R,e[4]=_*R,e[5]=(h*b*s-v*m*s+v*n*f-t*b*f-h*n*y+t*m*y)*R,e[6]=(v*l*s-a*b*s-v*n*c+t*b*c+a*n*y-t*l*y)*R,e[7]=(a*m*s-h*l*s+h*n*c-t*m*c-a*n*f+t*l*f)*R,e[8]=C*R,e[9]=(v*d*s-h*w*s-v*i*f+t*w*f+h*i*y-t*d*y)*R,e[10]=(a*w*s-v*o*s+v*i*c-t*w*c-a*i*y+t*o*y)*R,e[11]=(h*o*s-a*d*s-h*i*c+t*d*c+a*i*f-t*o*f)*R,e[12]=M*R,e[13]=(h*w*n-v*d*n+v*i*m-t*w*m-h*i*b+t*d*b)*R,e[14]=(v*o*n-a*w*n-v*i*l+t*w*l+a*i*b-t*o*b)*R,e[15]=(a*d*n-h*o*n+h*i*l-t*d*l-a*i*m+t*o*m)*R,this}scale(e){const t=this.elements,i=e.x,n=e.y,s=e.z;return t[0]*=i,t[4]*=n,t[8]*=s,t[1]*=i,t[5]*=n,t[9]*=s,t[2]*=i,t[6]*=n,t[10]*=s,t[3]*=i,t[7]*=n,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),n=Math.sin(t),s=1-i,a=e.x,o=e.y,l=e.z,c=s*a,h=s*o;return this.set(c*a+i,c*o-n*l,c*l+n*o,0,c*o+n*l,h*o+i,h*l-n*a,0,c*l-n*o,h*l+n*a,s*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,n,s,a){return this.set(1,i,s,0,e,1,a,0,t,n,1,0,0,0,0,1),this}compose(e,t,i){const n=this.elements,s=t._x,a=t._y,o=t._z,l=t._w,c=s+s,h=a+a,d=o+o,m=s*c,f=s*h,v=s*d,w=a*h,b=a*d,y=o*d,E=l*c,_=l*h,C=l*d,M=i.x,S=i.y,R=i.z;return n[0]=(1-(w+y))*M,n[1]=(f+C)*M,n[2]=(v-_)*M,n[3]=0,n[4]=(f-C)*S,n[5]=(1-(m+y))*S,n[6]=(b+E)*S,n[7]=0,n[8]=(v+_)*R,n[9]=(b-E)*R,n[10]=(1-(m+w))*R,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){const n=this.elements;let s=ja.set(n[0],n[1],n[2]).length();const a=ja.set(n[4],n[5],n[6]).length(),o=ja.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),e.x=n[12],e.y=n[13],e.z=n[14],Qn.copy(this);const l=1/s,c=1/a,h=1/o;return Qn.elements[0]*=l,Qn.elements[1]*=l,Qn.elements[2]*=l,Qn.elements[4]*=c,Qn.elements[5]*=c,Qn.elements[6]*=c,Qn.elements[8]*=h,Qn.elements[9]*=h,Qn.elements[10]*=h,t.setFromRotationMatrix(Qn),i.x=s,i.y=a,i.z=o,this}makePerspective(e,t,i,n,s,a,o=Es){const l=this.elements,c=2*s/(t-e),h=2*s/(i-n),d=(t+e)/(t-e),m=(i+n)/(i-n);let f,v;if(o===Es)f=-(a+s)/(a-s),v=-2*a*s/(a-s);else if(o===Fc)f=-a/(a-s),v=-a*s/(a-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return l[0]=c,l[4]=0,l[8]=d,l[12]=0,l[1]=0,l[5]=h,l[9]=m,l[13]=0,l[2]=0,l[6]=0,l[10]=f,l[14]=v,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,i,n,s,a,o=Es){const l=this.elements,c=1/(t-e),h=1/(i-n),d=1/(a-s),m=(t+e)*c,f=(i+n)*h;let v,w;if(o===Es)v=(a+s)*d,w=-2*d;else if(o===Fc)v=s*d,w=-1*d;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-m,l[1]=0,l[5]=2*h,l[9]=0,l[13]=-f,l[2]=0,l[6]=0,l[10]=w,l[14]=-v,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let n=0;n<16;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const ja=new P,Qn=new et,sm=new P(0,0,0),uA=new P(1,1,1),Ds=new P,Il=new P,en=new P,ju=new et,am=new Ct;class Di{constructor(e=0,t=0,i=0,n=Di.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,n=this._order){return this._x=e,this._y=t,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const n=e.elements,s=n[0],a=n[4],o=n[8],l=n[1],c=n[5],h=n[9],d=n[2],m=n[6],f=n[10];switch(t){case"XYZ":this._y=Math.asin(ki(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,f),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(m,c),this._z=0);break;case"YXZ":this._x=Math.asin(-ki(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(o,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,s),this._z=0);break;case"ZXY":this._x=Math.asin(ki(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(-d,f),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-ki(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(m,f),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(ki(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-d,s)):(this._x=0,this._y=Math.atan2(o,f));break;case"XZY":this._z=Math.asin(-ki(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(m,c),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-h,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return ju.makeRotationFromQuaternion(e),this.setFromRotationMatrix(ju,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return am.setFromEuler(this),this.setFromQuaternion(am,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Di.DEFAULT_ORDER="XYZ";class No{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let om=0;const lm=new P,ca=new Ct,ns=new et,Pl=new P,Ha=new P,cm=new P,pA=new Ct,Rl=new P(1,0,0),hm=new P(0,1,0),um=new P(0,0,1),dA={type:"added"},Hu={type:"removed"};class It extends zi{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:om++}),this.uuid=dn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=It.DEFAULT_UP.clone();const e=new P,t=new Di,i=new Ct,n=new P(1,1,1);function s(){i.setFromEuler(t,!1)}function a(){t.setFromQuaternion(i,void 0,!1)}t._onChange(s),i._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new et},normalMatrix:{value:new Bt}}),this.matrix=new et,this.matrixWorld=new et,this.matrixAutoUpdate=It.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=It.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new No,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(e,t,i,n,s,a){this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:i,geometry:n,material:s,group:a})}onAfterRender(e,t,i,n,s,a){this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:i,geometry:n,material:s,group:a})}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return ca.setFromAxisAngle(e,t),this.quaternion.multiply(ca),this}rotateOnWorldAxis(e,t){return ca.setFromAxisAngle(e,t),this.quaternion.premultiply(ca),this}rotateX(e){return this.rotateOnAxis(Rl,e)}rotateY(e){return this.rotateOnAxis(hm,e)}rotateZ(e){return this.rotateOnAxis(um,e)}translateOnAxis(e,t){return lm.copy(e).applyQuaternion(this.quaternion),this.position.add(lm.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Rl,e)}translateY(e){return this.translateOnAxis(hm,e)}translateZ(e){return this.translateOnAxis(um,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(ns.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Pl.copy(e):Pl.set(e,t,i);const n=this.parent;this.updateWorldMatrix(!0,!1),Ha.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ns.lookAt(Ha,Pl,this.up):ns.lookAt(Pl,Ha,this.up),this.quaternion.setFromRotationMatrix(ns),n&&(ns.extractRotation(n.matrixWorld),ca.setFromRotationMatrix(ns),this.quaternion.premultiply(ca.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(dA)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Hu)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(Hu)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),ns.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),ns.multiply(e.parent.matrixWorld)),e.applyMatrix4(ns),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){const s=this.children[i].getObjectByProperty(e,t);if(s!==void 0)return s}}getObjectsByProperty(e,t){let i=[];this[e]===t&&i.push(this);for(let n=0,s=this.children.length;n<s;n++){const a=this.children[n].getObjectsByProperty(e,t);a.length>0&&(i=i.concat(a))}return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ha,e,cm),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ha,pA,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,n=t.length;i<n;i++){const s=t[i];(s.matrixWorldAutoUpdate===!0||e===!0)&&s.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const n=this.children;for(let s=0,a=n.length;s<a;s++){const o=n[s];o.matrixWorldAutoUpdate===!0&&o.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{},extras:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON()));function s(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=s(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let c=0,h=l.length;c<h;c++){const d=l[c];s(e.shapes,d)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,c=this.material.length;l<c;l++)o.push(s(e.materials,this.material[l]));n.material=o}else n.material=s(e.materials,this.material);if(this.children.length>0){n.children=[];for(let o=0;o<this.children.length;o++)n.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];n.animations.push(s(e.animations,l))}}if(t){const o=a(e.geometries),l=a(e.materials),c=a(e.textures),h=a(e.images),d=a(e.shapes),m=a(e.skeletons),f=a(e.animations),v=a(e.nodes);o.length>0&&(i.geometries=o),l.length>0&&(i.materials=l),c.length>0&&(i.textures=c),h.length>0&&(i.images=h),d.length>0&&(i.shapes=d),m.length>0&&(i.skeletons=m),f.length>0&&(i.animations=f),v.length>0&&(i.nodes=v)}return i.object=n,i;function a(o){const l=[];for(const c in o){const h=o[c];delete h.metadata,l.push(h)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations,this.userData={};for(const[i,n]of Object.entries(e.userData))this.userData[i]=!n||n&&(n.isTexture||n.isObject3D)?n:JSON.parse(JSON.stringify(n));if(t===!0)for(let i=0;i<e.children.length;i++){const n=e.children[i];this.add(n.clone())}return this}}It.DEFAULT_UP=new P(0,1,0),It.DEFAULT_MATRIX_AUTO_UPDATE=!0,It.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const In=new P,Bs=new P,Wu=new P,Vn=new P,ss=new P,Go=new P,pm=new P,ha=new P,Xu=new P,qu=new P;let Zc=!1;class tn{constructor(e=new P,t=new P,i=new P){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,n){n.subVectors(i,t),In.subVectors(e,t),n.cross(In);const s=n.lengthSq();return s>0?n.multiplyScalar(1/Math.sqrt(s)):n.set(0,0,0)}static getBarycoord(e,t,i,n,s){In.subVectors(n,t),Bs.subVectors(i,t),Wu.subVectors(e,t);const a=In.dot(In),o=In.dot(Bs),l=In.dot(Wu),c=Bs.dot(Bs),h=Bs.dot(Wu),d=a*c-o*o;if(d===0)return s.set(-2,-1,-1);const m=1/d,f=(c*l-o*h)*m,v=(a*h-o*l)*m;return s.set(1-f-v,v,f)}static containsPoint(e,t,i,n){return this.getBarycoord(e,t,i,n,Vn),Vn.x>=0&&Vn.y>=0&&Vn.x+Vn.y<=1}static getUV(e,t,i,n,s,a,o,l){return Zc===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Zc=!0),this.getInterpolation(e,t,i,n,s,a,o,l)}static getInterpolation(e,t,i,n,s,a,o,l){return this.getBarycoord(e,t,i,n,Vn),l.setScalar(0),l.addScaledVector(s,Vn.x),l.addScaledVector(a,Vn.y),l.addScaledVector(o,Vn.z),l}static isFrontFacing(e,t,i,n){return In.subVectors(i,t),Bs.subVectors(e,t),In.cross(Bs).dot(n)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,t,i,n){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return In.subVectors(this.c,this.b),Bs.subVectors(this.a,this.b),In.cross(Bs).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return tn.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return tn.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,n,s){return Zc===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Zc=!0),tn.getInterpolation(e,this.a,this.b,this.c,t,i,n,s)}getInterpolation(e,t,i,n,s){return tn.getInterpolation(e,this.a,this.b,this.c,t,i,n,s)}containsPoint(e){return tn.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return tn.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,n=this.b,s=this.c;let a,o;ss.subVectors(n,i),Go.subVectors(s,i),ha.subVectors(e,i);const l=ss.dot(ha),c=Go.dot(ha);if(l<=0&&c<=0)return t.copy(i);Xu.subVectors(e,n);const h=ss.dot(Xu),d=Go.dot(Xu);if(h>=0&&d<=h)return t.copy(n);const m=l*d-h*c;if(m<=0&&l>=0&&h<=0)return a=l/(l-h),t.copy(i).addScaledVector(ss,a);qu.subVectors(e,s);const f=ss.dot(qu),v=Go.dot(qu);if(v>=0&&f<=v)return t.copy(s);const w=f*c-l*v;if(w<=0&&c>=0&&v<=0)return o=c/(c-v),t.copy(i).addScaledVector(Go,o);const b=h*v-f*d;if(b<=0&&d-h>=0&&f-v>=0)return pm.subVectors(s,n),o=(d-h)/(d-h+(f-v)),t.copy(n).addScaledVector(pm,o);const y=1/(b+w+m);return a=w*y,o=m*y,t.copy(i).addScaledVector(ss,a).addScaledVector(Go,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Yu=0;class Ki extends zi{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Yu++}),this.uuid=dn(),this.name="",this.type="Material",this.blending=ii,this.side=Ie,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Fn,this.blendDst=Ic,this.blendEquation=Da,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=gl,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Ro,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=na,this.stencilZFail=na,this.stencilZPass=na,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onAfterRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const n=this[t];n!==void 0&&(n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):Array.isArray(i)&&n&&typeof n.fromArray=="function"?n.fromArray(i):this[t]=i)}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==ii&&(i.blending=this.blending),this.side!==Ie&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(i.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function n(s){const a=[];for(const o in s){const l=s[o];delete l.metadata,a.push(l)}return a}if(t){const s=n(e.textures),a=n(e.images);s.length>0&&(i.textures=s),a.length>0&&(i.images=a)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const n=t.length;i=new Array(n);for(let s=0;s!==n;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=$c({},e.userData),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}function $c(r,e){if(!e)return r;for(const t of Object.keys(e)){if(t.startsWith("__")||typeof r[t]=="function"||typeof e[t]=="function")continue;const i=e[t],n=!i||i.isTexture||i.isObject3D||i.isMaterial;!n&&typeof e[t].clone=="function"?r[t]=e[t].clone():!n&&(typeof e[t]=="object"||Array.isArray(e[t]))?r[t]=$c(Array.isArray(e[t])?[]:{},e[t]):r[t]=e[t]}return r}const dm={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},jn={h:0,s:0,l:0},zo={h:0,s:0,l:0};function eh(r,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?r+(e-r)*6*t:t<1/2?e:t<2/3?r+(e-r)*6*(2/3-t):r}class fe{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const n=e;n&&n.isColor?this.copy(n):typeof n=="number"?this.setHex(n):typeof n=="string"&&this.setStyle(n)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=it){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,cr.toWorkingColorSpace(this,t),this}setRGB(e,t,i,n=cr.workingColorSpace){return this.r=e,this.g=t,this.b=i,cr.toWorkingColorSpace(this,n),this}setHSL(e,t,i,n=cr.workingColorSpace){if(e=Nu(e,1),t=ki(t,0,1),i=ki(i,0,1),t===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+t):i+t-i*t,a=2*i-s;this.r=eh(a,s,e+1/3),this.g=eh(a,s,e),this.b=eh(a,s,e-1/3)}return cr.toWorkingColorSpace(this,n),this}setStyle(e,t=it){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const a=n[1],o=n[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=n[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(a===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=it){const i=dm[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Oo(e.r),this.g=Oo(e.g),this.b=Oo(e.b),this}copyLinearToSRGB(e){return this.r=El(e.r),this.g=El(e.g),this.b=El(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=it){return cr.fromWorkingColorSpace(Lr.copy(this),e),Math.round(ki(Lr.r*255,0,255))*65536+Math.round(ki(Lr.g*255,0,255))*256+Math.round(ki(Lr.b*255,0,255))}getHexString(e=it){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=cr.workingColorSpace){cr.fromWorkingColorSpace(Lr.copy(this),t);const i=Lr.r,n=Lr.g,s=Lr.b,a=Math.max(i,n,s),o=Math.min(i,n,s);let l,c;const h=(o+a)/2;if(o===a)l=0,c=0;else{const d=a-o;switch(c=h<=.5?d/(a+o):d/(2-a-o),a){case i:l=(n-s)/d+(n<s?6:0);break;case n:l=(s-i)/d+2;break;case s:l=(i-n)/d+4;break}l/=6}return e.h=l,e.s=c,e.l=h,e}getRGB(e,t=cr.workingColorSpace){return cr.fromWorkingColorSpace(Lr.copy(this),t),e.r=Lr.r,e.g=Lr.g,e.b=Lr.b,e}getStyle(e=it){cr.fromWorkingColorSpace(Lr.copy(this),e);const t=Lr.r,i=Lr.g,n=Lr.b;return e!==it?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(n*255)})`}offsetHSL(e,t,i){return this.getHSL(jn),jn.h+=e,jn.s+=t,jn.l+=i,this.setHSL(jn.h,jn.s,jn.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(jn),e.getHSL(zo);const i=Bo(jn.h,zo.h,t),n=Bo(jn.s,zo.s,t),s=Bo(jn.l,zo.l,t);return this.setHSL(i,n,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,n=this.b,s=e.elements;return this.r=s[0]*t+s[3]*i+s[6]*n,this.g=s[1]*t+s[4]*i+s[7]*n,this.b=s[2]*t+s[5]*i+s[8]*n,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Lr=new fe;fe.NAMES=dm;class Pn extends Ki{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new fe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=vs,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Hn=mA();function mA(){const r=new ArrayBuffer(4),e=new Float32Array(r),t=new Uint32Array(r),i=new Uint32Array(512),n=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(i[l]=0,i[l|256]=32768,n[l]=24,n[l|256]=24):c<-14?(i[l]=1024>>-c-14,i[l|256]=1024>>-c-14|32768,n[l]=-c-1,n[l|256]=-c-1):c<=15?(i[l]=c+15<<10,i[l|256]=c+15<<10|32768,n[l]=13,n[l|256]=13):c<128?(i[l]=31744,i[l|256]=64512,n[l]=24,n[l|256]=24):(i[l]=31744,i[l|256]=64512,n[l]=13,n[l|256]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,h=0;for(;!(c&8388608);)c<<=1,h-=8388608;c&=-8388609,h+=947912704,s[l]=c|h}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:e,uint32View:t,baseTable:i,shiftTable:n,mantissaTable:s,exponentTable:a,offsetTable:o}}function rn(r){Math.abs(r)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),r=ki(r,-65504,65504),Hn.floatView[0]=r;const e=Hn.uint32View[0],t=e>>23&511;return Hn.baseTable[t]+((e&8388607)>>Hn.shiftTable[t])}function Wa(r){const e=r>>10;return Hn.uint32View[0]=Hn.mantissaTable[Hn.offsetTable[e]+(r&1023)]+Hn.exponentTable[e],Hn.floatView[0]}const Ur={toHalfFloat:rn,fromHalfFloat:Wa},ir=new P,th=new ne;class At{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=kc,this.updateRange={offset:0,count:-1},this.gpuType=qt,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[e+n]=t.array[i+n];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)th.fromBufferAttribute(this,t),th.applyMatrix3(e),this.setXY(t,th.x,th.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)ir.fromBufferAttribute(this,t),ir.applyMatrix3(e),this.setXYZ(t,ir.x,ir.y,ir.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)ir.fromBufferAttribute(this,t),ir.applyMatrix4(e),this.setXYZ(t,ir.x,ir.y,ir.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)ir.fromBufferAttribute(this,t),ir.applyNormalMatrix(e),this.setXYZ(t,ir.x,ir.y,ir.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)ir.fromBufferAttribute(this,t),ir.transformDirection(e),this.setXYZ(t,ir.x,ir.y,ir.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Jr(t,this.array)),t}setX(e,t){return this.normalized&&(t=Gt(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Jr(t,this.array)),t}setY(e,t){return this.normalized&&(t=Gt(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Jr(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Gt(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Jr(t,this.array)),t}setW(e,t){return this.normalized&&(t=Gt(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Gt(t,this.array),i=Gt(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,n){return e*=this.itemSize,this.normalized&&(t=Gt(t,this.array),i=Gt(i,this.array),n=Gt(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this}setXYZW(e,t,i,n,s){return e*=this.itemSize,this.normalized&&(t=Gt(t,this.array),i=Gt(i,this.array),n=Gt(n,this.array),s=Gt(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==kc&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class fA extends At{constructor(e,t,i){super(new Int8Array(e),t,i)}}class gA extends At{constructor(e,t,i){super(new Uint8Array(e),t,i)}}class AA extends At{constructor(e,t,i){super(new Uint8ClampedArray(e),t,i)}}class vA extends At{constructor(e,t,i){super(new Int16Array(e),t,i)}}class ih extends At{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class yA extends At{constructor(e,t,i){super(new Int32Array(e),t,i)}}class Ku extends At{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class _A extends At{constructor(e,t,i){super(new Uint16Array(e),t,i),this.isFloat16BufferAttribute=!0}getX(e){let t=Wa(this.array[e*this.itemSize]);return this.normalized&&(t=Jr(t,this.array)),t}setX(e,t){return this.normalized&&(t=Gt(t,this.array)),this.array[e*this.itemSize]=rn(t),this}getY(e){let t=Wa(this.array[e*this.itemSize+1]);return this.normalized&&(t=Jr(t,this.array)),t}setY(e,t){return this.normalized&&(t=Gt(t,this.array)),this.array[e*this.itemSize+1]=rn(t),this}getZ(e){let t=Wa(this.array[e*this.itemSize+2]);return this.normalized&&(t=Jr(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Gt(t,this.array)),this.array[e*this.itemSize+2]=rn(t),this}getW(e){let t=Wa(this.array[e*this.itemSize+3]);return this.normalized&&(t=Jr(t,this.array)),t}setW(e,t){return this.normalized&&(t=Gt(t,this.array)),this.array[e*this.itemSize+3]=rn(t),this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Gt(t,this.array),i=Gt(i,this.array)),this.array[e+0]=rn(t),this.array[e+1]=rn(i),this}setXYZ(e,t,i,n){return e*=this.itemSize,this.normalized&&(t=Gt(t,this.array),i=Gt(i,this.array),n=Gt(n,this.array)),this.array[e+0]=rn(t),this.array[e+1]=rn(i),this.array[e+2]=rn(n),this}setXYZW(e,t,i,n,s){return e*=this.itemSize,this.normalized&&(t=Gt(t,this.array),i=Gt(i,this.array),n=Gt(n,this.array),s=Gt(s,this.array)),this.array[e+0]=rn(t),this.array[e+1]=rn(i),this.array[e+2]=rn(n),this.array[e+3]=rn(s),this}}class Ne extends At{constructor(e,t,i){super(new Float32Array(e),t,i)}}class bA extends At{constructor(e,t,i){super(new Float64Array(e),t,i)}}let wA=0;const Rn=new et,Ju=new It,Xa=new P,mn=new Yi,Dl=new Yi,vr=new P;class ht extends zi{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:wA++}),this.uuid=dn(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(zu(e)?Ku:ih)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const s=new Bt().getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(e),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Rn.makeRotationFromQuaternion(e),this.applyMatrix4(Rn),this}rotateX(e){return Rn.makeRotationX(e),this.applyMatrix4(Rn),this}rotateY(e){return Rn.makeRotationY(e),this.applyMatrix4(Rn),this}rotateZ(e){return Rn.makeRotationZ(e),this.applyMatrix4(Rn),this}translate(e,t,i){return Rn.makeTranslation(e,t,i),this.applyMatrix4(Rn),this}scale(e,t,i){return Rn.makeScale(e,t,i),this.applyMatrix4(Rn),this}lookAt(e){return Ju.lookAt(e),Ju.updateMatrix(),this.applyMatrix4(Ju.matrix),this}center(e=void 0){return this.computeBoundingBox(),this.boundingBox.getCenter(Xa).negate(),this.translate(Xa.x,Xa.y,Xa.z),e&&e.copy(Xa),this}setFromPoints(e){const t=[];for(let i=0,n=e.length;i<n;i++){const s=e[i];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new Ne(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Yi);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new P(-1/0,-1/0,-1/0),new P(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,n=t.length;i<n;i++){const s=t[i];mn.setFromBufferAttribute(s),this.morphTargetsRelative?(vr.addVectors(this.boundingBox.min,mn.min),this.boundingBox.expandByPoint(vr),vr.addVectors(this.boundingBox.max,mn.max),this.boundingBox.expandByPoint(vr)):(this.boundingBox.expandByPoint(mn.min),this.boundingBox.expandByPoint(mn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new zr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new P,1/0);return}if(e){const i=this.boundingSphere.center;if(mn.setFromBufferAttribute(e),t)for(let s=0,a=t.length;s<a;s++){const o=t[s];Dl.setFromBufferAttribute(o),this.morphTargetsRelative?(vr.addVectors(mn.min,Dl.min),mn.expandByPoint(vr),vr.addVectors(mn.max,Dl.max),mn.expandByPoint(vr)):(mn.expandByPoint(Dl.min),mn.expandByPoint(Dl.max))}mn.getCenter(i);let n=0;for(let s=0,a=e.count;s<a;s++)vr.fromBufferAttribute(e,s),n=Math.max(n,i.distanceToSquared(vr));if(t)for(let s=0,a=t.length;s<a;s++){const o=t[s],l=this.morphTargetsRelative;for(let c=0,h=o.count;c<h;c++)vr.fromBufferAttribute(o,c),l&&(Xa.fromBufferAttribute(e,c),vr.add(Xa)),n=Math.max(n,i.distanceToSquared(vr))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=e.array,n=t.position.array,s=t.normal.array,a=t.uv.array,o=n.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new At(new Float32Array(4*o),4));const l=this.getAttribute("tangent").array,c=[],h=[];for(let B=0;B<o;B++)c[B]=new P,h[B]=new P;const d=new P,m=new P,f=new P,v=new ne,w=new ne,b=new ne,y=new P,E=new P;function _(B,Q,Z){d.fromArray(n,B*3),m.fromArray(n,Q*3),f.fromArray(n,Z*3),v.fromArray(a,B*2),w.fromArray(a,Q*2),b.fromArray(a,Z*2),m.sub(d),f.sub(d),w.sub(v),b.sub(v);const q=1/(w.x*b.y-b.x*w.y);isFinite(q)&&(y.copy(m).multiplyScalar(b.y).addScaledVector(f,-w.y).multiplyScalar(q),E.copy(f).multiplyScalar(w.x).addScaledVector(m,-b.x).multiplyScalar(q),c[B].add(y),c[Q].add(y),c[Z].add(y),h[B].add(E),h[Q].add(E),h[Z].add(E))}let C=this.groups;C.length===0&&(C=[{start:0,count:i.length}]);for(let B=0,Q=C.length;B<Q;++B){const Z=C[B],q=Z.start,X=Z.count;for(let te=q,me=q+X;te<me;te+=3)_(i[te+0],i[te+1],i[te+2])}const M=new P,S=new P,R=new P,U=new P;function T(B){R.fromArray(s,B*3),U.copy(R);const Q=c[B];M.copy(Q),M.sub(R.multiplyScalar(R.dot(Q))).normalize(),S.crossVectors(U,Q);const Z=S.dot(h[B])<0?-1:1;l[B*4]=M.x,l[B*4+1]=M.y,l[B*4+2]=M.z,l[B*4+3]=Z}for(let B=0,Q=C.length;B<Q;++B){const Z=C[B],q=Z.start,X=Z.count;for(let te=q,me=q+X;te<me;te+=3)T(i[te+0]),T(i[te+1]),T(i[te+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new At(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let m=0,f=i.count;m<f;m++)i.setXYZ(m,0,0,0);const n=new P,s=new P,a=new P,o=new P,l=new P,c=new P,h=new P,d=new P;if(e)for(let m=0,f=e.count;m<f;m+=3){const v=e.getX(m+0),w=e.getX(m+1),b=e.getX(m+2);n.fromBufferAttribute(t,v),s.fromBufferAttribute(t,w),a.fromBufferAttribute(t,b),h.subVectors(a,s),d.subVectors(n,s),h.cross(d),o.fromBufferAttribute(i,v),l.fromBufferAttribute(i,w),c.fromBufferAttribute(i,b),o.add(h),l.add(h),c.add(h),i.setXYZ(v,o.x,o.y,o.z),i.setXYZ(w,l.x,l.y,l.z),i.setXYZ(b,c.x,c.y,c.z)}else for(let m=0,f=t.count;m<f;m+=3)n.fromBufferAttribute(t,m+0),s.fromBufferAttribute(t,m+1),a.fromBufferAttribute(t,m+2),h.subVectors(a,s),d.subVectors(n,s),h.cross(d),i.setXYZ(m+0,h.x,h.y,h.z),i.setXYZ(m+1,h.x,h.y,h.z),i.setXYZ(m+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)vr.fromBufferAttribute(e,t),vr.normalize(),e.setXYZ(t,vr.x,vr.y,vr.z)}toNonIndexed(){function e(o,l){const c=o.array,h=o.itemSize,d=o.normalized,m=new c.constructor(l.length*h);let f=0,v=0;for(let w=0,b=l.length;w<b;w++){o.isInterleavedBufferAttribute?f=l[w]*o.data.stride+o.offset:f=l[w]*h;for(let y=0;y<h;y++)m[v++]=c[f++]}return new At(m,h,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new ht,i=this.index.array,n=this.attributes;for(const o in n){const l=n[o],c=e(l,i);t.setAttribute(o,c)}const s=this.morphAttributes;for(const o in s){const l=[],c=s[o];for(let h=0,d=c.length;h<d;h++){const m=c[h],f=e(m,i);l.push(f)}t.morphAttributes[o]=l}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,l=a.length;o<l;o++){const c=a[o];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const c=i[l];e.data.attributes[l]=c.toJSON(e.data)}const n={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],h=[];for(let d=0,m=c.length;d<m;d++){const f=c[d];h.push(f.toJSON(e.data))}h.length>0&&(n[l]=h,s=!0)}s&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const n=e.attributes;for(const c in n){const h=n[c];this.setAttribute(c,h.clone(t))}const s=e.morphAttributes;for(const c in s){const h=[],d=s[c];for(let m=0,f=d.length;m<f;m++)h.push(d[m].clone(t));this.morphAttributes[c]=h}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let c=0,h=a.length;c<h;c++){const d=a[c];this.addGroup(d.start,d.count,d.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Zu=new et,qa=new Va,rh=new zr,nh=new P,Ya=new P,Ka=new P,Qo=new P,$u=new P,sh=new P,Wn=new ne,Bl=new ne,Ls=new ne,mm=new P,Us=new P,fm=new P,Ll=new P,ah=new P;class Fe extends It{constructor(e=new ht,t=new Pn){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.isMesh?(e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this):this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,s=i.length;n<s;n++){const a=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=n}}}}getVertexPosition(e,t){const i=this.geometry,n=i.attributes.position,s=i.morphAttributes.position,a=i.morphTargetsRelative;t.fromBufferAttribute(n,e);const o=this.morphTargetInfluences;if(s&&o){sh.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const h=o[l],d=s[l];h!==0&&($u.fromBufferAttribute(d,e),a?sh.addScaledVector($u,h):sh.addScaledVector($u.sub(t),h))}t.add(sh)}return t}raycast(e,t){const i=this.geometry,n=this.material,s=this.matrixWorld;n!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),rh.copy(i.boundingSphere),rh.applyMatrix4(s),qa.copy(e.ray).recast(e.near),!(rh.containsPoint(qa.origin)===!1&&(qa.intersectSphere(rh,nh)===null||qa.origin.distanceToSquared(nh)>(e.far-e.near)**2))&&(Zu.copy(s).invert(),qa.copy(e.ray).applyMatrix4(Zu),!(i.boundingBox!==null&&qa.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,qa)))}_computeIntersections(e,t,i){let n;const s=this.geometry,a=this.material,o=s.index,l=s.attributes.position,c=s.attributes.uv,h=s.attributes.uv1,d=s.attributes.normal,m=s.groups,f=s.drawRange;if(o!==null)if(Array.isArray(a))for(let v=0,w=m.length;v<w;v++){const b=m[v],y=a[b.materialIndex],E=Math.max(b.start,f.start),_=Math.min(o.count,Math.min(b.start+b.count,f.start+f.count));for(let C=E,M=_;C<M;C+=3){const S=o.getX(C),R=o.getX(C+1),U=o.getX(C+2);n=Ul(this,y,e,i,c,h,d,S,R,U),n&&(n.faceIndex=Math.floor(C/3),n.face.materialIndex=b.materialIndex,t.push(n))}}else{const v=Math.max(0,f.start),w=Math.min(o.count,f.start+f.count);for(let b=v,y=w;b<y;b+=3){const E=o.getX(b),_=o.getX(b+1),C=o.getX(b+2);n=Ul(this,a,e,i,c,h,d,E,_,C),n&&(n.faceIndex=Math.floor(b/3),t.push(n))}}else if(l!==void 0)if(Array.isArray(a))for(let v=0,w=m.length;v<w;v++){const b=m[v],y=a[b.materialIndex],E=Math.max(b.start,f.start),_=Math.min(l.count,Math.min(b.start+b.count,f.start+f.count));for(let C=E,M=_;C<M;C+=3){const S=C,R=C+1,U=C+2;n=Ul(this,y,e,i,c,h,d,S,R,U),n&&(n.faceIndex=Math.floor(C/3),n.face.materialIndex=b.materialIndex,t.push(n))}}else{const v=Math.max(0,f.start),w=Math.min(l.count,f.start+f.count);for(let b=v,y=w;b<y;b+=3){const E=b,_=b+1,C=b+2;n=Ul(this,a,e,i,c,h,d,E,_,C),n&&(n.faceIndex=Math.floor(b/3),t.push(n))}}}}function Vo(r,e,t,i,n,s,a,o){let l;if(e.side===$e?l=i.intersectTriangle(a,s,n,!0,o):l=i.intersectTriangle(n,s,a,e.side===Ie,o),l===null)return null;ah.copy(o),ah.applyMatrix4(r.matrixWorld);const c=t.ray.origin.distanceTo(ah);return c<t.near||c>t.far?null:{distance:c,point:ah.clone(),object:r}}function Ul(r,e,t,i,n,s,a,o,l,c){r.getVertexPosition(o,Ya),r.getVertexPosition(l,Ka),r.getVertexPosition(c,Qo);const h=Vo(r,e,t,i,Ya,Ka,Qo,Ll);if(h){n&&(Wn.fromBufferAttribute(n,o),Bl.fromBufferAttribute(n,l),Ls.fromBufferAttribute(n,c),h.uv=tn.getInterpolation(Ll,Ya,Ka,Qo,Wn,Bl,Ls,new ne)),s&&(Wn.fromBufferAttribute(s,o),Bl.fromBufferAttribute(s,l),Ls.fromBufferAttribute(s,c),h.uv1=tn.getInterpolation(Ll,Ya,Ka,Qo,Wn,Bl,Ls,new ne),h.uv2=h.uv1),a&&(mm.fromBufferAttribute(a,o),Us.fromBufferAttribute(a,l),fm.fromBufferAttribute(a,c),h.normal=tn.getInterpolation(Ll,Ya,Ka,Qo,mm,Us,fm,new P),h.normal.dot(i.direction)>0&&h.normal.multiplyScalar(-1));const d={a:o,b:l,c,normal:new P,materialIndex:0};tn.getNormal(Ya,Ka,Qo,d.normal),h.face=d}return h}class Bi extends ht{constructor(e=1,t=1,i=1,n=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:s,depthSegments:a};const o=this;n=Math.floor(n),s=Math.floor(s),a=Math.floor(a);const l=[],c=[],h=[],d=[];let m=0,f=0;v("z","y","x",-1,-1,i,t,e,a,s,0),v("z","y","x",1,-1,i,t,-e,a,s,1),v("x","z","y",1,1,e,i,t,n,a,2),v("x","z","y",1,-1,e,i,-t,n,a,3),v("x","y","z",1,-1,e,t,i,n,s,4),v("x","y","z",-1,-1,e,t,-i,n,s,5),this.setIndex(l),this.setAttribute("position",new Ne(c,3)),this.setAttribute("normal",new Ne(h,3)),this.setAttribute("uv",new Ne(d,2));function v(w,b,y,E,_,C,M,S,R,U,T){const B=C/R,Q=M/U,Z=C/2,q=M/2,X=S/2,te=R+1,me=U+1;let se=0,he=0;const _e=new P;for(let ge=0;ge<me;ge++){const Oe=ge*Q-q;for(let oe=0;oe<te;oe++){const be=oe*B-Z;_e[w]=be*E,_e[b]=Oe*_,_e[y]=X,c.push(_e.x,_e.y,_e.z),_e[w]=0,_e[b]=0,_e[y]=S>0?1:-1,h.push(_e.x,_e.y,_e.z),d.push(oe/R),d.push(1-ge/U),se+=1}}for(let ge=0;ge<U;ge++)for(let Oe=0;Oe<R;Oe++){const oe=m+Oe+te*ge,be=m+Oe+te*(ge+1),Me=m+(Oe+1)+te*(ge+1),Ve=m+(Oe+1)+te*ge;l.push(oe,be,Ve),l.push(be,Me,Ve),he+=6}o.addGroup(f,he,T),f+=he,m+=se}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Bi(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Ja(r){const e={};for(const t in r){e[t]={};for(const i in r[t]){const n=r[t][i];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?n.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=n.clone():Array.isArray(n)?e[t][i]=n.slice():e[t][i]=n}}return e}function Qr(r){const e={};for(let t=0;t<r.length;t++){const i=Ja(r[t]);for(const n in i)e[n]=i[n]}return e}function ep(r){const e=[];for(let t=0;t<r.length;t++)e.push(r[t].clone());return e}function gm(r){return r.getRenderTarget()===null?r.outputColorSpace:wi}const Dn={clone:Ja,merge:Qr};var Am=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,xA=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class yr extends Ki{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Am,this.fragmentShader=xA,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ja(e.uniforms),this.uniformsGroups=ep(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const s=this.uniforms[n].value;s&&s.isTexture?t.uniforms[n]={type:"t",value:s.toJSON(e).uuid}:s&&s.isColor?t.uniforms[n]={type:"c",value:s.getHex()}:s&&s.isVector2?t.uniforms[n]={type:"v2",value:s.toArray()}:s&&s.isVector3?t.uniforms[n]={type:"v3",value:s.toArray()}:s&&s.isVector4?t.uniforms[n]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?t.uniforms[n]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?t.uniforms[n]={type:"m4",value:s.toArray()}:t.uniforms[n]={value:s}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const n in this.extensions)this.extensions[n]===!0&&(i[n]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class Ol extends It{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new et,this.projectionMatrix=new et,this.projectionMatrixInverse=new et,this.coordinateSystem=Es}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class Qi extends Ol{constructor(e=50,t=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Do*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Na*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Do*2*Math.atan(Math.tan(Na*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,n,s,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Na*.5*this.fov)/this.zoom,i=2*t,n=this.aspect*i,s=-.5*n;const a=this.view;if(this.view!==null&&this.view.enabled){const l=a.fullWidth,c=a.fullHeight;s+=a.offsetX*n/l,t-=a.offsetY*i/c,n*=a.width/l,i*=a.height/c}const o=this.filmOffset;o!==0&&(s+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const jo=-90,Ho=1;class vm extends It{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null;const n=new Qi(jo,Ho,e,t);n.layers=this.layers,this.add(n);const s=new Qi(jo,Ho,e,t);s.layers=this.layers,this.add(s);const a=new Qi(jo,Ho,e,t);a.layers=this.layers,this.add(a);const o=new Qi(jo,Ho,e,t);o.layers=this.layers,this.add(o);const l=new Qi(jo,Ho,e,t);l.layers=this.layers,this.add(l);const c=new Qi(jo,Ho,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,n,s,a,o,l]=t;for(const c of t)this.remove(c);if(e===Es)i.up.set(0,1,0),i.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===Fc)i.up.set(0,-1,0),i.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const i=this.renderTarget;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[n,s,a,o,l,c]=this.children,h=e.getRenderTarget(),d=e.toneMapping,m=e.xr.enabled;e.toneMapping=$n,e.xr.enabled=!1;const f=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,n),e.setRenderTarget(i,1),e.render(t,s),e.setRenderTarget(i,2),e.render(t,a),e.setRenderTarget(i,3),e.render(t,o),e.setRenderTarget(i,4),e.render(t,l),i.texture.generateMipmaps=f,e.setRenderTarget(i,5),e.render(t,c),e.setRenderTarget(h),e.toneMapping=d,e.xr.enabled=m,i.texture.needsPMREMUpdate=!0}}class Os extends Ti{constructor(e,t,i,n,s,a,o,l,c,h){e=e!==void 0?e:[],t=t!==void 0?t:ys,super(e,t,i,n,s,a,o,l,c,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class oh extends Gr{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},n=[i,i,i,i,i,i];t.encoding!==void 0&&(xl("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===ra?it:Xi),this.texture=new Os(n,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Et}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new Bi(5,5,5),s=new yr({name:"CubemapFromEquirect",uniforms:Ja(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:$e,blending:Qt});s.uniforms.tEquirect.value=t;const a=new Fe(n,s),o=t.minFilter;return t.minFilter===Er&&(t.minFilter=Et),new vm(1,10,this).update(e,a),t.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,i,n){const s=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,i,n);e.setRenderTarget(s)}}const tp=new P,ip=new P,ym=new Bt;class ks{constructor(e=new P(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const n=tp.subVectors(i,t).cross(ip.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(tp),n=this.normal.dot(i);if(n===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:t.copy(e.start).addScaledVector(i,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||ym.getNormalMatrix(e),n=this.coplanarPoint(tp).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Fs=new zr,lh=new P;class Xn{constructor(e=new ks,t=new ks,i=new ks,n=new ks,s=new ks,a=new ks){this.planes=[e,t,i,n,s,a]}set(e,t,i,n,s,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(i),o[3].copy(n),o[4].copy(s),o[5].copy(a),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=Es){const i=this.planes,n=e.elements,s=n[0],a=n[1],o=n[2],l=n[3],c=n[4],h=n[5],d=n[6],m=n[7],f=n[8],v=n[9],w=n[10],b=n[11],y=n[12],E=n[13],_=n[14],C=n[15];if(i[0].setComponents(l-s,m-c,b-f,C-y).normalize(),i[1].setComponents(l+s,m+c,b+f,C+y).normalize(),i[2].setComponents(l+a,m+h,b+v,C+E).normalize(),i[3].setComponents(l-a,m-h,b-v,C-E).normalize(),i[4].setComponents(l-o,m-d,b-w,C-_).normalize(),t===Es)i[5].setComponents(l+o,m+d,b+w,C+_).normalize();else if(t===Fc)i[5].setComponents(o,d,w,_).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Fs.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Fs.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Fs)}intersectsSprite(e){return Fs.center.set(0,0,0),Fs.radius=.7071067811865476,Fs.applyMatrix4(e.matrixWorld),this.intersectsSphere(Fs)}intersectsSphere(e){const t=this.planes,i=e.center,n=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(i)<n)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const n=t[i];if(lh.x=n.normal.x>0?e.max.x:e.min.x,lh.y=n.normal.y>0?e.max.y:e.min.y,lh.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(lh)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function _m(){let r=null,e=!1,t=null,i=null;function n(s,a){t(s,a),i=r.requestAnimationFrame(n)}return{start:function(){e!==!0&&t!==null&&(i=r.requestAnimationFrame(n),e=!0)},stop:function(){r.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){r=s}}}function EA(r,e){const t=e.isWebGL2,i=new WeakMap;function n(c,h){const d=c.array,m=c.usage,f=r.createBuffer();r.bindBuffer(h,f),r.bufferData(h,d,m),c.onUploadCallback();let v;if(d instanceof Float32Array)v=r.FLOAT;else if(d instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(t)v=r.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else v=r.UNSIGNED_SHORT;else if(d instanceof Int16Array)v=r.SHORT;else if(d instanceof Uint32Array)v=r.UNSIGNED_INT;else if(d instanceof Int32Array)v=r.INT;else if(d instanceof Int8Array)v=r.BYTE;else if(d instanceof Uint8Array)v=r.UNSIGNED_BYTE;else if(d instanceof Uint8ClampedArray)v=r.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+d);return{buffer:f,type:v,bytesPerElement:d.BYTES_PER_ELEMENT,version:c.version}}function s(c,h,d){const m=h.array,f=h.updateRange;r.bindBuffer(d,c),f.count===-1?r.bufferSubData(d,0,m):(t?r.bufferSubData(d,f.offset*m.BYTES_PER_ELEMENT,m,f.offset,f.count):r.bufferSubData(d,f.offset*m.BYTES_PER_ELEMENT,m.subarray(f.offset,f.offset+f.count)),f.count=-1),h.onUploadCallback()}function a(c){return c.isInterleavedBufferAttribute&&(c=c.data),i.get(c)}function o(c){c.isInterleavedBufferAttribute&&(c=c.data);const h=i.get(c);h&&(r.deleteBuffer(h.buffer),i.delete(c))}function l(c,h){if(c.isGLBufferAttribute){const m=i.get(c);(!m||m.version<c.version)&&i.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const d=i.get(c);d===void 0?i.set(c,n(c,h)):d.version<c.version&&(s(d.buffer,c,h),d.version=c.version)}return{get:a,remove:o,update:l}}class as extends ht{constructor(e=1,t=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};const s=e/2,a=t/2,o=Math.floor(i),l=Math.floor(n),c=o+1,h=l+1,d=e/o,m=t/l,f=[],v=[],w=[],b=[];for(let y=0;y<h;y++){const E=y*m-a;for(let _=0;_<c;_++){const C=_*d-s;v.push(C,-E,0),w.push(0,0,1),b.push(_/o),b.push(1-y/l)}}for(let y=0;y<l;y++)for(let E=0;E<o;E++){const _=E+c*y,C=E+c*(y+1),M=E+1+c*(y+1),S=E+1+c*y;f.push(_,C,S),f.push(C,M,S)}this.setIndex(f),this.setAttribute("position",new Ne(v,3)),this.setAttribute("normal",new Ne(w,3)),this.setAttribute("uv",new Ne(b,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new as(e.width,e.height,e.widthSegments,e.heightSegments)}}var CA=`#ifdef USE_ALPHAMAP
	#if defined(INVERSE_ALPHAMAP) && INVERSE_ALPHAMAP >= 1
	diffuseColor.a *= 1.0-texture2D( alphaMap, vAlphaMapUv ).g;
	#else
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
	#endif
#endif`,MA=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,bm=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,SA=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,TA=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,IA=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,PA="vec3 transformed = vec3( position );",RA=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,DA=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,BA=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,LA=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,UA=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,Ns=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,OA=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,wm=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,kA=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,xm=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,FA=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,NA=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Em=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Cm=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Mm=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,GA=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,zA=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,QA=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,VA=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,jA="gl_FragColor = linearToOutputTexel( gl_FragColor );",HA=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}`,WA=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	reflectVec = transformDirection(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,XA=`#ifdef USE_ENVMAP
	mat4 rotationMatrix(vec3 axis, float angle) {
		axis = normalize(axis);
		float s = sin(angle);
		float c = cos(angle);
		float oc = 1.0 - c;
		return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,
					oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,
					oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,
					0.0,                                0.0,                                0.0,                                1.0);
	}
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform float envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,Sm=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,qA=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,YA=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,A=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,u=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,g=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,x=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,O=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,H=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,ce=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,We=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Mt=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,li=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,rr=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
		#if defined( FIX_ENV_DIRECTION )
			vec3 worldNormal = normal;
		#else
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#endif
			worldNormal = transformDirection(worldNormal, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			#if !defined( FIX_ENV_DIRECTION )
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			#endif
			reflectVec = transformDirection(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,Or=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Za=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,$a=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Wo=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,xS=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	anisotropyV /= material.anisotropy;
	material.anisotropy = saturate( material.anisotropy );
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;
#endif`,ES=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,CS=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,MS=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometry.viewDir, geometry.normal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,SS=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,TS=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,IS=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,PS=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,RS=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,DS=`#ifdef USE_MAP
	diffuseColor *= texture2D( map, vMapUv );
#endif`,BS=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,LS=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,US=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,OS=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,kS=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,FS=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,NS=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,GS=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,zS=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,QS=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal, vNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 geometryNormal = normal;`,VS=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,jS=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,HS=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,WS=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,XS=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,qS=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,YS=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,KS=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,JS=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,ZS=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
diffuseColor.a = min(max(diffuseColor.a, 0.), 1.);
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,$S=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,eT=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,tT=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,iT=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,rT=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,nT=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,sT=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,aT=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,oT=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,lT=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,cT=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,hT=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,uT=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,pT=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,dT=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,mT=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,fT=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,gT=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,AT=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,vT=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,yT=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	#ifndef WebGL2Context
	#define textureLod texture2DLodEXT
	#define textureSize(s, lod) vec2(1024./pow(2.,float(lod)),1024./pow(2.,float(lod)))
	#define isinf(x) (x > 1e20 || x < -1e20)
	#endif
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		if(roughness == 0.0) return transmissionSamplerMapTexelToLinear( texture2D( transmissionSamplerMap, fragCoord.xy ) );
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return transmissionSamplerMapTexelToLinear( textureBicubic( transmissionSamplerMap, fragCoord.xy, lod ) );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) || attenuationDistance == 0.0) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,_T=`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,bT=`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,wT=`#ifdef USE_UV
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,xT=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const Ft={alphamap_fragment:CA,alphamap_pars_fragment:MA,alphatest_fragment:bm,alphatest_pars_fragment:SA,aomap_fragment:TA,aomap_pars_fragment:IA,begin_vertex:PA,beginnormal_vertex:RA,bsdfs:DA,iridescence_fragment:BA,bumpmap_pars_fragment:LA,clipping_planes_fragment:UA,clipping_planes_pars_fragment:Ns,clipping_planes_pars_vertex:OA,clipping_planes_vertex:wm,color_fragment:kA,color_pars_fragment:xm,color_pars_vertex:FA,color_vertex:NA,common:Em,cube_uv_reflection_fragment:Cm,defaultnormal_vertex:Mm,displacementmap_pars_vertex:GA,displacementmap_vertex:zA,emissivemap_fragment:QA,emissivemap_pars_fragment:VA,encodings_fragment:jA,encodings_pars_fragment:HA,envmap_fragment:WA,envmap_common_pars_fragment:XA,envmap_pars_fragment:Sm,envmap_pars_vertex:qA,envmap_physical_pars_fragment:rr,envmap_vertex:YA,fog_vertex:A,fog_pars_vertex:u,fog_fragment:g,fog_pars_fragment:x,gradientmap_pars_fragment:O,lightmap_fragment:H,lightmap_pars_fragment:ce,lights_lambert_fragment:We,lights_lambert_pars_fragment:Mt,lights_pars_begin:li,lights_toon_fragment:Or,lights_toon_pars_fragment:Za,lights_phong_fragment:$a,lights_phong_pars_fragment:Wo,lights_physical_fragment:xS,lights_physical_pars_fragment:ES,lights_fragment_begin:CS,lights_fragment_maps:MS,lights_fragment_end:SS,logdepthbuf_fragment:TS,logdepthbuf_pars_fragment:IS,logdepthbuf_pars_vertex:PS,logdepthbuf_vertex:RS,map_fragment:DS,map_pars_fragment:BS,map_particle_fragment:LS,map_particle_pars_fragment:US,metalnessmap_fragment:OS,metalnessmap_pars_fragment:kS,morphcolor_vertex:FS,morphnormal_vertex:NS,morphtarget_pars_vertex:GS,morphtarget_vertex:zS,normal_fragment_begin:QS,normal_fragment_maps:VS,normal_pars_fragment:jS,normal_pars_vertex:HS,normal_vertex:WS,normalmap_pars_fragment:XS,clearcoat_normal_fragment_begin:qS,clearcoat_normal_fragment_maps:YS,clearcoat_pars_fragment:KS,iridescence_pars_fragment:JS,output_fragment:ZS,packing:$S,premultiplied_alpha_fragment:eT,project_vertex:tT,dithering_fragment:iT,dithering_pars_fragment:rT,roughnessmap_fragment:nT,roughnessmap_pars_fragment:sT,shadowmap_pars_fragment:aT,shadowmap_pars_vertex:oT,shadowmap_vertex:lT,shadowmask_pars_fragment:cT,skinbase_vertex:hT,skinning_pars_vertex:uT,skinning_vertex:pT,skinnormal_vertex:dT,specularmap_fragment:mT,specularmap_pars_fragment:fT,tonemapping_fragment:gT,tonemapping_pars_fragment:AT,transmission_fragment:vT,transmission_pars_fragment:yT,uv_pars_fragment:_T,uv_pars_vertex:bT,uv_vertex:wT,worldpos_vertex:xT,background_vert:`#ifdef HAS_TEXTURE
varying vec2 vUv;
uniform mat3 uvTransform;
uniform bool flipX;
uniform bool flipY;
#endif
void main() {
#ifdef HAS_TEXTURE
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
    vUv = flipX ? vec2( 1.0 - vUv.x, vUv.y ) : vUv;
    vUv = flipY ? vec2( vUv.x, 1.0 - vUv.y ) : vUv;
#endif
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`#ifdef HAS_TEXTURE
uniform sampler2D t2D;
varying vec2 vUv;
#endif
uniform float backgroundIntensity;
uniform vec3 backgroundColor;
void main() {
#ifdef HAS_TEXTURE
	vec4 texColor = texture2D( t2D, vUv );
#else
	vec4 texColor = vec4( 1.0 );
#endif
	texColor.rgb *= backgroundColor * backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,backgroundCube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,backgroundCube_frag:`#include <envmap_common_pars_fragment>
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
void main() {
	vec3 vReflect = vWorldDirection;
	vReflect = transformDirection(vReflect, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vReflect, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	texColor.rgb *= envMapIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`},qe={common:{diffuse:{value:new fe(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Bt},alphaMap:{value:null},alphaMapTransform:{value:new Bt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Bt}},envmap:{envMap:{value:null},envMapRotation:{value:0},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Bt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Bt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Bt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Bt},normalScale:{value:new ne(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Bt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Bt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Bt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Bt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new fe(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new fe(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Bt},alphaTest:{value:0},uvTransform:{value:new Bt}},sprite:{diffuse:{value:new fe(16777215)},opacity:{value:1},center:{value:new ne(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Bt},alphaMap:{value:null},alphaMapTransform:{value:new Bt},alphaTest:{value:0}}},Vi={basic:{uniforms:Qr([qe.common,qe.specularmap,qe.envmap,qe.aomap,qe.lightmap,qe.fog]),vertexShader:Ft.meshbasic_vert,fragmentShader:Ft.meshbasic_frag},lambert:{uniforms:Qr([qe.common,qe.specularmap,qe.envmap,qe.aomap,qe.lightmap,qe.emissivemap,qe.bumpmap,qe.normalmap,qe.displacementmap,qe.fog,qe.lights,{emissive:{value:new fe(0)}}]),vertexShader:Ft.meshlambert_vert,fragmentShader:Ft.meshlambert_frag},phong:{uniforms:Qr([qe.common,qe.specularmap,qe.envmap,qe.aomap,qe.lightmap,qe.emissivemap,qe.bumpmap,qe.normalmap,qe.displacementmap,qe.fog,qe.lights,{emissive:{value:new fe(0)},specular:{value:new fe(1118481)},shininess:{value:30}}]),vertexShader:Ft.meshphong_vert,fragmentShader:Ft.meshphong_frag},standard:{uniforms:Qr([qe.common,qe.envmap,qe.aomap,qe.lightmap,qe.emissivemap,qe.bumpmap,qe.normalmap,qe.displacementmap,qe.roughnessmap,qe.metalnessmap,qe.fog,qe.lights,{emissive:{value:new fe(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ft.meshphysical_vert,fragmentShader:Ft.meshphysical_frag},toon:{uniforms:Qr([qe.common,qe.aomap,qe.lightmap,qe.emissivemap,qe.bumpmap,qe.normalmap,qe.displacementmap,qe.gradientmap,qe.fog,qe.lights,{emissive:{value:new fe(0)}}]),vertexShader:Ft.meshtoon_vert,fragmentShader:Ft.meshtoon_frag},matcap:{uniforms:Qr([qe.common,qe.bumpmap,qe.normalmap,qe.displacementmap,qe.fog,{matcap:{value:null}}]),vertexShader:Ft.meshmatcap_vert,fragmentShader:Ft.meshmatcap_frag},points:{uniforms:Qr([qe.points,qe.fog]),vertexShader:Ft.points_vert,fragmentShader:Ft.points_frag},dashed:{uniforms:Qr([qe.common,qe.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ft.linedashed_vert,fragmentShader:Ft.linedashed_frag},depth:{uniforms:Qr([qe.common,qe.displacementmap]),vertexShader:Ft.depth_vert,fragmentShader:Ft.depth_frag},normal:{uniforms:Qr([qe.common,qe.bumpmap,qe.normalmap,qe.displacementmap,{opacity:{value:1}}]),vertexShader:Ft.meshnormal_vert,fragmentShader:Ft.meshnormal_frag},sprite:{uniforms:Qr([qe.sprite,qe.fog]),vertexShader:Ft.sprite_vert,fragmentShader:Ft.sprite_frag},background:{uniforms:{uvTransform:{value:new Bt},t2D:{value:null},backgroundIntensity:{value:1},backgroundColor:{value:new fe(16777215)},flipX:{value:!1},flipY:{value:!1}},vertexShader:Ft.background_vert,fragmentShader:Ft.background_frag},backgroundCube:{uniforms:{envMap:{value:null},envMapRotation:{value:0},envMapIntensity:{value:1},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Ft.backgroundCube_vert,fragmentShader:Ft.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ft.cube_vert,fragmentShader:Ft.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ft.equirect_vert,fragmentShader:Ft.equirect_frag},distanceRGBA:{uniforms:Qr([qe.common,qe.displacementmap,{referencePosition:{value:new P},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ft.distanceRGBA_vert,fragmentShader:Ft.distanceRGBA_frag},shadow:{uniforms:Qr([qe.lights,qe.fog,{color:{value:new fe(0)},opacity:{value:1}}]),vertexShader:Ft.shadow_vert,fragmentShader:Ft.shadow_frag}};Vi.physical={uniforms:Qr([Vi.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Bt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Bt},clearcoatNormalScale:{value:new ne(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Bt},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Bt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Bt},sheen:{value:0},sheenColor:{value:new fe(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Bt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Bt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Bt},transmissionSamplerSize:{value:new ne},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Bt},attenuationDistance:{value:0},attenuationColor:{value:new fe(0)},specularColor:{value:new fe(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Bt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Bt},anisotropyVector:{value:new ne},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Bt}}]),vertexShader:Ft.meshphysical_vert,fragmentShader:Ft.meshphysical_frag};const Tm={r:0,b:0,g:0};function ET(r,e,t,i,n,s,a){const o=new fe(0);let l=s===!0?0:1,c,h,d=null,m=0,f=null;function v(b,y){let E=!1,_=y.isScene===!0?y.background:null;const C=y.isScene&&y.backgroundColor!==void 0?y.backgroundColor:null;switch(_==="environment"&&(_=y.environment),_&&_.isTexture&&(_=(y.backgroundBlurriness>0?t:e).get(_)),_===null?w(o,l):_&&_.isColor&&(w(_,1),E=!0),r.xr.getEnvironmentBlendMode()){case"opaque":E=!0;break;case"additive":i.buffers.color.setClear(0,0,0,1,a),E=!0;break;case"alpha-blend":i.buffers.color.setClear(0,0,0,0,a),E=!0;break}if((r.autoClear||E)&&r.clear(r.autoClearColor,r.autoClearDepth,r.autoClearStencil),_&&(_.isCubeTexture||_.mapping===xo))h===void 0&&(h=new Fe(new Bi(1,1,1),new yr({name:"BackgroundCubeMaterial",uniforms:Ja(Vi.backgroundCube.uniforms),vertexShader:Vi.backgroundCube.vertexShader,fragmentShader:Vi.backgroundCube.fragmentShader,side:$e,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(M,S,R){this.matrixWorld.copyPosition(R.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(h)),h.material.uniforms.envMap.value=_,h.material.uniforms.envMapRotation.value=_&&_.rotation||0,h.material.uniforms.envMapIntensity.value=_===y.environment&&y.envMapIntensity||1,h.material.uniforms.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=y.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=y.backgroundIntensity,h.material.toneMapped=_.colorSpace!==it,(d!==_||m!==_.version||f!==r.toneMapping)&&(h.material.needsUpdate=!0,d=_,m=_.version,f=r.toneMapping),h.layers.enableAll(),b.unshift(h,h.geometry,h.material,0,0,null);else if(_&&_.isTexture||!_&&C){c===void 0&&(c=new Fe(new as(2,2),new yr({name:"BackgroundMaterial",uniforms:Ja(Vi.background.uniforms),vertexShader:Vi.background.vertexShader,fragmentShader:Vi.background.fragmentShader,side:Ie,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.backgroundColor.value.set(C||16777215),c.material.uniforms.t2D.value=_,c.material.uniforms.backgroundIntensity.value=y.backgroundIntensity,_?(c.material.toneMapped=_.colorSpace!==it,c.material.uniforms.flipX.value=_.userData.flipX||!1,c.material.uniforms.flipY.value=_.userData.flipY||!1,_.matrixAutoUpdate===!0&&_.updateMatrix(),c.material.uniforms.uvTransform.value.copy(_.matrix),c.material.defines.HAS_TEXTURE="1"):c.material.defines.HAS_TEXTURE&&delete c.material.defines.HAS_TEXTURE;const M=_?_.version:-1;(d!==_||m!==M||f!==r.toneMapping)&&(c.material.needsUpdate=!0,d=_,m=M,f=r.toneMapping),c.layers.enableAll(),b.unshift(c,c.geometry,c.material,0,0,null)}}function w(b,y){b.getRGB(Tm,gm(r)),i.buffers.color.setClear(Tm.r,Tm.g,Tm.b,y,a)}return{getClearColor:function(){return o},setClearColor:function(b,y=1){o.set(b),l=y,w(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(b){l=b,w(o,l)},getPlaneMesh:function(){return c},getBoxMesh:function(){return h},getBoxMesh2:function(){return h===void 0&&(h=new Fe(new Bi(1,1,1),new yr({name:"BackgroundCubeMaterial",uniforms:Ja(Vi.backgroundCube.uniforms),vertexShader:Vi.backgroundCube.vertexShader,fragmentShader:Vi.backgroundCube.fragmentShader,side:$e,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(b,y,E){this.matrixWorld.copyPosition(E.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(h)),h},render:v}}function CT(r,e,t,i){const n=r.getParameter(r.MAX_VERTEX_ATTRIBS),s=i.isWebGL2?null:e.get("OES_vertex_array_object"),a=i.isWebGL2||s!==null,o={},l=b(null);let c=l,h=!1;function d(X,te,me,se,he){let _e=!1;if(a){const ge=w(se,me,te);c!==ge&&(c=ge,f(c.object)),_e=y(X,se,me,he),_e&&E(X,se,me,he)}else{const ge=te.wireframe===!0;(c.geometry!==se.id||c.program!==me.id||c.wireframe!==ge)&&(c.geometry=se.id,c.program=me.id,c.wireframe=ge,_e=!0)}he!==null&&t.update(he,r.ELEMENT_ARRAY_BUFFER),(_e||h)&&(h=!1,U(X,te,me,se),he!==null&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.get(he).buffer))}function m(){return i.isWebGL2?r.createVertexArray():s.createVertexArrayOES()}function f(X){return i.isWebGL2?r.bindVertexArray(X):s.bindVertexArrayOES(X)}function v(X){return i.isWebGL2?r.deleteVertexArray(X):s.deleteVertexArrayOES(X)}function w(X,te,me){const se=me.wireframe===!0;let he=o[X.id];he===void 0&&(he={},o[X.id]=he);let _e=he[te.id];_e===void 0&&(_e={},he[te.id]=_e);let ge=_e[se];return ge===void 0&&(ge=b(m()),_e[se]=ge),ge}function b(X){const te=[],me=[],se=[];for(let he=0;he<n;he++)te[he]=0,me[he]=0,se[he]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:te,enabledAttributes:me,attributeDivisors:se,object:X,attributes:{},index:null}}function y(X,te,me,se){const he=c.attributes,_e=te.attributes;let ge=0;const Oe=me.getAttributes();for(const oe in Oe)if(Oe[oe].location>=0){const be=he[oe];let Me=_e[oe];if(Me===void 0&&(oe==="instanceMatrix"&&X.instanceMatrix&&(Me=X.instanceMatrix),oe==="instanceColor"&&X.instanceColor&&(Me=X.instanceColor)),be===void 0||be.attribute!==Me||Me&&be.data!==Me.data)return!0;ge++}return c.attributesNum!==ge||c.index!==se}function E(X,te,me,se){const he={},_e=te.attributes;let ge=0;const Oe=me.getAttributes();for(const oe in Oe)if(Oe[oe].location>=0){let be=_e[oe];be===void 0&&(oe==="instanceMatrix"&&X.instanceMatrix&&(be=X.instanceMatrix),oe==="instanceColor"&&X.instanceColor&&(be=X.instanceColor));const Me={};Me.attribute=be,be&&be.data&&(Me.data=be.data),he[oe]=Me,ge++}c.attributes=he,c.attributesNum=ge,c.index=se}function _(){const X=c.newAttributes;for(let te=0,me=X.length;te<me;te++)X[te]=0}function C(X){M(X,0)}function M(X,te){const me=c.newAttributes,se=c.enabledAttributes,he=c.attributeDivisors;me[X]=1,se[X]===0&&(r.enableVertexAttribArray(X),se[X]=1),he[X]!==te&&((i.isWebGL2?r:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](X,te),he[X]=te)}function S(){const X=c.newAttributes,te=c.enabledAttributes;for(let me=0,se=te.length;me<se;me++)te[me]!==X[me]&&(r.disableVertexAttribArray(me),te[me]=0)}function R(X,te,me,se,he,_e,ge){ge===!0?r.vertexAttribIPointer(X,te,me,he,_e):r.vertexAttribPointer(X,te,me,se,he,_e)}function U(X,te,me,se){if(i.isWebGL2===!1&&(X.isInstancedMesh||se.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;_();const he=se.attributes,_e=me.getAttributes(),ge=te.defaultAttributeValues;for(const Oe in _e){const oe=_e[Oe];if(oe.location>=0){let be=he[Oe];if(be===void 0&&(Oe==="instanceMatrix"&&X.instanceMatrix&&(be=X.instanceMatrix),Oe==="instanceColor"&&X.instanceColor&&(be=X.instanceColor)),be!==void 0){const Me=be.normalized,Ve=be.itemSize,Ue=t.get(be);if(Ue===void 0)continue;const rt=Ue.buffer,xt=Ue.type,mt=Ue.bytesPerElement,Dt=i.isWebGL2===!0&&(xt===r.INT||xt===r.UNSIGNED_INT||be.gpuType===vl);if(be.isInterleavedBufferAttribute){const we=be.data,Y=we.stride,je=be.offset;if(we.isInstancedInterleavedBuffer){for(let Pe=0;Pe<oe.locationSize;Pe++)M(oe.location+Pe,we.meshPerAttribute);X.isInstancedMesh!==!0&&se._maxInstanceCount===void 0&&(se._maxInstanceCount=we.meshPerAttribute*we.count)}else for(let Pe=0;Pe<oe.locationSize;Pe++)C(oe.location+Pe);r.bindBuffer(r.ARRAY_BUFFER,rt);for(let Pe=0;Pe<oe.locationSize;Pe++)R(oe.location+Pe,Ve/oe.locationSize,xt,Me,Y*mt,(je+Ve/oe.locationSize*Pe)*mt,Dt)}else{if(be.isInstancedBufferAttribute){for(let we=0;we<oe.locationSize;we++)M(oe.location+we,be.meshPerAttribute);X.isInstancedMesh!==!0&&se._maxInstanceCount===void 0&&(se._maxInstanceCount=be.meshPerAttribute*be.count)}else for(let we=0;we<oe.locationSize;we++)C(oe.location+we);r.bindBuffer(r.ARRAY_BUFFER,rt);for(let we=0;we<oe.locationSize;we++)R(oe.location+we,Ve/oe.locationSize,xt,Me,Ve*mt,Ve/oe.locationSize*we*mt,Dt)}}else if(ge!==void 0){const Me=ge[Oe];if(Me!==void 0)switch(Me.length){case 2:r.vertexAttrib2fv(oe.location,Me);break;case 3:r.vertexAttrib3fv(oe.location,Me);break;case 4:r.vertexAttrib4fv(oe.location,Me);break;default:r.vertexAttrib1fv(oe.location,Me)}}}}S()}function T(){Z();for(const X in o){const te=o[X];for(const me in te){const se=te[me];for(const he in se)v(se[he].object),delete se[he];delete te[me]}delete o[X]}}function B(X){if(o[X.id]===void 0)return;const te=o[X.id];for(const me in te){const se=te[me];for(const he in se)v(se[he].object),delete se[he];delete te[me]}delete o[X.id]}function Q(X){for(const te in o){const me=o[te];if(me[X.id]===void 0)continue;const se=me[X.id];for(const he in se)v(se[he].object),delete se[he];delete me[X.id]}}function Z(){q(),h=!0,c!==l&&(c=l,f(c.object))}function q(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:d,reset:Z,resetDefaultState:q,dispose:T,releaseStatesOfGeometry:B,releaseStatesOfProgram:Q,initAttributes:_,enableAttribute:C,disableUnusedAttributes:S}}function MT(r,e,t,i){const n=i.isWebGL2;let s;function a(c){s=c}function o(c,h){r.drawArrays(s,c,h),t.update(h,s,1)}function l(c,h,d){if(d===0)return;let m,f;if(n)m=r,f="drawArraysInstanced";else if(m=e.get("ANGLE_instanced_arrays"),f="drawArraysInstancedANGLE",m===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}m[f](s,c,h,d),t.update(h,s,d)}this.setMode=a,this.render=o,this.renderInstances=l}function ST(r,e,t){let i;function n(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const R=e.get("EXT_texture_filter_anisotropic");i=r.getParameter(R.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function s(R){if(R==="highp"){if(r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.HIGH_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT).precision>0)return"highp";R="mediump"}return R==="mediump"&&r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.MEDIUM_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const a=typeof WebGL2RenderingContext<"u"&&r.constructor.name==="WebGL2RenderingContext";let o=t.precision!==void 0?t.precision:"highp";const l=s(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);const c=a||e.has("WEBGL_draw_buffers"),h=t.logarithmicDepthBuffer===!0,d=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS),m=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS),f=r.getParameter(r.MAX_TEXTURE_SIZE),v=r.getParameter(r.MAX_CUBE_MAP_TEXTURE_SIZE),w=r.getParameter(r.MAX_VERTEX_ATTRIBS),b=r.getParameter(r.MAX_VERTEX_UNIFORM_VECTORS),y=r.getParameter(r.MAX_VARYING_VECTORS),E=r.getParameter(r.MAX_FRAGMENT_UNIFORM_VECTORS),_=m>0,C=a||e.has("OES_texture_float"),M=_&&C,S=a?r.getParameter(r.MAX_SAMPLES):0;return{isWebGL2:a,drawBuffers:c,getMaxAnisotropy:n,getMaxPrecision:s,precision:o,logarithmicDepthBuffer:h,maxTextures:d,maxVertexTextures:m,maxTextureSize:f,maxCubemapSize:v,maxAttributes:w,maxVertexUniforms:b,maxVaryings:y,maxFragmentUniforms:E,vertexTextures:_,floatFragmentTextures:C,floatVertexTextures:M,maxSamples:S}}function TT(r){const e=this;let t=null,i=0,n=!1,s=!1;const a=new ks,o=new Bt,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,m){const f=d.length!==0||m||i!==0||n;return n=m,i=d.length,f},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(d,m){t=h(d,m,0)},this.setState=function(d,m,f){const v=d.clippingPlanes,w=d.clipIntersection,b=d.clipShadows,y=r.get(d);if(!n||v===null||v.length===0||s&&!b)s?h(null):c();else{const E=s?0:i,_=E*4;let C=y.clippingState||null;l.value=C,C=h(v,m,_,f);for(let M=0;M!==_;++M)C[M]=t[M];y.clippingState=C,this.numIntersection=w?this.numPlanes:0,this.numPlanes+=E}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function h(d,m,f,v){const w=d!==null?d.length:0;let b=null;if(w!==0){if(b=l.value,v!==!0||b===null){const y=f+w*4,E=m.matrixWorldInverse;o.getNormalMatrix(E),(b===null||b.length<y)&&(b=new Float32Array(y));for(let _=0,C=f;_!==w;++_,C+=4)a.copy(d[_]).applyMatrix4(E,o),a.normal.toArray(b,C),b[C+3]=a.constant}l.value=b,l.needsUpdate=!0}return e.numPlanes=w,e.numIntersection=0,b}}function IT(r){let e=new WeakMap;function t(a,o){return o===_s?a.mapping=ys:o===ea&&(a.mapping=Ba),a}function i(a){if(a&&a.isTexture&&a.isRenderTargetTexture===!1){const o=a.mapping;if(o===_s||o===ea)if(e.has(a)){const l=e.get(a).texture;return l.rotation=a.rotation,t(l,a.mapping)}else{const l=a.image;if(l&&l.height>0){const c=new oh(l.height/2);return c.fromEquirectangularTexture(r,a),c.texture.rotation=a.rotation,e.set(a,c),a.addEventListener("dispose",n),t(c.texture,a.mapping)}else return null}}return a}function n(a){const o=a.target;o.removeEventListener("dispose",n);const l=e.get(o);l!==void 0&&(e.delete(o),l.dispose())}function s(){e=new WeakMap}return{get:i,dispose:s}}class ua extends Ol{constructor(e=-1,t=1,i=1,n=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,n,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=i-e,a=i+e,o=n+t,l=n-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,a=s+c*this.view.width,o-=h*this.view.offsetY,l=o-h*this.view.height}this.projectionMatrix.makeOrthographic(s,a,o,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const ch=4,k_=[.125,.215,.35,.446,.526,.582],kl=20,KA=new ua,F_=new fe;let JA=null;const Fl=(1+Math.sqrt(5))/2,hh=1/Fl,N_=[new P(1,1,1),new P(-1,1,1),new P(1,1,-1),new P(-1,1,-1),new P(0,Fl,hh),new P(0,Fl,-hh),new P(hh,0,Fl),new P(-hh,0,Fl),new P(Fl,hh,0),new P(-Fl,hh,0)];class ZA{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,n=100){JA=this._renderer.getRenderTarget(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,i,n,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Q_(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=z_(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(JA),e.scissorTest=!1,Im(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===ys||e.mapping===Ba?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),JA=this._renderer.getRenderTarget();const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Et,minFilter:Et,generateMipmaps:!1,type:di,format:mi,colorSpace:wi,depthBuffer:!1},n=G_(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=G_(e,t,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=PT(s)),this._blurMaterial=RT(s,e,t)}return n}_compileMaterial(e){const t=new Fe(this._lodPlanes[0],e);this._renderer.compile(t,KA)}_sceneToCubeUV(e,t,i,n){const s=new Qi(90,1,t,i),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],l=this._renderer,c=l.autoClear,h=l.toneMapping;l.getClearColor(F_),l.toneMapping=$n,l.autoClear=!1;const d=new Pn({name:"PMREM.Background",side:$e,depthWrite:!1,depthTest:!1}),m=new Fe(new Bi,d);let f=!1;const v=e.background;v?v.isColor&&(d.color.copy(v),e.background=null,f=!0):(d.color.copy(F_),f=!0);for(let w=0;w<6;w++){const b=w%3;b===0?(s.up.set(0,a[w],0),s.lookAt(o[w],0,0)):b===1?(s.up.set(0,0,a[w]),s.lookAt(0,o[w],0)):(s.up.set(0,a[w],0),s.lookAt(0,0,o[w]));const y=this._cubeSize;Im(n,b*y,w>2?y:0,y,y),l.setRenderTarget(n),f&&l.render(m,s),l.render(e,s)}m.geometry.dispose(),m.material.dispose(),l.toneMapping=h,l.autoClear=c,e.background=v}_textureToCubeUV(e,t){const i=this._renderer,n=e.mapping===ys||e.mapping===Ba;n?(this._cubemapMaterial===null&&(this._cubemapMaterial=Q_()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=z_());const s=n?this._cubemapMaterial:this._equirectMaterial,a=new Fe(this._lodPlanes[0],s),o=s.uniforms;o.envMap.value=e;const l=this._cubeSize;Im(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(a,KA)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let n=1;n<this._lodPlanes.length;n++){const s=Math.sqrt(this._sigmas[n]*this._sigmas[n]-this._sigmas[n-1]*this._sigmas[n-1]),a=N_[(n-1)%N_.length];this._blur(e,n-1,n,s,a)}t.autoClear=i}_blur(e,t,i,n,s){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,i,n,"latitudinal",s),this._halfBlur(a,e,i,i,n,"longitudinal",s)}_halfBlur(e,t,i,n,s,a,o){const l=this._renderer,c=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=3,d=new Fe(this._lodPlanes[n],c),m=c.uniforms,f=this._sizeLods[i]-1,v=isFinite(s)?Math.PI/(2*f):2*Math.PI/(2*kl-1),w=s/v,b=isFinite(s)?1+Math.floor(h*w):kl;b>kl&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${b} samples when the maximum is set to ${kl}`);const y=[];let E=0;for(let R=0;R<kl;++R){const U=R/w,T=Math.exp(-U*U/2);y.push(T),R===0?E+=T:R<b&&(E+=2*T)}for(let R=0;R<y.length;R++)y[R]=y[R]/E;m.envMap.value=e.texture,m.samples.value=b,m.weights.value=y,m.latitudinal.value=a==="latitudinal",o&&(m.poleAxis.value=o);const{_lodMax:_}=this;m.dTheta.value=v,m.mipInt.value=_-i;const C=this._sizeLods[n],M=3*C*(n>_-ch?n-_+ch:0),S=4*(this._cubeSize-C);Im(t,M,S,3*C,2*C),l.setRenderTarget(t),l.render(d,KA)}}function PT(r){const e=[],t=[],i=[];let n=r;const s=r-ch+1+k_.length;for(let a=0;a<s;a++){const o=Math.pow(2,n);t.push(o);let l=1/o;a>r-ch?l=k_[a-r+ch-1]:a===0&&(l=0),i.push(l);const c=1/(o-2),h=-c,d=1+c,m=[h,h,d,h,d,d,h,h,d,d,h,d],f=6,v=6,w=3,b=2,y=1,E=new Float32Array(w*v*f),_=new Float32Array(b*v*f),C=new Float32Array(y*v*f);for(let S=0;S<f;S++){const R=S%3*2/3-1,U=S>2?0:-1,T=[R,U,0,R+2/3,U,0,R+2/3,U+1,0,R,U,0,R+2/3,U+1,0,R,U+1,0];E.set(T,w*v*S),_.set(m,b*v*S);const B=[S,S,S,S,S,S];C.set(B,y*v*S)}const M=new ht;M.setAttribute("position",new At(E,w)),M.setAttribute("uv",new At(_,b)),M.setAttribute("faceIndex",new At(C,y)),e.push(M),n>ch&&n--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function G_(r,e,t){const i=new Gr(r,e,t);return i.texture.mapping=xo,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Im(r,e,t,i,n){r.viewport.set(e,t,i,n),r.scissor.set(e,t,i,n)}function RT(r,e,t){const i=new Float32Array(kl),n=new P(0,1,0);return new yr({name:"SphericalGaussianBlur",defines:{n:kl,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${r}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:$A(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Qt,depthTest:!1,depthWrite:!1})}function z_(){return new yr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:$A(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Qt,depthTest:!1,depthWrite:!1})}function Q_(){return new yr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:$A(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Qt,depthTest:!1,depthWrite:!1})}function $A(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function DT(r){let e=new WeakMap,t=null;function i(o){if(o&&o.isTexture){const l=o.mapping,c=l===_s||l===ea,h=l===ys||l===Ba;if(c||h)if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let d=e.get(o);return t===null&&(t=new ZA(r)),d=c?t.fromEquirectangular(o,d):t.fromCubemap(o,d),e.set(o,d),d.texture}else{if(e.has(o))return e.get(o).texture;{const d=o.image;if(c&&d&&d.height>0||h&&d&&n(d)){t===null&&(t=new ZA(r));const m=c?t.fromEquirectangular(o):t.fromCubemap(o);return e.set(o,m),o.addEventListener("dispose",s),m.texture}else return null}}}return o}function n(o){let l=0;const c=6;for(let h=0;h<c;h++)o[h]!==void 0&&l++;return l===c}function s(o){const l=o.target;l.removeEventListener("dispose",s);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function a(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:a}}function BT(r){const e={};function t(i){if(e[i]!==void 0)return e[i];let n;switch(i){case"WEBGL_depth_texture":n=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=r.getExtension(i)}return e[i]=n,n}return{has:function(i){return t(i)!==null},init:function(i){i.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(i){const n=t(i);return n===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),n}}}function LT(r,e,t,i){const n={},s=new WeakMap;function a(d){const m=d.target;m.index!==null&&e.remove(m.index);for(const v in m.attributes)e.remove(m.attributes[v]);for(const v in m.morphAttributes){const w=m.morphAttributes[v];for(let b=0,y=w.length;b<y;b++)e.remove(w[b])}m.removeEventListener("dispose",a),delete n[m.id];const f=s.get(m);f&&(e.remove(f),s.delete(m)),i.releaseStatesOfGeometry(m),m.isInstancedBufferGeometry===!0&&delete m._maxInstanceCount,t.memory.geometries--}function o(d,m){return n[m.id]===!0||(m.addEventListener("dispose",a),n[m.id]=!0,t.memory.geometries++),m}function l(d){const m=d.attributes;for(const v in m)e.update(m[v],r.ARRAY_BUFFER);const f=d.morphAttributes;for(const v in f){const w=f[v];for(let b=0,y=w.length;b<y;b++)e.update(w[b],r.ARRAY_BUFFER)}}function c(d){const m=[],f=d.index,v=d.attributes.position;let w=0;if(f!==null){const E=f.array;w=f.version;for(let _=0,C=E.length;_<C;_+=3){const M=E[_+0],S=E[_+1],R=E[_+2];m.push(M,S,S,R,R,M)}}else{const E=v.array;w=v.version;for(let _=0,C=E.length/3-1;_<C;_+=3){const M=_+0,S=_+1,R=_+2;m.push(M,S,S,R,R,M)}}const b=new(zu(m)?Ku:ih)(m,1);b.version=w;const y=s.get(d);y&&e.remove(y),s.set(d,b)}function h(d){const m=s.get(d);if(m){const f=d.index;f!==null&&m.version<f.version&&c(d)}else c(d);return s.get(d)}return{get:o,update:l,getWireframeAttribute:h}}function UT(r,e,t,i){const n=i.isWebGL2;let s;function a(m){s=m}let o,l;function c(m){o=m.type,l=m.bytesPerElement}function h(m,f){r.drawElements(s,f,o,m*l),t.update(f,s,1)}function d(m,f,v){if(v===0)return;let w,b;if(n)w=r,b="drawElementsInstanced";else if(w=e.get("ANGLE_instanced_arrays"),b="drawElementsInstancedANGLE",w===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}w[b](s,f,o,m*l,v),t.update(f,s,v)}this.setMode=a,this.setIndex=c,this.render=h,this.renderInstances=d}function OT(r){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(s,a,o){switch(t.calls++,a){case r.TRIANGLES:t.triangles+=o*(s/3);break;case r.LINES:t.lines+=o*(s/2);break;case r.LINE_STRIP:t.lines+=o*(s-1);break;case r.LINE_LOOP:t.lines+=o*s;break;case r.POINTS:t.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function n(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:n,update:i}}function kT(r,e){return r[0]-e[0]}function FT(r,e){return Math.abs(e[1])-Math.abs(r[1])}function NT(r,e,t){const i={},n=new Float32Array(8),s=new WeakMap,a=new bt,o=[];for(let c=0;c<8;c++)o[c]=[c,0];function l(c,h,d){const m=c.morphTargetInfluences;if(e.isWebGL2===!0){const f=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,v=f!==void 0?f.length:0;let w=s.get(h);if(w===void 0||w.count!==v){let E=function(){q.dispose(),s.delete(h),h.removeEventListener("dispose",E)};w!==void 0&&w.texture.dispose();const _=h.morphAttributes.position!==void 0,C=h.morphAttributes.normal!==void 0,M=h.morphAttributes.color!==void 0,S=h.morphAttributes.position||[],R=h.morphAttributes.normal||[],U=h.morphAttributes.color||[];let T=0;_===!0&&(T=1),C===!0&&(T=2),M===!0&&(T=3);let B=h.attributes.position.count*T,Q=1;B>e.maxTextureSize&&(Q=Math.ceil(B/e.maxTextureSize),B=e.maxTextureSize);const Z=new Float32Array(B*Q*4*v),q=new Hc(Z,B,Q,v);q.type=qt,q.needsUpdate=!0;const X=T*4;for(let te=0;te<v;te++){const me=S[te],se=R[te],he=U[te],_e=B*Q*4*te;for(let ge=0;ge<me.count;ge++){const Oe=ge*X;_===!0&&(a.fromBufferAttribute(me,ge),Z[_e+Oe+0]=a.x,Z[_e+Oe+1]=a.y,Z[_e+Oe+2]=a.z,Z[_e+Oe+3]=0),C===!0&&(a.fromBufferAttribute(se,ge),Z[_e+Oe+4]=a.x,Z[_e+Oe+5]=a.y,Z[_e+Oe+6]=a.z,Z[_e+Oe+7]=0),M===!0&&(a.fromBufferAttribute(he,ge),Z[_e+Oe+8]=a.x,Z[_e+Oe+9]=a.y,Z[_e+Oe+10]=a.z,Z[_e+Oe+11]=he.itemSize===4?a.w:1)}}w={count:v,texture:q,size:new ne(B,Q)},s.set(h,w),h.addEventListener("dispose",E)}let b=0;for(let E=0;E<m.length;E++)b+=m[E];const y=h.morphTargetsRelative?1:1-b;d.getUniforms().setValue(r,"morphTargetBaseInfluence",y),d.getUniforms().setValue(r,"morphTargetInfluences",m),d.getUniforms().setValue(r,"morphTargetsTexture",w.texture,t),d.getUniforms().setValue(r,"morphTargetsTextureSize",w.size)}else{const f=m===void 0?0:m.length;let v=i[h.id];if(v===void 0||v.length!==f){v=[];for(let _=0;_<f;_++)v[_]=[_,0];i[h.id]=v}for(let _=0;_<f;_++){const C=v[_];C[0]=_,C[1]=m[_]}v.sort(FT);for(let _=0;_<8;_++)_<f&&v[_][1]?(o[_][0]=v[_][0],o[_][1]=v[_][1]):(o[_][0]=Number.MAX_SAFE_INTEGER,o[_][1]=0);o.sort(kT);const w=h.morphAttributes.position,b=h.morphAttributes.normal;let y=0;for(let _=0;_<8;_++){const C=o[_],M=C[0],S=C[1];M!==Number.MAX_SAFE_INTEGER&&S?(w&&h.getAttribute("morphTarget"+_)!==w[M]&&h.setAttribute("morphTarget"+_,w[M]),b&&h.getAttribute("morphNormal"+_)!==b[M]&&h.setAttribute("morphNormal"+_,b[M]),n[_]=S,y+=S):(w&&h.hasAttribute("morphTarget"+_)===!0&&h.deleteAttribute("morphTarget"+_),b&&h.hasAttribute("morphNormal"+_)===!0&&h.deleteAttribute("morphNormal"+_),n[_]=0)}const E=h.morphTargetsRelative?1:1-y;d.getUniforms().setValue(r,"morphTargetBaseInfluence",E),d.getUniforms().setValue(r,"morphTargetInfluences",n)}}return{update:l}}function GT(r,e,t,i){let n=new WeakMap;function s(l){const c=i.render.frame,h=l.geometry,d=e.get(l,h);return n.get(d)!==c&&(e.update(d),n.set(d,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),t.update(l.instanceMatrix,r.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,r.ARRAY_BUFFER)),d}function a(){n=new WeakMap}function o(l){const c=l.target;c.removeEventListener("dispose",o),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:s,dispose:a}}const V_=new Ti,j_=new Hc,H_=new Wc,W_=new Os,X_=[],q_=[],Y_=new Float32Array(16),K_=new Float32Array(9),J_=new Float32Array(4);function uh(r,e,t){const i=r[0];if(i<=0||i>0)return r;const n=e*t;let s=X_[n];if(s===void 0&&(s=new Float32Array(n),X_[n]=s),e!==0){i.toArray(s,0);for(let a=1,o=0;a!==e;++a)o+=t,r[a].toArray(s,o)}return s}function Mr(r,e){if(r.length!==e.length)return!1;for(let t=0,i=r.length;t<i;t++)if(r[t]!==e[t])return!1;return!0}function Sr(r,e){for(let t=0,i=e.length;t<i;t++)r[t]=e[t]}function Pm(r,e){let t=q_[e];t===void 0&&(t=new Int32Array(e),q_[e]=t);for(let i=0;i!==e;++i)t[i]=r.allocateTextureUnit();return t}function zT(r,e){const t=this.cache;t[0]!==e&&(r.uniform1f(this.addr,e),t[0]=e)}function QT(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Mr(t,e))return;r.uniform2fv(this.addr,e),Sr(t,e)}}function VT(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(r.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Mr(t,e))return;r.uniform3fv(this.addr,e),Sr(t,e)}}function jT(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Mr(t,e))return;r.uniform4fv(this.addr,e),Sr(t,e)}}function HT(r,e){const t=this.cache,i=e.elements;if(i===void 0){if(Mr(t,e))return;r.uniformMatrix2fv(this.addr,!1,e),Sr(t,e)}else{if(Mr(t,i))return;J_.set(i),r.uniformMatrix2fv(this.addr,!1,J_),Sr(t,i)}}function WT(r,e){const t=this.cache,i=e.elements;if(i===void 0){if(Mr(t,e))return;r.uniformMatrix3fv(this.addr,!1,e),Sr(t,e)}else{if(Mr(t,i))return;K_.set(i),r.uniformMatrix3fv(this.addr,!1,K_),Sr(t,i)}}function XT(r,e){const t=this.cache,i=e.elements;if(i===void 0){if(Mr(t,e))return;r.uniformMatrix4fv(this.addr,!1,e),Sr(t,e)}else{if(Mr(t,i))return;Y_.set(i),r.uniformMatrix4fv(this.addr,!1,Y_),Sr(t,i)}}function qT(r,e){const t=this.cache;t[0]!==e&&(r.uniform1i(this.addr,e),t[0]=e)}function YT(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Mr(t,e))return;r.uniform2iv(this.addr,e),Sr(t,e)}}function KT(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Mr(t,e))return;r.uniform3iv(this.addr,e),Sr(t,e)}}function JT(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Mr(t,e))return;r.uniform4iv(this.addr,e),Sr(t,e)}}function ZT(r,e){const t=this.cache;t[0]!==e&&(r.uniform1ui(this.addr,e),t[0]=e)}function $T(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Mr(t,e))return;r.uniform2uiv(this.addr,e),Sr(t,e)}}function eI(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Mr(t,e))return;r.uniform3uiv(this.addr,e),Sr(t,e)}}function tI(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Mr(t,e))return;r.uniform4uiv(this.addr,e),Sr(t,e)}}function iI(r,e,t){const i=this.cache,n=t.allocateTextureUnit();i[0]!==n&&(r.uniform1i(this.addr,n),i[0]=n),t.setTexture2D(e||V_,n)}function rI(r,e,t){const i=this.cache,n=t.allocateTextureUnit();i[0]!==n&&(r.uniform1i(this.addr,n),i[0]=n),t.setTexture3D(e||H_,n)}function nI(r,e,t){const i=this.cache,n=t.allocateTextureUnit();i[0]!==n&&(r.uniform1i(this.addr,n),i[0]=n),t.setTextureCube(e||W_,n)}function sI(r,e,t){const i=this.cache,n=t.allocateTextureUnit();i[0]!==n&&(r.uniform1i(this.addr,n),i[0]=n),t.setTexture2DArray(e||j_,n)}function aI(r){switch(r){case 5126:return zT;case 35664:return QT;case 35665:return VT;case 35666:return jT;case 35674:return HT;case 35675:return WT;case 35676:return XT;case 5124:case 35670:return qT;case 35667:case 35671:return YT;case 35668:case 35672:return KT;case 35669:case 35673:return JT;case 5125:return ZT;case 36294:return $T;case 36295:return eI;case 36296:return tI;case 35678:case 36198:case 36298:case 36306:case 35682:return iI;case 35679:case 36299:case 36307:return rI;case 35680:case 36300:case 36308:case 36293:return nI;case 36289:case 36303:case 36311:case 36292:return sI}}function oI(r,e){r.uniform1fv(this.addr,e)}function lI(r,e){const t=uh(e,this.size,2);r.uniform2fv(this.addr,t)}function cI(r,e){const t=uh(e,this.size,3);r.uniform3fv(this.addr,t)}function hI(r,e){const t=uh(e,this.size,4);r.uniform4fv(this.addr,t)}function uI(r,e){const t=uh(e,this.size,4);r.uniformMatrix2fv(this.addr,!1,t)}function pI(r,e){const t=uh(e,this.size,9);r.uniformMatrix3fv(this.addr,!1,t)}function dI(r,e){const t=uh(e,this.size,16);r.uniformMatrix4fv(this.addr,!1,t)}function mI(r,e){r.uniform1iv(this.addr,e)}function fI(r,e){r.uniform2iv(this.addr,e)}function gI(r,e){r.uniform3iv(this.addr,e)}function AI(r,e){r.uniform4iv(this.addr,e)}function vI(r,e){r.uniform1uiv(this.addr,e)}function yI(r,e){r.uniform2uiv(this.addr,e)}function _I(r,e){r.uniform3uiv(this.addr,e)}function bI(r,e){r.uniform4uiv(this.addr,e)}function wI(r,e,t){const i=this.cache,n=e.length,s=Pm(t,n);Mr(i,s)||(r.uniform1iv(this.addr,s),Sr(i,s));for(let a=0;a!==n;++a)t.setTexture2D(e[a]||V_,s[a])}function xI(r,e,t){const i=this.cache,n=e.length,s=Pm(t,n);Mr(i,s)||(r.uniform1iv(this.addr,s),Sr(i,s));for(let a=0;a!==n;++a)t.setTexture3D(e[a]||H_,s[a])}function EI(r,e,t){const i=this.cache,n=e.length,s=Pm(t,n);Mr(i,s)||(r.uniform1iv(this.addr,s),Sr(i,s));for(let a=0;a!==n;++a)t.setTextureCube(e[a]||W_,s[a])}function CI(r,e,t){const i=this.cache,n=e.length,s=Pm(t,n);Mr(i,s)||(r.uniform1iv(this.addr,s),Sr(i,s));for(let a=0;a!==n;++a)t.setTexture2DArray(e[a]||j_,s[a])}function MI(r){switch(r){case 5126:return oI;case 35664:return lI;case 35665:return cI;case 35666:return hI;case 35674:return uI;case 35675:return pI;case 35676:return dI;case 5124:case 35670:return mI;case 35667:case 35671:return fI;case 35668:case 35672:return gI;case 35669:case 35673:return AI;case 5125:return vI;case 36294:return yI;case 36295:return _I;case 36296:return bI;case 35678:case 36198:case 36298:case 36306:case 35682:return wI;case 35679:case 36299:case 36307:return xI;case 35680:case 36300:case 36308:case 36293:return EI;case 36289:case 36303:case 36311:case 36292:return CI}}class SI{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=aI(t.type)}}class TI{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=MI(t.type)}}class II{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const n=this.seq;for(let s=0,a=n.length;s!==a;++s){const o=n[s];o.setValue(e,t[o.id],i)}}}const ev=/(\w+)(\])?(\[|\.)?/g;function Z_(r,e){r.seq.push(e),r.map[e.id]=e}function PI(r,e,t){const i=r.name,n=i.length;for(ev.lastIndex=0;;){const s=ev.exec(i),a=ev.lastIndex;let o=s[1];const l=s[2]==="]",c=s[3];if(l&&(o=o|0),c===void 0||c==="["&&a+2===n){Z_(t,c===void 0?new SI(o,r,e):new TI(o,r,e));break}else{let h=t.map[o];h===void 0&&(h=new II(o),Z_(t,h)),t=h}}}class Rm{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let n=0;n<i;++n){const s=e.getActiveUniform(t,n),a=e.getUniformLocation(t,s.name);PI(s,a,this)}}setValue(e,t,i,n){const s=this.map[t];s!==void 0&&s.setValue(e,i,n)}setOptional(e,t,i){const n=t[i];n!==void 0&&this.setValue(e,i,n)}static upload(e,t,i,n){for(let s=0,a=t.length;s!==a;++s){const o=t[s],l=i[o.id];l.needsUpdate!==!1&&o.setValue(e,l.value,n)}}static seqWithValue(e,t){const i=[];for(let n=0,s=e.length;n!==s;++n){const a=e[n];a.id in t&&i.push(a)}return i}}function $_(r,e,t){const i=r.createShader(e);return r.shaderSource(i,t),r.compileShader(i),i}let RI=0;function DI(r,e){const t=r.split(`
`),i=[],n=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let a=n;a<s;a++){const o=a+1;i.push(`${o===e?">":" "} ${o}: ${t[a]}`)}return i.join(`
`)}function eb(r){switch(r){case Xi:case wi:return["Linear","( value )"];case it:return["sRGB","( value )"];case _l:return["RGBM","( value, 16.0 )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",r),["Linear","( value )"]}}function tb(r,e,t){const i=r.getShaderParameter(e,r.COMPILE_STATUS),n=r.getShaderInfoLog(e).trim();if(i&&n==="")return"";const s=/ERROR: 0:(\d+)/.exec(n);if(s){const a=parseInt(s[1]);return t.toUpperCase()+`

`+n+`

`+DI(r.getShaderSource(e),a)}else return n}function BI(r,e){const t=eb(e);return"vec4 "+r+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function LI(r,e){const t=eb(e);return"vec4 "+r+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function UI(r,e){let t;switch(e){case Rd:t="Linear";break;case Dd:t="Reinhard";break;case Bd:t="OptimizedCineon";break;case bo:t="ACESFilmic";break;case gu:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+r+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function OI(r){return[r.extensionDerivatives||r.envMapCubeUVHeight||r.bumpMap||r.normalMapTangentSpace||r.clearcoatNormalMap||r.flatShading||r.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(r.extensionFragDepth||r.logarithmicDepthBuffer)&&r.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",r.extensionDrawBuffers&&r.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(r.extensionShaderTextureLOD||r.envMap||r.transmission)&&r.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(rp).join(`
`)}function kI(r){const e=[];for(const t in r){const i=r[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function FI(r,e){const t={},i=r.getProgramParameter(e,r.ACTIVE_ATTRIBUTES);for(let n=0;n<i;n++){const s=r.getActiveAttrib(e,n),a=s.name;let o=1;s.type===r.FLOAT_MAT2&&(o=2),s.type===r.FLOAT_MAT3&&(o=3),s.type===r.FLOAT_MAT4&&(o=4),t[a]={type:s.type,location:r.getAttribLocation(e,a),locationSize:o}}return t}function rp(r){return r!==""}function ib(r,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return r.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function rb(r,e){return r.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const NI=/^[ \t]*#include +<([\w\d./]+)>/gm;function tv(r){return r.replace(NI,GI)}function GI(r,e){const t=Ft[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return tv(t)}const zI=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function nb(r){return r.replace(zI,QI)}function QI(r,e,t,i){let n="";for(let s=parseInt(e);s<parseInt(t);s++)n+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function sb(r){let e="precision "+r.precision+` float;
precision `+r.precision+" int;";return r.precision==="highp"?e+=`
#define HIGH_PRECISION`:r.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:r.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function VI(r){let e="SHADOWMAP_TYPE_BASIC";return r.shadowMapType===_t?e="SHADOWMAP_TYPE_PCF":r.shadowMapType===Nt?e="SHADOWMAP_TYPE_PCF_SOFT":r.shadowMapType===Ci&&(e="SHADOWMAP_TYPE_VSM"),e}function jI(r){let e="ENVMAP_TYPE_CUBE";if(r.envMap)switch(r.envMapMode){case ys:case Ba:e="ENVMAP_TYPE_CUBE";break;case xo:e="ENVMAP_TYPE_CUBE_UV";break}return e}function HI(r){let e="ENVMAP_MODE_REFLECTION";if(r.envMap)switch(r.envMapMode){case Ba:e="ENVMAP_MODE_REFRACTION";break}return e}function WI(r){let e="ENVMAP_BLENDING_NONE";if(r.envMap)switch(r.combine){case vs:e="ENVMAP_BLENDING_MULTIPLY";break;case Yg:e="ENVMAP_BLENDING_MIX";break;case fu:e="ENVMAP_BLENDING_ADD";break}return e}function XI(r){const e=r.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function qI(r,e,t,i){const n=r.getContext(),s=t.defines;let a=t.vertexShader,o=t.fragmentShader;const l=VI(t),c=jI(t),h=HI(t),d=WI(t),m=XI(t),f=t.isWebGL2?"":OI(t),v=kI(s),w=n.createProgram();let b,y,E=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(b=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v].filter(rp).join(`
`),b.length>0&&(b+=`
`),y=[f,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v].filter(rp).join(`
`),y.length>0&&(y+=`
`)):(b=[sb(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(rp).join(`
`),y=[f,sb(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",t.envMap?"#define "+d:"",m?"#define CUBEUV_TEXEL_WIDTH "+m.texelWidth:"",m?"#define CUBEUV_TEXEL_HEIGHT "+m.texelHeight:"",m?"#define CUBEUV_MAX_MIP "+m.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==$n?"#define TONE_MAPPING":"",t.toneMapping!==$n?Ft.tonemapping_pars_fragment:"",t.toneMapping!==$n?UI("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Ft.encodings_pars_fragment,LI("linearToOutputTexel",t.outputColorSpace),t.transmissionSamplerMapEncoding?BI("transmissionSamplerMapTexelToLinear",t.transmissionSamplerMapEncoding):"",t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(rp).join(`
`)),a=tv(a),a=ib(a,t),a=rb(a,t),o=tv(o),o=ib(o,t),o=rb(o,t),a=nb(a),o=nb(o),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(E=`#version 300 es
`,b=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+b,y=["#define varying in",t.glslVersion===ku?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===ku?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad","#define WebGL2Context 1"].join(`
`)+`
`+y);const _=E+b+a,C=E+y+o,M=$_(n,n.VERTEX_SHADER,_),S=$_(n,n.FRAGMENT_SHADER,C);if(n.attachShader(w,M),n.attachShader(w,S),t.index0AttributeName!==void 0?n.bindAttribLocation(w,0,t.index0AttributeName):t.morphTargets===!0&&n.bindAttribLocation(w,0,"position"),n.linkProgram(w),r.debug.checkShaderErrors){const T=n.getProgramInfoLog(w).trim(),B=n.getShaderInfoLog(M).trim(),Q=n.getShaderInfoLog(S).trim();let Z=!0,q=!0;if(n.getProgramParameter(w,n.LINK_STATUS)===!1)if(Z=!1,typeof r.debug.onShaderError=="function")r.debug.onShaderError(n,w,M,S);else{const X=tb(n,M,"vertex"),te=tb(n,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(w,n.VALIDATE_STATUS)+`

Program Info Log: `+T+`
`+X+`
`+te)}else T!==""?console.warn("THREE.WebGLProgram: Program Info Log:",T):(B===""||Q==="")&&(q=!1);q&&(this.diagnostics={runnable:Z,programLog:T,vertexShader:{log:B,prefix:b},fragmentShader:{log:Q,prefix:y}})}n.deleteShader(M),n.deleteShader(S);let R;this.getUniforms=function(){return R===void 0&&(R=new Rm(n,w)),R};let U;return this.getAttributes=function(){return U===void 0&&(U=FI(n,w)),U},this.destroy=function(){i.releaseStatesOfProgram(this),n.deleteProgram(w),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=RI++,this.cacheKey=e,this.usedTimes=1,this.program=w,this.vertexShader=M,this.fragmentShader=S,this}let YI=0;class KI{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,n=this._getShaderStage(t),s=this._getShaderStage(i),a=this._getShaderCacheForMaterial(e);return a.has(n)===!1&&(a.add(n),n.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new JI(e),t.set(e,i)),i}}class JI{constructor(e){this.id=YI++,this.code=e,this.usedTimes=0}}function ZI(r,e,t,i,n,s,a){const o=new No,l=new KI,c=[],h=n.isWebGL2,d=n.logarithmicDepthBuffer,m=n.vertexTextures;let f=n.precision;const v={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function w(T){return T===0?"uv":`uv${T}`}function b(T,B,Q,Z,q){const X=Z.fog,te=q.geometry,me=T.isMeshStandardMaterial?Z.environment:null,se=(T.isMeshStandardMaterial?t:e).get(T.envMap||me),he=se&&se.mapping===xo?se.image.height:null,_e=v[T.type];T.precision!==null&&(f=n.getMaxPrecision(T.precision),f!==T.precision&&console.warn("THREE.WebGLProgram.getParameters:",T.precision,"not supported, using",f,"instead."));const ge=te.morphAttributes.position||te.morphAttributes.normal||te.morphAttributes.color,Oe=ge!==void 0?ge.length:0;let oe=0;te.morphAttributes.position!==void 0&&(oe=1),te.morphAttributes.normal!==void 0&&(oe=2),te.morphAttributes.color!==void 0&&(oe=3);let be,Me,Ve,Ue;if(_e){const ke=Vi[_e];be=ke.vertexShader,Me=ke.fragmentShader}else be=T.vertexShader,Me=T.fragmentShader,l.update(T),Ve=l.getVertexShaderID(T),Ue=l.getFragmentShaderID(T);const rt=r.getRenderTarget(),xt=r.userData&&r.userData.transmissionRenderTarget,mt=rt?Array.isArray(rt.texture)?rt.texture[0]:rt.texture:null,Dt=q.isInstancedMesh===!0,we=!!T.map,Y=!!T.matcap,je=!!se,Pe=!!T.aoMap,Te=!!T.lightMap,Ye=!!T.bumpMap,Ee=!!T.normalMap,at=!!T.displacementMap,ot=!!T.emissiveMap,Pt=!!T.metalnessMap,Li=!!T.roughnessMap,Wi=T.anisotropy>0,G=T.clearcoat>0,F=T.iridescence>0,ye=T.sheen>0,Ge=T.transmission>0,ze=Wi&&!!T.anisotropyMap,V=G&&!!T.clearcoatMap,Ce=G&&!!T.clearcoatNormalMap,Be=G&&!!T.clearcoatRoughnessMap,Ae=F&&!!T.iridescenceMap,ut=F&&!!T.iridescenceThicknessMap,ft=ye&&!!T.sheenColorMap,He=ye&&!!T.sheenRoughnessMap,ct=!!T.specularMap,lt=!!T.specularColorMap,I=!!T.specularIntensityMap,k=Ge&&!!T.transmissionMap,L=Ge&&!!T.thicknessMap,j=!!T.gradientMap,z=!!T.alphaMap,J=T.alphaTest>0,ae=!!T.extensions,Re=!!te.attributes.uv1,Le=!!te.attributes.uv2,Se=!!te.attributes.uv3;return{isWebGL2:h,shaderID:_e,shaderType:T.type,shaderName:T.name,vertexShader:be,fragmentShader:Me,defines:T.defines,customVertexShaderID:Ve,customFragmentShaderID:Ue,isRawShaderMaterial:T.isRawShaderMaterial===!0,glslVersion:T.glslVersion,precision:f,instancing:Dt,instancingColor:Dt&&q.instanceColor!==null,supportsVertexTextures:m,outputColorSpace:rt===null?r.outputColorSpace:rt.isXRRenderTarget===!0||mt.colorSpace&&mt.colorSpace!==it?mt.colorSpace:wi,map:we,matcap:Y,envMap:je,envMapMode:je&&se.mapping,envMapCubeUVHeight:he,aoMap:Pe,lightMap:Te,bumpMap:Ye,normalMap:Ee,displacementMap:m&&at,emissiveMap:ot,normalMapObjectSpace:Ee&&T.normalMapType===Lu,normalMapTangentSpace:Ee&&T.normalMapType===pn,metalnessMap:Pt,roughnessMap:Li,anisotropy:Wi,anisotropyMap:ze,clearcoat:G,clearcoatMap:V,clearcoatNormalMap:Ce,clearcoatRoughnessMap:Be,iridescence:F,iridescenceMap:Ae,iridescenceThicknessMap:ut,sheen:ye,sheenColorMap:ft,sheenRoughnessMap:He,specularMap:ct,specularColorMap:lt,specularIntensityMap:I,transmission:Ge,transmissionMap:k,thicknessMap:L,transmissionSamplerMapEncoding:xt&&xt.texture.colorSpace||wi,gradientMap:j,opaque:T.transparent===!1&&T.blending===ii&&!(T.transmission>0),alphaMap:z,alphaTest:J,combine:T.combine,mapUv:we&&w(T.map.channel),aoMapUv:Pe&&w(T.aoMap.channel),lightMapUv:Te&&w(T.lightMap.channel),bumpMapUv:Ye&&w(T.bumpMap.channel),normalMapUv:Ee&&w(T.normalMap.channel),displacementMapUv:at&&w(T.displacementMap.channel),emissiveMapUv:ot&&w(T.emissiveMap.channel),metalnessMapUv:Pt&&w(T.metalnessMap.channel),roughnessMapUv:Li&&w(T.roughnessMap.channel),anisotropyMapUv:ze&&w(T.anisotropyMap.channel),clearcoatMapUv:V&&w(T.clearcoatMap.channel),clearcoatNormalMapUv:Ce&&w(T.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Be&&w(T.clearcoatRoughnessMap.channel),iridescenceMapUv:Ae&&w(T.iridescenceMap.channel),iridescenceThicknessMapUv:ut&&w(T.iridescenceThicknessMap.channel),sheenColorMapUv:ft&&w(T.sheenColorMap.channel),sheenRoughnessMapUv:He&&w(T.sheenRoughnessMap.channel),specularMapUv:ct&&w(T.specularMap.channel),specularColorMapUv:lt&&w(T.specularColorMap.channel),specularIntensityMapUv:I&&w(T.specularIntensityMap.channel),transmissionMapUv:k&&w(T.transmissionMap.channel),thicknessMapUv:L&&w(T.thicknessMap.channel),alphaMapUv:z&&w(T.alphaMap.channel),vertexTangents:!!te.attributes.tangent&&(Ee||Wi),vertexColors:T.vertexColors,vertexAlphas:T.vertexColors===!0&&!!te.attributes.color&&te.attributes.color.itemSize===4,vertexUv1s:Re,vertexUv2s:Le,vertexUv3s:Se,pointsUvs:q.isPoints===!0&&!!te.attributes.uv&&(we||z),fog:!!X,useFog:T.fog===!0,fogExp2:X&&X.isFogExp2,flatShading:T.flatShading===!0,sizeAttenuation:T.sizeAttenuation===!0,logarithmicDepthBuffer:d,skinning:q.isSkinnedMesh===!0,morphTargets:te.morphAttributes.position!==void 0,morphNormals:te.morphAttributes.normal!==void 0,morphColors:te.morphAttributes.color!==void 0,morphTargetsCount:Oe,morphTextureStride:oe,numDirLights:B.directional.length,numPointLights:B.point.length,numSpotLights:B.spot.length,numSpotLightMaps:B.spotLightMap.length,numRectAreaLights:B.rectArea.length,numHemiLights:B.hemi.length,numDirLightShadows:B.directionalShadowMap.length,numPointLightShadows:B.pointShadowMap.length,numSpotLightShadows:B.spotShadowMap.length,numSpotLightShadowsWithMaps:B.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:T.dithering,shadowMapEnabled:r.shadowMap.enabled&&Q.length>0,shadowMapType:r.shadowMap.type,toneMapping:T.toneMapped?r.toneMapping:$n,useLegacyLights:r.useLegacyLights,premultipliedAlpha:T.premultipliedAlpha,doubleSided:T.side===dt,flipSided:T.side===$e,useDepthPacking:T.depthPacking>=0,depthPacking:T.depthPacking||0,index0AttributeName:T.index0AttributeName,extensionDerivatives:ae&&T.extensions.derivatives===!0,extensionFragDepth:ae&&T.extensions.fragDepth===!0,extensionDrawBuffers:ae&&T.extensions.drawBuffers===!0,extensionShaderTextureLOD:ae&&T.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:h||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||i.has("EXT_shader_texture_lod"),customProgramCacheKey:T.customProgramCacheKey()}}function y(T){const B=[];if(T.shaderID?B.push(T.shaderID):(B.push(T.customVertexShaderID),B.push(T.customFragmentShaderID)),T.defines!==void 0)for(const Q in T.defines)B.push(Q),B.push(T.defines[Q]);return T.isRawShaderMaterial===!1&&(E(B,T),_(B,T),B.push(r.outputColorSpace)),B.push(T.customProgramCacheKey),B.join()}function E(T,B){T.push(B.precision),T.push(B.outputColorSpace),T.push(B.envMapMode),T.push(B.envMapCubeUVHeight),T.push(B.mapUv),T.push(B.alphaMapUv),T.push(B.lightMapUv),T.push(B.aoMapUv),T.push(B.bumpMapUv),T.push(B.normalMapUv),T.push(B.displacementMapUv),T.push(B.emissiveMapUv),T.push(B.metalnessMapUv),T.push(B.roughnessMapUv),T.push(B.anisotropyMapUv),T.push(B.clearcoatMapUv),T.push(B.clearcoatNormalMapUv),T.push(B.clearcoatRoughnessMapUv),T.push(B.iridescenceMapUv),T.push(B.iridescenceThicknessMapUv),T.push(B.sheenColorMapUv),T.push(B.sheenRoughnessMapUv),T.push(B.specularMapUv),T.push(B.specularColorMapUv),T.push(B.specularIntensityMapUv),T.push(B.transmissionMapUv),T.push(B.thicknessMapUv),T.push(B.combine),T.push(B.fogExp2),T.push(B.sizeAttenuation),T.push(B.morphTargetsCount),T.push(B.morphAttributeCount),T.push(B.numDirLights),T.push(B.numPointLights),T.push(B.numSpotLights),T.push(B.numSpotLightMaps),T.push(B.numHemiLights),T.push(B.numRectAreaLights),T.push(B.numDirLightShadows),T.push(B.numPointLightShadows),T.push(B.numSpotLightShadows),T.push(B.numSpotLightShadowsWithMaps),T.push(B.shadowMapType),T.push(B.toneMapping),T.push(B.numClippingPlanes),T.push(B.numClipIntersection),T.push(B.depthPacking)}function _(T,B){o.disableAll(),B.isWebGL2&&o.enable(0),B.supportsVertexTextures&&o.enable(1),B.instancing&&o.enable(2),B.instancingColor&&o.enable(3),B.matcap&&o.enable(4),B.envMap&&o.enable(5),B.normalMapObjectSpace&&o.enable(6),B.normalMapTangentSpace&&o.enable(7),B.clearcoat&&o.enable(8),B.iridescence&&o.enable(9),B.alphaTest&&o.enable(10),B.vertexColors&&o.enable(11),B.vertexAlphas&&o.enable(12),B.vertexUv1s&&o.enable(13),B.vertexUv2s&&o.enable(14),B.vertexUv3s&&o.enable(15),B.vertexTangents&&o.enable(16),B.anisotropy&&o.enable(17),T.push(o.mask),o.disableAll(),B.fog&&o.enable(0),B.useFog&&o.enable(1),B.flatShading&&o.enable(2),B.logarithmicDepthBuffer&&o.enable(3),B.skinning&&o.enable(4),B.morphTargets&&o.enable(5),B.morphNormals&&o.enable(6),B.morphColors&&o.enable(7),B.premultipliedAlpha&&o.enable(8),B.shadowMapEnabled&&o.enable(9),B.useLegacyLights&&o.enable(10),B.doubleSided&&o.enable(11),B.flipSided&&o.enable(12),B.useDepthPacking&&o.enable(13),B.dithering&&o.enable(14),B.transmission&&o.enable(15),B.sheen&&o.enable(16),B.opaque&&o.enable(17),B.pointsUvs&&o.enable(18),T.push(o.mask)}function C(T){const B=v[T.type];let Q;if(B){const Z=Vi[B];Q=Dn.clone(Z.uniforms)}else Q=T.uniforms;return Q}function M(T,B){let Q;for(let Z=0,q=c.length;Z<q;Z++){const X=c[Z];if(X.cacheKey===B){Q=X,++Q.usedTimes;break}}return Q===void 0&&(Q=new qI(r,B,T,s),c.push(Q)),Q}function S(T){if(--T.usedTimes===0){const B=c.indexOf(T);c[B]=c[c.length-1],c.pop(),T.destroy()}}function R(T){l.remove(T)}function U(){l.dispose()}return{getParameters:b,getProgramCacheKey:y,getUniforms:C,acquireProgram:M,releaseProgram:S,releaseShaderCache:R,programs:c,dispose:U}}function $I(){let r=new WeakMap;function e(s){let a=r.get(s);return a===void 0&&(a={},r.set(s,a)),a}function t(s){r.delete(s)}function i(s,a,o){r.get(s)[a]=o}function n(){r=new WeakMap}return{get:e,remove:t,update:i,dispose:n}}function eP(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.material.id!==e.material.id?r.material.id-e.material.id:r.z!==e.z?r.z-e.z:r.id-e.id}function ab(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.z!==e.z?e.z-r.z:r.id-e.id}function ob(){const r=[];let e=0;const t=[],i=[],n=[];function s(){e=0,t.length=0,i.length=0,n.length=0}function a(d,m,f,v,w,b){let y=r[e];return y===void 0?(y={id:d.id,object:d,geometry:m,material:f,groupOrder:v,renderOrder:d.renderOrder,z:w,group:b},r[e]=y):(y.id=d.id,y.object=d,y.geometry=m,y.material=f,y.groupOrder=v,y.renderOrder=d.renderOrder,y.z=w,y.group=b),e++,y}function o(d,m,f,v,w,b){const y=a(d,m,f,v,w,b);f.transmission>0?i.push(y):f.transparent===!0?n.push(y):t.push(y)}function l(d,m,f,v,w,b){const y=a(d,m,f,v,w,b);f.transmission>0?i.unshift(y):f.transparent===!0?n.unshift(y):t.unshift(y)}function c(d,m){t.length>1&&t.sort(d||eP),i.length>1&&i.sort(m||ab),n.length>1&&n.sort(m||ab)}function h(){for(let d=e,m=r.length;d<m;d++){const f=r[d];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:t,transmissive:i,transparent:n,init:s,push:o,unshift:l,finish:h,sort:c}}function tP(){let r=new WeakMap;function e(i,n){const s=r.get(i);let a;return s===void 0?(a=new ob,r.set(i,[a])):n>=s.length?(a=new ob,s.push(a)):a=s[n],a}function t(){r=new WeakMap}return{get:e,dispose:t}}function iP(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new P,color:new fe};break;case"SpotLight":t={position:new P,direction:new P,color:new fe,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new P,color:new fe,distance:0,decay:0};break;case"HemisphereLight":t={direction:new P,skyColor:new fe,groundColor:new fe};break;case"RectAreaLight":t={color:new fe,position:new P,halfWidth:new P,halfHeight:new P};break}return r[e.id]=t,t}}}function rP(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ne};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ne};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ne,shadowCameraNear:1,shadowCameraFar:1e3};break}return r[e.id]=t,t}}}let nP=0;function sP(r,e){return(e.castShadow?2:0)-(r.castShadow?2:0)+(e.map?1:0)-(r.map?1:0)}function aP(r,e){const t=new iP,i=rP(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let h=0;h<9;h++)n.probe.push(new P);const s=new P,a=new et,o=new et;function l(h,d){let m=0,f=0,v=0;for(let Q=0;Q<9;Q++)n.probe[Q].set(0,0,0);let w=0,b=0,y=0,E=0,_=0,C=0,M=0,S=0,R=0,U=0;h.sort(sP);const T=d===!0?Math.PI:1;for(let Q=0,Z=h.length;Q<Z;Q++){const q=h[Q],X=q.color,te=q.intensity,me=q.distance,se=q.shadow&&q.shadow.map?q.shadow.map.texture:null;if(q.isAmbientLight)m+=X.r*te*T,f+=X.g*te*T,v+=X.b*te*T;else if(q.isLightProbe)for(let he=0;he<9;he++)n.probe[he].addScaledVector(q.sh.coefficients[he],te);else if(q.isDirectionalLight){const he=t.get(q);if(he.color.copy(q.color).multiplyScalar(q.intensity*T),q.castShadow){const _e=q.shadow,ge=i.get(q);ge.shadowBias=_e.bias,ge.shadowNormalBias=_e.normalBias,ge.shadowRadius=_e.radius,ge.shadowMapSize=_e.mapSize,n.directionalShadow[w]=ge,n.directionalShadowMap[w]=se,n.directionalShadowMatrix[w]=q.shadow.matrix,C++}n.directional[w]=he,w++}else if(q.isSpotLight){const he=t.get(q);he.position.setFromMatrixPosition(q.matrixWorld),he.color.copy(X).multiplyScalar(te*T),he.distance=me,he.coneCos=Math.cos(q.angle),he.penumbraCos=Math.cos(q.angle*(1-q.penumbra)),he.decay=q.decay,n.spot[y]=he;const _e=q.shadow;if(q.map&&(n.spotLightMap[R]=q.map,R++,_e.updateMatrices(q),q.castShadow&&U++),n.spotLightMatrix[y]=_e.matrix,q.castShadow){const ge=i.get(q);ge.shadowBias=_e.bias,ge.shadowNormalBias=_e.normalBias,ge.shadowRadius=_e.radius,ge.shadowMapSize=_e.mapSize,n.spotShadow[y]=ge,n.spotShadowMap[y]=se,S++}y++}else if(q.isRectAreaLight){const he=t.get(q);he.color.copy(X).multiplyScalar(te),he.halfWidth.set(q.width*.5,0,0),he.halfHeight.set(0,q.height*.5,0),n.rectArea[E]=he,E++}else if(q.isPointLight){const he=t.get(q);if(he.color.copy(q.color).multiplyScalar(q.intensity*T),he.distance=q.distance,he.decay=q.decay,q.castShadow){const _e=q.shadow,ge=i.get(q);ge.shadowBias=_e.bias,ge.shadowNormalBias=_e.normalBias,ge.shadowRadius=_e.radius,ge.shadowMapSize=_e.mapSize,ge.shadowCameraNear=_e.camera.near,ge.shadowCameraFar=_e.camera.far,n.pointShadow[b]=ge,n.pointShadowMap[b]=se,n.pointShadowMatrix[b]=q.shadow.matrix,M++}n.point[b]=he,b++}else if(q.isHemisphereLight){const he=t.get(q);he.skyColor.copy(q.color).multiplyScalar(te*T),he.groundColor.copy(q.groundColor).multiplyScalar(te*T),n.hemi[_]=he,_++}}E>0&&(e.isWebGL2||r.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=qe.LTC_FLOAT_1,n.rectAreaLTC2=qe.LTC_FLOAT_2):r.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=qe.LTC_HALF_1,n.rectAreaLTC2=qe.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=m,n.ambient[1]=f,n.ambient[2]=v;const B=n.hash;(B.directionalLength!==w||B.pointLength!==b||B.spotLength!==y||B.rectAreaLength!==E||B.hemiLength!==_||B.numDirectionalShadows!==C||B.numPointShadows!==M||B.numSpotShadows!==S||B.numSpotMaps!==R)&&(n.directional.length=w,n.spot.length=y,n.rectArea.length=E,n.point.length=b,n.hemi.length=_,n.directionalShadow.length=C,n.directionalShadowMap.length=C,n.pointShadow.length=M,n.pointShadowMap.length=M,n.spotShadow.length=S,n.spotShadowMap.length=S,n.directionalShadowMatrix.length=C,n.pointShadowMatrix.length=M,n.spotLightMatrix.length=S+R-U,n.spotLightMap.length=R,n.numSpotLightShadowsWithMaps=U,B.directionalLength=w,B.pointLength=b,B.spotLength=y,B.rectAreaLength=E,B.hemiLength=_,B.numDirectionalShadows=C,B.numPointShadows=M,B.numSpotShadows=S,B.numSpotMaps=R,n.version=nP++)}function c(h,d){let m=0,f=0,v=0,w=0,b=0;const y=d.matrixWorldInverse;for(let E=0,_=h.length;E<_;E++){const C=h[E];if(C.isDirectionalLight){const M=n.directional[m];M.direction.setFromMatrixPosition(C.matrixWorld),s.setFromMatrixPosition(C.target.matrixWorld),M.direction.sub(s),M.direction.transformDirection(y),m++}else if(C.isSpotLight){const M=n.spot[v];M.position.setFromMatrixPosition(C.matrixWorld),M.position.applyMatrix4(y),M.direction.setFromMatrixPosition(C.matrixWorld),s.setFromMatrixPosition(C.target.matrixWorld),M.direction.sub(s),M.direction.transformDirection(y),v++}else if(C.isRectAreaLight){const M=n.rectArea[w];M.position.setFromMatrixPosition(C.matrixWorld),M.position.applyMatrix4(y),o.identity(),a.copy(C.matrixWorld),a.premultiply(y),o.extractRotation(a),M.halfWidth.set(C.width*.5,0,0),M.halfHeight.set(0,C.height*.5,0),M.halfWidth.applyMatrix4(o),M.halfHeight.applyMatrix4(o),w++}else if(C.isPointLight){const M=n.point[f];M.position.setFromMatrixPosition(C.matrixWorld),M.position.applyMatrix4(y),f++}else if(C.isHemisphereLight){const M=n.hemi[b];M.direction.setFromMatrixPosition(C.matrixWorld),M.direction.transformDirection(y),b++}}}return{setup:l,setupView:c,state:n}}function lb(r,e){const t=new aP(r,e),i=[],n=[];function s(){i.length=0,n.length=0}function a(h){i.push(h)}function o(h){n.push(h)}function l(h){t.setup(i,h)}function c(h){t.setupView(i,h)}return{init:s,state:{lightsArray:i,shadowsArray:n,lights:t},setupLights:l,setupLightsView:c,pushLight:a,pushShadow:o}}function oP(r,e){let t=new WeakMap;function i(s,a=0){const o=t.get(s);let l;return o===void 0?(l=new lb(r,e),t.set(s,[l])):a>=o.length?(l=new lb(r,e),o.push(l)):l=o[a],l}function n(){t=new WeakMap}return{get:i,dispose:n}}class np extends Ki{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=xs,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class iv extends Ki{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const lP=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,cP=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function hP(r,e,t){let i=new Xn;const n=new ne,s=new ne,a=new bt,o=new np({depthPacking:Jd}),l=new iv,c={},h=t.maxTextureSize,d={[Ie]:$e,[$e]:Ie,[dt]:dt},m=new yr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ne},radius:{value:4}},vertexShader:lP,fragmentShader:cP}),f=m.clone();f.defines.HORIZONTAL_PASS=1;const v=new ht;v.setAttribute("position",new At(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const w=new Fe(v,m),b=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=_t;let y=this.type;this.render=function(M,S,R){if(b.enabled===!1||b.autoUpdate===!1&&b.needsUpdate===!1||M.length===0)return;const U=r.getRenderTarget(),T=r.getActiveCubeFace(),B=r.getActiveMipmapLevel(),Q=r.state;Q.setBlending(Qt),Q.buffers.color.setClear(1,1,1,1),Q.buffers.depth.setTest(!0),Q.setScissorTest(!1);const Z=y!==Ci&&this.type===Ci,q=y===Ci&&this.type!==Ci;for(let X=0,te=M.length;X<te;X++){const me=M[X],se=me.shadow;if(se===void 0){console.warn("THREE.WebGLShadowMap:",me,"has no shadow.");continue}if(se.autoUpdate===!1&&se.needsUpdate===!1)continue;n.copy(se.mapSize);const he=se.getFrameExtents();if(n.multiply(he),s.copy(se.mapSize),(n.x>h||n.y>h)&&(n.x>h&&(s.x=Math.floor(h/he.x),n.x=s.x*he.x,se.mapSize.x=s.x),n.y>h&&(s.y=Math.floor(h/he.y),n.y=s.y*he.y,se.mapSize.y=s.y)),se.map===null||Z===!0||q===!0){const ge=this.type!==Ci?{minFilter:Ai,magFilter:Ai}:{};se.map!==null&&se.map.dispose(),se.map=new Gr(n.x,n.y,ge),se.map.texture.name=me.name+".shadowMap",se.camera.updateProjectionMatrix()}r.setRenderTarget(se.map),r.clear();const _e=se.getViewportCount();for(let ge=0;ge<_e;ge++){const Oe=se.getViewport(ge);a.set(s.x*Oe.x,s.y*Oe.y,s.x*Oe.z,s.y*Oe.w),Q.viewport(a),se.updateMatrices(me,ge),i=se.getFrustum(),C(S,R,se.camera,me,this.type)}se.isPointLightShadow!==!0&&this.type===Ci&&E(se,R),se.needsUpdate=!1}y=this.type,b.needsUpdate=!1,r.setRenderTarget(U,T,B)};function E(M,S){const R=e.update(w);m.defines.VSM_SAMPLES!==M.blurSamples&&(m.defines.VSM_SAMPLES=M.blurSamples,f.defines.VSM_SAMPLES=M.blurSamples,m.needsUpdate=!0,f.needsUpdate=!0),M.mapPass===null&&(M.mapPass=new Gr(n.x,n.y)),m.uniforms.shadow_pass.value=M.map.texture,m.uniforms.resolution.value=M.mapSize,m.uniforms.radius.value=M.radius,r.setRenderTarget(M.mapPass),r.clear(),r.renderBufferDirect(S,null,R,m,w,null),f.uniforms.shadow_pass.value=M.mapPass.texture,f.uniforms.resolution.value=M.mapSize,f.uniforms.radius.value=M.radius,r.setRenderTarget(M.map),r.clear(),r.renderBufferDirect(S,null,R,f,w,null)}function _(M,S,R,U){let T=null;const B=R.isPointLight===!0?M.customDistanceMaterial:M.customDepthMaterial;if(B!==void 0)T=B;else if(T=R.isPointLight===!0?l:o,r.localClippingEnabled&&S.clipShadows===!0&&Array.isArray(S.clippingPlanes)&&S.clippingPlanes.length!==0||S.displacementMap&&S.displacementScale!==0||S.alphaMap&&S.alphaTest>0||S.map&&S.alphaTest>0){const Q=T.uuid,Z=S.uuid;let q=c[Q];q===void 0&&(q={},c[Q]=q);let X=q[Z];X===void 0&&(X=T.clone(),q[Z]=X),T=X}if(T.visible=S.visible,T.wireframe=S.wireframe,U===Ci?T.side=S.shadowSide!==null?S.shadowSide:S.side:T.side=S.shadowSide!==null?S.shadowSide:d[S.side],T.alphaMap=S.alphaMap,T.alphaTest=S.alphaTest,T.map=S.map,T.clipShadows=S.clipShadows,T.clippingPlanes=S.clippingPlanes,T.clipIntersection=S.clipIntersection,T.displacementMap=S.displacementMap,T.displacementScale=S.displacementScale,T.displacementBias=S.displacementBias,T.wireframeLinewidth=S.wireframeLinewidth,T.linewidth=S.linewidth,R.isPointLight===!0&&T.isMeshDistanceMaterial===!0){const Q=r.properties.get(T);Q.light=R}return T}function C(M,S,R,U,T){if(M.visible===!1)return;if(M.layers.test(S.layers)&&(M.isMesh||M.isLine||M.isPoints)&&(M.castShadow||M.receiveShadow&&T===Ci)&&(!M.frustumCulled||i.intersectsObject(M))){M.modelViewMatrix.multiplyMatrices(R.matrixWorldInverse,M.matrixWorld);const Q=e.update(M),Z=M.material;if(Array.isArray(Z)){const q=Q.groups;for(let X=0,te=q.length;X<te;X++){const me=q[X],se=Z[me.materialIndex];if(se&&se.visible){const he=_(M,se,U,T);r.renderBufferDirect(R,null,Q,he,M,me)}}}else if(Z.visible){const q=_(M,Z,U,T);r.renderBufferDirect(R,null,Q,q,M,null)}}const B=M.children;for(let Q=0,Z=B.length;Q<Z;Q++)C(B[Q],S,R,U,T)}}function uP(r,e,t){const i=t.isWebGL2;function n(){let L=!1;const j=new bt;let z=null;const J=new bt(0,0,0,0);return{setMask:function(ae){z!==ae&&!L&&(r.colorMask(ae,ae,ae,ae),z=ae)},setLocked:function(ae){L=ae},setClear:function(ae,Re,Le,Se,ke){ke===!0&&(ae*=Se,Re*=Se,Le*=Se),j.set(ae,Re,Le,Se),J.equals(j)===!1&&(r.clearColor(ae,Re,Le,Se),J.copy(j))},reset:function(){L=!1,z=null,J.set(-1,0,0,0)}}}function s(){let L=!1,j=null,z=null,J=null;return{setTest:function(ae){ae?rt(r.DEPTH_TEST):xt(r.DEPTH_TEST)},setMask:function(ae){j!==ae&&!L&&(r.depthMask(ae),j=ae)},setFunc:function(ae){if(z!==ae){switch(ae){case Pd:r.depthFunc(r.NEVER);break;case pu:r.depthFunc(r.ALWAYS);break;case Zn:r.depthFunc(r.LESS);break;case gl:r.depthFunc(r.LEQUAL);break;case du:r.depthFunc(r.EQUAL);break;case mu:r.depthFunc(r.GEQUAL);break;case _o:r.depthFunc(r.GREATER);break;case Nn:r.depthFunc(r.NOTEQUAL);break;default:r.depthFunc(r.LEQUAL)}z=ae}},setLocked:function(ae){L=ae},setClear:function(ae){J!==ae&&(r.clearDepth(ae),J=ae)},reset:function(){L=!1,j=null,z=null,J=null}}}function a(){let L=!1,j=null,z=null,J=null,ae=null,Re=null,Le=null,Se=null,ke=null;return{setTest:function(Ke){L||(Ke?rt(r.STENCIL_TEST):xt(r.STENCIL_TEST))},setMask:function(Ke){j!==Ke&&!L&&(r.stencilMask(Ke),j=Ke)},setFunc:function(Ke,nt,pt){(z!==Ke||J!==nt||ae!==pt)&&(r.stencilFunc(Ke,nt,pt),z=Ke,J=nt,ae=pt)},setOp:function(Ke,nt,pt){(Re!==Ke||Le!==nt||Se!==pt)&&(r.stencilOp(Ke,nt,pt),Re=Ke,Le=nt,Se=pt)},setLocked:function(Ke){L=Ke},setClear:function(Ke){ke!==Ke&&(r.clearStencil(Ke),ke=Ke)},reset:function(){L=!1,j=null,z=null,J=null,ae=null,Re=null,Le=null,Se=null,ke=null}}}const o=new n,l=new s,c=new a,h=new WeakMap,d=new WeakMap;let m={},f={},v=new WeakMap,w=[],b=null,y=!1,E=null,_=null,C=null,M=null,S=null,R=null,U=null,T=!1,B=null,Q=null,Z=null,q=null,X=null;const te=r.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let me=!1,se=0;const he=r.getParameter(r.VERSION);he.indexOf("WebGL")!==-1?(se=parseFloat(/^WebGL (\d)/.exec(he)[1]),me=se>=1):he.indexOf("OpenGL ES")!==-1&&(se=parseFloat(/^OpenGL ES (\d)/.exec(he)[1]),me=se>=2);let _e=null,ge={};const Oe=r.getParameter(r.SCISSOR_BOX),oe=r.getParameter(r.VIEWPORT),be=new bt().fromArray(Oe),Me=new bt().fromArray(oe);function Ve(L,j,z,J){const ae=new Uint8Array(4),Re=r.createTexture();r.bindTexture(L,Re),r.texParameteri(L,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(L,r.TEXTURE_MAG_FILTER,r.NEAREST);for(let Le=0;Le<z;Le++)i&&(L===r.TEXTURE_3D||L===r.TEXTURE_2D_ARRAY)?r.texImage3D(j,0,r.RGBA,1,1,J,0,r.RGBA,r.UNSIGNED_BYTE,ae):r.texImage2D(j+Le,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,ae);return Re}const Ue={};Ue[r.TEXTURE_2D]=Ve(r.TEXTURE_2D,r.TEXTURE_2D,1),Ue[r.TEXTURE_CUBE_MAP]=Ve(r.TEXTURE_CUBE_MAP,r.TEXTURE_CUBE_MAP_POSITIVE_X,6),i&&(Ue[r.TEXTURE_2D_ARRAY]=Ve(r.TEXTURE_2D_ARRAY,r.TEXTURE_2D_ARRAY,1,1),Ue[r.TEXTURE_3D]=Ve(r.TEXTURE_3D,r.TEXTURE_3D,1,1)),o.setClear(0,0,0,1),l.setClear(1),c.setClear(0),rt(r.DEPTH_TEST),l.setFunc(gl),Ye(!1),Ee(yt),rt(r.CULL_FACE),Pe(Qt);function rt(L){m[L]!==!0&&(r.enable(L),m[L]=!0)}function xt(L){m[L]!==!1&&(r.disable(L),m[L]=!1)}function mt(L,j){return f[L]!==j?(r.bindFramebuffer(L,j),f[L]=j,i&&(L===r.DRAW_FRAMEBUFFER&&(f[r.FRAMEBUFFER]=j),L===r.FRAMEBUFFER&&(f[r.DRAW_FRAMEBUFFER]=j)),!0):!1}function Dt(L,j){let z=w,J=!1;if(L)if(z=v.get(j),z===void 0&&(z=[],v.set(j,z)),L.isWebGLMultipleRenderTargets){const ae=L.texture;if(z.length!==ae.length||z[0]!==r.COLOR_ATTACHMENT0){for(let Re=0,Le=ae.length;Re<Le;Re++)z[Re]=r.COLOR_ATTACHMENT0+Re;z.length=ae.length,J=!0}}else z[0]!==r.COLOR_ATTACHMENT0&&(z[0]=r.COLOR_ATTACHMENT0,J=!0);else z[0]!==r.BACK&&(z[0]=r.BACK,J=!0);J&&(t.isWebGL2?r.drawBuffers(z):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(z))}function we(L){return b!==L?(r.useProgram(L),b=L,!0):!1}const Y={[Da]:r.FUNC_ADD,[Td]:r.FUNC_SUBTRACT,[jg]:r.FUNC_REVERSE_SUBTRACT};if(i)Y[Id]=r.MIN,Y[gr]=r.MAX;else{const L=e.get("EXT_blend_minmax");L!==null&&(Y[Id]=L.MIN_EXT,Y[gr]=L.MAX_EXT)}const je={[Vt]:r.ZERO,[Hg]:r.ONE,[Wg]:r.SRC_COLOR,[Fn]:r.SRC_ALPHA,[uu]:r.SRC_ALPHA_SATURATE,[hu]:r.DST_COLOR,[Ri]:r.DST_ALPHA,[Xg]:r.ONE_MINUS_SRC_COLOR,[Ic]:r.ONE_MINUS_SRC_ALPHA,[qg]:r.ONE_MINUS_DST_COLOR,[xr]:r.ONE_MINUS_DST_ALPHA};function Pe(L,j,z,J,ae,Re,Le,Se){if(L===Qt){y===!0&&(xt(r.BLEND),y=!1);return}if(y===!1&&(rt(r.BLEND),y=!0),L!==$s){if(L!==E||Se!==T){if((_!==Da||S!==Da)&&(r.blendEquation(r.FUNC_ADD),_=Da,S=Da),Se)switch(L){case ii:r.blendFuncSeparate(r.ONE,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case Oi:r.blendFunc(r.ONE,r.ONE);break;case Si:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case Rr:r.blendFuncSeparate(r.ZERO,r.SRC_COLOR,r.ZERO,r.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",L);break}else switch(L){case ii:r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case Oi:r.blendFunc(r.SRC_ALPHA,r.ONE);break;case Si:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case Rr:r.blendFunc(r.ZERO,r.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",L);break}C=null,M=null,R=null,U=null,E=L,T=Se}return}ae=ae||j,Re=Re||z,Le=Le||J,(j!==_||ae!==S)&&(r.blendEquationSeparate(Y[j],Y[ae]),_=j,S=ae),(z!==C||J!==M||Re!==R||Le!==U)&&(r.blendFuncSeparate(je[z],je[J],je[Re],je[Le]),C=z,M=J,R=Re,U=Le),E=L,T=!1}function Te(L,j){L.side===dt?xt(r.CULL_FACE):rt(r.CULL_FACE);let z=L.side===$e;j&&(z=!z),Ye(z),L.blending===ii&&L.transparent===!1?Pe(Qt):Pe(L.blending,L.blendEquation,L.blendSrc,L.blendDst,L.blendEquationAlpha,L.blendSrcAlpha,L.blendDstAlpha,L.premultipliedAlpha),l.setFunc(L.depthFunc),l.setTest(L.depthTest),l.setMask(L.depthWrite),o.setMask(L.colorWrite);const J=L.stencilWrite;c.setTest(J),J&&(c.setMask(L.stencilWriteMask),c.setFunc(L.stencilFunc,L.stencilRef,L.stencilFuncMask),c.setOp(L.stencilFail,L.stencilZFail,L.stencilZPass)),ot(L.polygonOffset,L.polygonOffsetFactor,L.polygonOffsetUnits),L.alphaToCoverage===!0?rt(r.SAMPLE_ALPHA_TO_COVERAGE):xt(r.SAMPLE_ALPHA_TO_COVERAGE)}function Ye(L){B!==L&&(L?r.frontFace(r.CW):r.frontFace(r.CCW),B=L)}function Ee(L){L!==vi?(rt(r.CULL_FACE),L!==Q&&(L===yt?r.cullFace(r.BACK):L===zt?r.cullFace(r.FRONT):r.cullFace(r.FRONT_AND_BACK))):xt(r.CULL_FACE),Q=L}function at(L){L!==Z&&(me&&r.lineWidth(L),Z=L)}function ot(L,j,z){L?(rt(r.POLYGON_OFFSET_FILL),(q!==j||X!==z)&&(r.polygonOffset(j,z),q=j,X=z)):xt(r.POLYGON_OFFSET_FILL)}function Pt(L){L?rt(r.SCISSOR_TEST):xt(r.SCISSOR_TEST)}function Li(L){L===void 0&&(L=r.TEXTURE0+te-1),_e!==L&&(r.activeTexture(L),_e=L)}function Wi(L,j,z){z===void 0&&(_e===null?z=r.TEXTURE0+te-1:z=_e);let J=ge[z];J===void 0&&(J={type:void 0,texture:void 0},ge[z]=J),(J.type!==L||J.texture!==j)&&(_e!==z&&(r.activeTexture(z),_e=z),r.bindTexture(L,j||Ue[L]),J.type=L,J.texture=j)}function G(){const L=ge[_e];L!==void 0&&L.type!==void 0&&(r.bindTexture(L.type,null),L.type=void 0,L.texture=void 0)}function F(){try{r.compressedTexImage2D.apply(r,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function ye(){try{r.compressedTexImage3D.apply(r,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function Ge(){try{r.texSubImage2D.apply(r,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function ze(){try{r.texSubImage3D.apply(r,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function V(){try{r.compressedTexSubImage2D.apply(r,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function Ce(){try{r.compressedTexSubImage3D.apply(r,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function Be(){try{r.texStorage2D.apply(r,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function Ae(){try{r.texStorage3D.apply(r,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function ut(){try{r.texImage2D.apply(r,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function ft(){try{r.texImage3D.apply(r,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function He(L){be.equals(L)===!1&&(r.scissor(L.x,L.y,L.z,L.w),be.copy(L))}function ct(L){Me.equals(L)===!1&&(r.viewport(L.x,L.y,L.z,L.w),Me.copy(L))}function lt(L,j){let z=d.get(j);z===void 0&&(z=new WeakMap,d.set(j,z));let J=z.get(L);J===void 0&&(J=r.getUniformBlockIndex(j,L.name),z.set(L,J))}function I(L,j){const z=d.get(j).get(L);h.get(j)!==z&&(r.uniformBlockBinding(j,z,L.__bindingPointIndex),h.set(j,z))}function k(){r.disable(r.BLEND),r.disable(r.CULL_FACE),r.disable(r.DEPTH_TEST),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SCISSOR_TEST),r.disable(r.STENCIL_TEST),r.disable(r.SAMPLE_ALPHA_TO_COVERAGE),r.blendEquation(r.FUNC_ADD),r.blendFunc(r.ONE,r.ZERO),r.blendFuncSeparate(r.ONE,r.ZERO,r.ONE,r.ZERO),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0),r.depthMask(!0),r.depthFunc(r.LESS),r.clearDepth(1),r.stencilMask(4294967295),r.stencilFunc(r.ALWAYS,0,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),r.clearStencil(0),r.cullFace(r.BACK),r.frontFace(r.CCW),r.polygonOffset(0,0),r.activeTexture(r.TEXTURE0),r.bindFramebuffer(r.FRAMEBUFFER,null),i===!0&&(r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),r.bindFramebuffer(r.READ_FRAMEBUFFER,null)),r.useProgram(null),r.lineWidth(1),r.scissor(0,0,r.canvas.width,r.canvas.height),r.viewport(0,0,r.canvas.width,r.canvas.height),m={},_e=null,ge={},f={},v=new WeakMap,w=[],b=null,y=!1,E=null,_=null,C=null,M=null,S=null,R=null,U=null,T=!1,B=null,Q=null,Z=null,q=null,X=null,be.set(0,0,r.canvas.width,r.canvas.height),Me.set(0,0,r.canvas.width,r.canvas.height),o.reset(),l.reset(),c.reset()}return{buffers:{color:o,depth:l,stencil:c},enable:rt,disable:xt,bindFramebuffer:mt,drawBuffers:Dt,useProgram:we,setBlending:Pe,setMaterial:Te,setFlipSided:Ye,setCullFace:Ee,setLineWidth:at,setPolygonOffset:ot,setScissorTest:Pt,activeTexture:Li,bindTexture:Wi,unbindTexture:G,compressedTexImage2D:F,compressedTexImage3D:ye,texImage2D:ut,texImage3D:ft,updateUBOMapping:lt,uniformBlockBinding:I,texStorage2D:Be,texStorage3D:Ae,texSubImage2D:Ge,texSubImage3D:ze,compressedTexSubImage2D:V,compressedTexSubImage3D:Ce,scissor:He,viewport:ct,reset:k}}function pP(r,e,t,i,n,s,a){const o=n.isWebGL2,l=n.maxTextures,c=n.maxCubemapSize,h=n.maxTextureSize,d=n.maxSamples,m=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,f=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),v=new WeakMap;let w;const b=new WeakMap;let y=!1;try{y=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function E(G,F){return y?new OffscreenCanvas(G,F):Ms("canvas")}function _(G,F,ye,Ge){let ze=1;if((G.width>Ge||G.height>Ge)&&(ze=Ge/Math.max(G.width,G.height)),ze<1||F===!0)if(typeof HTMLImageElement<"u"&&G instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&G instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&G instanceof ImageBitmap){const V=F?Mn:Math.floor,Ce=V(ze*G.width),Be=V(ze*G.height);w===void 0&&(w=E(Ce,Be));const Ae=ye?E(Ce,Be):w;return Ae.width=Ce,Ae.height=Be,Ae.getContext("2d").drawImage(G,0,0,Ce,Be),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+G.width+"x"+G.height+") to ("+Ce+"x"+Be+")."),Ae}else return"data"in G&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+G.width+"x"+G.height+")."),G;return G}function C(G){return Br(G.width)&&Br(G.height)}function M(G){return o?!1:G.wrapS!==ai||G.wrapT!==ai||G.minFilter!==Ai&&G.minFilter!==Et}function S(G,F){return G.generateMipmaps&&F&&G.minFilter!==Ai&&G.minFilter!==Et}function R(G){r.generateMipmap(G)}function U(G,F,ye,Ge,ze=!1){if(o===!1)return F;if(G!==null){if(r[G]!==void 0)return r[G];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+G+"'")}let V=F;return F===r.RED&&(ye===r.FLOAT&&(V=r.R32F),ye===r.HALF_FLOAT&&(V=r.R16F),ye===r.UNSIGNED_BYTE&&(V=r.R8)),F===r.RG&&(ye===r.FLOAT&&(V=r.RG32F),ye===r.HALF_FLOAT&&(V=r.RG16F),ye===r.UNSIGNED_BYTE&&(V=r.RG8)),F===r.RGBA&&(ye===r.FLOAT&&(V=r.RGBA32F),ye===r.HALF_FLOAT&&(V=r.RGBA16F),ye===r.UNSIGNED_BYTE&&(V=Ge===it&&ze===!1?r.SRGB8_ALPHA8:r.RGBA8),ye===r.UNSIGNED_SHORT_4_4_4_4&&(V=r.RGBA4),ye===r.UNSIGNED_SHORT_5_5_5_1&&(V=r.RGB5_A1)),(V===r.R16F||V===r.R32F||V===r.RG16F||V===r.RG32F||V===r.RGBA16F||V===r.RGBA32F)&&e.get("EXT_color_buffer_float"),V}function T(G,F,ye){return S(G,ye)===!0||G.isFramebufferTexture&&G.minFilter!==Ai&&G.minFilter!==Et?Math.log2(Math.max(F.width,F.height))+1:G.mipmaps!==void 0&&G.mipmaps.length>0?G.mipmaps.length:G.isCompressedTexture&&Array.isArray(G.image)?F.mipmaps.length:1}function B(G){return G===Ai||G===es||G===Gn?r.NEAREST:r.LINEAR}function Q(G){const F=G.target;F.removeEventListener("dispose",Q),q(F),F.isVideoTexture&&v.delete(F)}function Z(G){const F=G.target;F.removeEventListener("dispose",Z),te(F)}function q(G){const F=i.get(G);if(F.__webglInit===void 0)return;const ye=G.source,Ge=b.get(ye);if(Ge){const ze=Ge[F.__cacheKey];ze.usedTimes--,ze.usedTimes===0&&X(G),Object.keys(Ge).length===0&&b.delete(ye)}i.remove(G)}function X(G){const F=i.get(G);r.deleteTexture(F.__webglTexture);const ye=G.source,Ge=b.get(ye);delete Ge[F.__cacheKey],a.memory.textures--}function te(G){const F=G.texture,ye=i.get(G),Ge=i.get(F);if(Ge.__webglTexture!==void 0&&(r.deleteTexture(Ge.__webglTexture),a.memory.textures--),G.depthTexture&&G.depthTexture.dispose(),G.isWebGLCubeRenderTarget)for(let ze=0;ze<6;ze++)r.deleteFramebuffer(ye.__webglFramebuffer[ze]),ye.__webglDepthbuffer&&r.deleteRenderbuffer(ye.__webglDepthbuffer[ze]);else{if(r.deleteFramebuffer(ye.__webglFramebuffer),ye.__webglDepthbuffer&&r.deleteRenderbuffer(ye.__webglDepthbuffer),ye.__webglMultisampledFramebuffer&&r.deleteFramebuffer(ye.__webglMultisampledFramebuffer),ye.__webglColorRenderbuffer)for(let ze=0;ze<ye.__webglColorRenderbuffer.length;ze++)ye.__webglColorRenderbuffer[ze]&&r.deleteRenderbuffer(ye.__webglColorRenderbuffer[ze]);ye.__webglDepthRenderbuffer&&r.deleteRenderbuffer(ye.__webglDepthRenderbuffer)}if(G.isWebGLMultipleRenderTargets)for(let ze=0,V=F.length;ze<V;ze++){const Ce=i.get(F[ze]);Ce.__webglTexture&&(r.deleteTexture(Ce.__webglTexture),a.memory.textures--),i.remove(F[ze])}i.remove(F),i.remove(G)}let me=0;function se(){me=0}function he(){const G=me;return G>=l&&console.warn("THREE.WebGLTextures: Trying to use "+G+" texture units while this GPU supports only "+l),me+=1,G}function _e(G){const F=[];return F.push(G.wrapS),F.push(G.wrapT),F.push(G.wrapR||0),F.push(G.magFilter),F.push(G.minFilter),F.push(G.anisotropy),F.push(G.internalFormat),F.push(G.format),F.push(G.type),F.push(G.generateMipmaps),F.push(G.premultiplyAlpha),F.push(G.flipY),F.push(G.unpackAlignment),F.push(G.colorSpace),F.join()}function ge(G,F){const ye=i.get(G);if(G.isVideoTexture&&Li(G),G.isRenderTargetTexture===!1&&G.version>0&&ye.__version!==G.version){const Ge=G.image;if(Ge===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ge.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{mt(ye,G,F);return}}t.bindTexture(r.TEXTURE_2D,ye.__webglTexture,r.TEXTURE0+F)}function Oe(G,F){const ye=i.get(G);if(G.version>0&&ye.__version!==G.version){mt(ye,G,F);return}t.bindTexture(r.TEXTURE_2D_ARRAY,ye.__webglTexture,r.TEXTURE0+F)}function oe(G,F){const ye=i.get(G);if(G.version>0&&ye.__version!==G.version){mt(ye,G,F);return}t.bindTexture(r.TEXTURE_3D,ye.__webglTexture,r.TEXTURE0+F)}function be(G,F){const ye=i.get(G);if(G.version>0&&ye.__version!==G.version){Dt(ye,G,F);return}t.bindTexture(r.TEXTURE_CUBE_MAP,ye.__webglTexture,r.TEXTURE0+F)}const Me={[Ar]:r.REPEAT,[ai]:r.CLAMP_TO_EDGE,[bs]:r.MIRRORED_REPEAT},Ve={[Ai]:r.NEAREST,[es]:r.NEAREST_MIPMAP_NEAREST,[Gn]:r.NEAREST_MIPMAP_LINEAR,[Et]:r.LINEAR,[Eo]:r.LINEAR_MIPMAP_NEAREST,[Er]:r.LINEAR_MIPMAP_LINEAR},Ue={[Jg]:r.NEVER,[tA]:r.ALWAYS,[bl]:r.LESS,[Ou]:r.LEQUAL,[Zg]:r.EQUAL,[eA]:r.GEQUAL,[Zd]:r.GREATER,[$g]:r.NOTEQUAL};function rt(G,F,ye){if(ye?(r.texParameteri(G,r.TEXTURE_WRAP_S,Me[F.wrapS]),r.texParameteri(G,r.TEXTURE_WRAP_T,Me[F.wrapT]),(G===r.TEXTURE_3D||G===r.TEXTURE_2D_ARRAY)&&r.texParameteri(G,r.TEXTURE_WRAP_R,Me[F.wrapR]),r.texParameteri(G,r.TEXTURE_MAG_FILTER,Ve[F.magFilter]),r.texParameteri(G,r.TEXTURE_MIN_FILTER,Ve[F.minFilter])):(r.texParameteri(G,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(G,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),(G===r.TEXTURE_3D||G===r.TEXTURE_2D_ARRAY)&&r.texParameteri(G,r.TEXTURE_WRAP_R,r.CLAMP_TO_EDGE),(F.wrapS!==ai||F.wrapT!==ai)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),r.texParameteri(G,r.TEXTURE_MAG_FILTER,B(F.magFilter)),r.texParameteri(G,r.TEXTURE_MIN_FILTER,B(F.minFilter)),F.minFilter!==Ai&&F.minFilter!==Et&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),F.compareFunction&&(r.texParameteri(G,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri(G,r.TEXTURE_COMPARE_FUNC,Ue[F.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){const Ge=e.get("EXT_texture_filter_anisotropic");if(F.magFilter===Ai||F.minFilter!==Gn&&F.minFilter!==Er||F.type===qt&&e.has("OES_texture_float_linear")===!1||o===!1&&F.type===di&&e.has("OES_texture_half_float_linear")===!1)return;(F.anisotropy>1||i.get(F).__currentAnisotropy)&&(r.texParameterf(G,Ge.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(F.anisotropy,n.getMaxAnisotropy())),i.get(F).__currentAnisotropy=F.anisotropy)}}function xt(G,F){let ye=!1;G.__webglInit===void 0&&(G.__webglInit=!0,F.addEventListener("dispose",Q));const Ge=F.source;let ze=b.get(Ge);ze===void 0&&(ze={},b.set(Ge,ze));const V=_e(F);if(V!==G.__cacheKey){ze[V]===void 0&&(ze[V]={texture:r.createTexture(),usedTimes:0},a.memory.textures++,ye=!0),ze[V].usedTimes++;const Ce=ze[G.__cacheKey];Ce!==void 0&&(ze[G.__cacheKey].usedTimes--,Ce.usedTimes===0&&X(F)),G.__cacheKey=V,G.__webglTexture=ze[V].texture}return ye}function mt(G,F,ye){let Ge=r.TEXTURE_2D;(F.isDataArrayTexture||F.isCompressedArrayTexture)&&(Ge=r.TEXTURE_2D_ARRAY),F.isData3DTexture&&(Ge=r.TEXTURE_3D);const ze=xt(G,F),V=F.source;t.bindTexture(Ge,G.__webglTexture,r.TEXTURE0+ye);const Ce=i.get(V);if(V.version!==Ce.__version||ze===!0){t.activeTexture(r.TEXTURE0+ye),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,F.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,F.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,F.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE);const Be=M(F)&&C(F.image)===!1;let Ae=_(F.image,Be,!1,h);Ae=Wi(F,Ae);const ut=C(Ae)||o,ft=s.convert(F.format,F.colorSpace);let He=s.convert(F.type),ct=U(F.internalFormat,ft,He,F.colorSpace);rt(Ge,F,ut);let lt;const I=F.mipmaps,k=o&&F.isVideoTexture!==!0,L=Ce.__version===void 0||ze===!0,j=T(F,Ae,ut);if(F.isDepthTexture)ct=r.DEPTH_COMPONENT,o?F.type===qt?ct=r.DEPTH_COMPONENT32F:F.type===un?ct=r.DEPTH_COMPONENT24:F.type===En?ct=r.DEPTH24_STENCIL8:ct=r.DEPTH_COMPONENT16:F.type===qt&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),F.format===ta&&ct===r.DEPTH_COMPONENT&&F.type!==Pc&&F.type!==un&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),F.type=un,He=s.convert(F.type)),F.format===Co&&ct===r.DEPTH_COMPONENT&&(ct=r.DEPTH_STENCIL,F.type!==En&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),F.type=En,He=s.convert(F.type))),L&&(k?t.texStorage2D(r.TEXTURE_2D,1,ct,Ae.width,Ae.height):t.texImage2D(r.TEXTURE_2D,0,ct,Ae.width,Ae.height,0,ft,He,null));else if(F.isDataTexture)if(I.length>0&&ut){k&&L&&t.texStorage2D(r.TEXTURE_2D,j,ct,I[0].width,I[0].height);for(let z=0,J=I.length;z<J;z++)lt=I[z],k?t.texSubImage2D(r.TEXTURE_2D,z,0,0,lt.width,lt.height,ft,He,lt.data):t.texImage2D(r.TEXTURE_2D,z,ct,lt.width,lt.height,0,ft,He,lt.data);F.generateMipmaps=!1}else k?(L&&t.texStorage2D(r.TEXTURE_2D,j,ct,Ae.width,Ae.height),t.texSubImage2D(r.TEXTURE_2D,0,0,0,Ae.width,Ae.height,ft,He,Ae.data)):t.texImage2D(r.TEXTURE_2D,0,ct,Ae.width,Ae.height,0,ft,He,Ae.data);else if(F.isCompressedTexture)if(F.isCompressedArrayTexture){k&&L&&t.texStorage3D(r.TEXTURE_2D_ARRAY,j,ct,I[0].width,I[0].height,Ae.depth);for(let z=0,J=I.length;z<J;z++)lt=I[z],F.format!==mi?ft!==null?k?t.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,z,0,0,0,lt.width,lt.height,Ae.depth,ft,lt.data,0,0):t.compressedTexImage3D(r.TEXTURE_2D_ARRAY,z,ct,lt.width,lt.height,Ae.depth,0,lt.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):k?t.texSubImage3D(r.TEXTURE_2D_ARRAY,z,0,0,0,lt.width,lt.height,Ae.depth,ft,He,lt.data):t.texImage3D(r.TEXTURE_2D_ARRAY,z,ct,lt.width,lt.height,Ae.depth,0,ft,He,lt.data)}else{k&&L&&t.texStorage2D(r.TEXTURE_2D,j,ct,I[0].width,I[0].height);for(let z=0,J=I.length;z<J;z++)lt=I[z],F.format!==mi?ft!==null?k?t.compressedTexSubImage2D(r.TEXTURE_2D,z,0,0,lt.width,lt.height,ft,lt.data):t.compressedTexImage2D(r.TEXTURE_2D,z,ct,lt.width,lt.height,0,lt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):k?t.texSubImage2D(r.TEXTURE_2D,z,0,0,lt.width,lt.height,ft,He,lt.data):t.texImage2D(r.TEXTURE_2D,z,ct,lt.width,lt.height,0,ft,He,lt.data)}else if(F.isDataArrayTexture)k?(L&&t.texStorage3D(r.TEXTURE_2D_ARRAY,j,ct,Ae.width,Ae.height,Ae.depth),t.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,0,Ae.width,Ae.height,Ae.depth,ft,He,Ae.data)):t.texImage3D(r.TEXTURE_2D_ARRAY,0,ct,Ae.width,Ae.height,Ae.depth,0,ft,He,Ae.data);else if(F.isData3DTexture)k?(L&&t.texStorage3D(r.TEXTURE_3D,j,ct,Ae.width,Ae.height,Ae.depth),t.texSubImage3D(r.TEXTURE_3D,0,0,0,0,Ae.width,Ae.height,Ae.depth,ft,He,Ae.data)):t.texImage3D(r.TEXTURE_3D,0,ct,Ae.width,Ae.height,Ae.depth,0,ft,He,Ae.data);else if(F.isFramebufferTexture){if(L)if(k)t.texStorage2D(r.TEXTURE_2D,j,ct,Ae.width,Ae.height);else{let z=Ae.width,J=Ae.height;for(let ae=0;ae<j;ae++)t.texImage2D(r.TEXTURE_2D,ae,ct,z,J,0,ft,He,null),z>>=1,J>>=1}}else if(I.length>0&&ut){k&&L&&t.texStorage2D(r.TEXTURE_2D,j,ct,I[0].width,I[0].height);for(let z=0,J=I.length;z<J;z++)lt=I[z],k?t.texSubImage2D(r.TEXTURE_2D,z,0,0,ft,He,lt):t.texImage2D(r.TEXTURE_2D,z,ct,ft,He,lt);F.generateMipmaps=!1}else k?(L&&t.texStorage2D(r.TEXTURE_2D,j,ct,Ae.width,Ae.height),t.texSubImage2D(r.TEXTURE_2D,0,0,0,ft,He,Ae)):t.texImage2D(r.TEXTURE_2D,0,ct,ft,He,Ae);S(F,ut)&&R(Ge),Ce.__version=V.version,F.onUpdate&&F.onUpdate(F)}G.__version=F.version}function Dt(G,F,ye){if(F.image.length!==6)return;const Ge=xt(G,F),ze=F.source;t.bindTexture(r.TEXTURE_CUBE_MAP,G.__webglTexture,r.TEXTURE0+ye);const V=i.get(ze);if(ze.version!==V.__version||Ge===!0){t.activeTexture(r.TEXTURE0+ye),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,F.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,F.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,F.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE);const Ce=F.isCompressedTexture||F.image[0].isCompressedTexture,Be=F.image[0]&&F.image[0].isDataTexture,Ae=[];for(let z=0;z<6;z++)!Ce&&!Be?Ae[z]=_(F.image[z],!1,!0,c):Ae[z]=Be?F.image[z].image:F.image[z],Ae[z]=Wi(F,Ae[z]);const ut=Ae[0],ft=C(ut)||o,He=s.convert(F.format,F.colorSpace),ct=s.convert(F.type),lt=U(F.internalFormat,He,ct,F.colorSpace),I=o&&F.isVideoTexture!==!0,k=V.__version===void 0||Ge===!0;let L=T(F,ut,ft);rt(r.TEXTURE_CUBE_MAP,F,ft);let j;if(Ce){I&&k&&t.texStorage2D(r.TEXTURE_CUBE_MAP,L,lt,ut.width,ut.height);for(let z=0;z<6;z++){j=Ae[z].mipmaps;for(let J=0;J<j.length;J++){const ae=j[J];F.format!==mi?He!==null?I?t.compressedTexSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+z,J,0,0,ae.width,ae.height,He,ae.data):t.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+z,J,lt,ae.width,ae.height,0,ae.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):I?t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+z,J,0,0,ae.width,ae.height,He,ct,ae.data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+z,J,lt,ae.width,ae.height,0,He,ct,ae.data)}}}else{j=F.mipmaps,I&&k&&(j.length>0&&L++,t.texStorage2D(r.TEXTURE_CUBE_MAP,L,lt,Ae[0].width,Ae[0].height));for(let z=0;z<6;z++)if(Be){I?t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+z,0,0,0,Ae[z].width,Ae[z].height,He,ct,Ae[z].data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+z,0,lt,Ae[z].width,Ae[z].height,0,He,ct,Ae[z].data);for(let J=0;J<j.length;J++){const ae=j[J].image[z].image;I?t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+z,J+1,0,0,ae.width,ae.height,He,ct,ae.data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+z,J+1,lt,ae.width,ae.height,0,He,ct,ae.data)}}else{I?t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+z,0,0,0,He,ct,Ae[z]):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+z,0,lt,He,ct,Ae[z]);for(let J=0;J<j.length;J++){const ae=j[J];I?t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+z,J+1,0,0,He,ct,ae.image[z]):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+z,J+1,lt,He,ct,ae.image[z])}}}S(F,ft)&&R(r.TEXTURE_CUBE_MAP),V.__version=ze.version,F.onUpdate&&F.onUpdate(F)}G.__version=F.version}function we(G,F,ye,Ge,ze){const V=s.convert(ye.format,ye.colorSpace),Ce=s.convert(ye.type),Be=U(ye.internalFormat,V,Ce,ye.colorSpace);i.get(F).__hasExternalTextures||(ze===r.TEXTURE_3D||ze===r.TEXTURE_2D_ARRAY?t.texImage3D(ze,0,Be,F.width,F.height,F.depth,0,V,Ce,null):t.texImage2D(ze,0,Be,F.width,F.height,0,V,Ce,null)),t.bindFramebuffer(r.FRAMEBUFFER,G),Pt(F)?m.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,Ge,ze,i.get(ye).__webglTexture,0,ot(F)):(ze===r.TEXTURE_2D||ze>=r.TEXTURE_CUBE_MAP_POSITIVE_X&&ze<=r.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&r.framebufferTexture2D(r.FRAMEBUFFER,Ge,ze,i.get(ye).__webglTexture,0),t.bindFramebuffer(r.FRAMEBUFFER,null)}function Y(G,F,ye){if(r.bindRenderbuffer(r.RENDERBUFFER,G),F.depthBuffer&&!F.stencilBuffer){let Ge=r.DEPTH_COMPONENT16;if(ye||Pt(F)){const ze=F.depthTexture;ze&&ze.isDepthTexture&&(ze.type===qt?Ge=r.DEPTH_COMPONENT32F:ze.type===un&&(Ge=r.DEPTH_COMPONENT24));const V=ot(F);Pt(F)?m.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,V,Ge,F.width,F.height):r.renderbufferStorageMultisample(r.RENDERBUFFER,V,Ge,F.width,F.height)}else r.renderbufferStorage(r.RENDERBUFFER,Ge,F.width,F.height);r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,G)}else if(F.depthBuffer&&F.stencilBuffer){const Ge=ot(F);ye&&Pt(F)===!1?r.renderbufferStorageMultisample(r.RENDERBUFFER,Ge,r.DEPTH24_STENCIL8,F.width,F.height):Pt(F)?m.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,Ge,r.DEPTH24_STENCIL8,F.width,F.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,F.width,F.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,G)}else{const Ge=F.isWebGLMultipleRenderTargets===!0?F.texture:[F.texture];for(let ze=0;ze<Ge.length;ze++){const V=Ge[ze],Ce=s.convert(V.format,V.colorSpace),Be=s.convert(V.type),Ae=U(V.internalFormat,Ce,Be,V.colorSpace),ut=ot(F);ye&&Pt(F)===!1?r.renderbufferStorageMultisample(r.RENDERBUFFER,ut,Ae,F.width,F.height):Pt(F)?m.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,ut,Ae,F.width,F.height):r.renderbufferStorage(r.RENDERBUFFER,Ae,F.width,F.height)}}r.bindRenderbuffer(r.RENDERBUFFER,null)}function je(G,F){if(F&&F.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(r.FRAMEBUFFER,G),!(F.depthTexture&&F.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(F.depthTexture).__webglTexture||F.depthTexture.image.width!==F.width||F.depthTexture.image.height!==F.height)&&(F.depthTexture.image.width=F.width,F.depthTexture.image.height=F.height,F.depthTexture.needsUpdate=!0),ge(F.depthTexture,0);const ye=i.get(F.depthTexture).__webglTexture,Ge=ot(F);if(F.depthTexture.format===ta)Pt(F)?m.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,ye,0,Ge):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,ye,0);else if(F.depthTexture.format===Co)Pt(F)?m.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,ye,0,Ge):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,ye,0);else throw new Error("Unknown depthTexture format")}function Pe(G){const F=i.get(G),ye=G.isWebGLCubeRenderTarget===!0;if(G.depthTexture&&!F.__autoAllocateDepthBuffer){if(ye)throw new Error("target.depthTexture not supported in Cube render targets");je(F.__webglFramebuffer,G)}else if(ye){F.__webglDepthbuffer=[];for(let Ge=0;Ge<6;Ge++)t.bindFramebuffer(r.FRAMEBUFFER,F.__webglFramebuffer[Ge]),F.__webglDepthbuffer[Ge]=r.createRenderbuffer(),Y(F.__webglDepthbuffer[Ge],G,!1)}else t.bindFramebuffer(r.FRAMEBUFFER,F.__webglFramebuffer),F.__webglDepthbuffer=r.createRenderbuffer(),Y(F.__webglDepthbuffer,G,!1);t.bindFramebuffer(r.FRAMEBUFFER,null)}function Te(G,F,ye){const Ge=i.get(G);F!==void 0&&we(Ge.__webglFramebuffer,G,G.texture,r.COLOR_ATTACHMENT0,r.TEXTURE_2D),ye!==void 0&&Pe(G)}function Ye(G){const F=G.texture,ye=i.get(G),Ge=i.get(F);G.addEventListener("dispose",Z),G.isWebGLMultipleRenderTargets!==!0&&(Ge.__webglTexture===void 0&&(Ge.__webglTexture=r.createTexture()),Ge.__version=F.version,a.memory.textures++);const ze=G.isWebGLCubeRenderTarget===!0,V=G.isWebGLMultipleRenderTargets===!0,Ce=C(G)||o;if(ze){ye.__webglFramebuffer=[];for(let Be=0;Be<6;Be++)ye.__webglFramebuffer[Be]=r.createFramebuffer()}else{if(ye.__webglFramebuffer=r.createFramebuffer(),V)if(n.drawBuffers){const Be=G.texture;for(let Ae=0,ut=Be.length;Ae<ut;Ae++){const ft=i.get(Be[Ae]);ft.__webglTexture===void 0&&(ft.__webglTexture=r.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&G.samples>0&&Pt(G)===!1){const Be=V?F:[F];ye.__webglMultisampledFramebuffer=r.createFramebuffer(),ye.__webglColorRenderbuffer=[],t.bindFramebuffer(r.FRAMEBUFFER,ye.__webglMultisampledFramebuffer);for(let Ae=0;Ae<Be.length;Ae++){const ut=Be[Ae];ye.__webglColorRenderbuffer[Ae]=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,ye.__webglColorRenderbuffer[Ae]);const ft=s.convert(ut.format,ut.colorSpace),He=s.convert(ut.type),ct=U(ut.internalFormat,ft,He,ut.colorSpace,G.isXRRenderTarget===!0),lt=ot(G);r.renderbufferStorageMultisample(r.RENDERBUFFER,lt,ct,G.width,G.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+Ae,r.RENDERBUFFER,ye.__webglColorRenderbuffer[Ae])}r.bindRenderbuffer(r.RENDERBUFFER,null),G.depthBuffer&&(ye.__webglDepthRenderbuffer=r.createRenderbuffer(),Y(ye.__webglDepthRenderbuffer,G,!0)),t.bindFramebuffer(r.FRAMEBUFFER,null)}}if(ze){t.bindTexture(r.TEXTURE_CUBE_MAP,Ge.__webglTexture),rt(r.TEXTURE_CUBE_MAP,F,Ce);for(let Be=0;Be<6;Be++)we(ye.__webglFramebuffer[Be],G,F,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+Be);S(F,Ce)&&R(r.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(V){const Be=G.texture;for(let Ae=0,ut=Be.length;Ae<ut;Ae++){const ft=Be[Ae],He=i.get(ft);t.bindTexture(r.TEXTURE_2D,He.__webglTexture),rt(r.TEXTURE_2D,ft,Ce),we(ye.__webglFramebuffer,G,ft,r.COLOR_ATTACHMENT0+Ae,r.TEXTURE_2D),S(ft,Ce)&&R(r.TEXTURE_2D)}t.unbindTexture()}else{let Be=r.TEXTURE_2D;(G.isWebGL3DRenderTarget||G.isWebGLArrayRenderTarget)&&(o?Be=G.isWebGL3DRenderTarget?r.TEXTURE_3D:r.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(Be,Ge.__webglTexture),rt(Be,F,Ce),we(ye.__webglFramebuffer,G,F,r.COLOR_ATTACHMENT0,Be),S(F,Ce)&&R(Be),t.unbindTexture()}G.depthBuffer&&Pe(G)}function Ee(G){const F=C(G)||o,ye=G.isWebGLMultipleRenderTargets===!0?G.texture:[G.texture],Ge=G.isWebGLCubeRenderTarget?r.TEXTURE_CUBE_MAP:r.TEXTURE_2D;for(let ze=0,V=ye.length;ze<V;ze++){const Ce=ye[ze],Be=i.get(Ce),Ae=Be.__webglTexture;Be.__version!==Ce.version&&(t.bindTexture(Ge,Ae),rt(Ge,Ce,F),t.unbindTexture(),Be.__version=Ce.version),S(Ce,F)&&(t.bindTexture(Ge,Ae),R(Ge),t.unbindTexture())}}function at(G){if(o&&G.samples>0&&Pt(G)===!1){const F=G.isWebGLMultipleRenderTargets?G.texture:[G.texture],ye=G.width,Ge=G.height;let ze=r.COLOR_BUFFER_BIT;const V=[],Ce=G.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,Be=i.get(G),Ae=G.isWebGLMultipleRenderTargets===!0;if(Ae)for(let ut=0;ut<F.length;ut++)t.bindFramebuffer(r.FRAMEBUFFER,Be.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+ut,r.RENDERBUFFER,null),t.bindFramebuffer(r.FRAMEBUFFER,Be.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+ut,r.TEXTURE_2D,null,0);t.bindFramebuffer(r.READ_FRAMEBUFFER,Be.__webglMultisampledFramebuffer),t.bindFramebuffer(r.DRAW_FRAMEBUFFER,Be.__webglFramebuffer);for(let ut=0;ut<F.length;ut++){V.push(r.COLOR_ATTACHMENT0+ut),G.depthBuffer&&V.push(Ce);const ft=Be.__ignoreDepthValues!==void 0?Be.__ignoreDepthValues:!1;if(ft===!1&&(G.depthBuffer&&(ze|=r.DEPTH_BUFFER_BIT),G.stencilBuffer&&(ze|=r.STENCIL_BUFFER_BIT)),Ae&&r.framebufferRenderbuffer(r.READ_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,Be.__webglColorRenderbuffer[ut]),ft===!0&&(r.invalidateFramebuffer(r.READ_FRAMEBUFFER,[Ce]),r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,[Ce])),Ae){const He=i.get(F[ut]).__webglTexture;r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,He,0)}r.blitFramebuffer(0,0,ye,Ge,0,0,ye,Ge,ze,r.NEAREST),f&&r.invalidateFramebuffer(r.READ_FRAMEBUFFER,V)}if(t.bindFramebuffer(r.READ_FRAMEBUFFER,null),t.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),Ae)for(let ut=0;ut<F.length;ut++){t.bindFramebuffer(r.FRAMEBUFFER,Be.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+ut,r.RENDERBUFFER,Be.__webglColorRenderbuffer[ut]);const ft=i.get(F[ut]).__webglTexture;t.bindFramebuffer(r.FRAMEBUFFER,Be.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+ut,r.TEXTURE_2D,ft,0)}t.bindFramebuffer(r.DRAW_FRAMEBUFFER,Be.__webglMultisampledFramebuffer)}}function ot(G){return Math.min(d,G.samples)}function Pt(G){const F=i.get(G);return o&&G.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&F.__useRenderToTexture!==!1}function Li(G){const F=a.render.frame;v.get(G)!==F&&(v.set(G,F),G.update())}function Wi(G,F){const ye=G.colorSpace,Ge=G.format,ze=G.type;return G.isCompressedTexture===!0||G.format===Fu||ye!==wi&&ye!==Xi&&(ye===it?o===!1?e.has("EXT_sRGB")===!0&&Ge===mi?(G.format=Fu,G.minFilter=Et,G.generateMipmaps=!1):F=Qc.sRGBToLinear(F):(Ge!==mi||ze!==oi)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):ye===_l||console.error("THREE.WebGLTextures: Unsupported texture color space:",ye)),F}this.allocateTextureUnit=he,this.resetTextureUnits=se,this.setTexture2D=ge,this.setTexture2DArray=Oe,this.setTexture3D=oe,this.setTextureCube=be,this.rebindTextures=Te,this.setupRenderTarget=Ye,this.updateRenderTargetMipmap=Ee,this.updateMultisampleRenderTarget=at,this.setupDepthRenderbuffer=Pe,this.setupFrameBufferTexture=we,this.useMultisampledRTT=Pt}function cb(r,e,t){const i=t.isWebGL2;function n(s,a=Xi){let o;if(s===oi)return r.UNSIGNED_BYTE;if(s===ts)return r.UNSIGNED_SHORT_4_4_4_4;if(s===Au)return r.UNSIGNED_SHORT_5_5_5_1;if(s===Ld)return r.BYTE;if(s===Ud)return r.SHORT;if(s===Pc)return r.UNSIGNED_SHORT;if(s===vl)return r.INT;if(s===un)return r.UNSIGNED_INT;if(s===qt)return r.FLOAT;if(s===di)return i?r.HALF_FLOAT:(o=e.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(s===Od)return r.ALPHA;if(s===mi)return r.RGBA;if(s===vu)return r.LUMINANCE;if(s===yu)return r.LUMINANCE_ALPHA;if(s===ta)return r.DEPTH_COMPONENT;if(s===Co)return r.DEPTH_STENCIL;if(s===Fu)return o=e.get("EXT_sRGB"),o!==null?o.SRGB_ALPHA_EXT:null;if(s===Mo)return r.RED;if(s===kd)return r.RED_INTEGER;if(s===La)return r.RG;if(s===Fd)return r.RG_INTEGER;if(s===Nd)return r.RGBA_INTEGER;if(s===ia||s===Rc||s===_u||s===So)if(a===it)if(o=e.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(s===ia)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===Rc)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===_u)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===So)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=e.get("WEBGL_compressed_texture_s3tc"),o!==null){if(s===ia)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===Rc)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===_u)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===So)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===bu||s===Ua||s===Dc||s===wu)if(o=e.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(s===bu)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===Ua)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===Dc)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===wu)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===Gd)return o=e.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===Bc||s===xu)if(o=e.get("WEBGL_compressed_texture_etc"),o!==null){if(s===Bc)return a===it?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(s===xu)return a===it?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===Oa||s===zd||s===Qd||s===Eu||s===Cu||s===Mu||s===Su||s===Vd||s===To||s===jd||s===Tu||s===Iu||s===Hd||s===Wd)if(o=e.get("WEBGL_compressed_texture_astc"),o!==null){if(s===Oa)return a===it?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===zd)return a===it?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===Qd)return a===it?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===Eu)return a===it?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===Cu)return a===it?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===Mu)return a===it?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===Su)return a===it?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===Vd)return a===it?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===To)return a===it?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===jd)return a===it?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===Tu)return a===it?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===Iu)return a===it?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===Hd)return a===it?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===Wd)return a===it?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===Lc)if(o=e.get("EXT_texture_compression_bptc"),o!==null){if(s===Lc)return a===it?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(s===Kg||s===Pu||s===Xd||s===qd)if(o=e.get("EXT_texture_compression_rgtc"),o!==null){if(s===Lc)return o.COMPRESSED_RED_RGTC1_EXT;if(s===Pu)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===Xd)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===qd)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===En?i?r.UNSIGNED_INT_24_8:(o=e.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null):r[s]!==void 0?r[s]:null}return{convert:n}}class hb extends Qi{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class fn extends It{constructor(){super(),this.isGroup=!0,this.type="Group"}}const dP={type:"move"};class rv{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new fn,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new fn,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new P,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new P),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new fn,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new P,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new P),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let n=null,s=null,a=null;const o=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){a=!0;for(const w of e.hand.values()){const b=t.getJointPose(w,i),y=this._getHandJoint(c,w);b!==null&&(y.matrix.fromArray(b.transform.matrix),y.matrix.decompose(y.position,y.rotation,y.scale),y.matrixWorldNeedsUpdate=!0,y.jointRadius=b.radius),y.visible=b!==null}const h=c.joints["index-finger-tip"],d=c.joints["thumb-tip"],m=h.position.distanceTo(d.position),f=.02,v=.005;c.inputState.pinching&&m>f+v?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&m<=f-v&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(n=t.getPose(e.targetRaySpace,i),n===null&&s!==null&&(n=s),n!==null&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(dP)))}return o!==null&&(o.visible=n!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=a!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new fn;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class nv extends Ti{constructor(e,t,i,n,s,a,o,l,c,h){if(h=h!==void 0?h:ta,h!==ta&&h!==Co)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&h===ta&&(i=un),i===void 0&&h===Co&&(i=En),super(null,n,s,a,o,l,h,i,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=o!==void 0?o:Ai,this.minFilter=l!==void 0?l:Ai,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class mP extends zi{constructor(e,t){super();const i=this;let n=null,s=1,a=null,o="local-floor",l=1,c=null,h=null,d=null,m=null,f=null,v=null;const w=t.getContextAttributes();let b=null,y=null;const E=[],_=[];let C=null;const M=new Qi;M.layers.enable(1),M.viewport=new bt;const S=new Qi;S.layers.enable(2),S.viewport=new bt;const R=[M,S],U=new hb;U.layers.enable(1),U.layers.enable(2);let T=null,B=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getCamera=function(){},this.setUserCamera=function(oe){C=oe},this.getController=function(oe){let be=E[oe];return be===void 0&&(be=new rv,E[oe]=be),be.getTargetRaySpace()},this.getControllerGrip=function(oe){let be=E[oe];return be===void 0&&(be=new rv,E[oe]=be),be.getGripSpace()},this.getHand=function(oe){let be=E[oe];return be===void 0&&(be=new rv,E[oe]=be),be.getHandSpace()};function Q(oe){const be=_.indexOf(oe.inputSource);if(be===-1)return;const Me=E[be];Me!==void 0&&(Me.update(oe.inputSource,oe.frame,c||a),Me.dispatchEvent({type:oe.type,data:oe.inputSource}))}function Z(){n.removeEventListener("select",Q),n.removeEventListener("selectstart",Q),n.removeEventListener("selectend",Q),n.removeEventListener("squeeze",Q),n.removeEventListener("squeezestart",Q),n.removeEventListener("squeezeend",Q),n.removeEventListener("end",Z),n.removeEventListener("inputsourceschange",q);for(let oe=0;oe<E.length;oe++){const be=_[oe];be!==null&&(_[oe]=null,E[oe].disconnect(be))}T=null,B=null,e.setRenderTarget(b),f=null,m=null,d=null,n=null,y=null,Oe.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(oe){s=oe,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(oe){o=oe,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||a},this.setReferenceSpace=function(oe){c=oe},this.getBaseLayer=function(){return m!==null?m:f},this.getBinding=function(){return d},this.getFrame=function(){return v},this.getSession=function(){return n},this.setSession=async function(oe){if(n=oe,n!==null){if(b=e.getRenderTarget(),n.addEventListener("select",Q),n.addEventListener("selectstart",Q),n.addEventListener("selectend",Q),n.addEventListener("squeeze",Q),n.addEventListener("squeezestart",Q),n.addEventListener("squeezeend",Q),n.addEventListener("end",Z),n.addEventListener("inputsourceschange",q),w.xrCompatible!==!0&&await t.makeXRCompatible(),n.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const be={antialias:n.renderState.layers===void 0?w.antialias:!0,alpha:!0,depth:w.depth,stencil:w.stencil,framebufferScaleFactor:s};f=new XRWebGLLayer(n,t,be),n.updateRenderState({baseLayer:f}),y=new Gr(f.framebufferWidth,f.framebufferHeight,{format:mi,type:oi,colorSpace:e.outputColorSpace,stencilBuffer:w.stencil})}else{let be=null,Me=null,Ve=null;w.depth&&(Ve=w.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,be=w.stencil?Co:ta,Me=w.stencil?En:un);const Ue={colorFormat:t.RGBA8,depthFormat:Ve,scaleFactor:s};d=new XRWebGLBinding(n,t),m=d.createProjectionLayer(Ue),n.updateRenderState({layers:[m]}),y=new Gr(m.textureWidth,m.textureHeight,{format:mi,type:oi,depthTexture:new nv(m.textureWidth,m.textureHeight,Me,void 0,void 0,void 0,void 0,void 0,void 0,be),stencilBuffer:w.stencil,colorSpace:e.outputColorSpace,samples:w.antialias?4:0});const rt=e.properties.get(y);rt.__ignoreDepthValues=m.ignoreDepthValues}y.isXRRenderTarget=!0,this.setFoveation(l),c=null,a=await n.requestReferenceSpace(o),Oe.setContext(n),Oe.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(n!==null)return n.environmentBlendMode};function q(oe){for(let be=0;be<oe.removed.length;be++){const Me=oe.removed[be],Ve=_.indexOf(Me);Ve>=0&&(_[Ve]=null,E[Ve].disconnect(Me))}for(let be=0;be<oe.added.length;be++){const Me=oe.added[be];let Ve=_.indexOf(Me);if(Ve===-1){for(let rt=0;rt<E.length;rt++)if(rt>=_.length){_.push(Me),Ve=rt;break}else if(_[rt]===null){_[rt]=Me,Ve=rt;break}if(Ve===-1)break}const Ue=E[Ve];Ue&&Ue.connect(Me)}}const X=new P,te=new P;function me(oe,be,Me){X.setFromMatrixPosition(be.matrixWorld),te.setFromMatrixPosition(Me.matrixWorld);const Ve=X.distanceTo(te),Ue=be.projectionMatrix.elements,rt=Me.projectionMatrix.elements,xt=Ue[14]/(Ue[10]-1),mt=Ue[14]/(Ue[10]+1),Dt=(Ue[9]+1)/Ue[5],we=(Ue[9]-1)/Ue[5],Y=(Ue[8]-1)/Ue[0],je=(rt[8]+1)/rt[0],Pe=xt*Y,Te=xt*je,Ye=Ve/(-Y+je),Ee=Ye*-Y;be.matrixWorld.decompose(oe.position,oe.quaternion,oe.scale),oe.translateX(Ee),oe.translateZ(Ye),oe.matrixWorld.compose(oe.position,oe.quaternion,oe.scale),oe.matrixWorldInverse.copy(oe.matrixWorld).invert();const at=xt+Ye,ot=mt+Ye,Pt=Pe-Ee,Li=Te+(Ve-Ee),Wi=Dt*mt/ot*at,G=we*mt/ot*at;oe.projectionMatrix.makePerspective(Pt,Li,Wi,G,at,ot),oe.projectionMatrixInverse.copy(oe.projectionMatrix).invert()}function se(oe,be){be===null?oe.matrixWorld.copy(oe.matrix):oe.matrixWorld.multiplyMatrices(be.matrixWorld,oe.matrix),oe.matrixWorldInverse.copy(oe.matrixWorld).invert()}this.updateCameraXR=function(oe){if(n===null)return oe;C&&(oe=C),U.near=S.near=M.near=oe.near,U.far=S.far=M.far=oe.far,(T!==U.near||B!==U.far)&&(n.updateRenderState({depthNear:U.near,depthFar:U.far}),T=U.near,B=U.far);const be=oe.parent,Me=U.cameras;se(U,be);for(let Ve=0;Ve<Me.length;Ve++)se(Me[Ve],be);return Me.length===2?me(U,M,S):U.projectionMatrix.copy(M.projectionMatrix),C&&he(U,be),U};function he(oe,be){const Me=C;be===null?Me.matrix.copy(oe.matrixWorld):(Me.matrix.copy(be.matrixWorld),Me.matrix.invert(),Me.matrix.multiply(oe.matrixWorld)),Me.matrix.decompose(Me.position,Me.quaternion,Me.scale),Me.updateMatrixWorld(!0);const Ve=Me.children;for(let Ue=0,rt=Ve.length;Ue<rt;Ue++)Ve[Ue].updateMatrixWorld(!0);Me.projectionMatrix.copy(oe.projectionMatrix),Me.projectionMatrixInverse.copy(oe.projectionMatrixInverse),Me.isPerspectiveCamera&&(Me.fov=Do*2*Math.atan(1/Me.projectionMatrix.elements[5]),Me.zoom=1)}this.getFoveation=function(){if(!(m===null&&f===null))return l},this.setFoveation=function(oe){l=oe,m!==null&&(m.fixedFoveation=oe),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=oe)};let _e=null;this.onPreAnimationFrameCallback=null;function ge(oe,be){if(i.onPreAnimationFrameCallback&&i.onPreAnimationFrameCallback(oe,be),h=be.getViewerPose(c||a),v=be,h!==null){const Me=h.views;f!==null&&(e.setRenderTargetFramebuffer(y,f.framebuffer),e.setRenderTarget(y));let Ve=!1;Me.length!==U.cameras.length&&(U.cameras.length=0,Ve=!0);for(let Ue=0;Ue<Me.length;Ue++){const rt=Me[Ue];let xt=null;if(f!==null)xt=f.getViewport(rt);else{const Dt=d.getViewSubImage(m,rt);xt=Dt.viewport,Ue===0&&(e.setRenderTargetTextures(y,Dt.colorTexture,m.ignoreDepthValues?void 0:Dt.depthStencilTexture),e.setRenderTarget(y))}let mt=R[Ue];mt===void 0&&(mt=new Qi,mt.layers.enable(Ue),mt.viewport=new bt,R[Ue]=mt),mt.matrix.fromArray(rt.transform.matrix),mt.matrix.decompose(mt.position,mt.quaternion,mt.scale),mt.projectionMatrix.fromArray(rt.projectionMatrix),mt.projectionMatrixInverse.copy(mt.projectionMatrix).invert(),mt.viewport.set(xt.x,xt.y,xt.width,xt.height),Ue===0&&(U.matrix.copy(mt.matrix),U.matrix.decompose(U.position,U.quaternion,U.scale)),Ve===!0&&U.cameras.push(mt)}}for(let Me=0;Me<E.length;Me++){const Ve=_[Me],Ue=E[Me];Ve!==null&&Ue!==void 0&&Ue.update(Ve,be,c||a)}_e&&_e(oe,be),be.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:be}),v=null}const Oe=new _m;Oe.setAnimationLoop(ge),this.setAnimationLoop=function(oe){_e=oe},this.dispose=function(){}}}function fP(r,e){function t(b,y){b.matrixAutoUpdate===!0&&b.updateMatrix(),y.value.copy(b.matrix)}function i(b,y){y.color.getRGB(b.fogColor.value,gm(r)),y.isFog?(b.fogNear.value=y.near,b.fogFar.value=y.far):y.isFogExp2&&(b.fogDensity.value=y.density)}function n(b,y,E,_,C){y.isMeshBasicMaterial||y.isMeshLambertMaterial?s(b,y):y.isMeshToonMaterial?(s(b,y),d(b,y)):y.isMeshPhongMaterial?(s(b,y),h(b,y)):y.isMeshStandardMaterial?(s(b,y),m(b,y),y.isMeshPhysicalMaterial&&f(b,y,C)):y.isMeshMatcapMaterial?(s(b,y),v(b,y)):y.isMeshDepthMaterial?s(b,y):y.isMeshDistanceMaterial?(s(b,y),w(b,y)):y.isMeshNormalMaterial?s(b,y):y.isLineBasicMaterial?(a(b,y),y.isLineDashedMaterial&&o(b,y)):y.isPointsMaterial?l(b,y,E,_):y.isSpriteMaterial?c(b,y):y.isShadowMaterial?(b.color.value.copy(y.color),b.opacity.value=y.opacity):y.isShaderMaterial&&(y.transmission!==void 0&&(b.transmission&&(b.transmission.value=y.transmission),b.transmissionSamplerMap&&C&&(b.transmissionSamplerMap.value=C?C.texture:null),b.transmissionSamplerSize&&C&&b.transmissionSamplerSize.value.set(C.width,C.height)),y.uniformsNeedUpdate=!1)}function s(b,y){b.opacity.value=y.opacity,y.color&&b.diffuse.value.copy(y.color),y.emissive&&b.emissive.value.copy(y.emissive).multiplyScalar(y.emissiveIntensity),y.map&&(b.map.value=y.map,t(y.map,b.mapTransform)),y.alphaMap&&(b.alphaMap.value=y.alphaMap,t(y.alphaMap,b.alphaMapTransform)),y.bumpMap&&(b.bumpMap.value=y.bumpMap,t(y.bumpMap,b.bumpMapTransform),b.bumpScale.value=y.bumpScale,y.side===$e&&(b.bumpScale.value*=-1)),y.normalMap&&(b.normalMap.value=y.normalMap,t(y.normalMap,b.normalMapTransform),b.normalScale.value.copy(y.normalScale),y.side===$e&&b.normalScale.value.negate()),y.displacementMap&&(b.displacementMap.value=y.displacementMap,t(y.displacementMap,b.displacementMapTransform),b.displacementScale.value=y.displacementScale,b.displacementBias.value=y.displacementBias),y.emissiveMap&&(b.emissiveMap.value=y.emissiveMap,t(y.emissiveMap,b.emissiveMapTransform)),y.specularMap&&(b.specularMap.value=y.specularMap,t(y.specularMap,b.specularMapTransform)),y.alphaTest>0&&(b.alphaTest.value=y.alphaTest);const E=e.get(y).envMap;if(E){b.envMap.value=E;const _=e.get(y).environment||E;b.envMapRotation.value=_?_.rotation:0,b.flipEnvMap.value=E.isCubeTexture&&E.isRenderTargetTexture===!1?-1:1,b.reflectivity.value=y.reflectivity,b.ior.value=y.ior,b.refractionRatio.value=y.refractionRatio}if(y.lightMap){b.lightMap.value=y.lightMap;const _=r.useLegacyLights===!0?Math.PI:1;b.lightMapIntensity.value=y.lightMapIntensity*_,t(y.lightMap,b.lightMapTransform)}y.aoMap&&(b.aoMap.value=y.aoMap,b.aoMapIntensity.value=y.aoMapIntensity,t(y.aoMap,b.aoMapTransform))}function a(b,y){b.diffuse.value.copy(y.color),b.opacity.value=y.opacity,y.map&&(b.map.value=y.map,t(y.map,b.mapTransform))}function o(b,y){b.dashSize.value=y.dashSize,b.totalSize.value=y.dashSize+y.gapSize,b.scale.value=y.scale}function l(b,y,E,_){b.diffuse.value.copy(y.color),b.opacity.value=y.opacity,b.size.value=y.size*E,b.scale.value=_*.5,y.map&&(b.map.value=y.map,t(y.map,b.uvTransform)),y.alphaMap&&(b.alphaMap.value=y.alphaMap,t(y.alphaMap,b.alphaMapTransform)),y.alphaTest>0&&(b.alphaTest.value=y.alphaTest)}function c(b,y){b.diffuse.value.copy(y.color),b.opacity.value=y.opacity,b.rotation.value=y.rotation,y.map&&(b.map.value=y.map,t(y.map,b.mapTransform)),y.alphaMap&&(b.alphaMap.value=y.alphaMap,t(y.alphaMap,b.alphaMapTransform)),y.alphaTest>0&&(b.alphaTest.value=y.alphaTest)}function h(b,y){b.specular.value.copy(y.specular),b.shininess.value=Math.max(y.shininess,1e-4)}function d(b,y){y.gradientMap&&(b.gradientMap.value=y.gradientMap)}function m(b,y){b.metalness.value=y.metalness,y.metalnessMap&&(b.metalnessMap.value=y.metalnessMap,t(y.metalnessMap,b.metalnessMapTransform)),b.roughness.value=y.roughness,y.roughnessMap&&(b.roughnessMap.value=y.roughnessMap,t(y.roughnessMap,b.roughnessMapTransform)),e.get(y).envMap&&(b.envMapIntensity.value=y.envMapIntensity)}function f(b,y,E){b.ior.value=y.ior,y.sheen>0&&(b.sheenColor.value.copy(y.sheenColor).multiplyScalar(y.sheen),b.sheenRoughness.value=y.sheenRoughness,y.sheenColorMap&&(b.sheenColorMap.value=y.sheenColorMap,t(y.sheenColorMap,b.sheenColorMapTransform)),y.sheenRoughnessMap&&(b.sheenRoughnessMap.value=y.sheenRoughnessMap,t(y.sheenRoughnessMap,b.sheenRoughnessMapTransform))),y.clearcoat>0&&(b.clearcoat.value=y.clearcoat,b.clearcoatRoughness.value=y.clearcoatRoughness,y.clearcoatMap&&(b.clearcoatMap.value=y.clearcoatMap,t(y.clearcoatMap,b.clearcoatMapTransform)),y.clearcoatRoughnessMap&&(b.clearcoatRoughnessMap.value=y.clearcoatRoughnessMap,t(y.clearcoatRoughnessMap,b.clearcoatRoughnessMapTransform)),y.clearcoatNormalMap&&(b.clearcoatNormalMap.value=y.clearcoatNormalMap,t(y.clearcoatNormalMap,b.clearcoatNormalMapTransform),b.clearcoatNormalScale.value.copy(y.clearcoatNormalScale),y.side===$e&&b.clearcoatNormalScale.value.negate())),y.iridescence>0&&(b.iridescence.value=y.iridescence,b.iridescenceIOR.value=y.iridescenceIOR,b.iridescenceThicknessMinimum.value=y.iridescenceThicknessRange[0],b.iridescenceThicknessMaximum.value=y.iridescenceThicknessRange[1],y.iridescenceMap&&(b.iridescenceMap.value=y.iridescenceMap,t(y.iridescenceMap,b.iridescenceMapTransform)),y.iridescenceThicknessMap&&(b.iridescenceThicknessMap.value=y.iridescenceThicknessMap,t(y.iridescenceThicknessMap,b.iridescenceThicknessMapTransform))),y.transmission>0&&(b.transmission.value=y.transmission,b.transmissionSamplerMap.value=E.texture,b.transmissionSamplerSize.value.set(E.width,E.height),y.transmissionMap&&(b.transmissionMap.value=y.transmissionMap,t(y.transmissionMap,b.transmissionMapTransform)),b.thickness.value=y.thickness,y.thicknessMap&&(b.thicknessMap.value=y.thicknessMap,t(y.thicknessMap,b.thicknessMapTransform)),b.attenuationDistance.value=y.attenuationDistance,b.attenuationColor.value.copy(y.attenuationColor)),y.anisotropy>0&&(b.anisotropyVector.value.set(y.anisotropy*Math.cos(y.anisotropyRotation),y.anisotropy*Math.sin(y.anisotropyRotation)),y.anisotropyMap&&(b.anisotropyMap.value=y.anisotropyMap,t(y.anisotropyMap,b.anisotropyMapTransform))),b.specularIntensity.value=y.specularIntensity,b.specularColor.value.copy(y.specularColor),y.specularColorMap&&(b.specularColorMap.value=y.specularColorMap,t(y.specularColorMap,b.specularColorMapTransform)),y.specularIntensityMap&&(b.specularIntensityMap.value=y.specularIntensityMap,t(y.specularIntensityMap,b.specularIntensityMapTransform))}function v(b,y){y.matcap&&(b.matcap.value=y.matcap)}function w(b,y){const E=e.get(y).light;b.referencePosition.value.setFromMatrixPosition(E.matrixWorld),b.nearDistance.value=E.shadow.camera.near,b.farDistance.value=E.shadow.camera.far}return{refreshTransformUniform:t,refreshFogUniforms:i,refreshMaterialUniforms:n}}function gP(r,e,t,i){let n={},s={},a=[];const o=t.isWebGL2?r.getParameter(r.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(E,_){const C=_.program;i.uniformBlockBinding(E,C)}function c(E,_){let C=n[E.id];C===void 0&&(v(E),C=h(E),n[E.id]=C,E.addEventListener("dispose",b));const M=_.program;i.updateUBOMapping(E,M);const S=e.render.frame;s[E.id]!==S&&(m(E),s[E.id]=S)}function h(E){const _=d();E.__bindingPointIndex=_;const C=r.createBuffer(),M=E.__size,S=E.usage;return r.bindBuffer(r.UNIFORM_BUFFER,C),r.bufferData(r.UNIFORM_BUFFER,M,S),r.bindBuffer(r.UNIFORM_BUFFER,null),r.bindBufferBase(r.UNIFORM_BUFFER,_,C),C}function d(){for(let E=0;E<o;E++)if(a.indexOf(E)===-1)return a.push(E),E;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function m(E){const _=n[E.id],C=E.uniforms,M=E.__cache;r.bindBuffer(r.UNIFORM_BUFFER,_);for(let S=0,R=C.length;S<R;S++){const U=C[S];if(f(U,S,M)===!0){const T=U.__offset,B=Array.isArray(U.value)?U.value:[U.value];let Q=0;for(let Z=0;Z<B.length;Z++){const q=B[Z],X=w(q);typeof q=="number"?(U.__data[0]=q,r.bufferSubData(r.UNIFORM_BUFFER,T+Q,U.__data)):q.isMatrix3?(U.__data[0]=q.elements[0],U.__data[1]=q.elements[1],U.__data[2]=q.elements[2],U.__data[3]=q.elements[0],U.__data[4]=q.elements[3],U.__data[5]=q.elements[4],U.__data[6]=q.elements[5],U.__data[7]=q.elements[0],U.__data[8]=q.elements[6],U.__data[9]=q.elements[7],U.__data[10]=q.elements[8],U.__data[11]=q.elements[0]):(q.toArray(U.__data,Q),Q+=X.storage/Float32Array.BYTES_PER_ELEMENT)}r.bufferSubData(r.UNIFORM_BUFFER,T,U.__data)}}r.bindBuffer(r.UNIFORM_BUFFER,null)}function f(E,_,C){const M=E.value;if(C[_]===void 0){if(typeof M=="number")C[_]=M;else{const S=Array.isArray(M)?M:[M],R=[];for(let U=0;U<S.length;U++)R.push(S[U].clone());C[_]=R}return!0}else if(typeof M=="number"){if(C[_]!==M)return C[_]=M,!0}else{const S=Array.isArray(C[_])?C[_]:[C[_]],R=Array.isArray(M)?M:[M];for(let U=0;U<S.length;U++){const T=S[U];if(T.equals(R[U])===!1)return T.copy(R[U]),!0}}return!1}function v(E){const _=E.uniforms;let C=0;const M=16;let S=0;for(let R=0,U=_.length;R<U;R++){const T=_[R],B={boundary:0,storage:0},Q=Array.isArray(T.value)?T.value:[T.value];for(let Z=0,q=Q.length;Z<q;Z++){const X=Q[Z],te=w(X);B.boundary+=te.boundary,B.storage+=te.storage}if(T.__data=new Float32Array(B.storage/Float32Array.BYTES_PER_ELEMENT),T.__offset=C,R>0){S=C%M;const Z=M-S;S!==0&&Z-B.boundary<0&&(C+=M-S,T.__offset=C)}C+=B.storage}return S=C%M,S>0&&(C+=M-S),E.__size=C,E.__cache={},this}function w(E){const _={boundary:0,storage:0};return typeof E=="number"?(_.boundary=4,_.storage=4):E.isVector2?(_.boundary=8,_.storage=8):E.isVector3||E.isColor?(_.boundary=16,_.storage=12):E.isVector4?(_.boundary=16,_.storage=16):E.isMatrix3?(_.boundary=48,_.storage=48):E.isMatrix4?(_.boundary=64,_.storage=64):E.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",E),_}function b(E){const _=E.target;_.removeEventListener("dispose",b);const C=a.indexOf(_.__bindingPointIndex);a.splice(C,1),r.deleteBuffer(n[_.id]),delete n[_.id],delete s[_.id]}function y(){for(const E in n)r.deleteBuffer(n[E]);a=[],n={},s={}}return{bind:l,update:c,dispose:y}}function AP(){const r=Ms("canvas");return r.style.display="block",r}class sp{constructor(e={}){const{canvas:t=AP(),context:i=null,depth:n=!0,stencil:s=!0,alpha:a=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:d=!1}=e;this.isWebGLRenderer=!0;let m;i!==null?m=i.getContextAttributes().alpha:m=a;const f=new Uint32Array(4),v=new Int32Array(4);let w=null,b=null;const y=[],E=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=it,this.useLegacyLights=!0,this.toneMapping=$n,this.toneMappingExposure=1,this.userData={},this.onContextLost=()=>{},this.onContextRestore=()=>{},this.onContextCreationError=()=>{};const _=this;let C=!1,M=0,S=0,R=null,U=-1,T=null;const B=new bt,Q=new bt;let Z=null;const q=new fe(0);let X=0,te=t.width,me=t.height,se=1,he=null,_e=null;const ge=new bt(0,0,te,me),Oe=new bt(0,0,te,me);let oe=!1;const be=new Xn;let Me=!1,Ve=!1,Ue=null;const rt=new et,xt=new ne,mt=new P,Dt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function we(){return R===null?se:1}let Y=i;function je(N,le){for(let pe=0;pe<N.length;pe++){const ie=N[pe],xe=t.getContext(ie,le);if(xe!==null)return xe}return null}try{const N={alpha:!0,depth:n,stencil:s,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:h,failIfMajorPerformanceCaveat:d};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Ze}`),t.addEventListener("webglcontextlost",j,!1),t.addEventListener("webglcontextrestored",z,!1),t.addEventListener("webglcontextcreationerror",J,!1),Y===null){const le=["webgl2","webgl","experimental-webgl"];if(_.isWebGL1Renderer===!0&&le.shift(),Y=je(le,N),Y===null)throw je(le)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Y instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),Y.getShaderPrecisionFormat===void 0&&(Y.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(N){throw console.error("THREE.WebGLRenderer: "+N.message),N}let Pe,Te,Ye,Ee,at,ot,Pt,Li,Wi,G,F,ye,Ge,ze,V,Ce,Be,Ae,ut,ft,He,ct,lt,I;function k(){Pe=new BT(Y),Te=new ST(Y,Pe,e),Pe.init(Te),ct=new cb(Y,Pe,Te),Ye=new uP(Y,Pe,Te),Ee=new OT(Y),at=new $I,ot=new pP(Y,Pe,Ye,at,Te,ct,Ee),Pt=new IT(_),Li=new DT(_),Wi=new EA(Y,Te),lt=new CT(Y,Pe,Wi,Te),G=new LT(Y,Wi,Ee,lt),F=new GT(Y,G,Wi,Ee),ut=new NT(Y,Te,ot),Ce=new TT(at),ye=new ZI(_,Pt,Li,Pe,Te,lt,Ce),Ge=new fP(_,at),ze=new tP,V=new oP(Pe,Te),Ae=new ET(_,Pt,Li,Ye,F,m,l),Be=new hP(_,F,Te),I=new gP(Y,Ee,Te,Ye),ft=new MT(Y,Pe,Ee,Te),He=new UT(Y,Pe,Ee,Te),Ee.programs=ye.programs,_.capabilities=Te,_.extensions=Pe,_.properties=at,_.renderLists=ze,_.shadowMap=Be,_.state=Ye,_.info=Ee,_.background=Ae,_.cubemaps=Pt,_.cubeuvmaps=Li,_.materials=Ge}k();const L=new mP(_,Y);this.xr=L,this.getContext=function(){return Y},this.getContextAttributes=function(){return Y.getContextAttributes()},this.forceContextLoss=function(){const N=Pe.get("WEBGL_lose_context");N&&N.loseContext()},this.forceContextRestore=function(){const N=Pe.get("WEBGL_lose_context");N&&N.restoreContext()},this.getPixelRatio=function(){return se},this.setPixelRatio=function(N){N!==void 0&&(se=N,this.setSize(te,me,!1))},this.getSize=function(N){return N.set(te,me)},this.setSize=function(N,le,pe=!0){if(L.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}te=N,me=le,t.width=Math.floor(N*se),t.height=Math.floor(le*se),pe===!0&&(t.style.width=N+"px",t.style.height=le+"px"),this.setViewport(0,0,N,le)},this.getDrawingBufferSize=function(N){return N.set(te*se,me*se).floor()},this.setDrawingBufferSize=function(N,le,pe){te=N,me=le,se=pe,t.width=Math.floor(N*pe),t.height=Math.floor(le*pe),this.setViewport(0,0,N,le)},this.getCurrentViewport=function(N){return N.copy(B)},this.getViewport=function(N){return N.copy(ge)},this.setViewport=function(N,le,pe,ie){N.isVector4?ge.set(N.x,N.y,N.z,N.w):ge.set(N,le,pe,ie),Ye.viewport(B.copy(ge).multiplyScalar(se).floor())},this.getScissor=function(N){return N.copy(Oe)},this.setScissor=function(N,le,pe,ie){N.isVector4?Oe.set(N.x,N.y,N.z,N.w):Oe.set(N,le,pe,ie),Ye.scissor(Q.copy(Oe).multiplyScalar(se).floor())},this.getScissorTest=function(){return oe},this.setScissorTest=function(N){Ye.setScissorTest(oe=N)},this.setOpaqueSort=function(N){he=N},this.setTransparentSort=function(N){_e=N},this.getClearColor=function(N){return N.copy(Ae.getClearColor())},this.setClearColor=function(){Ae.setClearColor.apply(Ae,arguments)},this.getClearAlpha=function(){return Ae.getClearAlpha()},this.setClearAlpha=function(){Ae.setClearAlpha.apply(Ae,arguments)},this.clear=function(N=!0,le=!0,pe=!0){let ie=0;if(N){let xe=!1;if(R!==null){const Je=R.texture.format;xe=Je===Nd||Je===Fd||Je===kd}if(xe){const Je=R.texture.type,St=Je===oi||Je===un||Je===Pc||Je===En||Je===ts||Je===Au,vt=Ae.getClearColor(),Ut=Ae.getClearAlpha(),pi=vt.r,Yt=vt.g,Ot=vt.b,er=at.get(R).__webglFramebuffer;St?(f[0]=pi,f[1]=Yt,f[2]=Ot,f[3]=Ut,Y.clearBufferuiv(Y.COLOR,er,f)):(v[0]=pi,v[1]=Yt,v[2]=Ot,v[3]=Ut,Y.clearBufferiv(Y.COLOR,er,v))}else ie|=Y.COLOR_BUFFER_BIT}le&&(ie|=Y.DEPTH_BUFFER_BIT),pe&&(ie|=Y.STENCIL_BUFFER_BIT),Y.clear(ie)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",j,!1),t.removeEventListener("webglcontextrestored",z,!1),t.removeEventListener("webglcontextcreationerror",J,!1),ze.dispose(),V.dispose(),at.dispose(),Pt.dispose(),Li.dispose(),F.dispose(),lt.dispose(),I.dispose(),ye.dispose(),L.dispose(),L.removeEventListener("sessionstart",Ke),L.removeEventListener("sessionend",nt),Ue&&(Ue.dispose(),Ue=null),pt.stop()};function j(N){N.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),C=!0,_.onContextLost(N)}function z(){console.log("THREE.WebGLRenderer: Context Restored."),C=!1;const N=_.info?_.info.autoReset:void 0,le=Be.enabled,pe=Be.autoUpdate,ie=Be.needsUpdate,xe=Be.type;k(),_.info&&N!==void 0&&(_.info.autoReset=N),Be.enabled=le,Be.autoUpdate=pe,Be.needsUpdate=ie,Be.type=xe,_.onContextRestore&&_.onContextRestore(),console.log("restored")}function J(N){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",N.statusMessage),_.onContextCreationError(N)}function ae(N){const le=N.target;le.removeEventListener("dispose",ae),Re(le)}function Re(N){Le(N),at.remove(N)}function Le(N){const le=at.get(N).programs;le!==void 0&&(le.forEach(function(pe){ye.releaseProgram(pe)}),N.isShaderMaterial&&ye.releaseShaderCache(N))}this.renderBufferDirect=function(N,le,pe,ie,xe,Je){le===null&&(le=Dt);const St=xe.isMesh&&xe.matrixWorld.determinant()<0,vt=Pi(N,le,pe,ie,xe);Ye.setMaterial(ie,St);let Ut=pe.index,pi=1;ie.wireframe===!0&&(Ut=G.getWireframeAttribute(pe),pi=2);const Yt=pe.drawRange,Ot=pe.attributes.position;let er=Yt.start*pi,fr=(Yt.start+Yt.count)*pi;Je!==null&&(er=Math.max(er,Je.start*pi),fr=Math.min(fr,(Je.start+Je.count)*pi)),Ut!==null?(er=Math.max(er,0),fr=Math.min(fr,Ut.count)):Ot!=null&&(er=Math.max(er,0),fr=Math.min(fr,Ot.count));const Ys=fr-er;if(Ys<0||Ys===1/0)return;lt.setup(xe,ie,vt,pe,Ut);let Ao,wr=ft;if(Ut!==null&&(Ao=Wi.get(Ut),wr=He,wr.setIndex(Ao)),xe.isMesh)ie.wireframe===!0?(Ye.setLineWidth(ie.wireframeLinewidth*we()),wr.setMode(Y.LINES)):wr.setMode(Y.TRIANGLES);else if(xe.isLine){let gi=ie.linewidth;gi===void 0&&(gi=1),Ye.setLineWidth(gi*we()),xe.isLineSegments?wr.setMode(Y.LINES):xe.isLineLoop?wr.setMode(Y.LINE_LOOP):wr.setMode(Y.LINE_STRIP)}else xe.isPoints?wr.setMode(Y.POINTS):xe.isSprite&&wr.setMode(Y.TRIANGLES);if(xe.isInstancedMesh)wr.renderInstances(er,Ys,xe.count);else if(pe.isInstancedBufferGeometry){const gi=pe._maxInstanceCount!==void 0?pe._maxInstanceCount:1/0,I_=Math.min(pe.instanceCount,gi);wr.renderInstances(er,Ys,I_)}else wr.render(er,Ys)},this.compile=function(N,le){function pe(ie,xe,Je){ie.transparent===!0&&ie.side===dt&&ie.forceSinglePass===!1?(ie.side=$e,ie.needsUpdate=!0,Ui(ie,xe,Je),ie.side=Ie,ie.needsUpdate=!0,Ui(ie,xe,Je),ie.side=dt):Ui(ie,xe,Je)}b=V.get(N),b.init(),E.push(b),N.traverseVisible(function(ie){ie.isLight&&ie.layers.test(le.layers)&&(b.pushLight(ie),ie.castShadow&&b.pushShadow(ie))}),b.setupLights(_.useLegacyLights),N.traverse(function(ie){const xe=ie.material;if(xe)if(Array.isArray(xe))for(let Je=0;Je<xe.length;Je++){const St=xe[Je];pe(St,N,ie)}else pe(xe,N,ie)}),E.pop(),b=null};let Se=null;function ke(N){Se&&Se(N)}function Ke(){pt.stop()}function nt(){pt.start()}const pt=new _m;pt.setAnimationLoop(ke),typeof self<"u"&&pt.setContext(self),this.setAnimationLoop=function(N){Se=N,L.setAnimationLoop(N),N===null?pt.stop():pt.start()},L.addEventListener("sessionstart",Ke),L.addEventListener("sessionend",nt),this.render=function(N,le){if(le!==void 0&&le.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(C!==!0){if(N.matrixWorldAutoUpdate===!0&&N.updateMatrixWorld(),le.parent===null&&le.matrixWorldAutoUpdate===!0&&le.updateMatrixWorld(),L.enabled===!0&&L.isPresenting===!0&&(le=L.updateCameraXR(le)),N.isScene===!0&&N.onBeforeRender(_,N,le,R),b=V.get(N,E.length),b.init(),E.push(b),rt.multiplyMatrices(le.projectionMatrix,le.matrixWorldInverse),be.setFromProjectionMatrix(rt),Ve=this.localClippingEnabled,Me=Ce.init(this.clippingPlanes,Ve),w=ze.get(N,y.length),w.init(),y.push(w),jt(N,le,0,_.sortObjects),w.finish(),_.sortObjects===!0&&w.sort(he,_e),_.userData.shadowMapRender!==!1){Me===!0&&Ce.beginShadows();const pe=b.state.shadowsArray;pe.length>0&&Be.render(pe,N,le),Me===!0&&Ce.endShadows()}if(this.info.autoReset===!0&&this.info.reset(),this.info.render.frame++,_.userData.backgroundRender!==!1&&Ae.render(w,N),_.userData.sceneRender!==!1)if(b.setupLights(_.useLegacyLights),le.isArrayCamera){const pe=le.cameras;for(let ie=0,xe=pe.length;ie<xe;ie++){const Je=pe[ie];gt(w,N,Je,Je.viewport)}}else gt(w,N,le);R!==null&&(ot.updateMultisampleRenderTarget(R),ot.updateRenderTargetMipmap(R)),N.isScene===!0&&N.onAfterRender(_,N,le),lt.resetDefaultState(),U=-1,T=null,E.pop(),E.length>0?b=E[E.length-1]:b=null,y.pop(),y.length>0?w=y[y.length-1]:w=null}};function jt(N,le,pe,ie){if(N.visible===!1)return;if(N.layers.test(le.layers)){if(N.isGroup)pe=N.renderOrder;else if(N.isLOD)N.autoUpdate===!0&&N.update(le);else if(N.isLight)b.pushLight(N),N.castShadow&&b.pushShadow(N);else if(N.isSprite){if(!N.frustumCulled||be.intersectsSprite(N)){ie&&mt.setFromMatrixPosition(N.matrixWorld).applyMatrix4(rt);const Je=F.update(N),St=N.material;St.visible&&w.push(N,Je,St,pe,mt.z,null)}}else if((N.isMesh||N.isLine||N.isPoints)&&(!N.frustumCulled||be.intersectsObject(N))){N.isSkinnedMesh&&N.skeleton.frame!==Ee.render.frame&&(N.skeleton.update(),N.skeleton.frame=Ee.render.frame);const Je=F.update(N),St=N.material;if(ie&&(N.boundingSphere!==void 0?(N.boundingSphere===null&&N.computeBoundingSphere(),mt.copy(N.boundingSphere.center)):(Je.boundingSphere===null&&Je.computeBoundingSphere(),mt.copy(Je.boundingSphere.center)),mt.applyMatrix4(N.matrixWorld).applyMatrix4(rt)),Array.isArray(St)){const vt=Je.groups;for(let Ut=0,pi=vt.length;Ut<pi;Ut++){const Yt=vt[Ut],Ot=St[Yt.materialIndex];Ot&&Ot.visible&&w.push(N,Je,Ot,pe,mt.z,Yt)}}else St.visible&&w.push(N,Je,St,pe,mt.z,null)}}const xe=N.children;for(let Je=0,St=xe.length;Je<St;Je++)jt(xe[Je],le,pe,ie)}function gt(N,le,pe,ie){const xe=N.opaque,Je=N.transmissive,St=N.transparent;if(b.setupLightsView(pe),Me===!0&&Ce.setGlobalState(_.clippingPlanes,pe),_.userData.transmissionRender===void 0&&_.userData.renderTransmissionPass!==!1&&Je.length>0&&wt([...xe,...St],Je,le,pe),ie&&Ye.viewport(B.copy(ie)),_.userData.opaqueRender!==!1&&xe.length>0&&Xt(xe,le,pe),_.userData.transparentRender!==!1&&St.length>0&&Xt(St,le,pe),_.userData.transmissionRender!==!1&&Je.length>0){Ue||(Ue=new Gr(1,1));const vt=(_.userData.transmissionRenderTarget||Ue).texture,Ut=Te.isWebGL2,pi=vt.generateMipmaps,Yt=vt.minFilter;Ut&&_.userData.blurTransmissionTarget&&_.userData.transmissionRenderTarget&&(vt.generateMipmaps=!0,vt.minFilter=Er,vt.needsUpdate=!0,ot.updateMultisampleRenderTarget(_.userData.transmissionRenderTarget),ot.updateRenderTargetMipmap(_.userData.transmissionRenderTarget)),Xt(Je,le,pe),Ut&&_.userData.blurTransmissionTarget&&_.userData.transmissionRenderTarget&&(vt.generateMipmaps=pi,vt.minFilter=Yt,vt.needsUpdate=!0,ot.updateMultisampleRenderTarget(_.userData.transmissionRenderTarget),ot.updateRenderTargetMipmap(_.userData.transmissionRenderTarget))}Ye.buffers.depth.setTest(!0),Ye.buffers.depth.setMask(!0),Ye.buffers.color.setMask(!0),Ye.setPolygonOffset(!1)}function wt(N,le,pe,ie){console.warn("three.js internal render transmission pass should not be called");const xe=Te.isWebGL2;Ue===null&&(Ue=new Gr(1,1,{generateMipmaps:!0,type:Pe.has("EXT_color_buffer_half_float")?di:oi,minFilter:Er,samples:xe&&o===!0?4:0})),_.getDrawingBufferSize(xt),xe?Ue.setSize(xt.x,xt.y):Ue.setSize(Mn(xt.x),Mn(xt.y));const Je=_.getRenderTarget();_.setRenderTarget(Ue),_.getClearColor(q),X=_.getClearAlpha(),X<1&&_.setClearColor(16777215,.5),_.clear();const St=_.toneMapping;_.toneMapping=$n,Xt(N,pe,ie),ot.updateMultisampleRenderTarget(Ue),ot.updateRenderTargetMipmap(Ue);let vt=!1;for(let Ut=0,pi=le.length;Ut<pi;Ut++){const Yt=le[Ut],Ot=Yt.object,er=Yt.geometry,fr=Yt.material,Ys=Yt.group;if(fr.side===dt&&Ot.layers.test(ie.layers)){const Ao=fr.side;fr.side=$e,fr.needsUpdate=!0,Gi(Ot,pe,ie,er,fr,Ys),fr.side=Ao,fr.needsUpdate=!0,vt=!0}}vt===!0&&(ot.updateMultisampleRenderTarget(Ue),ot.updateRenderTargetMipmap(Ue)),_.setRenderTarget(Je),_.setClearColor(q,X),_.toneMapping=St}function Xt(N,le,pe){const ie={..._.userData};_.userData.opaqueRender=void 0,_.userData.transparentRender=void 0,_.userData.transmissionRender=void 0,_.userData.backgroundRender=void 0;const xe=le.isScene===!0?le.overrideMaterial:null;for(let Je=0,St=N.length;Je<St;Je++){const vt=N[Je],Ut=vt.object,pi=vt.geometry,Yt=xe===null?vt.material:xe,Ot=vt.group;Ut.layers.test(pe.layers)&&Gi(Ut,le,pe,pi,Yt,Ot)}Object.assign(_.userData,ie)}function Gi(N,le,pe,ie,xe,Je){N.onBeforeRender(_,le,pe,ie,xe,Je),N.modelViewMatrix.multiplyMatrices(pe.matrixWorldInverse,N.matrixWorld),N.normalMatrix.getNormalMatrix(N.modelViewMatrix),xe.onBeforeRender(_,le,pe,ie,N,Je),xe.transparent===!0&&xe.side===dt&&xe.forceSinglePass===!1?(xe.side=$e,xe.needsUpdate=!0,_.renderBufferDirect(pe,le,ie,xe,N,Je),xe.side=Ie,xe.needsUpdate=!0,_.renderBufferDirect(pe,le,ie,xe,N,Je),xe.side=dt):_.renderBufferDirect(pe,le,ie,xe,N,Je),N.onAfterRender(_,le,pe,ie,xe,Je),xe.onAfterRender(_,le,pe,ie,N,Je)}function Ui(N,le,pe){le.isScene!==!0&&(le=Dt);const ie=at.get(N),xe=b.state.lights,Je=b.state.shadowsArray,St=xe.state.version,vt=ye.getParameters(N,xe.state,Je,le,pe),Ut=ye.getProgramCacheKey(vt);let pi=ie.programs;ie.environment=N.isMeshStandardMaterial?le.environment:null,ie.fog=le.fog,ie.envMap=(N.isMeshStandardMaterial?Li:Pt).get(N.envMap||ie.environment),pi===void 0&&(N.addEventListener("dispose",ae),pi=new Map,ie.programs=pi);let Yt=pi.get(Ut);if(Yt!==void 0){if(ie.currentProgram===Yt&&ie.lightsStateVersion===St)return cn(N,vt),Yt}else vt.uniforms=ye.getUniforms(N),N.onBuild(pe,vt,_),N.onBeforeCompile(vt,_),Yt=ye.acquireProgram(vt,Ut),pi.set(Ut,Yt),ie.uniforms=vt.uniforms;const Ot=ie.uniforms;(!N.isShaderMaterial&&!N.isRawShaderMaterial||N.clipping===!0)&&(Ot.clippingPlanes=Ce.uniform),cn(N,vt),ie.needsLights=mr(N),ie.lightsStateVersion=St,ie.needsLights&&(Ot.ambientLightColor.value=xe.state.ambient,Ot.lightProbe.value=xe.state.probe,Ot.directionalLights.value=xe.state.directional,Ot.directionalLightShadows.value=xe.state.directionalShadow,Ot.spotLights.value=xe.state.spot,Ot.spotLightShadows.value=xe.state.spotShadow,Ot.rectAreaLights.value=xe.state.rectArea,Ot.ltc_1.value=xe.state.rectAreaLTC1,Ot.ltc_2.value=xe.state.rectAreaLTC2,Ot.pointLights.value=xe.state.point,Ot.pointLightShadows.value=xe.state.pointShadow,Ot.hemisphereLights.value=xe.state.hemi,Ot.directionalShadowMap.value=xe.state.directionalShadowMap,Ot.directionalShadowMatrix.value=xe.state.directionalShadowMatrix,Ot.spotShadowMap.value=xe.state.spotShadowMap,Ot.spotLightMatrix.value=xe.state.spotLightMatrix,Ot.spotLightMap.value=xe.state.spotLightMap,Ot.pointShadowMap.value=xe.state.pointShadowMap,Ot.pointShadowMatrix.value=xe.state.pointShadowMatrix);const er=Yt.getUniforms(),fr=Rm.seqWithValue(er.seq,Ot);return ie.currentProgram=Yt,ie.uniformsList=fr,Yt}function cn(N,le){const pe=at.get(N);pe.outputColorSpace=le.outputColorSpace,pe.instancing=le.instancing,pe.skinning=le.skinning,pe.morphTargets=le.morphTargets,pe.morphNormals=le.morphNormals,pe.morphColors=le.morphColors,pe.morphTargetsCount=le.morphTargetsCount,pe.numClippingPlanes=le.numClippingPlanes,pe.numIntersection=le.numClipIntersection,pe.vertexAlphas=le.vertexAlphas,pe.vertexTangents=le.vertexTangents,pe.toneMapping=le.toneMapping}function Pi(N,le,pe,ie,xe){le.isScene!==!0&&(le=Dt),ot.resetTextureUnits();const Je=le.fog,St=ie.isMeshStandardMaterial?le.environment:null,vt=R===null?_.outputColorSpace:R.isXRRenderTarget===!0||R.texture.colorSpace&&R.texture.colorSpace!==it?R.texture.colorSpace:wi,Ut=(ie.isMeshStandardMaterial?Li:Pt).get(ie.envMap||St),pi=ie.vertexColors===!0&&!!pe.attributes.color&&pe.attributes.color.itemSize===4,Yt=!!pe.attributes.tangent&&(!!ie.normalMap||ie.anisotropy>0),Ot=!!pe.morphAttributes.position,er=!!pe.morphAttributes.normal,fr=!!pe.morphAttributes.color,Ys=ie.toneMapped?_.toneMapping:$n,Ao=pe.morphAttributes.position||pe.morphAttributes.normal||pe.morphAttributes.color,wr=Ao!==void 0?Ao.length:0,gi=at.get(ie),I_=b.state.lights;if(Me===!0&&(Ve===!0||N!==T)){const xn=N===T&&ie.id===U;Ce.setState(ie,N,xn)}let P_=!1;ie.version===gi.__version?(gi.needsLights&&gi.lightsStateVersion!==I_.state.version||gi.outputColorSpace!==vt||xe.isInstancedMesh&&gi.instancing===!1||!xe.isInstancedMesh&&gi.instancing===!0||xe.isSkinnedMesh&&gi.skinning===!1||!xe.isSkinnedMesh&&gi.skinning===!0||gi.envMap!==Ut||ie.fog===!0&&gi.fog!==Je||gi.numClippingPlanes!==void 0&&(gi.numClippingPlanes!==Ce.numPlanes||gi.numIntersection!==Ce.numIntersection)||gi.vertexAlphas!==pi||gi.vertexTangents!==Yt||gi.morphTargets!==Ot||gi.morphNormals!==er||gi.morphColors!==fr||gi.toneMapping!==Ys||Te.isWebGL2===!0&&gi.morphTargetsCount!==wr)&&(P_=!0):(P_=!0,gi.__version=ie.version);let Cc=gi.currentProgram;P_===!0&&(Cc=Ui(ie,le,xe));let rS=!1,xd=!1,R_=!1;const hn=Cc.getUniforms(),Mc=gi.uniforms;if(Ye.useProgram(Cc.program)&&(rS=!0,xd=!0,R_=!0),ie.id!==U&&(U=ie.id,xd=!0),rS||T!==N){if(hn.setValue(Y,"projectionMatrix",N.projectionMatrix),Te.logarithmicDepthBuffer&&hn.setValue(Y,"logDepthBufFC",2/(Math.log(N.far+1)/Math.LN2)),T!==N&&(T=N,xd=!0,R_=!0),ie.isShaderMaterial||ie.isMeshPhongMaterial||ie.isMeshToonMaterial||ie.isMeshStandardMaterial||ie.envMap){const xn=hn.map.cameraPosition;xn!==void 0&&xn.setValue(Y,mt.setFromMatrixPosition(N.matrixWorld))}(ie.isMeshPhongMaterial||ie.isMeshToonMaterial||ie.isMeshLambertMaterial||ie.isMeshBasicMaterial||ie.isMeshStandardMaterial||ie.isShaderMaterial)&&hn.setValue(Y,"isOrthographic",N.isOrthographicCamera===!0),(ie.isMeshPhongMaterial||ie.isMeshToonMaterial||ie.isMeshLambertMaterial||ie.isMeshBasicMaterial||ie.isMeshStandardMaterial||ie.isShaderMaterial||ie.isShadowMaterial||xe.isSkinnedMesh)&&hn.setValue(Y,"viewMatrix",N.matrixWorldInverse)}if(xe.isSkinnedMesh){hn.setOptional(Y,xe,"bindMatrix"),hn.setOptional(Y,xe,"bindMatrixInverse");const xn=xe.skeleton;xn&&(Te.floatVertexTextures?(xn.boneTexture===null&&xn.computeBoneTexture(),hn.setValue(Y,"boneTexture",xn.boneTexture,ot),hn.setValue(Y,"boneTextureSize",xn.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const D_=pe.morphAttributes;(D_.position!==void 0||D_.normal!==void 0||D_.color!==void 0&&Te.isWebGL2===!0)&&ut.update(xe,pe,Cc),(xd||gi.receiveShadow!==xe.receiveShadow)&&(gi.receiveShadow=xe.receiveShadow,hn.setValue(Y,"receiveShadow",xe.receiveShadow)),ie.isMeshGouraudMaterial&&ie.envMap!==null&&(Mc.envMap.value=Ut,Mc.flipEnvMap.value=Ut.isCubeTexture&&Ut.isRenderTargetTexture===!1?-1:1),xd&&(hn.setValue(Y,"toneMappingExposure",_.toneMappingExposure),gi.needsLights&&ui(Mc,R_),Je&&ie.fog===!0&&Ge.refreshFogUniforms(Mc,Je),Ge.refreshMaterialUniforms(Mc,ie,se,me,_.userData.transmissionRenderTarget||Ue),Rm.upload(Y,gi.uniformsList,Mc,ot)),ie.isShaderMaterial&&ie.uniformsNeedUpdate===!0&&(Rm.upload(Y,gi.uniformsList,Mc,ot),ie.uniformsNeedUpdate=!1),ie.isSpriteMaterial&&hn.setValue(Y,"center",xe.center),hn.setValue(Y,"modelViewMatrix",xe.modelViewMatrix),hn.setValue(Y,"normalMatrix",xe.normalMatrix),hn.setValue(Y,"modelMatrix",xe.matrixWorld);const nS=ie.extraUniformsToUpload;if(nS&&Object.entries(nS).forEach(([xn,Ed])=>hn.setValue(Y,xn,Ed.value,ot)),ie.isShaderMaterial||ie.isRawShaderMaterial){const xn=ie.uniformsGroups;for(let Ed=0,h5=xn.length;Ed<h5;Ed++)if(Te.isWebGL2){const sS=xn[Ed];I.update(sS,Cc),I.bind(sS,Cc)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Cc}function ui(N,le){N.ambientLightColor.needsUpdate=le,N.lightProbe.needsUpdate=le,N.directionalLights.needsUpdate=le,N.directionalLightShadows.needsUpdate=le,N.pointLights.needsUpdate=le,N.pointLightShadows.needsUpdate=le,N.spotLights.needsUpdate=le,N.spotLightShadows.needsUpdate=le,N.rectAreaLights.needsUpdate=le,N.hemisphereLights.needsUpdate=le}function mr(N){return N.isMeshLambertMaterial||N.isMeshToonMaterial||N.isMeshPhongMaterial||N.isMeshStandardMaterial||N.isShadowMaterial||N.isShaderMaterial&&N.lights===!0}this.getActiveCubeFace=function(){return M},this.getActiveMipmapLevel=function(){return S},this.getRenderTarget=function(){return R},this.setRenderTargetTextures=function(N,le,pe){at.get(N.texture).__webglTexture=le,at.get(N.depthTexture).__webglTexture=pe;const ie=at.get(N);ie.__hasExternalTextures=!0,ie.__hasExternalTextures&&(ie.__autoAllocateDepthBuffer=pe===void 0,ie.__autoAllocateDepthBuffer||Pe.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ie.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(N,le){const pe=at.get(N);pe.__webglFramebuffer=le,pe.__useDefaultFramebuffer=le===void 0},this.setRenderTarget=function(N,le=0,pe=0){R=N,M=le,S=pe;let ie=!0,xe=null,Je=!1,St=!1;if(N){const vt=at.get(N);vt.__useDefaultFramebuffer!==void 0?(Ye.bindFramebuffer(Y.FRAMEBUFFER,null),ie=!1):vt.__webglFramebuffer===void 0?ot.setupRenderTarget(N):vt.__hasExternalTextures&&ot.rebindTextures(N,at.get(N.texture).__webglTexture,at.get(N.depthTexture).__webglTexture);const Ut=N.texture;(Ut.isData3DTexture||Ut.isDataArrayTexture||Ut.isCompressedArrayTexture)&&(St=!0);const pi=at.get(N).__webglFramebuffer;N.isWebGLCubeRenderTarget?(xe=pi[le],Je=!0):Te.isWebGL2&&N.samples>0&&ot.useMultisampledRTT(N)===!1?xe=at.get(N).__webglMultisampledFramebuffer:xe=pi,B.copy(N.viewport),Q.copy(N.scissor),Z=N.scissorTest}else B.copy(ge).multiplyScalar(se).floor(),Q.copy(Oe).multiplyScalar(se).floor(),Z=oe;if(Ye.bindFramebuffer(Y.FRAMEBUFFER,xe)&&Te.drawBuffers&&ie&&Ye.drawBuffers(N,xe),Ye.viewport(B),Ye.scissor(Q),Ye.setScissorTest(Z),Je){const vt=at.get(N.texture);Y.framebufferTexture2D(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Y.TEXTURE_CUBE_MAP_POSITIVE_X+le,vt.__webglTexture,pe)}else if(St){const vt=at.get(N.texture),Ut=le||0;Y.framebufferTextureLayer(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0,vt.__webglTexture,pe||0,Ut)}U=-1},this.readRenderTargetPixels=function(N,le,pe,ie,xe,Je,St,vt){if(!(N&&N.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ut=at.get(N).__webglFramebuffer;if(N.isWebGLCubeRenderTarget&&St!==void 0&&(Ut=Ut[St]),Ut){Ye.bindFramebuffer(Y.FRAMEBUFFER,Ut);try{const pi=Array.isArray(N.texture)?N.texture[vt||0]:N.texture,Yt=pi.format,Ot=pi.type;if(Yt!==mi&&ct.convert(Yt)!==Y.getParameter(Y.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const er=Ot===di&&(Pe.has("EXT_color_buffer_half_float")||Te.isWebGL2&&Pe.has("EXT_color_buffer_float"));if(Ot!==oi&&ct.convert(Ot)!==Y.getParameter(Y.IMPLEMENTATION_COLOR_READ_TYPE)&&!(Ot===qt&&(Te.isWebGL2||Pe.has("OES_texture_float")||Pe.has("WEBGL_color_buffer_float")))&&!er){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}le>=0&&le<=N.width-ie&&pe>=0&&pe<=N.height-xe&&(N.isWebGLMultipleRenderTargets&&Y.readBuffer(Y.COLOR_ATTACHMENT0+vt),Y.readPixels(le,pe,ie,xe,ct.convert(Yt),ct.convert(Ot),Je))}finally{const pi=R?at.get(R).__webglFramebuffer:null;Ye.bindFramebuffer(Y.FRAMEBUFFER,pi)}}},this.copyFramebufferToTexture=function(N,le,pe=0){const ie=Math.pow(2,-pe),xe=Math.floor(le.image.width*ie),Je=Math.floor(le.image.height*ie);ot.setTexture2D(le,0),Y.copyTexSubImage2D(Y.TEXTURE_2D,pe,0,0,N.x,N.y,xe,Je),Ye.unbindTexture()},this.copyTextureToTexture=function(N,le,pe,ie=0){const xe=le.image.width,Je=le.image.height,St=ct.convert(pe.format),vt=ct.convert(pe.type);ot.setTexture2D(pe,0),Y.pixelStorei(Y.UNPACK_FLIP_Y_WEBGL,pe.flipY),Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,pe.premultiplyAlpha),Y.pixelStorei(Y.UNPACK_ALIGNMENT,pe.unpackAlignment),le.isDataTexture?Y.texSubImage2D(Y.TEXTURE_2D,ie,N.x,N.y,xe,Je,St,vt,le.image.data):le.isCompressedTexture?Y.compressedTexSubImage2D(Y.TEXTURE_2D,ie,N.x,N.y,le.mipmaps[0].width,le.mipmaps[0].height,St,le.mipmaps[0].data):Y.texSubImage2D(Y.TEXTURE_2D,ie,N.x,N.y,St,vt,le.image),ie===0&&pe.generateMipmaps&&Y.generateMipmap(Y.TEXTURE_2D),Ye.unbindTexture()},this.copyTextureToTexture3D=function(N,le,pe,ie,xe=0){if(_.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Je=N.max.x-N.min.x+1,St=N.max.y-N.min.y+1,vt=N.max.z-N.min.z+1,Ut=ct.convert(ie.format),pi=ct.convert(ie.type);let Yt;if(ie.isData3DTexture)ot.setTexture3D(ie,0),Yt=Y.TEXTURE_3D;else if(ie.isDataArrayTexture)ot.setTexture2DArray(ie,0),Yt=Y.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Y.pixelStorei(Y.UNPACK_FLIP_Y_WEBGL,ie.flipY),Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ie.premultiplyAlpha),Y.pixelStorei(Y.UNPACK_ALIGNMENT,ie.unpackAlignment);const Ot=Y.getParameter(Y.UNPACK_ROW_LENGTH),er=Y.getParameter(Y.UNPACK_IMAGE_HEIGHT),fr=Y.getParameter(Y.UNPACK_SKIP_PIXELS),Ys=Y.getParameter(Y.UNPACK_SKIP_ROWS),Ao=Y.getParameter(Y.UNPACK_SKIP_IMAGES),wr=pe.isCompressedTexture?pe.mipmaps[0]:pe.image;Y.pixelStorei(Y.UNPACK_ROW_LENGTH,wr.width),Y.pixelStorei(Y.UNPACK_IMAGE_HEIGHT,wr.height),Y.pixelStorei(Y.UNPACK_SKIP_PIXELS,N.min.x),Y.pixelStorei(Y.UNPACK_SKIP_ROWS,N.min.y),Y.pixelStorei(Y.UNPACK_SKIP_IMAGES,N.min.z),pe.isDataTexture||pe.isData3DTexture?Y.texSubImage3D(Yt,xe,le.x,le.y,le.z,Je,St,vt,Ut,pi,wr.data):pe.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Y.compressedTexSubImage3D(Yt,xe,le.x,le.y,le.z,Je,St,vt,Ut,wr.data)):Y.texSubImage3D(Yt,xe,le.x,le.y,le.z,Je,St,vt,Ut,pi,wr),Y.pixelStorei(Y.UNPACK_ROW_LENGTH,Ot),Y.pixelStorei(Y.UNPACK_IMAGE_HEIGHT,er),Y.pixelStorei(Y.UNPACK_SKIP_PIXELS,fr),Y.pixelStorei(Y.UNPACK_SKIP_ROWS,Ys),Y.pixelStorei(Y.UNPACK_SKIP_IMAGES,Ao),xe===0&&ie.generateMipmaps&&Y.generateMipmap(Yt),Ye.unbindTexture()},this.initTexture=function(N){N.isCubeTexture?ot.setTextureCube(N,0):N.isData3DTexture?ot.setTexture3D(N,0):N.isDataArrayTexture||N.isCompressedArrayTexture?ot.setTexture2DArray(N,0):ot.setTexture2D(N,0),Ye.unbindTexture()},this.resetState=function(){M=0,S=0,R=null,Ye.reset(),lt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Es}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===it?ra:Oc}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===ra?it:wi}}class ub extends sp{}ub.prototype.isWebGL1Renderer=!0;class Dm{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new fe(e),this.density=t}clone(){return new Dm(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class Bm{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new fe(e),this.near=t,this.far=i}clone(){return new Bm(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class Nl extends It{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class ph{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=kc,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=dn()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let n=0,s=this.stride;n<s;n++)this.array[e+n]=t.array[i+n];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=dn()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=dn()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const gn=new P;class Vr{constructor(e,t,i,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)gn.fromBufferAttribute(this,t),gn.applyMatrix4(e),this.setXYZ(t,gn.x,gn.y,gn.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)gn.fromBufferAttribute(this,t),gn.applyNormalMatrix(e),this.setXYZ(t,gn.x,gn.y,gn.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)gn.fromBufferAttribute(this,t),gn.transformDirection(e),this.setXYZ(t,gn.x,gn.y,gn.z);return this}setX(e,t){return this.normalized&&(t=Gt(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Gt(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Gt(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Gt(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Jr(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Jr(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Jr(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Jr(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Gt(t,this.array),i=Gt(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Gt(t,this.array),i=Gt(i,this.array),n=Gt(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this}setXYZW(e,t,i,n,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Gt(t,this.array),i=Gt(i,this.array),n=Gt(n,this.array),s=Gt(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const n=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[n+s])}return new At(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Vr(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const n=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[n+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class ap extends Ki{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new fe(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let dh;const op=new P,mh=new P,fh=new P,gh=new ne,lp=new ne,pb=new et,Lm=new P,cp=new P,Um=new P,db=new ne,sv=new ne,mb=new ne;class Om extends It{constructor(e){if(super(),this.isSprite=!0,this.type="Sprite",dh===void 0){dh=new ht;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new ph(t,5);dh.setIndex([0,1,2,0,2,3]),dh.setAttribute("position",new Vr(i,3,0,!1)),dh.setAttribute("uv",new Vr(i,2,3,!1))}this.geometry=dh,this.material=e!==void 0?e:new ap,this.center=new ne(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),mh.setFromMatrixScale(this.matrixWorld),pb.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),fh.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&mh.multiplyScalar(-fh.z);const i=this.material.rotation;let n,s;i!==0&&(s=Math.cos(i),n=Math.sin(i));const a=this.center;km(Lm.set(-.5,-.5,0),fh,a,mh,n,s),km(cp.set(.5,-.5,0),fh,a,mh,n,s),km(Um.set(.5,.5,0),fh,a,mh,n,s),db.set(0,0),sv.set(1,0),mb.set(1,1);let o=e.ray.intersectTriangle(Lm,cp,Um,!1,op);if(o===null&&(km(cp.set(-.5,.5,0),fh,a,mh,n,s),sv.set(0,1),o=e.ray.intersectTriangle(Lm,Um,cp,!1,op),o===null))return;const l=e.ray.origin.distanceTo(op);l<e.near||l>e.far||t.push({distance:l,point:op.clone(),uv:tn.getInterpolation(op,Lm,cp,Um,db,sv,mb,new ne),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function km(r,e,t,i,n,s){gh.subVectors(r,t).addScalar(.5).multiply(i),n!==void 0?(lp.x=s*gh.x-n*gh.y,lp.y=n*gh.x+s*gh.y):lp.copy(gh),r.copy(e),r.x+=lp.x,r.y+=lp.y,r.applyMatrix4(pb)}const Fm=new P,fb=new P;class gb extends It{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let i=0,n=t.length;i<n;i++){const s=t[i];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,i=0){t=Math.abs(t);const n=this.levels;let s;for(s=0;s<n.length&&!(t<n[s].distance);s++);return n.splice(s,0,{distance:t,hysteresis:i,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let i,n;for(i=1,n=t.length;i<n;i++){let s=t[i].distance;if(t[i].object.visible&&(s-=s*t[i].hysteresis),e<s)break}return t[i-1].object}return null}raycast(e,t){if(this.levels.length>0){Fm.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo(Fm);this.getObjectForDistance(i).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Fm.setFromMatrixPosition(e.matrixWorld),fb.setFromMatrixPosition(this.matrixWorld);const i=Fm.distanceTo(fb)/e.zoom;t[0].object.visible=!0;let n,s;for(n=1,s=t.length;n<s;n++){let a=t[n].distance;if(t[n].object.visible&&(a-=a*t[n].hysteresis),i>=a)t[n-1].object.visible=!1,t[n].object.visible=!0;else break}for(this._currentLevel=n-1;n<s;n++)t[n].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let n=0,s=i.length;n<s;n++){const a=i[n];t.object.levels.push({object:a.object.uuid,distance:a.distance,hysteresis:a.hysteresis})}return t}}const Ab=new P,vb=new bt,yb=new bt,vP=new P,_b=new et,Ah=new P,av=new zr,bb=new et,ov=new Va;class Nm extends Fe{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new et,this.bindMatrixInverse=new et,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Yi),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)Ah.fromBufferAttribute(t,i),this.applyBoneTransform(i,Ah),this.boundingBox.expandByPoint(Ah)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new zr),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)Ah.fromBufferAttribute(t,i),this.applyBoneTransform(i,Ah),this.boundingSphere.expandByPoint(Ah)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const i=this.material,n=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),av.copy(this.boundingSphere),av.applyMatrix4(n),e.ray.intersectsSphere(av)!==!1&&(bb.copy(n).invert(),ov.copy(e.ray).applyMatrix4(bb),!(this.boundingBox!==null&&ov.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,ov)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new bt,t=this.geometry.attributes.skinWeight;for(let i=0,n=t.count;i<n;i++){e.fromBufferAttribute(t,i);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const i=this.skeleton,n=this.geometry;vb.fromBufferAttribute(n.attributes.skinIndex,e),yb.fromBufferAttribute(n.attributes.skinWeight,e),Ab.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const a=yb.getComponent(s);if(a!==0){const o=vb.getComponent(s);_b.multiplyMatrices(i.bones[o].matrixWorld,i.boneInverses[o]),t.addScaledVector(vP.copy(Ab).applyMatrix4(_b),a)}}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}class vh extends It{constructor(){super(),this.isBone=!0,this.type="Bone"}}class pa extends Ti{constructor(e=null,t=1,i=1,n,s,a,o,l,c=Ai,h=Ai,d,m){super(null,a,o,l,c,h,n,s,d,m),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const wb=new et,yP=new et;class yh{constructor(e=[],t=[]){this.uuid=dn(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,n=this.bones.length;i<n;i++)this.boneInverses.push(new et)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new et;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let s=0,a=e.length;s<a;s++){const o=e[s]?e[s].matrixWorld:yP;wb.multiplyMatrices(o,t[s]),wb.toArray(i,s*16)}n!==null&&(n.needsUpdate=!0)}clone(){return new yh(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Lo(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new pa(t,e,e,mi,qt);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,n=e.bones.length;i<n;i++){const s=e.bones[i];let a=t[s];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),a=new vh),this.bones.push(a),this.boneInverses.push(new et().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let n=0,s=t.length;n<s;n++){const a=t[n];e.bones.push(a.uuid);const o=i[n];e.boneInverses.push(o.toArray())}return e}}class Xo extends At{constructor(e,t,i,n=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const _h=new et,xb=new et,Gm=[],Eb=new Yi,_P=new et,hp=new Fe,up=new zr;class pp extends Fe{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Xo(new Float32Array(i*16),16),this.instanceColor=null,this.sourceTrs=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let n=0;n<i;n++)this.setMatrixAt(n,_P)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Yi),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,_h),Eb.copy(e.boundingBox).applyMatrix4(_h),this.boundingBox.union(Eb)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new zr),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,_h),up.copy(e.boundingSphere).applyMatrix4(_h),this.boundingSphere.union(up)}copy(e,t){return super.copy(e,t),e.isInstancedMesh?(this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this):this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const i=this.matrixWorld,n=this.count;if(hp.geometry=this.geometry,hp.material=this.material,hp.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),up.copy(this.boundingSphere),up.applyMatrix4(i),e.ray.intersectsSphere(up)!==!1))for(let s=0;s<n;s++){this.getMatrixAt(s,_h),xb.multiplyMatrices(i,_h),hp.matrixWorld=xb,hp.raycast(e,Gm);for(let a=0,o=Gm.length;a<o;a++){const l=Gm[a];l.instanceId=s,l.object=this,t.push(l)}Gm.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Xo(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Ji extends Ki{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new fe(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Cb=new P,Mb=new P,Sb=new et,lv=new Va,zm=new zr;class Tr extends It{constructor(e=new ht,t=new Ji){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let n=1,s=t.count;n<s;n++)Cb.fromBufferAttribute(t,n-1),Mb.fromBufferAttribute(t,n),i[n]=i[n-1],i[n]+=Cb.distanceTo(Mb);e.setAttribute("lineDistance",new Ne(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,s=e.params.Line.threshold,a=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),zm.copy(i.boundingSphere),zm.applyMatrix4(n),zm.radius+=s,e.ray.intersectsSphere(zm)===!1)return;Sb.copy(n).invert(),lv.copy(e.ray).applyMatrix4(Sb);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=new P,h=new P,d=new P,m=new P,f=this.isLineSegments?2:1,v=i.index,w=i.attributes.position;if(v!==null){const b=Math.max(0,a.start),y=Math.min(v.count,a.start+a.count);for(let E=b,_=y-1;E<_;E+=f){const C=v.getX(E),M=v.getX(E+1);if(c.fromBufferAttribute(w,C),h.fromBufferAttribute(w,M),lv.distanceSqToSegment(c,h,m,d)>l)continue;m.applyMatrix4(this.matrixWorld);const S=e.ray.origin.distanceTo(m);S<e.near||S>e.far||t.push({distance:S,point:d.clone().applyMatrix4(this.matrixWorld),index:E,face:null,faceIndex:null,object:this})}}else{const b=Math.max(0,a.start),y=Math.min(w.count,a.start+a.count);for(let E=b,_=y-1;E<_;E+=f){if(c.fromBufferAttribute(w,E),h.fromBufferAttribute(w,E+1),lv.distanceSqToSegment(c,h,m,d)>l)continue;m.applyMatrix4(this.matrixWorld);const C=e.ray.origin.distanceTo(m);C<e.near||C>e.far||t.push({distance:C,point:d.clone().applyMatrix4(this.matrixWorld),index:E,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,s=i.length;n<s;n++){const a=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=n}}}}}const Tb=new P,Ib=new P;class qn extends Tr{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let n=0,s=t.count;n<s;n+=2)Tb.fromBufferAttribute(t,n),Ib.fromBufferAttribute(t,n+1),i[n]=n===0?0:i[n-1],i[n+1]=i[n]+Tb.distanceTo(Ib);e.setAttribute("lineDistance",new Ne(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class cv extends Tr{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class da extends Ki{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new fe(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Pb=new et,hv=new Va,Qm=new zr,Vm=new P;class Gl extends It{constructor(e=new ht,t=new da){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,s=e.params.Points.threshold,a=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Qm.copy(i.boundingSphere),Qm.applyMatrix4(n),Qm.radius+=s,e.ray.intersectsSphere(Qm)===!1)return;Pb.copy(n).invert(),hv.copy(e.ray).applyMatrix4(Pb);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=i.index,h=i.attributes.position;if(c!==null){const d=Math.max(0,a.start),m=Math.min(c.count,a.start+a.count);for(let f=d,v=m;f<v;f++){const w=c.getX(f);Vm.fromBufferAttribute(h,w),Rb(Vm,w,l,n,e,t,this)}}else{const d=Math.max(0,a.start),m=Math.min(h.count,a.start+a.count);for(let f=d,v=m;f<v;f++)Vm.fromBufferAttribute(h,f),Rb(Vm,f,l,n,e,t,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,s=i.length;n<s;n++){const a=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=n}}}}}function Rb(r,e,t,i,n,s,a){const o=hv.distanceSqToPoint(r);if(o<t){const l=new P;hv.closestPointToPoint(r,l),l.applyMatrix4(i);const c=n.ray.origin.distanceTo(l);if(c<n.near||c>n.far)return;s.push({distance:c,distanceToRay:Math.sqrt(o),point:l,index:e,face:null,object:a})}}class bP extends Ti{constructor(e,t,i,n,s,a,o,l,c){super(e,t,i,n,s,a,o,l,c),this.isVideoTexture=!0,this.minFilter=a!==void 0?a:Et,this.magFilter=s!==void 0?s:Et,this.generateMipmaps=!1;const h=this;function d(){h.needsUpdate=!0,e.requestVideoFrameCallback(d)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(d)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class wP extends Ti{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=Ai,this.minFilter=Ai,this.generateMipmaps=!1,this.needsUpdate=!0}}class qo extends Ti{constructor(e,t,i,n,s,a,o,l,c,h,d,m){super(null,a,o,l,c,h,n,s,d,m),this.isCompressedTexture=!0,this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class Db extends qo{constructor(e,t,i,n,s,a){super(e,t,i,s,a),this.isCompressedArrayTexture=!0,this.image.depth=n,this.wrapR=ai}}class jm extends Ti{constructor(e,t,i,n,s,a,o,l,c){super(e,t,i,n,s,a,o,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class os{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,n=this.getPoint(0),s=0;t.push(0);for(let a=1;a<=e;a++)i=this.getPoint(a/e),s+=i.distanceTo(n),t.push(s),n=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let n=0;const s=i.length;let a;t?a=t:a=e*i[s-1];let o=0,l=s-1,c;for(;o<=l;)if(n=Math.floor(o+(l-o)/2),c=i[n]-a,c<0)o=n+1;else if(c>0)l=n-1;else{l=n;break}if(n=l,i[n]===a)return n/(s-1);const h=i[n],d=i[n+1]-h,m=(a-h)/d;return(n+m)/(s-1)}getTangent(e,t){let i=e-1e-4,n=e+1e-4;i<0&&(i=0),n>1&&(n=1);const s=this.getPoint(i),a=this.getPoint(n),o=t||(s.isVector2?new ne:new P);return o.copy(a).sub(s).normalize(),o}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new P,n=[],s=[],a=[],o=new P,l=new et;for(let f=0;f<=e;f++){const v=f/e;n[f]=this.getTangentAt(v,new P)}s[0]=new P,a[0]=new P;let c=Number.MAX_VALUE;const h=Math.abs(n[0].x),d=Math.abs(n[0].y),m=Math.abs(n[0].z);h<=c&&(c=h,i.set(1,0,0)),d<=c&&(c=d,i.set(0,1,0)),m<=c&&i.set(0,0,1),o.crossVectors(n[0],i).normalize(),s[0].crossVectors(n[0],o),a[0].crossVectors(n[0],s[0]);for(let f=1;f<=e;f++){if(s[f]=s[f-1].clone(),a[f]=a[f-1].clone(),o.crossVectors(n[f-1],n[f]),o.length()>Number.EPSILON){o.normalize();const v=Math.acos(ki(n[f-1].dot(n[f]),-1,1));s[f].applyMatrix4(l.makeRotationAxis(o,v))}a[f].crossVectors(n[f],s[f])}if(t===!0){let f=Math.acos(ki(s[0].dot(s[e]),-1,1));f/=e,n[0].dot(o.crossVectors(s[0],s[e]))>0&&(f=-f);for(let v=1;v<=e;v++)s[v].applyMatrix4(l.makeRotationAxis(n[v],f*v)),a[v].crossVectors(n[v],s[v])}return{tangents:n,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Hm extends os{constructor(e=0,t=0,i=1,n=1,s=0,a=Math.PI*2,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=o,this.aRotation=l}getPoint(e,t){const i=t||new ne,n=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const a=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=n;for(;s>n;)s-=n;s<Number.EPSILON&&(a?s=0:s=n),this.aClockwise===!0&&!a&&(s===n?s=-n:s=s-n);const o=this.aStartAngle+e*s;let l=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const h=Math.cos(this.aRotation),d=Math.sin(this.aRotation),m=l-this.aX,f=c-this.aY;l=m*h-f*d+this.aX,c=m*d+f*h+this.aY}return i.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class Bb extends Hm{constructor(e,t,i,n,s,a){super(e,t,i,i,n,s,a),this.isArcCurve=!0,this.type="ArcCurve"}}function uv(){let r=0,e=0,t=0,i=0;function n(s,a,o,l){r=s,e=o,t=-3*s+3*a-2*o-l,i=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,c){n(a,o,c*(o-s),c*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,c,h,d){let m=(a-s)/c-(o-s)/(c+h)+(o-a)/h,f=(o-a)/h-(l-a)/(h+d)+(l-o)/d;m*=h,f*=h,n(a,o,m,f)},calc:function(s){const a=s*s,o=a*s;return r+e*s+t*a+i*o}}}const Wm=new P,pv=new uv,dv=new uv,mv=new uv;class Lb extends os{constructor(e=[],t=!1,i="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=n}getPoint(e,t=new P){const i=t,n=this.points,s=n.length,a=(s-(this.closed?0:1))*e;let o=Math.floor(a),l=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:l===0&&o===s-1&&(o=s-2,l=1);let c,h;this.closed||o>0?c=n[(o-1)%s]:(Wm.subVectors(n[0],n[1]).add(n[0]),c=Wm);const d=n[o%s],m=n[(o+1)%s];if(this.closed||o+2<s?h=n[(o+2)%s]:(Wm.subVectors(n[s-1],n[s-2]).add(n[s-1]),h=Wm),this.curveType==="centripetal"||this.curveType==="chordal"){const f=this.curveType==="chordal"?.5:.25;let v=Math.pow(c.distanceToSquared(d),f),w=Math.pow(d.distanceToSquared(m),f),b=Math.pow(m.distanceToSquared(h),f);w<1e-4&&(w=1),v<1e-4&&(v=w),b<1e-4&&(b=w),pv.initNonuniformCatmullRom(c.x,d.x,m.x,h.x,v,w,b),dv.initNonuniformCatmullRom(c.y,d.y,m.y,h.y,v,w,b),mv.initNonuniformCatmullRom(c.z,d.z,m.z,h.z,v,w,b)}else this.curveType==="catmullrom"&&(pv.initCatmullRom(c.x,d.x,m.x,h.x,this.tension),dv.initCatmullRom(c.y,d.y,m.y,h.y,this.tension),mv.initCatmullRom(c.z,d.z,m.z,h.z,this.tension));return i.set(pv.calc(l),dv.calc(l),mv.calc(l)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const n=e.points[t];this.points.push(new P().fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function Ub(r,e,t,i,n){const s=(i-e)*.5,a=(n-t)*.5,o=r*r,l=r*o;return(2*t-2*i+s+a)*l+(-3*t+3*i-2*s-a)*o+s*r+t}function xP(r,e){const t=1-r;return t*t*e}function EP(r,e){return 2*(1-r)*r*e}function CP(r,e){return r*r*e}function dp(r,e,t,i){return xP(r,e)+EP(r,t)+CP(r,i)}function MP(r,e){const t=1-r;return t*t*t*e}function SP(r,e){const t=1-r;return 3*t*t*r*e}function TP(r,e){return 3*(1-r)*r*r*e}function IP(r,e){return r*r*r*e}function mp(r,e,t,i,n){return MP(r,e)+SP(r,t)+TP(r,i)+IP(r,n)}class fv extends os{constructor(e=new ne,t=new ne,i=new ne,n=new ne){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new ne){const i=t,n=this.v0,s=this.v1,a=this.v2,o=this.v3;return i.set(mp(e,n.x,s.x,a.x,o.x),mp(e,n.y,s.y,a.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Ob extends os{constructor(e=new P,t=new P,i=new P,n=new P){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new P){const i=t,n=this.v0,s=this.v1,a=this.v2,o=this.v3;return i.set(mp(e,n.x,s.x,a.x,o.x),mp(e,n.y,s.y,a.y,o.y),mp(e,n.z,s.z,a.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Xm extends os{constructor(e=new ne,t=new ne){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new ne){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new ne){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class kb extends os{constructor(e=new P,t=new P){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new P){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new P){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class gv extends os{constructor(e=new ne,t=new ne,i=new ne){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new ne){const i=t,n=this.v0,s=this.v1,a=this.v2;return i.set(dp(e,n.x,s.x,a.x),dp(e,n.y,s.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Av extends os{constructor(e=new P,t=new P,i=new P){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new P){const i=t,n=this.v0,s=this.v1,a=this.v2;return i.set(dp(e,n.x,s.x,a.x),dp(e,n.y,s.y,a.y),dp(e,n.z,s.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class vv extends os{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new ne){const i=t,n=this.points,s=(n.length-1)*e,a=Math.floor(s),o=s-a,l=n[a===0?a:a-1],c=n[a],h=n[a>n.length-2?n.length-1:a+1],d=n[a>n.length-3?n.length-1:a+2];return i.set(Ub(o,l.x,c.x,h.x,d.x),Ub(o,l.y,c.y,h.y,d.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const n=e.points[t];this.points.push(new ne().fromArray(n))}return this}}var yv=Object.freeze({__proto__:null,ArcCurve:Bb,CatmullRomCurve3:Lb,CubicBezierCurve:fv,CubicBezierCurve3:Ob,EllipseCurve:Hm,LineCurve:Xm,LineCurve3:kb,QuadraticBezierCurve:gv,QuadraticBezierCurve3:Av,SplineCurve:vv});class Fb extends os{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Xm(t,e))}getPoint(e,t){const i=e*this.getLength(),n=this.getCurveLengths();let s=0;for(;s<n.length;){if(n[s]>=i){const a=n[s]-i,o=this.curves[s],l=o.getLength(),c=l===0?0:1-a/l;return o.getPointAt(c,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,n=this.curves.length;i<n;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let n=0,s=this.curves;n<s.length;n++){const a=s[n],o=a.isEllipseCurve?e*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,l=a.getPoints(o);for(let c=0;c<l.length;c++){const h=l[c];i&&i.equals(h)||(t.push(h),i=h)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const n=e.curves[t];this.curves.push(new yv[n.type]().fromJSON(n))}return this}}class fp extends Fb{constructor(e){super(),this.type="Path",this.currentPoint=new ne,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new Xm(this.currentPoint.clone(),new ne(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,n){const s=new gv(this.currentPoint.clone(),new ne(e,t),new ne(i,n));return this.curves.push(s),this.currentPoint.set(i,n),this}bezierCurveTo(e,t,i,n,s,a){const o=new fv(this.currentPoint.clone(),new ne(e,t),new ne(i,n),new ne(s,a));return this.curves.push(o),this.currentPoint.set(s,a),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new vv(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,n,s,a){const o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+o,t+l,i,n,s,a),this}absarc(e,t,i,n,s,a){return this.absellipse(e,t,i,i,n,s,a),this}ellipse(e,t,i,n,s,a,o,l){const c=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+c,t+h,i,n,s,a,o,l),this}absellipse(e,t,i,n,s,a,o,l){const c=new Hm(e,t,i,n,s,a,o,l);if(this.curves.length>0){const d=c.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push(c);const h=c.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class gp extends ht{constructor(e=[new ne(0,-.5),new ne(.5,0),new ne(0,.5)],t=12,i=0,n=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},t=Math.floor(t),n=ki(n,0,Math.PI*2);const s=[],a=[],o=[],l=[],c=[],h=1/t,d=new P,m=new ne,f=new P,v=new P,w=new P;let b=0,y=0;for(let E=0;E<=e.length-1;E++)switch(E){case 0:b=e[E+1].x-e[E].x,y=e[E+1].y-e[E].y,f.x=y*1,f.y=-b,f.z=y*0,w.copy(f),f.normalize(),l.push(f.x,f.y,f.z);break;case e.length-1:l.push(w.x,w.y,w.z);break;default:b=e[E+1].x-e[E].x,y=e[E+1].y-e[E].y,f.x=y*1,f.y=-b,f.z=y*0,v.copy(f),f.x+=w.x,f.y+=w.y,f.z+=w.z,f.normalize(),l.push(f.x,f.y,f.z),w.copy(v)}for(let E=0;E<=t;E++){const _=i+E*h*n,C=Math.sin(_),M=Math.cos(_);for(let S=0;S<=e.length-1;S++){d.x=e[S].x*C,d.y=e[S].y,d.z=e[S].x*M,a.push(d.x,d.y,d.z),m.x=E/t,m.y=S/(e.length-1),o.push(m.x,m.y);const R=l[3*S+0]*C,U=l[3*S+1],T=l[3*S+0]*M;c.push(R,U,T)}}for(let E=0;E<t;E++)for(let _=0;_<e.length-1;_++){const C=_+E*e.length,M=C,S=C+e.length,R=C+e.length+1,U=C+1;s.push(M,S,U),s.push(R,U,S)}this.setIndex(s),this.setAttribute("position",new Ne(a,3)),this.setAttribute("uv",new Ne(o,2)),this.setAttribute("normal",new Ne(c,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new gp(e.points,e.segments,e.phiStart,e.phiLength)}}class qm extends gp{constructor(e=1,t=1,i=4,n=8){const s=new fp;s.absarc(0,-t/2,e,Math.PI*1.5,0),s.absarc(0,t/2,e,0,Math.PI*.5),super(s.getPoints(i),n),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:i,radialSegments:n}}static fromJSON(e){return new qm(e.radius,e.length,e.capSegments,e.radialSegments)}}class Ym extends ht{constructor(e=1,t=32,i=0,n=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:n},t=Math.max(3,t);const s=[],a=[],o=[],l=[],c=new P,h=new ne;a.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let d=0,m=3;d<=t;d++,m+=3){const f=i+d/t*n;c.x=e*Math.cos(f),c.y=e*Math.sin(f),a.push(c.x,c.y,c.z),o.push(0,0,1),h.x=(a[m]/e+1)/2,h.y=(a[m+1]/e+1)/2,l.push(h.x,h.y)}for(let d=1;d<=t;d++)s.push(d,d+1,0);this.setIndex(s),this.setAttribute("position",new Ne(a,3)),this.setAttribute("normal",new Ne(o,3)),this.setAttribute("uv",new Ne(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ym(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class kr extends ht{constructor(e=1,t=1,i=1,n=32,s=1,a=!1,o=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l};const c=this;n=Math.floor(n),s=Math.floor(s);const h=[],d=[],m=[],f=[];let v=0;const w=[],b=i/2;let y=0;E(),a===!1&&(e>0&&_(!0),t>0&&_(!1)),this.setIndex(h),this.setAttribute("position",new Ne(d,3)),this.setAttribute("normal",new Ne(m,3)),this.setAttribute("uv",new Ne(f,2));function E(){const C=new P,M=new P;let S=0;const R=(t-e)/i;for(let U=0;U<=s;U++){const T=[],B=U/s,Q=B*(t-e)+e;for(let Z=0;Z<=n;Z++){const q=Z/n,X=q*l+o,te=Math.sin(X),me=Math.cos(X);M.x=Q*te,M.y=-B*i+b,M.z=Q*me,d.push(M.x,M.y,M.z),C.set(te,R,me).normalize(),m.push(C.x,C.y,C.z),f.push(q,1-B),T.push(v++)}w.push(T)}for(let U=0;U<n;U++)for(let T=0;T<s;T++){const B=w[T][U],Q=w[T+1][U],Z=w[T+1][U+1],q=w[T][U+1];h.push(B,Q,q),h.push(Q,Z,q),S+=6}c.addGroup(y,S,0),y+=S}function _(C){const M=v,S=new ne,R=new P;let U=0;const T=C===!0?e:t,B=C===!0?1:-1;for(let Z=1;Z<=n;Z++)d.push(0,b*B,0),m.push(0,B,0),f.push(.5,.5),v++;const Q=v;for(let Z=0;Z<=n;Z++){const q=Z/n*l+o,X=Math.cos(q),te=Math.sin(q);R.x=T*te,R.y=b*B,R.z=T*X,d.push(R.x,R.y,R.z),m.push(0,B,0),S.x=X*.5+.5,S.y=te*.5*B+.5,f.push(S.x,S.y),v++}for(let Z=0;Z<n;Z++){const q=M+Z,X=Q+Z;C===!0?h.push(X,X+1,q):h.push(X+1,X,q),U+=3}c.addGroup(y,U,C===!0?1:2),y+=U}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new kr(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Km extends kr{constructor(e=1,t=1,i=32,n=1,s=!1,a=0,o=Math.PI*2){super(0,e,t,i,n,s,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:s,thetaStart:a,thetaLength:o}}static fromJSON(e){return new Km(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Yo extends ht{constructor(e=[],t=[],i=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n};const s=[],a=[];o(n),c(i),h(),this.setAttribute("position",new Ne(s,3)),this.setAttribute("normal",new Ne(s.slice(),3)),this.setAttribute("uv",new Ne(a,2)),n===0?this.computeVertexNormals():this.normalizeNormals();function o(E){const _=new P,C=new P,M=new P;for(let S=0;S<t.length;S+=3)f(t[S+0],_),f(t[S+1],C),f(t[S+2],M),l(_,C,M,E)}function l(E,_,C,M){const S=M+1,R=[];for(let U=0;U<=S;U++){R[U]=[];const T=E.clone().lerp(C,U/S),B=_.clone().lerp(C,U/S),Q=S-U;for(let Z=0;Z<=Q;Z++)Z===0&&U===S?R[U][Z]=T:R[U][Z]=T.clone().lerp(B,Z/Q)}for(let U=0;U<S;U++)for(let T=0;T<2*(S-U)-1;T++){const B=Math.floor(T/2);T%2===0?(m(R[U][B+1]),m(R[U+1][B]),m(R[U][B])):(m(R[U][B+1]),m(R[U+1][B+1]),m(R[U+1][B]))}}function c(E){const _=new P;for(let C=0;C<s.length;C+=3)_.x=s[C+0],_.y=s[C+1],_.z=s[C+2],_.normalize().multiplyScalar(E),s[C+0]=_.x,s[C+1]=_.y,s[C+2]=_.z}function h(){const E=new P;for(let _=0;_<s.length;_+=3){E.x=s[_+0],E.y=s[_+1],E.z=s[_+2];const C=b(E)/2/Math.PI+.5,M=y(E)/Math.PI+.5;a.push(C,1-M)}v(),d()}function d(){for(let E=0;E<a.length;E+=6){const _=a[E+0],C=a[E+2],M=a[E+4],S=Math.max(_,C,M),R=Math.min(_,C,M);S>.9&&R<.1&&(_<.2&&(a[E+0]+=1),C<.2&&(a[E+2]+=1),M<.2&&(a[E+4]+=1))}}function m(E){s.push(E.x,E.y,E.z)}function f(E,_){const C=E*3;_.x=e[C+0],_.y=e[C+1],_.z=e[C+2]}function v(){const E=new P,_=new P,C=new P,M=new P,S=new ne,R=new ne,U=new ne;for(let T=0,B=0;T<s.length;T+=9,B+=6){E.set(s[T+0],s[T+1],s[T+2]),_.set(s[T+3],s[T+4],s[T+5]),C.set(s[T+6],s[T+7],s[T+8]),S.set(a[B+0],a[B+1]),R.set(a[B+2],a[B+3]),U.set(a[B+4],a[B+5]),M.copy(E).add(_).add(C).divideScalar(3);const Q=b(M);w(S,B+0,E,Q),w(R,B+2,_,Q),w(U,B+4,C,Q)}}function w(E,_,C,M){M<0&&E.x===1&&(a[_]=E.x-1),C.x===0&&C.z===0&&(a[_]=M/2/Math.PI+.5)}function b(E){return Math.atan2(E.z,-E.x)}function y(E){return Math.atan2(-E.y,Math.sqrt(E.x*E.x+E.z*E.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Yo(e.vertices,e.indices,e.radius,e.details)}}class Jm extends Yo{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,n=1/i,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,a,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Jm(e.radius,e.detail)}}const Zm=new P,$m=new P,_v=new P,ef=new tn;class Nb extends ht{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const i=Math.pow(10,4),n=Math.cos(Na*t),s=e.getIndex(),a=e.getAttribute("position"),o=s?s.count:a.count,l=[0,0,0],c=["a","b","c"],h=new Array(3),d={},m=[];for(let f=0;f<o;f+=3){s?(l[0]=s.getX(f),l[1]=s.getX(f+1),l[2]=s.getX(f+2)):(l[0]=f,l[1]=f+1,l[2]=f+2);const{a:v,b:w,c:b}=ef;if(v.fromBufferAttribute(a,l[0]),w.fromBufferAttribute(a,l[1]),b.fromBufferAttribute(a,l[2]),ef.getNormal(_v),h[0]=`${Math.round(v.x*i)},${Math.round(v.y*i)},${Math.round(v.z*i)}`,h[1]=`${Math.round(w.x*i)},${Math.round(w.y*i)},${Math.round(w.z*i)}`,h[2]=`${Math.round(b.x*i)},${Math.round(b.y*i)},${Math.round(b.z*i)}`,!(h[0]===h[1]||h[1]===h[2]||h[2]===h[0]))for(let y=0;y<3;y++){const E=(y+1)%3,_=h[y],C=h[E],M=ef[c[y]],S=ef[c[E]],R=`${_}_${C}`,U=`${C}_${_}`;U in d&&d[U]?(_v.dot(d[U].normal)<=n&&(m.push(M.x,M.y,M.z),m.push(S.x,S.y,S.z)),d[U]=null):R in d||(d[R]={index0:l[y],index1:l[E],normal:_v.clone()})}}for(const f in d)if(d[f]){const{index0:v,index1:w}=d[f];Zm.fromBufferAttribute(a,v),$m.fromBufferAttribute(a,w),m.push(Zm.x,Zm.y,Zm.z),m.push($m.x,$m.y,$m.z)}this.setAttribute("position",new Ne(m,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class zl extends fp{constructor(e){super(e),this.uuid=dn(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,n=this.holes.length;i<n;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const n=e.holes[t];this.holes.push(new fp().fromJSON(n))}return this}}const PP={triangulate:function(r,e,t=2){const i=e&&e.length,n=i?e[0]*t:r.length;let s=Gb(r,0,n,t,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,c,h,d,m,f;if(i&&(s=UP(r,e,s,t)),r.length>80*t){o=c=r[0],l=h=r[1];for(let v=t;v<n;v+=t)d=r[v],m=r[v+1],d<o&&(o=d),m<l&&(l=m),d>c&&(c=d),m>h&&(h=m);f=Math.max(c-o,h-l),f=f!==0?32767/f:0}return Ap(s,a,t,o,l,f,0),a}};function Gb(r,e,t,i,n){let s,a;if(n===WP(r,e,t,i)>0)for(s=e;s<t;s+=i)a=Vb(s,r[s],r[s+1],a);else for(s=t-i;s>=e;s-=i)a=Vb(s,r[s],r[s+1],a);return a&&tf(a,a.next)&&(yp(a),a=a.next),a}function Ql(r,e){if(!r)return r;e||(e=r);let t=r,i;do if(i=!1,!t.steiner&&(tf(t,t.next)||Zi(t.prev,t,t.next)===0)){if(yp(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function Ap(r,e,t,i,n,s,a){if(!r)return;!a&&s&&GP(r,i,n,s);let o=r,l,c;for(;r.prev!==r.next;){if(l=r.prev,c=r.next,s?DP(r,i,n,s):RP(r)){e.push(l.i/t|0),e.push(r.i/t|0),e.push(c.i/t|0),yp(r),r=c.next,o=c.next;continue}if(r=c,r===o){a?a===1?(r=BP(Ql(r),e,t),Ap(r,e,t,i,n,s,2)):a===2&&LP(r,e,t,i,n,s):Ap(Ql(r),e,t,i,n,s,1);break}}}function RP(r){const e=r.prev,t=r,i=r.next;if(Zi(e,t,i)>=0)return!1;const n=e.x,s=t.x,a=i.x,o=e.y,l=t.y,c=i.y,h=n<s?n<a?n:a:s<a?s:a,d=o<l?o<c?o:c:l<c?l:c,m=n>s?n>a?n:a:s>a?s:a,f=o>l?o>c?o:c:l>c?l:c;let v=i.next;for(;v!==e;){if(v.x>=h&&v.x<=m&&v.y>=d&&v.y<=f&&bh(n,o,s,l,a,c,v.x,v.y)&&Zi(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function DP(r,e,t,i){const n=r.prev,s=r,a=r.next;if(Zi(n,s,a)>=0)return!1;const o=n.x,l=s.x,c=a.x,h=n.y,d=s.y,m=a.y,f=o<l?o<c?o:c:l<c?l:c,v=h<d?h<m?h:m:d<m?d:m,w=o>l?o>c?o:c:l>c?l:c,b=h>d?h>m?h:m:d>m?d:m,y=bv(f,v,e,t,i),E=bv(w,b,e,t,i);let _=r.prevZ,C=r.nextZ;for(;_&&_.z>=y&&C&&C.z<=E;){if(_.x>=f&&_.x<=w&&_.y>=v&&_.y<=b&&_!==n&&_!==a&&bh(o,h,l,d,c,m,_.x,_.y)&&Zi(_.prev,_,_.next)>=0||(_=_.prevZ,C.x>=f&&C.x<=w&&C.y>=v&&C.y<=b&&C!==n&&C!==a&&bh(o,h,l,d,c,m,C.x,C.y)&&Zi(C.prev,C,C.next)>=0))return!1;C=C.nextZ}for(;_&&_.z>=y;){if(_.x>=f&&_.x<=w&&_.y>=v&&_.y<=b&&_!==n&&_!==a&&bh(o,h,l,d,c,m,_.x,_.y)&&Zi(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;C&&C.z<=E;){if(C.x>=f&&C.x<=w&&C.y>=v&&C.y<=b&&C!==n&&C!==a&&bh(o,h,l,d,c,m,C.x,C.y)&&Zi(C.prev,C,C.next)>=0)return!1;C=C.nextZ}return!0}function BP(r,e,t){let i=r;do{const n=i.prev,s=i.next.next;!tf(n,s)&&zb(n,i,i.next,s)&&vp(n,s)&&vp(s,n)&&(e.push(n.i/t|0),e.push(i.i/t|0),e.push(s.i/t|0),yp(i),yp(i.next),i=r=s),i=i.next}while(i!==r);return Ql(i)}function LP(r,e,t,i,n,s){let a=r;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&VP(a,o)){let l=Qb(a,o);a=Ql(a,a.next),l=Ql(l,l.next),Ap(a,e,t,i,n,s,0),Ap(l,e,t,i,n,s,0);return}o=o.next}a=a.next}while(a!==r)}function UP(r,e,t,i){const n=[];let s,a,o,l,c;for(s=0,a=e.length;s<a;s++)o=e[s]*i,l=s<a-1?e[s+1]*i:r.length,c=Gb(r,o,l,i,!1),c===c.next&&(c.steiner=!0),n.push(QP(c));for(n.sort(OP),s=0;s<n.length;s++)t=kP(n[s],t);return t}function OP(r,e){return r.x-e.x}function kP(r,e){const t=FP(r,e);if(!t)return e;const i=Qb(t,r);return Ql(i,i.next),Ql(t,t.next)}function FP(r,e){let t=e,i=-1/0,n;const s=r.x,a=r.y;do{if(a<=t.y&&a>=t.next.y&&t.next.y!==t.y){const m=t.x+(a-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(m<=s&&m>i&&(i=m,n=t.x<t.next.x?t:t.next,m===s))return n}t=t.next}while(t!==e);if(!n)return null;const o=n,l=n.x,c=n.y;let h=1/0,d;t=n;do s>=t.x&&t.x>=l&&s!==t.x&&bh(a<c?s:i,a,l,c,a<c?i:s,a,t.x,t.y)&&(d=Math.abs(a-t.y)/(s-t.x),vp(t,r)&&(d<h||d===h&&(t.x>n.x||t.x===n.x&&NP(n,t)))&&(n=t,h=d)),t=t.next;while(t!==o);return n}function NP(r,e){return Zi(r.prev,r,e.prev)<0&&Zi(e.next,r,r.next)<0}function GP(r,e,t,i){let n=r;do n.z===0&&(n.z=bv(n.x,n.y,e,t,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==r);n.prevZ.nextZ=null,n.prevZ=null,zP(n)}function zP(r){let e,t,i,n,s,a,o,l,c=1;do{for(t=r,r=null,s=null,a=0;t;){for(a++,i=t,o=0,e=0;e<c&&(o++,i=i.nextZ,!!i);e++);for(l=c;o>0||l>0&&i;)o!==0&&(l===0||!i||t.z<=i.z)?(n=t,t=t.nextZ,o--):(n=i,i=i.nextZ,l--),s?s.nextZ=n:r=n,n.prevZ=s,s=n;t=i}s.nextZ=null,c*=2}while(a>1);return r}function bv(r,e,t,i,n){return r=(r-t)*n|0,e=(e-i)*n|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}function QP(r){let e=r,t=r;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==r);return t}function bh(r,e,t,i,n,s,a,o){return(n-a)*(e-o)>=(r-a)*(s-o)&&(r-a)*(i-o)>=(t-a)*(e-o)&&(t-a)*(s-o)>=(n-a)*(i-o)}function VP(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!jP(r,e)&&(vp(r,e)&&vp(e,r)&&HP(r,e)&&(Zi(r.prev,r,e.prev)||Zi(r,e.prev,e))||tf(r,e)&&Zi(r.prev,r,r.next)>0&&Zi(e.prev,e,e.next)>0)}function Zi(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function tf(r,e){return r.x===e.x&&r.y===e.y}function zb(r,e,t,i){const n=nf(Zi(r,e,t)),s=nf(Zi(r,e,i)),a=nf(Zi(t,i,r)),o=nf(Zi(t,i,e));return!!(n!==s&&a!==o||n===0&&rf(r,t,e)||s===0&&rf(r,i,e)||a===0&&rf(t,r,i)||o===0&&rf(t,e,i))}function rf(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y)}function nf(r){return r>0?1:r<0?-1:0}function jP(r,e){let t=r;do{if(t.i!==r.i&&t.next.i!==r.i&&t.i!==e.i&&t.next.i!==e.i&&zb(t,t.next,r,e))return!0;t=t.next}while(t!==r);return!1}function vp(r,e){return Zi(r.prev,r,r.next)<0?Zi(r,e,r.next)>=0&&Zi(r,r.prev,e)>=0:Zi(r,e,r.prev)<0||Zi(r,r.next,e)<0}function HP(r,e){let t=r,i=!1;const n=(r.x+e.x)/2,s=(r.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&n<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==r);return i}function Qb(r,e){const t=new wv(r.i,r.x,r.y),i=new wv(e.i,e.x,e.y),n=r.next,s=e.prev;return r.next=e,e.prev=r,t.next=n,n.prev=t,i.next=t,t.prev=i,s.next=i,i.prev=s,i}function Vb(r,e,t,i){const n=new wv(r,e,t);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function yp(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function wv(r,e,t){this.i=r,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function WP(r,e,t,i){let n=0;for(let s=e,a=t-i;s<t;s+=i)n+=(r[a]-r[s])*(r[s+1]+r[a+1]),a=s;return n}class ma{static area(e){const t=e.length;let i=0;for(let n=t-1,s=0;s<t;n=s++)i+=e[n].x*e[s].y-e[s].x*e[n].y;return i*.5}static isClockWise(e){return ma.area(e)<0}static triangulateShape(e,t){const i=[],n=[],s=[];jb(e),Hb(i,e);let a=e.length;t.forEach(jb);for(let l=0;l<t.length;l++)n.push(a),a+=t[l].length,Hb(i,t[l]);const o=PP.triangulate(i,n);for(let l=0;l<o.length;l+=3)s.push(o.slice(l,l+3));return s}}function jb(r){const e=r.length;e>2&&r[e-1].equals(r[0])&&r.pop()}function Hb(r,e){for(let t=0;t<e.length;t++)r.push(e[t].x),r.push(e[t].y)}class sf extends ht{constructor(e=new zl([new ne(.5,.5),new ne(-.5,.5),new ne(-.5,-.5),new ne(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,n=[],s=[];for(let o=0,l=e.length;o<l;o++){const c=e[o];a(c)}this.setAttribute("position",new Ne(n,3)),this.setAttribute("uv",new Ne(s,2)),this.computeVertexNormals();function a(o){const l=[],c=t.curveSegments!==void 0?t.curveSegments:12,h=t.steps!==void 0?t.steps:1,d=t.depth!==void 0?t.depth:1;let m=t.bevelEnabled!==void 0?t.bevelEnabled:!0,f=t.bevelThickness!==void 0?t.bevelThickness:.2,v=t.bevelSize!==void 0?t.bevelSize:f-.1,w=t.bevelOffset!==void 0?t.bevelOffset:0,b=t.bevelSegments!==void 0?t.bevelSegments:3;const y=t.extrudePath,E=t.UVGenerator!==void 0?t.UVGenerator:XP;let _,C=!1,M,S,R,U;y&&(_=y.getSpacedPoints(h),C=!0,m=!1,M=y.computeFrenetFrames(h,!1),S=new P,R=new P,U=new P),m||(b=0,f=0,v=0,w=0);const T=o.extractPoints(c);let B=T.shape;const Q=T.holes;if(!ma.isClockWise(B)){B=B.reverse();for(let we=0,Y=Q.length;we<Y;we++){const je=Q[we];ma.isClockWise(je)&&(Q[we]=je.reverse())}}const Z=ma.triangulateShape(B,Q),q=B;for(let we=0,Y=Q.length;we<Y;we++){const je=Q[we];B=B.concat(je)}function X(we,Y,je){return Y||console.error("THREE.ExtrudeGeometry: vec does not exist"),we.clone().addScaledVector(Y,je)}const te=B.length,me=Z.length;function se(we,Y,je){let Pe,Te,Ye;const Ee=we.x-Y.x,at=we.y-Y.y,ot=je.x-we.x,Pt=je.y-we.y,Li=Ee*Ee+at*at,Wi=Ee*Pt-at*ot;if(Math.abs(Wi)>Number.EPSILON){const G=Math.sqrt(Li),F=Math.sqrt(ot*ot+Pt*Pt),ye=Y.x-at/G,Ge=Y.y+Ee/G,ze=je.x-Pt/F,V=je.y+ot/F,Ce=((ze-ye)*Pt-(V-Ge)*ot)/(Ee*Pt-at*ot);Pe=ye+Ee*Ce-we.x,Te=Ge+at*Ce-we.y;const Be=Pe*Pe+Te*Te;if(Be<=2)return new ne(Pe,Te);Ye=Math.sqrt(Be/2)}else{let G=!1;Ee>Number.EPSILON?ot>Number.EPSILON&&(G=!0):Ee<-Number.EPSILON?ot<-Number.EPSILON&&(G=!0):Math.sign(at)===Math.sign(Pt)&&(G=!0),G?(Pe=-at,Te=Ee,Ye=Math.sqrt(Li)):(Pe=Ee,Te=at,Ye=Math.sqrt(Li/2))}return new ne(Pe/Ye,Te/Ye)}const he=[];for(let we=0,Y=q.length,je=Y-1,Pe=we+1;we<Y;we++,je++,Pe++)je===Y&&(je=0),Pe===Y&&(Pe=0),he[we]=se(q[we],q[je],q[Pe]);const _e=[];let ge,Oe=he.concat();for(let we=0,Y=Q.length;we<Y;we++){const je=Q[we];ge=[];for(let Pe=0,Te=je.length,Ye=Te-1,Ee=Pe+1;Pe<Te;Pe++,Ye++,Ee++)Ye===Te&&(Ye=0),Ee===Te&&(Ee=0),ge[Pe]=se(je[Pe],je[Ye],je[Ee]);_e.push(ge),Oe=Oe.concat(ge)}for(let we=0;we<b;we++){const Y=we/b,je=f*Math.cos(Y*Math.PI/2),Pe=v*Math.sin(Y*Math.PI/2)+w;for(let Te=0,Ye=q.length;Te<Ye;Te++){const Ee=X(q[Te],he[Te],Pe);Ue(Ee.x,Ee.y,-je)}for(let Te=0,Ye=Q.length;Te<Ye;Te++){const Ee=Q[Te];ge=_e[Te];for(let at=0,ot=Ee.length;at<ot;at++){const Pt=X(Ee[at],ge[at],Pe);Ue(Pt.x,Pt.y,-je)}}}const oe=v+w;for(let we=0;we<te;we++){const Y=m?X(B[we],Oe[we],oe):B[we];C?(R.copy(M.normals[0]).multiplyScalar(Y.x),S.copy(M.binormals[0]).multiplyScalar(Y.y),U.copy(_[0]).add(R).add(S),Ue(U.x,U.y,U.z)):Ue(Y.x,Y.y,0)}for(let we=1;we<=h;we++)for(let Y=0;Y<te;Y++){const je=m?X(B[Y],Oe[Y],oe):B[Y];C?(R.copy(M.normals[we]).multiplyScalar(je.x),S.copy(M.binormals[we]).multiplyScalar(je.y),U.copy(_[we]).add(R).add(S),Ue(U.x,U.y,U.z)):Ue(je.x,je.y,d/h*we)}for(let we=b-1;we>=0;we--){const Y=we/b,je=f*Math.cos(Y*Math.PI/2),Pe=v*Math.sin(Y*Math.PI/2)+w;for(let Te=0,Ye=q.length;Te<Ye;Te++){const Ee=X(q[Te],he[Te],Pe);Ue(Ee.x,Ee.y,d+je)}for(let Te=0,Ye=Q.length;Te<Ye;Te++){const Ee=Q[Te];ge=_e[Te];for(let at=0,ot=Ee.length;at<ot;at++){const Pt=X(Ee[at],ge[at],Pe);C?Ue(Pt.x,Pt.y+_[h-1].y,_[h-1].x+je):Ue(Pt.x,Pt.y,d+je)}}}be(),Me();function be(){const we=n.length/3;if(m){let Y=0,je=te*Y;for(let Pe=0;Pe<me;Pe++){const Te=Z[Pe];rt(Te[2]+je,Te[1]+je,Te[0]+je)}Y=h+b*2,je=te*Y;for(let Pe=0;Pe<me;Pe++){const Te=Z[Pe];rt(Te[0]+je,Te[1]+je,Te[2]+je)}}else{for(let Y=0;Y<me;Y++){const je=Z[Y];rt(je[2],je[1],je[0])}for(let Y=0;Y<me;Y++){const je=Z[Y];rt(je[0]+te*h,je[1]+te*h,je[2]+te*h)}}i.addGroup(we,n.length/3-we,0)}function Me(){const we=n.length/3;let Y=0;Ve(q,Y),Y+=q.length;for(let je=0,Pe=Q.length;je<Pe;je++){const Te=Q[je];Ve(Te,Y),Y+=Te.length}i.addGroup(we,n.length/3-we,1)}function Ve(we,Y){let je=we.length;for(;--je>=0;){const Pe=je;let Te=je-1;Te<0&&(Te=we.length-1);for(let Ye=0,Ee=h+b*2;Ye<Ee;Ye++){const at=te*Ye,ot=te*(Ye+1),Pt=Y+Pe+at,Li=Y+Te+at,Wi=Y+Te+ot,G=Y+Pe+ot;xt(Pt,Li,Wi,G)}}}function Ue(we,Y,je){l.push(we),l.push(Y),l.push(je)}function rt(we,Y,je){mt(we),mt(Y),mt(je);const Pe=n.length/3,Te=E.generateTopUV(i,n,Pe-3,Pe-2,Pe-1);Dt(Te[0]),Dt(Te[1]),Dt(Te[2])}function xt(we,Y,je,Pe){mt(we),mt(Y),mt(Pe),mt(Y),mt(je),mt(Pe);const Te=n.length/3,Ye=E.generateSideWallUV(i,n,Te-6,Te-3,Te-2,Te-1);Dt(Ye[0]),Dt(Ye[1]),Dt(Ye[3]),Dt(Ye[1]),Dt(Ye[2]),Dt(Ye[3])}function mt(we){n.push(l[we*3+0]),n.push(l[we*3+1]),n.push(l[we*3+2])}function Dt(we){s.push(we.x),s.push(we.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,i=this.parameters.options;return qP(t,i,e)}static fromJSON(e,t){const i=[];for(let s=0,a=e.shapes.length;s<a;s++){const o=t[e.shapes[s]];i.push(o)}const n=e.options.extrudePath;return n!==void 0&&(e.options.extrudePath=new yv[n.type]().fromJSON(n)),new sf(i,e.options)}}const XP={generateTopUV:function(r,e,t,i,n){const s=e[t*3],a=e[t*3+1],o=e[i*3],l=e[i*3+1],c=e[n*3],h=e[n*3+1];return[new ne(s,a),new ne(o,l),new ne(c,h)]},generateSideWallUV:function(r,e,t,i,n,s){const a=e[t*3],o=e[t*3+1],l=e[t*3+2],c=e[i*3],h=e[i*3+1],d=e[i*3+2],m=e[n*3],f=e[n*3+1],v=e[n*3+2],w=e[s*3],b=e[s*3+1],y=e[s*3+2];return Math.abs(o-h)<Math.abs(a-c)?[new ne(a,1-l),new ne(c,1-d),new ne(m,1-v),new ne(w,1-y)]:[new ne(o,1-l),new ne(h,1-d),new ne(f,1-v),new ne(b,1-y)]}};function qP(r,e,t){if(t.shapes=[],Array.isArray(r))for(let i=0,n=r.length;i<n;i++){const s=r[i];t.shapes.push(s.uuid)}else t.shapes.push(r.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class af extends Yo{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,n=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(n,s,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new af(e.radius,e.detail)}}class eo extends Yo{constructor(e=1,t=0){const i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(i,n,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new eo(e.radius,e.detail)}}class of extends ht{constructor(e=.5,t=1,i=32,n=1,s=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:n,thetaStart:s,thetaLength:a},i=Math.max(3,i),n=Math.max(1,n);const o=[],l=[],c=[],h=[];let d=e;const m=(t-e)/n,f=new P,v=new ne;for(let w=0;w<=n;w++){for(let b=0;b<=i;b++){const y=s+b/i*a;f.x=d*Math.cos(y),f.y=d*Math.sin(y),l.push(f.x,f.y,f.z),c.push(0,0,1),v.x=(f.x/t+1)/2,v.y=(f.y/t+1)/2,h.push(v.x,v.y)}d+=m}for(let w=0;w<n;w++){const b=w*(i+1);for(let y=0;y<i;y++){const E=y+b,_=E,C=E+i+1,M=E+i+2,S=E+1;o.push(_,C,S),o.push(C,M,S)}}this.setIndex(o),this.setAttribute("position",new Ne(l,3)),this.setAttribute("normal",new Ne(c,3)),this.setAttribute("uv",new Ne(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new of(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class lf extends ht{constructor(e=new zl([new ne(0,.5),new ne(-.5,-.5),new ne(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],n=[],s=[],a=[];let o=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let h=0;h<e.length;h++)c(e[h]),this.addGroup(o,l,h),o+=l,l=0;this.setIndex(i),this.setAttribute("position",new Ne(n,3)),this.setAttribute("normal",new Ne(s,3)),this.setAttribute("uv",new Ne(a,2));function c(h){const d=n.length/3,m=h.extractPoints(t);let f=m.shape;const v=m.holes;ma.isClockWise(f)===!1&&(f=f.reverse());for(let b=0,y=v.length;b<y;b++){const E=v[b];ma.isClockWise(E)===!0&&(v[b]=E.reverse())}const w=ma.triangulateShape(f,v);for(let b=0,y=v.length;b<y;b++){const E=v[b];f=f.concat(E)}for(let b=0,y=f.length;b<y;b++){const E=f[b];n.push(E.x,E.y,0),s.push(0,0,1),a.push(E.x,E.y)}for(let b=0,y=w.length;b<y;b++){const E=w[b],_=E[0]+d,C=E[1]+d,M=E[2]+d;i.push(_,C,M),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return YP(t,e)}static fromJSON(e,t){const i=[];for(let n=0,s=e.shapes.length;n<s;n++){const a=t[e.shapes[n]];i.push(a)}return new lf(i,e.curveSegments)}}function YP(r,e){if(e.shapes=[],Array.isArray(r))for(let t=0,i=r.length;t<i;t++){const n=r[t];e.shapes.push(n.uuid)}else e.shapes.push(r.uuid);return e}class Gs extends ht{constructor(e=1,t=32,i=16,n=0,s=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:s,thetaStart:a,thetaLength:o},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const l=Math.min(a+o,Math.PI);let c=0;const h=[],d=new P,m=new P,f=[],v=[],w=[],b=[];for(let y=0;y<=i;y++){const E=[],_=y/i;let C=0;y===0&&a===0?C=.5/t:y===i&&l===Math.PI&&(C=-.5/t);for(let M=0;M<=t;M++){const S=M/t;d.x=-e*Math.cos(n+S*s)*Math.sin(a+_*o),d.y=e*Math.cos(a+_*o),d.z=e*Math.sin(n+S*s)*Math.sin(a+_*o),v.push(d.x,d.y,d.z),m.copy(d).normalize(),w.push(m.x,m.y,m.z),b.push(S+C,1-_),E.push(c++)}h.push(E)}for(let y=0;y<i;y++)for(let E=0;E<t;E++){const _=h[y][E+1],C=h[y][E],M=h[y+1][E],S=h[y+1][E+1];(y!==0||a>0)&&f.push(_,C,S),(y!==i-1||l<Math.PI)&&f.push(C,M,S)}this.setIndex(f),this.setAttribute("position",new Ne(v,3)),this.setAttribute("normal",new Ne(w,3)),this.setAttribute("uv",new Ne(b,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Gs(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class cf extends Yo{constructor(e=1,t=0){const i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],n=[2,1,0,0,3,2,1,3,0,2,3,1];super(i,n,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new cf(e.radius,e.detail)}}class wh extends ht{constructor(e=1,t=.4,i=12,n=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:s},i=Math.floor(i),n=Math.floor(n);const a=[],o=[],l=[],c=[],h=new P,d=new P,m=new P;for(let f=0;f<=i;f++)for(let v=0;v<=n;v++){const w=v/n*s,b=f/i*Math.PI*2;d.x=(e+t*Math.cos(b))*Math.cos(w),d.y=(e+t*Math.cos(b))*Math.sin(w),d.z=t*Math.sin(b),o.push(d.x,d.y,d.z),h.x=e*Math.cos(w),h.y=e*Math.sin(w),m.subVectors(d,h).normalize(),l.push(m.x,m.y,m.z),c.push(v/n),c.push(f/i)}for(let f=1;f<=i;f++)for(let v=1;v<=n;v++){const w=(n+1)*f+v-1,b=(n+1)*(f-1)+v-1,y=(n+1)*(f-1)+v,E=(n+1)*f+v;a.push(w,b,E),a.push(b,y,E)}this.setIndex(a),this.setAttribute("position",new Ne(o,3)),this.setAttribute("normal",new Ne(l,3)),this.setAttribute("uv",new Ne(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new wh(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class hf extends ht{constructor(e=1,t=.4,i=64,n=8,s=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:n,p:s,q:a},i=Math.floor(i),n=Math.floor(n);const o=[],l=[],c=[],h=[],d=new P,m=new P,f=new P,v=new P,w=new P,b=new P,y=new P;for(let _=0;_<=i;++_){const C=_/i*s*Math.PI*2;E(C,s,a,e,f),E(C+.01,s,a,e,v),b.subVectors(v,f),y.addVectors(v,f),w.crossVectors(b,y),y.crossVectors(w,b),w.normalize(),y.normalize();for(let M=0;M<=n;++M){const S=M/n*Math.PI*2,R=-t*Math.cos(S),U=t*Math.sin(S);d.x=f.x+(R*y.x+U*w.x),d.y=f.y+(R*y.y+U*w.y),d.z=f.z+(R*y.z+U*w.z),l.push(d.x,d.y,d.z),m.subVectors(d,f).normalize(),c.push(m.x,m.y,m.z),h.push(_/i),h.push(M/n)}}for(let _=1;_<=i;_++)for(let C=1;C<=n;C++){const M=(n+1)*(_-1)+(C-1),S=(n+1)*_+(C-1),R=(n+1)*_+C,U=(n+1)*(_-1)+C;o.push(M,S,U),o.push(S,R,U)}this.setIndex(o),this.setAttribute("position",new Ne(l,3)),this.setAttribute("normal",new Ne(c,3)),this.setAttribute("uv",new Ne(h,2));function E(_,C,M,S,R){const U=Math.cos(_),T=Math.sin(_),B=M/C*_,Q=Math.cos(B);R.x=S*(2+Q)*.5*U,R.y=S*(2+Q)*T*.5,R.z=S*Math.sin(B)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new hf(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class uf extends ht{constructor(e=new Av(new P(-1,-1,0),new P(-1,1,0),new P(1,1,0)),t=64,i=1,n=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:n,closed:s};const a=e.computeFrenetFrames(t,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new P,l=new P,c=new ne;let h=new P;const d=[],m=[],f=[],v=[];w(),this.setIndex(v),this.setAttribute("position",new Ne(d,3)),this.setAttribute("normal",new Ne(m,3)),this.setAttribute("uv",new Ne(f,2));function w(){for(let _=0;_<t;_++)b(_);b(s===!1?t:0),E(),y()}function b(_){h=e.getPointAt(_/t,h);const C=a.normals[_],M=a.binormals[_];for(let S=0;S<=n;S++){const R=S/n*Math.PI*2,U=Math.sin(R),T=-Math.cos(R);l.x=T*C.x+U*M.x,l.y=T*C.y+U*M.y,l.z=T*C.z+U*M.z,l.normalize(),m.push(l.x,l.y,l.z),o.x=h.x+i*l.x,o.y=h.y+i*l.y,o.z=h.z+i*l.z,d.push(o.x,o.y,o.z)}}function y(){for(let _=1;_<=t;_++)for(let C=1;C<=n;C++){const M=(n+1)*(_-1)+(C-1),S=(n+1)*_+(C-1),R=(n+1)*_+C,U=(n+1)*(_-1)+C;v.push(M,S,U),v.push(S,R,U)}}function E(){for(let _=0;_<=t;_++)for(let C=0;C<=n;C++)c.x=_/t,c.y=C/n,f.push(c.x,c.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new uf(new yv[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class pf extends ht{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],i=new Set,n=new P,s=new P;if(e.index!==null){const a=e.attributes.position,o=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:o.count,materialIndex:0}]);for(let c=0,h=l.length;c<h;++c){const d=l[c],m=d.start,f=d.count;for(let v=m,w=m+f;v<w;v+=3)for(let b=0;b<3;b++){const y=o.getX(v+b),E=o.getX(v+(b+1)%3);n.fromBufferAttribute(a,y),s.fromBufferAttribute(a,E),Wb(n,s,i)===!0&&(t.push(n.x,n.y,n.z),t.push(s.x,s.y,s.z))}}}else{const a=e.attributes.position;for(let o=0,l=a.count/3;o<l;o++)for(let c=0;c<3;c++){const h=3*o+c,d=3*o+(c+1)%3;n.fromBufferAttribute(a,h),s.fromBufferAttribute(a,d),Wb(n,s,i)===!0&&(t.push(n.x,n.y,n.z),t.push(s.x,s.y,s.z))}}this.setAttribute("position",new Ne(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function Wb(r,e,t){const i=`${r.x},${r.y},${r.z}-${e.x},${e.y},${e.z}`,n=`${e.x},${e.y},${e.z}-${r.x},${r.y},${r.z}`;return t.has(i)===!0||t.has(n)===!0?!1:(t.add(i),t.add(n),!0)}var Xb=Object.freeze({__proto__:null,BoxGeometry:Bi,CapsuleGeometry:qm,CircleGeometry:Ym,ConeGeometry:Km,CylinderGeometry:kr,DodecahedronGeometry:Jm,EdgesGeometry:Nb,ExtrudeGeometry:sf,IcosahedronGeometry:af,LatheGeometry:gp,OctahedronGeometry:eo,PlaneGeometry:as,PolyhedronGeometry:Yo,RingGeometry:of,ShapeGeometry:lf,SphereGeometry:Gs,TetrahedronGeometry:cf,TorusGeometry:wh,TorusKnotGeometry:hf,TubeGeometry:uf,WireframeGeometry:pf});class qb extends Ki{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new fe(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class Yb extends yr{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class fa extends Ki{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new fe(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new fe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=pn,this.normalScale=new ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class _p extends fa{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ne(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ki(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new fe(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new fe(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new fe(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Vl extends Ki{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new fe(16777215),this.specular=new fe(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new fe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=pn,this.normalScale=new ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=vs,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Kb extends Ki{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new fe(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new fe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=pn,this.normalScale=new ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class xv extends Ki{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=pn,this.normalScale=new ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class Ev extends Ki{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new fe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new fe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=pn,this.normalScale=new ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=vs,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Jb extends Ki{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new fe(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=pn,this.normalScale=new ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Zb extends Ji{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function ls(r,e,t){return Cv(r)?new r.constructor(r.subarray(e,t!==void 0?t:r.length)):r.slice(e,t)}function jl(r,e,t){return!r||!t&&r.constructor===e?r:typeof e.BYTES_PER_ELEMENT=="number"?new e(r):Array.prototype.slice.call(r)}function Cv(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function $b(r){function e(n,s){return r[n]-r[s]}const t=r.length,i=new Array(t);for(let n=0;n!==t;++n)i[n]=n;return i.sort(e),i}function Mv(r,e,t){const i=r.length,n=new r.constructor(i);for(let s=0,a=0;a!==i;++s){const o=t[s]*e;for(let l=0;l!==e;++l)n[a++]=r[o+l]}return n}function Sv(r,e,t,i){let n=1,s=r[0];for(;s!==void 0&&s[i]===void 0;)s=r[n++];if(s===void 0)return;let a=s[i];if(a!==void 0)if(Array.isArray(a))do a=s[i],a!==void 0&&(e.push(s.time),t.push.apply(t,a)),s=r[n++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[i],a!==void 0&&(e.push(s.time),a.toArray(t,t.length)),s=r[n++];while(s!==void 0);else do a=s[i],a!==void 0&&(e.push(s.time),t.push(a)),s=r[n++];while(s!==void 0)}function KP(r,e,t,i,n=30){const s=r.clone();s.name=e;const a=[];for(let l=0;l<s.tracks.length;++l){const c=s.tracks[l],h=c.getValueSize(),d=[],m=[];for(let f=0;f<c.times.length;++f){const v=c.times[f]*n;if(!(v<t||v>=i)){d.push(c.times[f]);for(let w=0;w<h;++w)m.push(c.values[f*h+w])}}d.length!==0&&(c.times=jl(d,c.times.constructor),c.values=jl(m,c.values.constructor),a.push(c))}s.tracks=a;let o=1/0;for(let l=0;l<s.tracks.length;++l)o>s.tracks[l].times[0]&&(o=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*o);return s.resetDuration(),s}function JP(r,e=0,t=r,i=30){i<=0&&(i=30);const n=t.tracks.length,s=e/i;for(let a=0;a<n;++a){const o=t.tracks[a],l=o.ValueTypeName;if(l==="bool"||l==="string")continue;const c=r.tracks.find(function(y){return y.name===o.name&&y.ValueTypeName===l});if(c===void 0)continue;let h=0;const d=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=d/3);let m=0;const f=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(m=f/3);const v=o.times.length-1;let w;if(s<=o.times[0]){const y=h,E=d-h;w=ls(o.values,y,E)}else if(s>=o.times[v]){const y=v*d+h,E=y+d-h;w=ls(o.values,y,E)}else{const y=o.createInterpolant(),E=h,_=d-h;y.evaluate(s),w=ls(y.resultBuffer,E,_)}l==="quaternion"&&new Ct().fromArray(w).normalize().conjugate().toArray(w);const b=c.times.length;for(let y=0;y<b;++y){const E=y*f+m;if(l==="quaternion")Ct.multiplyQuaternionsFlat(c.values,E,w,0,c.values,E);else{const _=f-m*2;for(let C=0;C<_;++C)c.values[E+C]-=w[C]}}}return r.blendMode=Po,r}const ZP={arraySlice:ls,convertArray:jl,isTypedArray:Cv,getKeyframeOrder:$b,sortedArray:Mv,flattenJSON:Sv,subclip:KP,makeClipAdditive:JP};class xh{constructor(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=n!==void 0?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,n=t[i],s=t[i-1];e:{t:{let a;i:{r:if(!(e<n)){for(let o=i+2;;){if(n===void 0){if(e<s)break r;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===o)break;if(s=n,n=t[++i],e<n)break t}a=t.length;break i}if(!(e>=s)){const o=t[1];e<o&&(i=2,s=o);for(let l=i-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(n=s,s=t[--i-1],e>=s)break t}a=i,i=0;break i}break e}for(;i<a;){const o=i+a>>>1;e<t[o]?a=o:i=o+1}if(n=t[i],s=t[i-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,n)}return this.interpolate_(i,s,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,s=e*n;for(let a=0;a!==n;++a)t[a]=i[s+a];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class ew extends xh{constructor(e,t,i,n){super(e,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Fa,endingEnd:Fa}}intervalChanged_(e,t,i){const n=this.parameterPositions;let s=e-2,a=e+1,o=n[s],l=n[a];if(o===void 0)switch(this.getSettings_().endingStart){case ws:s=e,o=2*t-i;break;case Io:s=n.length-2,o=t+n[s]-n[s+1];break;default:s=e,o=i}if(l===void 0)switch(this.getSettings_().endingEnd){case ws:a=e,l=2*i-t;break;case Io:a=1,l=i+n[1]-n[0];break;default:a=e-1,l=t}const c=(i-t)*.5,h=this.valueSize;this._weightPrev=c/(t-o),this._weightNext=c/(l-i),this._offsetPrev=s*h,this._offsetNext=a*h}interpolate_(e,t,i,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,c=l-o,h=this._offsetPrev,d=this._offsetNext,m=this._weightPrev,f=this._weightNext,v=(i-t)/(n-t),w=v*v,b=w*v,y=-m*b+2*m*w-m*v,E=(1+m)*b+(-1.5-2*m)*w+(-.5+m)*v+1,_=(-1-f)*b+(1.5+f)*w+.5*v,C=f*b-f*w;for(let M=0;M!==o;++M)s[M]=y*a[h+M]+E*a[c+M]+_*a[l+M]+C*a[d+M];return s}}class Tv extends xh{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,c=l-o,h=(i-t)/(n-t),d=1-h;for(let m=0;m!==o;++m)s[m]=a[c+m]*d+a[l+m]*h;return s}}class tw extends xh{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e){return this.copySampleValue_(e-1)}}class zs{constructor(e,t,i,n){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=jl(t,this.TimeBufferType),this.values=jl(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:jl(e.times,Array),values:jl(e.values,Array)};const n=e.getInterpolation();n!==e.DefaultInterpolation&&(i.interpolation=n)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new tw(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Tv(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new ew(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Kr:t=this.InterpolantFactoryMethodDiscrete;break;case Cn:t=this.InterpolantFactoryMethodLinear;break;case ka:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Kr;case this.InterpolantFactoryMethodLinear:return Cn;case this.InterpolantFactoryMethodSmooth:return ka}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]*=e}return this}trim(e,t){const i=this.times,n=i.length;let s=0,a=n-1;for(;s!==n&&i[s]<e;)++s;for(;a!==-1&&i[a]>t;)--a;if(++a,s!==0||a!==n){s>=a&&(a=Math.max(a,1),s=a-1);const o=this.getValueSize();this.times=ls(i,s,a),this.values=ls(this.values,s*o,a*o)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,n=this.values,s=i.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let o=0;o!==s;o++){const l=i[o];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,l),e=!1;break}if(a!==null&&a>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,l,a),e=!1;break}a=l}if(n!==void 0&&Cv(n))for(let o=0,l=n.length;o!==l;++o){const c=n[o];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,c),e=!1;break}}return e}optimize(){const e=ls(this.times),t=ls(this.values),i=this.getValueSize(),n=this.getInterpolation()===ka,s=e.length-1;let a=1;for(let o=1;o<s;++o){let l=!1;const c=e[o],h=e[o+1];if(c!==h&&(o!==1||c!==e[0]))if(n)l=!0;else{const d=o*i,m=d-i,f=d+i;for(let v=0;v!==i;++v){const w=t[d+v];if(w!==t[m+v]||w!==t[f+v]){l=!0;break}}}if(l){if(o!==a){e[a]=e[o];const d=o*i,m=a*i;for(let f=0;f!==i;++f)t[m+f]=t[d+f]}++a}}if(s>0){e[a]=e[s];for(let o=s*i,l=a*i,c=0;c!==i;++c)t[l+c]=t[o+c];++a}return a!==e.length?(this.times=ls(e,0,a),this.values=ls(t,0,a*i)):(this.times=e,this.values=t),this}clone(){const e=ls(this.times,0),t=ls(this.values,0),i=this.constructor,n=new i(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}zs.prototype.TimeBufferType=Float32Array,zs.prototype.ValueBufferType=Float32Array,zs.prototype.DefaultInterpolation=Cn;class Hl extends zs{}Hl.prototype.ValueTypeName="bool",Hl.prototype.ValueBufferType=Array,Hl.prototype.DefaultInterpolation=Kr,Hl.prototype.InterpolantFactoryMethodLinear=void 0,Hl.prototype.InterpolantFactoryMethodSmooth=void 0;class Iv extends zs{}Iv.prototype.ValueTypeName="color";class Wl extends zs{}Wl.prototype.ValueTypeName="number";class iw extends xh{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=(i-t)/(n-t);let c=e*o;for(let h=c+o;c!==h;c+=4)Ct.slerpFlat(s,0,a,c-o,a,c,l);return s}}class to extends zs{InterpolantFactoryMethodLinear(e){return new iw(this.times,this.values,this.getValueSize(),e)}}to.prototype.ValueTypeName="quaternion",to.prototype.DefaultInterpolation=Cn,to.prototype.InterpolantFactoryMethodSmooth=void 0;class Xl extends zs{}Xl.prototype.ValueTypeName="string",Xl.prototype.ValueBufferType=Array,Xl.prototype.DefaultInterpolation=Kr,Xl.prototype.InterpolantFactoryMethodLinear=void 0,Xl.prototype.InterpolantFactoryMethodSmooth=void 0;class ql extends zs{}ql.prototype.ValueTypeName="vector";class Yl{constructor(e,t=-1,i,n=Bu){this.name=e,this.tracks=i,this.duration=t,this.blendMode=n,this.uuid=dn(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,n=1/(e.fps||1);for(let a=0,o=i.length;a!==o;++a)t.push(e2(i[a]).scale(n));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,a=i.length;s!==a;++s)t.push(zs.toJSON(i[s]));return n}static CreateFromMorphTargetSequence(e,t,i,n){const s=t.length,a=[];for(let o=0;o<s;o++){let l=[],c=[];l.push((o+s-1)%s,o,(o+1)%s),c.push(0,1,0);const h=$b(l);l=Mv(l,1,h),c=Mv(c,1,h),!n&&l[0]===0&&(l.push(s),c.push(c[0])),a.push(new Wl(".morphTargetInfluences["+t[o].name+"]",l,c).scale(1/i))}return new this(e,-1,a)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const n=e;i=n.geometry&&n.geometry.animations||n.animations}for(let n=0;n<i.length;n++)if(i[n].name===t)return i[n];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const n={},s=/^([\w-]*?)([\d]+)$/;for(let o=0,l=e.length;o<l;o++){const c=e[o],h=c.name.match(s);if(h&&h.length>1){const d=h[1];let m=n[d];m||(n[d]=m=[]),m.push(c)}}const a=[];for(const o in n)a.push(this.CreateFromMorphTargetSequence(o,n[o],t,i));return a}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(h,d,m,f,v){if(m.length!==0){const w=[],b=[];Sv(m,w,b,f),w.length!==0&&v.push(new h(d,w,b))}},n=[],s=e.name||"default",a=e.fps||30,o=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let h=0;h<c.length;h++){const d=c[h].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const m={};let f;for(f=0;f<d.length;f++)if(d[f].morphTargets)for(let v=0;v<d[f].morphTargets.length;v++)m[d[f].morphTargets[v]]=-1;for(const v in m){const w=[],b=[];for(let y=0;y!==d[f].morphTargets.length;++y){const E=d[f];w.push(E.time),b.push(E.morphTarget===v?1:0)}n.push(new Wl(".morphTargetInfluence["+v+"]",w,b))}l=m.length*a}else{const m=".bones["+t[h].name+"]";i(ql,m+".position",d,"pos",n),i(to,m+".quaternion",d,"rot",n),i(ql,m+".scale",d,"scl",n)}}return n.length===0?null:new this(s,l,n,o)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,n=e.length;i!==n;++i){const s=this.tracks[i];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function $P(r){switch(r.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Wl;case"vector":case"vector2":case"vector3":case"vector4":return ql;case"color":return Iv;case"quaternion":return to;case"bool":case"boolean":return Hl;case"string":return Xl}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+r)}function e2(r){if(r.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=$P(r.type);if(r.times===void 0){const t=[],i=[];Sv(r.keys,t,i,"value"),r.times=t,r.values=i}return e.parse!==void 0?e.parse(r):new e(r.name,r.times,r.values,r.interpolation)}const Bn={enabled:!1,files:{},add:function(r,e){this.enabled!==!1&&(this.files[r]=e)},get:function(r,e){return this.enabled===!1?e?Promise.resolve():void 0:e?Promise.resolve(this.files[r]):this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}};class df{constructor(e,t,i){const n=this;let s=!1,a=0,o=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(h){o++,s===!1&&n.onStart!==void 0&&n.onStart(h,a,o),s=!0},this.itemEnd=function(h){a++,n.onProgress!==void 0&&n.onProgress(h,a,o),a===o&&(s=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(h){n.onError!==void 0&&n.onError(h)},this.resolveURL=function(h){return l?l(h):h},this.setURLModifier=function(h){return l=h,this},this.addHandler=function(h,d){return c.push(h,d),this},this.removeHandler=function(h){const d=c.indexOf(h);return d!==-1&&c.splice(d,2),this},this.getHandler=function(h){for(let d=0,m=c.length;d<m;d+=2){const f=c[d],v=c[d+1];if(f.global&&(f.lastIndex=0),f.test(h))return v}return null}}}const Pv=new df;class $i{constructor(e){this.manager=e!==void 0?e:Pv,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(n,s){i.load(e,n,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const io={};class t2 extends Error{constructor(e,t){super(e),this.response=t}}class bi extends $i{constructor(e){super(e),this.responseType="text",this.useCache=!0}load(e,t,i,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e),(this.useCache?Bn.get(e,this.responseType,this.mimeType):Promise.resolve(void 0)).then(s=>{if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(io[e]!==void 0){io[e].push({onLoad:t,onProgress:i,onError:n});return}io[e]=[],io[e].push({onLoad:t,onProgress:i,onError:n});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,l=this.responseType;fetch(a).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const h=io[e],d=c.body.getReader(),m=c.headers.get("Content-Length")||c.headers.get("X-File-Size"),f=m?parseInt(m):0,v=f!==0;let w=0;const b=new ReadableStream({start(y){E();function E(){d.read().then(({done:_,value:C})=>{if(_)y.close();else{w+=C.byteLength;const M=new ProgressEvent("progress",{lengthComputable:v,loaded:w,total:f});for(let S=0,R=h.length;S<R;S++){const U=h[S];U.onProgress&&U.onProgress(M)}y.enqueue(C),E()}})}}});return new Response(b)}else throw new t2(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(h=>new DOMParser().parseFromString(h,o));case"json":return c.json();default:if(o===void 0)return c.text();{const h=/charset="?([^;"\s]*)"?/i.exec(o),d=h&&h[1]?h[1].toLowerCase():void 0,m=new TextDecoder(d);return c.arrayBuffer().then(f=>m.decode(f))}}}).then(c=>{this.useCache&&Bn.add(e,c,this.responseType);const h=io[e];delete io[e];for(let d=0,m=h.length;d<m;d++){const f=h[d];f.onLoad&&f.onLoad(c)}}).catch(c=>{const h=io[e];if(h===void 0)throw this.manager.itemError(e),c;delete io[e];for(let d=0,m=h.length;d<m;d++){const f=h[d];f.onError&&f.onError(c)}this.manager.itemError(e)}).finally(()=>{this.useCache&&this.manager.itemEnd(e)}),this.useCache&&this.manager.itemStart(e)})}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class i2 extends $i{constructor(e){super(e)}load(e,t,i,n){const s=this,a=new bi(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(o){try{t(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(e)}},i,n)}parse(e){const t=[];for(let i=0;i<e.length;i++){const n=Yl.parse(e[i]);t.push(n)}return t}}class rw extends $i{constructor(e){super(e)}load(e,t,i,n){const s=this,a=[],o=new qo,l=new bi(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(s.withCredentials);let c=0;function h(d){l.load(e[d],function(m){const f=s.parse(m,!0);a[d]={width:f.width,height:f.height,format:f.format,mipmaps:f.mipmaps},c+=1,c===6&&(f.mipmapCount===1&&(o.minFilter=Et),o.image=a,o.format=f.format,o.needsUpdate=!0,t&&t(o))},i,n)}if(Array.isArray(e))for(let d=0,m=e.length;d<m;++d)h(d);else l.load(e,function(d){const m=s.parse(d,!0);if(m.isCubemap){const f=m.mipmaps.length/m.mipmapCount;for(let v=0;v<f;v++){a[v]={mipmaps:[]};for(let w=0;w<m.mipmapCount;w++)a[v].mipmaps.push(m.mipmaps[v*m.mipmapCount+w]),a[v].format=m.format,a[v].width=m.width,a[v].height=m.height}o.image=a}else o.image.width=m.width,o.image.height=m.height,o.mipmaps=m.mipmaps;m.mipmapCount===1&&(o.minFilter=Et),o.format=m.format,o.needsUpdate=!0,t&&t(o)},i,n);return o}}class bp extends $i{constructor(e){super(e)}load(e,t,i,n){const s=e;this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const a=this,o=Bn.get(e);if(o!==void 0)return a.manager.itemStart(e),setTimeout(function(){t&&t(o),a.manager.itemEnd(e)},0),o;const l=Ms("img");function c(){d(),Bn.add(e,this),t&&t(this),a.manager.itemEnd(e)}function h(m){d(),n&&n(m),a.manager.itemError(e),a.manager.itemEnd(e)}function d(){l.removeEventListener("load",c,!1),l.removeEventListener("error",h,!1)}return l.addEventListener("load",c,!1),l.addEventListener("error",h,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(l.crossOrigin=this.crossOrigin),a.manager.itemStart(e),Bn.get(e,"blob").then(m=>{if(m!==void 0&&!m.type.startsWith("text/plain")){m.type||(e.endsWith(".svg")||e.startsWith("data:image/svg"))&&(m=new Blob([m],{type:"image/svg+xml"})),l.src=URL.createObjectURL(m);return}const f=new bi(this.manager);f.useCache=!1,f.setPath(this.path),f.setCrossOrigin(this.crossOrigin),f.setResponseType("blob"),f.load(s,function(v){v.type||(e.endsWith(".svg")||e.startsWith("data:image/svg"))&&(v=new Blob([v],{type:"image/svg+xml"})),Bn.add(e,v,"blob"),l.src=URL.createObjectURL(v)},i,v=>{d(),n&&n(v)})}),l}}class r2 extends $i{constructor(e){super(e)}load(e,t,i,n){const s=new Os;s.colorSpace=it;const a=new bp(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function l(c){a.load(e[c],function(h){s.images[c]=h,o++,o===6&&(s.needsUpdate=!0,t&&t(s))},void 0,n)}for(let c=0;c<e.length;++c)l(c);return s}}class Rv extends $i{constructor(e){super(e)}load(e,t,i,n){const s=this,a=new pa,o=new bi(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(s.withCredentials),o.load(e,function(l){const c=s.parse(l);c&&(c.image!==void 0?a.image=c.image:c.data!==void 0&&(a.image.width=c.width,a.image.height=c.height,a.image.data=c.data,a.image.complete=!0),a.wrapS=c.wrapS!==void 0?c.wrapS:ai,a.wrapT=c.wrapT!==void 0?c.wrapT:ai,a.magFilter=c.magFilter!==void 0?c.magFilter:Et,a.minFilter=c.minFilter!==void 0?c.minFilter:Et,a.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0?a.colorSpace=c.colorSpace:c.encoding!==void 0&&(a.encoding=c.encoding),c.flipY!==void 0&&(a.flipY=c.flipY),c.format!==void 0&&(a.format=c.format),c.type!==void 0&&(a.type=c.type),c.mipmaps!==void 0&&(a.mipmaps=c.mipmaps,a.minFilter=Er),c.mipmapCount===1&&(a.minFilter=Et),c.generateMipmaps!==void 0&&(a.generateMipmaps=c.generateMipmaps),a.needsUpdate=!0,t&&t(a,c))},i,n),a}}class Ko extends $i{constructor(e){super(e)}load(e,t,i,n){const s=new Ti,a=new bp(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(o){s.image=o,s.needsUpdate=!0,t!==void 0&&t(s)},i,n),s}}class Jo extends It{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new fe(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}class mf extends Jo{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(It.DEFAULT_UP),this.updateMatrix(),this.groundColor=new fe(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const Dv=new et,nw=new P,sw=new P;class Bv{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ne(512,512),this.map=null,this.mapPass=null,this.matrix=new et,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Xn,this._frameExtents=new ne(1,1),this._viewportCount=1,this._viewports=[new bt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;nw.setFromMatrixPosition(e.matrixWorld),t.position.copy(nw),sw.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(sw),t.updateMatrixWorld(),Dv.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Dv),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(Dv)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.normalBias=e.normalBias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class n2 extends Bv{constructor(){super(new Qi(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=Do*2*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(i!==t.fov||n!==t.aspect||s!==t.far)&&(t.fov=i,t.aspect=n,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Eh extends Jo{constructor(e,t,i=0,n=Math.PI/3,s=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(It.DEFAULT_UP),this.updateMatrix(),this.target=new It,this.distance=i,this.angle=n,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new n2}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const aw=new et,wp=new P,Lv=new P;class s2 extends Bv{constructor(){super(new Qi(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ne(4,2),this._viewportCount=6,this._viewports=[new bt(2,1,1,1),new bt(0,1,1,1),new bt(3,1,1,1),new bt(1,1,1,1),new bt(3,0,1,1),new bt(1,0,1,1)],this._cubeDirections=[new P(1,0,0),new P(-1,0,0),new P(0,0,1),new P(0,0,-1),new P(0,1,0),new P(0,-1,0)],this._cubeUps=[new P(0,1,0),new P(0,1,0),new P(0,1,0),new P(0,1,0),new P(0,0,1),new P(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,n=this.matrix,s=e.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),wp.setFromMatrixPosition(e.matrixWorld),i.position.copy(wp),Lv.copy(i.position),Lv.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(Lv),i.updateMatrixWorld(),n.makeTranslation(-wp.x,-wp.y,-wp.z),aw.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(aw)}}class Kl extends Jo{constructor(e,t,i=0,n=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new s2}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class a2 extends Bv{constructor(){super(new ua(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Ch extends Jo{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(It.DEFAULT_UP),this.updateMatrix(),this.target=new It,this.shadow=new a2}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class ff extends Jo{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class gf extends Jo{constructor(e,t,i=10,n=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class ow{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new P)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,n=e.y,s=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*n),t.addScaledVector(a[2],.488603*s),t.addScaledVector(a[3],.488603*i),t.addScaledVector(a[4],1.092548*(i*n)),t.addScaledVector(a[5],1.092548*(n*s)),t.addScaledVector(a[6],.315392*(3*s*s-1)),t.addScaledVector(a[7],1.092548*(i*s)),t.addScaledVector(a[8],.546274*(i*i-n*n)),t}getIrradianceAt(e,t){const i=e.x,n=e.y,s=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],2*.511664*n),t.addScaledVector(a[2],2*.511664*s),t.addScaledVector(a[3],2*.511664*i),t.addScaledVector(a[4],2*.429043*i*n),t.addScaledVector(a[5],2*.429043*n*s),t.addScaledVector(a[6],.743125*s*s-.247708),t.addScaledVector(a[7],2*.429043*i*s),t.addScaledVector(a[8],.429043*(i*i-n*n)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(e,t+n*3);return this}toArray(e=[],t=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(e,t+n*3);return e}static getBasisAt(e,t){const i=e.x,n=e.y,s=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*s,t[3]=.488603*i,t[4]=1.092548*i*n,t[5]=1.092548*n*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*i*s,t[8]=.546274*(i*i-n*n)}}class Af extends Jo{constructor(e=new ow,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class xp extends $i{constructor(e){super(e),this.textures={}}load(e,t,i,n){const s=this,a=new bi(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(o){try{t(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(e)}},i,n)}parse(e){const t=this.textures;function i(a){return t[a]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",a),t[a]}const n=e.metadata&&e.metadata.version<=4.5?wi:void 0,s=xp.createMaterialFromType(e.type);if(e.uuid!==void 0&&(s.uuid=e.uuid),e.name!==void 0&&(s.name=e.name),e.color!==void 0&&s.color!==void 0&&s.color.setHex(e.color,n),e.roughness!==void 0&&(s.roughness=e.roughness),e.metalness!==void 0&&(s.metalness=e.metalness),e.sheen!==void 0&&(s.sheen=e.sheen),e.sheenColor!==void 0&&(s.sheenColor=new fe().setHex(e.sheenColor,n)),e.sheenRoughness!==void 0&&(s.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&s.emissive!==void 0&&s.emissive.setHex(e.emissive,n),e.specular!==void 0&&s.specular!==void 0&&s.specular.setHex(e.specular,n),e.specularIntensity!==void 0&&(s.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&s.specularColor!==void 0&&s.specularColor.setHex(e.specularColor,n),e.shininess!==void 0&&(s.shininess=e.shininess),e.clearcoat!==void 0&&(s.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=e.clearcoatRoughness),e.iridescence!==void 0&&(s.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(s.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(s.transmission=e.transmission),e.thickness!==void 0&&(s.thickness=e.thickness),e.attenuationDistance!==void 0&&(s.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&s.attenuationColor!==void 0&&s.attenuationColor.setHex(e.attenuationColor,n),e.anisotropy!==void 0&&(s.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(s.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(s.fog=e.fog),e.flatShading!==void 0&&(s.flatShading=e.flatShading),e.blending!==void 0&&(s.blending=e.blending),e.combine!==void 0&&(s.combine=e.combine),e.side!==void 0&&(s.side=e.side),e.shadowSide!==void 0&&(s.shadowSide=e.shadowSide),e.opacity!==void 0&&(s.opacity=e.opacity),e.transparent!==void 0&&(s.transparent=e.transparent),e.alphaTest!==void 0&&(s.alphaTest=e.alphaTest),e.depthTest!==void 0&&(s.depthTest=e.depthTest),e.depthWrite!==void 0&&(s.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(s.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(s.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(s.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(s.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(s.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(s.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(s.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(s.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(s.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(s.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(s.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(s.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(s.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(s.rotation=e.rotation),e.linewidth!==1&&(s.linewidth=e.linewidth),e.dashSize!==void 0&&(s.dashSize=e.dashSize),e.gapSize!==void 0&&(s.gapSize=e.gapSize),e.scale!==void 0&&(s.scale=e.scale),e.polygonOffset!==void 0&&(s.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(s.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(s.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(s.dithering=e.dithering),e.alphaToCoverage!==void 0&&(s.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(s.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(s.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(s.visible=e.visible),e.toneMapped!==void 0&&(s.toneMapped=e.toneMapped),e.userData!==void 0&&(s.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?s.vertexColors=e.vertexColors>0:s.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const a in e.uniforms){const o=e.uniforms[a];switch(s.uniforms[a]={},o.type){case"t":s.uniforms[a].value=i(o.value);break;case"c":s.uniforms[a].value=new fe().setHex(o.value,n);break;case"v2":s.uniforms[a].value=new ne().fromArray(o.value);break;case"v3":s.uniforms[a].value=new P().fromArray(o.value);break;case"v4":s.uniforms[a].value=new bt().fromArray(o.value);break;case"m3":s.uniforms[a].value=new Bt().fromArray(o.value);break;case"m4":s.uniforms[a].value=new et().fromArray(o.value);break;default:s.uniforms[a].value=o.value}}if(e.defines!==void 0&&(s.defines=e.defines),e.vertexShader!==void 0&&(s.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(s.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(s.glslVersion=e.glslVersion),e.extensions!==void 0)for(const a in e.extensions)s.extensions[a]=e.extensions[a];if(e.lights!==void 0&&(s.lights=e.lights),e.clipping!==void 0&&(s.clipping=e.clipping),e.size!==void 0&&(s.size=e.size),e.sizeAttenuation!==void 0&&(s.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(s.map=i(e.map)),e.matcap!==void 0&&(s.matcap=i(e.matcap)),e.alphaMap!==void 0&&(s.alphaMap=i(e.alphaMap)),e.bumpMap!==void 0&&(s.bumpMap=i(e.bumpMap)),e.bumpScale!==void 0&&(s.bumpScale=e.bumpScale),e.normalMap!==void 0&&(s.normalMap=i(e.normalMap)),e.normalMapType!==void 0&&(s.normalMapType=e.normalMapType),e.normalScale!==void 0){let a=e.normalScale;Array.isArray(a)===!1&&(a=[a,a]),s.normalScale=new ne().fromArray(a)}return e.displacementMap!==void 0&&(s.displacementMap=i(e.displacementMap)),e.displacementScale!==void 0&&(s.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(s.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(s.roughnessMap=i(e.roughnessMap)),e.metalnessMap!==void 0&&(s.metalnessMap=i(e.metalnessMap)),e.emissiveMap!==void 0&&(s.emissiveMap=i(e.emissiveMap)),e.emissiveIntensity!==void 0&&(s.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(s.specularMap=i(e.specularMap)),e.specularIntensityMap!==void 0&&(s.specularIntensityMap=i(e.specularIntensityMap)),e.specularColorMap!==void 0&&(s.specularColorMap=i(e.specularColorMap)),e.envMap!==void 0&&(s.envMap=i(e.envMap)),e.envMapIntensity!==void 0&&(s.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(s.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(s.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(s.lightMap=i(e.lightMap)),e.lightMapIntensity!==void 0&&(s.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(s.aoMap=i(e.aoMap)),e.aoMapIntensity!==void 0&&(s.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(s.gradientMap=i(e.gradientMap)),e.clearcoatMap!==void 0&&(s.clearcoatMap=i(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(s.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(s.clearcoatNormalMap=i(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(s.clearcoatNormalScale=new ne().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(s.iridescenceMap=i(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(s.iridescenceThicknessMap=i(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(s.transmissionMap=i(e.transmissionMap)),e.thicknessMap!==void 0&&(s.thicknessMap=i(e.thicknessMap)),e.anisotropyMap!==void 0&&(s.anisotropyMap=i(e.anisotropyMap)),e.sheenColorMap!==void 0&&(s.sheenColorMap=i(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(s.sheenRoughnessMap=i(e.sheenRoughnessMap)),s}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const t={ShadowMaterial:qb,SpriteMaterial:ap,RawShaderMaterial:Yb,ShaderMaterial:yr,PointsMaterial:da,MeshPhysicalMaterial:_p,MeshStandardMaterial:fa,MeshPhongMaterial:Vl,MeshToonMaterial:Kb,MeshNormalMaterial:xv,MeshLambertMaterial:Ev,MeshDepthMaterial:np,MeshDistanceMaterial:iv,MeshBasicMaterial:Pn,MeshMatcapMaterial:Jb,LineDashedMaterial:Zb,LineBasicMaterial:Ji,Material:Ki};return new t[e]}}class Qs{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let i=0,n=e.length;i<n;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class Uv extends ht{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class Ov extends $i{constructor(e){super(e)}load(e,t,i,n){const s=this,a=new bi(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(o){try{t(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(e)}},i,n)}parse(e){const t={},i={};function n(m,f){if(t[f]!==void 0)return t[f];const v=m.interleavedBuffers[f],w=s(m,v.buffer),b=Uo(v.type,w),y=new ph(b,v.stride);return y.uuid=v.uuid,t[f]=y,y}function s(m,f){if(i[f]!==void 0)return i[f];const v=m.arrayBuffers[f],w=new Uint32Array(v).buffer;return i[f]=w,w}const a=e.isInstancedBufferGeometry?new Uv:new ht,o=e.data.index;if(o!==void 0){const m=Uo(o.type,o.array);a.setIndex(new At(m,1))}const l=e.data.attributes;for(const m in l){const f=l[m];let v;if(f.isInterleavedBufferAttribute){const w=n(e.data,f.data);v=new Vr(w,f.itemSize,f.offset,f.normalized)}else{const w=Uo(f.type,f.array),b=f.isInstancedBufferAttribute?Xo:At;v=new b(w,f.itemSize,f.normalized)}f.name!==void 0&&(v.name=f.name),f.usage!==void 0&&v.setUsage(f.usage),f.updateRange!==void 0&&(v.updateRange.offset=f.updateRange.offset,v.updateRange.count=f.updateRange.count),a.setAttribute(m,v)}const c=e.data.morphAttributes;if(c)for(const m in c){const f=c[m],v=[];for(let w=0,b=f.length;w<b;w++){const y=f[w];let E;if(y.isInterleavedBufferAttribute){const _=n(e.data,y.data);E=new Vr(_,y.itemSize,y.offset,y.normalized)}else{const _=Uo(y.type,y.array);E=new At(_,y.itemSize,y.normalized)}y.name!==void 0&&(E.name=y.name),v.push(E)}a.morphAttributes[m]=v}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const h=e.data.groups||e.data.drawcalls||e.data.offsets;if(h!==void 0)for(let m=0,f=h.length;m!==f;++m){const v=h[m];a.addGroup(v.start,v.count,v.materialIndex)}const d=e.data.boundingSphere;if(d!==void 0){const m=new P;d.center!==void 0&&m.fromArray(d.center),a.boundingSphere=new zr(m,d.radius)}return e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}class vf extends $i{constructor(e){super(e)}load(e,t,i,n){const s=this,a=this.path===""?Qs.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const o=new bi(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){let c=null;try{c=JSON.parse(l)}catch(d){n!==void 0&&n(d),console.error("THREE:ObjectLoader: Can't parse "+e+".",d.message);return}const h=c.metadata;if(h===void 0||h.type===void 0||h.type.toLowerCase()==="geometry"){n!==void 0&&n(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}s.parse(c,t)},i,n)}async loadAsync(e,t){const i=this,n=this.path===""?Qs.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const s=new bi(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const a=await s.loadAsync(e,t),o=JSON.parse(a),l=o.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await i.parseAsync(o)}parse(e,t){const i=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,n),a=this.parseImages(e.images,function(){t!==void 0&&t(c)}),o=this.parseTextures(e.textures,a),l=this.parseMaterials(e.materials,o),c=this.parseObject(e.object,s,l,o,i),h=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,h),t!==void 0){let d=!1;for(const m in a)if(a[m].data instanceof HTMLImageElement){d=!0;break}d===!1&&t(c)}return c}async parseAsync(e){const t=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),n=this.parseGeometries(e.geometries,i),s=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,s),o=this.parseMaterials(e.materials,a),l=this.parseObject(e.object,n,o,a,t),c=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,c),l}parseShapes(e){const t={};if(e!==void 0)for(let i=0,n=e.length;i<n;i++){const s=new zl().fromJSON(e[i]);t[s.uuid]=s}return t}parseSkeletons(e,t){const i={},n={};if(t.traverse(function(s){s.isBone&&(n[s.uuid]=s)}),e!==void 0)for(let s=0,a=e.length;s<a;s++){const o=new yh().fromJSON(e[s],n);i[o.uuid]=o}return i}parseGeometries(e,t){const i={};if(e!==void 0){const n=new Ov;for(let s=0,a=e.length;s<a;s++){let o;const l=e[s];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":o=n.parse(l);break;default:l.type in Xb?o=Xb[l.type].fromJSON(l,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}o.uuid=l.uuid,l.name!==void 0&&(o.name=l.name),l.userData!==void 0&&(o.userData=l.userData),i[l.uuid]=o}}return i}parseMaterials(e,t){const i={},n={};if(e!==void 0){const s=new xp;s.setTextures(t);for(let a=0,o=e.length;a<o;a++){const l=e[a];i[l.uuid]===void 0&&(i[l.uuid]=s.parse(l)),n[l.uuid]=i[l.uuid]}}return n}parseAnimations(e){const t={};if(e!==void 0)for(let i=0;i<e.length;i++){const n=e[i],s=Yl.parse(n);t[s.uuid]=s}return t}parseImages(e,t){const i=this,n={};let s;function a(l){return i.manager.itemStart(l),s.load(l,function(){i.manager.itemEnd(l)},void 0,function(){i.manager.itemError(l),i.manager.itemEnd(l)})}function o(l){if(typeof l=="string"){const c=l,h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:i.resourcePath+c;return a(h)}else return l.data?{data:Uo(l.type,l.data),width:l.width,height:l.height,complete:!0}:null}if(e!==void 0&&e.length>0){const l=new df(t);s=new bp(l),s.setCrossOrigin(this.crossOrigin);for(let c=0,h=e.length;c<h;c++){const d=e[c],m=d.url;if(Array.isArray(m)){const f=[];for(let v=0,w=m.length;v<w;v++){const b=m[v],y=o(b);y!==null&&(y instanceof HTMLImageElement?f.push(y):f.push(new pa(y.data,y.width,y.height)))}n[d.uuid]=new Zr(f)}else{const f=o(d.url);n[d.uuid]=new Zr(f)}}}return n}async parseImagesAsync(e){const t=this,i={};let n;async function s(a){if(typeof a=="string"){const o=a,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:t.resourcePath+o;return await n.loadAsync(l)}else return a.data?{data:Uo(a.type,a.data),width:a.width,height:a.height,complete:!0}:null}if(e!==void 0&&e.length>0){n=new bp(this.manager),n.setCrossOrigin(this.crossOrigin);for(let a=0,o=e.length;a<o;a++){const l=e[a],c=l.url;if(Array.isArray(c)){const h=[];for(let d=0,m=c.length;d<m;d++){const f=c[d],v=await s(f);v!==null&&(v instanceof HTMLImageElement?h.push(v):h.push(new pa(v.data,v.width,v.height)))}i[l.uuid]=new Zr(h)}else{const h=await s(l.url);i[l.uuid]=new Zr(h)}}}return i}parseTextures(e,t){function i(s,a){return typeof s=="number"?s:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",s),a[s])}const n={};if(e!==void 0)for(let s=0,a=e.length;s<a;s++){const o=e[s];o.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),t[o.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const l=t[o.image],c=l?l.data:void 0;let h;Array.isArray(c)?(h=new Os,c.length===6&&(h.needsUpdate=!0)):(c&&c.data?h=new pa:h=new Ti,c&&c.complete&&(h.needsUpdate=!0)),h.source=l,h.uuid=o.uuid,o.name!==void 0&&(h.name=o.name),o.mapping!==void 0&&(h.mapping=i(o.mapping,o2)),o.channel!==void 0&&(h.channel=o.channel),o.offset!==void 0&&h.offset.fromArray(o.offset),o.repeat!==void 0&&h.repeat.fromArray(o.repeat),o.center!==void 0&&h.center.fromArray(o.center),o.rotation!==void 0&&(h.rotation=o.rotation),o.wrap!==void 0&&(h.wrapS=i(o.wrap[0],lw),h.wrapT=i(o.wrap[1],lw)),o.format!==void 0&&(h.format=o.format),o.internalFormat!==void 0&&(h.internalFormat=o.internalFormat),o.type!==void 0&&(h.type=o.type),o.colorSpace!==void 0?h.colorSpace=o.colorSpace:o.encoding!==void 0&&(h.encoding=o.encoding),o.minFilter!==void 0&&(h.minFilter=i(o.minFilter,cw)),o.magFilter!==void 0&&(h.magFilter=i(o.magFilter,cw)),o.anisotropy!==void 0&&(h.anisotropy=o.anisotropy),o.flipY!==void 0&&(h.flipY=o.flipY),o.generateMipmaps!==void 0&&(h.generateMipmaps=o.generateMipmaps),o.premultiplyAlpha!==void 0&&(h.premultiplyAlpha=o.premultiplyAlpha),o.unpackAlignment!==void 0&&(h.unpackAlignment=o.unpackAlignment),o.compareFunction!==void 0&&(h.compareFunction=o.compareFunction),o.userData!==void 0&&(h.userData=o.userData),n[o.uuid]=h}return n}parseObject(e,t,i,n,s){let a;const o=e.metadata&&e.metadata.version<=4.5?wi:void 0;function l(f){return t[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",f),t[f]}function c(f){if(f!==void 0){if(Array.isArray(f)){const v=[];for(let w=0,b=f.length;w<b;w++){const y=f[w];i[y]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",y),v.push(i[y])}return v}return i[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",f),i[f]}}function h(f){return n[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",f),n[f]}let d,m;switch(e.type){case"Scene":a=new Nl,e.background!==void 0&&(Number.isInteger(e.background)?a.background=new fe().setHex(e.background,o):a.background=h(e.background)),e.environment!==void 0&&(a.environment=h(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?a.fog=new Bm(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(a.fog=new Dm(e.fog.color,e.fog.density))),e.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(a.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":a=new Qi(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(a.focus=e.focus),e.zoom!==void 0&&(a.zoom=e.zoom),e.filmGauge!==void 0&&(a.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(a.filmOffset=e.filmOffset),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new ua(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(a.zoom=e.zoom),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new ff(e.color,e.intensity);break;case"DirectionalLight":a=new Ch(e.color,e.intensity);break;case"PointLight":a=new Kl(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new gf(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new Eh(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":a=new mf(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=new Af().fromJSON(e);break;case"SkinnedMesh":d=l(e.geometry),m=c(e.material),a=new Nm(d,m),e.bindMode!==void 0&&(a.bindMode=e.bindMode),e.bindMatrix!==void 0&&a.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(a.skeleton=e.skeleton);break;case"Mesh":d=l(e.geometry),m=c(e.material),a=new Fe(d,m);break;case"InstancedMesh":d=l(e.geometry),m=c(e.material);const f=e.count,v=e.instanceMatrix,w=e.instanceColor;a=new pp(d,m,f),a.instanceMatrix=new Xo(new Float32Array(v.array),16),w!==void 0&&(a.instanceColor=new Xo(new Float32Array(w.array),w.itemSize));break;case"LOD":a=new gb;break;case"Line":a=new Tr(l(e.geometry),c(e.material));break;case"LineLoop":a=new cv(l(e.geometry),c(e.material));break;case"LineSegments":a=new qn(l(e.geometry),c(e.material));break;case"PointCloud":case"Points":a=new Gl(l(e.geometry),c(e.material));break;case"Sprite":a=new Om(c(e.material));break;case"Group":a=new fn;break;case"Bone":a=new vh;break;default:a=new It}if(a.uuid=e.uuid,e.name!==void 0&&(a.name=e.name),e.matrix!==void 0?(a.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(e.position!==void 0&&a.position.fromArray(e.position),e.rotation!==void 0&&a.rotation.fromArray(e.rotation),e.quaternion!==void 0&&a.quaternion.fromArray(e.quaternion),e.scale!==void 0&&a.scale.fromArray(e.scale)),e.up!==void 0&&a.up.fromArray(e.up),e.castShadow!==void 0&&(a.castShadow=e.castShadow),e.receiveShadow!==void 0&&(a.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(a.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(a.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(a.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(a.visible=e.visible),e.frustumCulled!==void 0&&(a.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(a.renderOrder=e.renderOrder),e.userData!==void 0&&(a.userData=e.userData),e.layers!==void 0&&(a.layers.mask=e.layers),e.children!==void 0){const f=e.children;for(let v=0;v<f.length;v++)a.add(this.parseObject(f[v],t,i,n,s))}if(e.animations!==void 0){const f=e.animations;for(let v=0;v<f.length;v++){const w=f[v];a.animations.push(s[w])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(a.autoUpdate=e.autoUpdate);const f=e.levels;for(let v=0;v<f.length;v++){const w=f[v],b=a.getObjectByProperty("uuid",w.object);b!==void 0&&a.addLevel(b,w.distance,w.hysteresis)}}return a}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(i){if(i.isSkinnedMesh===!0&&i.skeleton!==void 0){const n=t[i.skeleton];n===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",i.skeleton):i.bind(n,i.bindMatrix)}})}}const o2={UVMapping:wo,CubeReflectionMapping:ys,CubeRefractionMapping:Ba,EquirectangularReflectionMapping:_s,EquirectangularRefractionMapping:ea,CubeUVReflectionMapping:xo},lw={RepeatWrapping:Ar,ClampToEdgeWrapping:ai,MirroredRepeatWrapping:bs},cw={NearestFilter:Ai,NearestMipmapNearestFilter:es,NearestMipmapLinearFilter:Gn,LinearFilter:Et,LinearMipmapNearestFilter:Eo,LinearMipmapLinearFilter:Er};class hw extends $i{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this;Bn.get(e,"blob").then(a=>{if(a!==void 0){s.manager.itemStart(e),createImageBitmap(a,Object.assign(s.options,{colorSpaceConversion:"none"})).then(function(l){t&&t(l),s.manager.itemEnd(e)}).catch(function(l){n&&n(l),s.manager.itemError(e),s.manager.itemEnd(e)});return}const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then(function(l){return l.blob()}).then(function(l){return Bn.add(e,l,"blob"),createImageBitmap(l,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(l){t&&t(l),s.manager.itemEnd(e)}).catch(function(l){n&&n(l),s.manager.itemError(e),s.manager.itemEnd(e)}),s.manager.itemStart(e)})}}let yf;class kv{static getContext(){return yf===void 0&&(yf=new(window.AudioContext||window.webkitAudioContext)),yf}static setContext(e){yf=e}}class l2 extends $i{constructor(e){super(e)}load(e,t,i,n){const s=this,a=new bi(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{const c=l.slice(0);kv.getContext().decodeAudioData(c,function(h){t(h)},o)}catch(c){o(c)}},i,n);function o(l){n?n(l):console.error(l),s.manager.itemError(e)}}}class c2 extends Af{constructor(e,t,i=1){super(void 0,i),this.isHemisphereLightProbe=!0;const n=new fe().set(e),s=new fe().set(t),a=new P(n.r,n.g,n.b),o=new P(s.r,s.g,s.b),l=Math.sqrt(Math.PI),c=l*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyScalar(l),this.sh.coefficients[1].copy(a).sub(o).multiplyScalar(c)}}class h2 extends Af{constructor(e,t=1){super(void 0,t),this.isAmbientLightProbe=!0;const i=new fe().set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const uw=new et,pw=new et,Jl=new et;class u2{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Qi,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Qi,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Jl.copy(e.projectionMatrix);const i=t.eyeSep/2,n=i*t.near/t.focus,s=t.near*Math.tan(Na*t.fov*.5)/t.zoom;let a,o;pw.elements[12]=-i,uw.elements[12]=i,a=-s*t.aspect+n,o=s*t.aspect+n,Jl.elements[0]=2*t.near/(o-a),Jl.elements[8]=(o+a)/(o-a),this.cameraL.projectionMatrix.copy(Jl),a=-s*t.aspect-n,o=s*t.aspect-n,Jl.elements[0]=2*t.near/(o-a),Jl.elements[8]=(o+a)/(o-a),this.cameraR.projectionMatrix.copy(Jl)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(pw),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(uw)}}class _f{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=dw(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=dw();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function dw(){return(typeof performance>"u"?Date:performance).now()}const Zl=new P,mw=new Ct,p2=new P,$l=new P;class d2 extends It{constructor(){super(),this.type="AudioListener",this.context=kv.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new _f}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Zl,mw,p2),$l.set(0,0,-1).applyQuaternion(mw),t.positionX){const n=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Zl.x,n),t.positionY.linearRampToValueAtTime(Zl.y,n),t.positionZ.linearRampToValueAtTime(Zl.z,n),t.forwardX.linearRampToValueAtTime($l.x,n),t.forwardY.linearRampToValueAtTime($l.y,n),t.forwardZ.linearRampToValueAtTime($l.z,n),t.upX.linearRampToValueAtTime(i.x,n),t.upY.linearRampToValueAtTime(i.y,n),t.upZ.linearRampToValueAtTime(i.z,n)}else t.setPosition(Zl.x,Zl.y,Zl.z),t.setOrientation($l.x,$l.y,$l.z,i.x,i.y,i.z)}}class fw extends It{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const ec=new P,gw=new Ct,m2=new P,tc=new P;class f2 extends fw{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(ec,gw,m2),tc.set(0,0,1).applyQuaternion(gw);const t=this.panner;if(t.positionX){const i=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(ec.x,i),t.positionY.linearRampToValueAtTime(ec.y,i),t.positionZ.linearRampToValueAtTime(ec.z,i),t.orientationX.linearRampToValueAtTime(tc.x,i),t.orientationY.linearRampToValueAtTime(tc.y,i),t.orientationZ.linearRampToValueAtTime(tc.z,i)}else t.setPosition(ec.x,ec.y,ec.z),t.setOrientation(tc.x,tc.y,tc.z)}}class g2{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}}class Aw{constructor(e,t,i){this.binding=e,this.valueSize=i;let n,s,a;switch(t){case"quaternion":n=this._slerp,s=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":n=this._select,s=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:n=this._lerp,s=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=s,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,n=this.valueSize,s=e*n+n;let a=this.cumulativeWeight;if(a===0){for(let o=0;o!==n;++o)i[s+o]=i[o];a=t}else{a+=t;const o=t/a;this._mixBufferRegion(i,s,0,o,n)}this.cumulativeWeight=a}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,n=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,n,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,n=e*t+t,s=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=t*this._origIndex;this._mixBufferRegion(i,n,l,1-s,t)}a>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(i[l]!==i[l+t]){o.setValue(i,n);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,n=i*this._origIndex;e.getValue(t,n);for(let s=i,a=n;s!==a;++s)t[s]=t[n+s%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,n,s){if(n>=.5)for(let a=0;a!==s;++a)e[t+a]=e[i+a]}_slerp(e,t,i,n){Ct.slerpFlat(e,t,e,t,e,i,n)}_slerpAdditive(e,t,i,n,s){const a=this._workIndex*s;Ct.multiplyQuaternionsFlat(e,a,e,t,e,i),Ct.slerpFlat(e,t,e,t,e,a,n)}_lerp(e,t,i,n,s){const a=1-n;for(let o=0;o!==s;++o){const l=t+o;e[l]=e[l]*a+e[i+o]*n}}_lerpAdditive(e,t,i,n,s){for(let a=0;a!==s;++a){const o=t+a;e[o]=e[o]+e[i+a]*n}}}const Fv="\\[\\]\\.:\\/",A2=new RegExp("["+Fv+"]","g"),Nv="[^"+Fv+"]",v2="[^"+Fv.replace("\\.","")+"]",y2=/((?:WC+[\/:])*)/.source.replace("WC",Nv),_2=/(WCOD+)?/.source.replace("WCOD",v2),b2=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Nv),w2=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Nv),x2=new RegExp("^"+y2+_2+b2+w2+"$"),E2=["material","materials","bones","map"];class C2{constructor(e,t,i){const n=i||Ht.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];n!==void 0&&n.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,s=i.length;n!==s;++n)i[n].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class Ht{constructor(e,t,i){this.path=t,this.parsedPath=i||Ht.parseTrackName(t),this.node=Ht.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new Ht.Composite(e,t,i):new Ht(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(A2,"")}static parseTrackName(e){const t=x2.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(n!==void 0&&n!==-1){const s=i.nodeName.substring(n+1);E2.indexOf(s)!==-1&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=s)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(s){for(let a=0;a<s.length;a++){const o=s[a];if(o.name===t||o.uuid===t)return o;const l=i(o.children);if(l)return l}return null},n=i(e.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)e[t++]=i[n]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,n=t.propertyName;let s=t.propertyIndex;if(e||(e=Ht.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let c=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let h=0;h<e.length;h++)if(e[h].name===c){c=h;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const a=e[n];if(a===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+n+" but it wasn't found.",e);return}let o=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?o=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(n==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else a.fromArray!==void 0&&a.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ht.Composite=C2,Ht.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Ht.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Ht.prototype.GetterByBindingType=[Ht.prototype._getValue_direct,Ht.prototype._getValue_array,Ht.prototype._getValue_arrayElement,Ht.prototype._getValue_toArray],Ht.prototype.SetterByBindingTypeAndVersioning=[[Ht.prototype._setValue_direct,Ht.prototype._setValue_direct_setNeedsUpdate,Ht.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ht.prototype._setValue_array,Ht.prototype._setValue_array_setNeedsUpdate,Ht.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ht.prototype._setValue_arrayElement,Ht.prototype._setValue_arrayElement_setNeedsUpdate,Ht.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ht.prototype._setValue_fromArray,Ht.prototype._setValue_fromArray_setNeedsUpdate,Ht.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class M2{constructor(){this.isAnimationObjectGroup=!0,this.uuid=dn(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let i=0,n=arguments.length;i!==n;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,i=this._paths,n=this._parsedPaths,s=this._bindings,a=s.length;let o,l=e.length,c=this.nCachedObjects_;for(let h=0,d=arguments.length;h!==d;++h){const m=arguments[h],f=m.uuid;let v=t[f];if(v===void 0){v=l++,t[f]=v,e.push(m);for(let w=0,b=a;w!==b;++w)s[w].push(new Ht(m,i[w],n[w]))}else if(v<c){o=e[v];const w=--c,b=e[w];t[b.uuid]=v,e[v]=b,t[f]=w,e[w]=m;for(let y=0,E=a;y!==E;++y){const _=s[y],C=_[w];let M=_[v];_[v]=C,M===void 0&&(M=new Ht(m,i[y],n[y])),_[w]=M}}else e[v]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,n=i.length;let s=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){const l=arguments[a],c=l.uuid,h=t[c];if(h!==void 0&&h>=s){const d=s++,m=e[d];t[m.uuid]=h,e[h]=m,t[c]=d,e[d]=l;for(let f=0,v=n;f!==v;++f){const w=i[f],b=w[d],y=w[h];w[h]=b,w[d]=y}}}this.nCachedObjects_=s}uncache(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,n=i.length;let s=this.nCachedObjects_,a=e.length;for(let o=0,l=arguments.length;o!==l;++o){const c=arguments[o],h=c.uuid,d=t[h];if(d!==void 0)if(delete t[h],d<s){const m=--s,f=e[m],v=--a,w=e[v];t[f.uuid]=d,e[d]=f,t[w.uuid]=m,e[m]=w,e.pop();for(let b=0,y=n;b!==y;++b){const E=i[b],_=E[m],C=E[v];E[d]=_,E[m]=C,E.pop()}}else{const m=--a,f=e[m];m>0&&(t[f.uuid]=d),e[d]=f,e.pop();for(let v=0,w=n;v!==w;++v){const b=i[v];b[d]=b[m],b.pop()}}}this.nCachedObjects_=s}subscribe_(e,t){const i=this._bindingsIndicesByPath;let n=i[e];const s=this._bindings;if(n!==void 0)return s[n];const a=this._paths,o=this._parsedPaths,l=this._objects,c=l.length,h=this.nCachedObjects_,d=new Array(c);n=s.length,i[e]=n,a.push(e),o.push(t),s.push(d);for(let m=h,f=l.length;m!==f;++m){const v=l[m];d[m]=new Ht(v,e,t)}return d}unsubscribe_(e){const t=this._bindingsIndicesByPath,i=t[e];if(i!==void 0){const n=this._paths,s=this._parsedPaths,a=this._bindings,o=a.length-1,l=a[o],c=e[o];t[c]=i,a[i]=l,a.pop(),s[i]=s[o],s.pop(),n[i]=n[o],n.pop()}}}class S2{constructor(e,t,i=null,n=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=n;const s=t.tracks,a=s.length,o=new Array(a),l={endingStart:Fa,endingEnd:Fa};for(let c=0;c!==a;++c){const h=s[c].createInterpolant(null);o[c]=h,h.settings=l}this._interpolantSettings=l,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Du,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const n=this._clip.duration,s=e._clip.duration,a=s/n,o=n/s;e.warp(1,a,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const n=this._mixer,s=n.time,a=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);const l=o.parameterPositions,c=o.sampleValues;return l[0]=s,l[1]=s+i,c[0]=e/a,c[1]=t/a,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,n){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const l=(e-s)*i;l<0||i===0?t=0:(this._startTime=null,t=i*l)}t*=this._updateTimeScale(e);const a=this._updateTime(t),o=this._updateWeight(e);if(o>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case Po:for(let h=0,d=l.length;h!==d;++h)l[h].evaluate(a),c[h].accumulateAdditive(o);break;case Bu:default:for(let h=0,d=l.length;h!==d;++h)l[h].evaluate(a),c[h].accumulate(n,o)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(i!==null){const n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopFading(),n===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;if(i!==null){const n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let n=this.time+e,s=this._loopCount;const a=i===yl;if(e===0)return s===-1?n:a&&(s&1)===1?t-n:n;if(i===Ru){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),n>=t||n<0){const o=Math.floor(n/t);n-=t*o,s+=Math.abs(o);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=e>0?t:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=n;if(a&&(s&1)===1)return t-n}return n}_setEndings(e,t,i){const n=this._interpolantSettings;i?(n.endingStart=ws,n.endingEnd=ws):(e?n.endingStart=this.zeroSlopeAtStart?ws:Fa:n.endingStart=Io,t?n.endingEnd=this.zeroSlopeAtEnd?ws:Fa:n.endingEnd=Io)}_scheduleFading(e,t,i){const n=this._mixer,s=n.time;let a=this._weightInterpolant;a===null&&(a=n._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=s,l[0]=t,o[1]=s+e,l[1]=i,this}}const T2=new Float32Array(1);class vw extends zi{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,n=e._clip.tracks,s=n.length,a=e._propertyBindings,o=e._interpolants,l=i.uuid,c=this._bindingsByRootAndName;let h=c[l];h===void 0&&(h={},c[l]=h);for(let d=0;d!==s;++d){const m=n[d],f=m.name;let v=h[f];if(v!==void 0)++v.referenceCount,a[d]=v;else{if(v=a[d],v!==void 0){v._cacheIndex===null&&(++v.referenceCount,this._addInactiveBinding(v,l,f));continue}const w=t&&t._propertyBindings[d].binding.parsedPath;v=new Aw(Ht.create(i,f,w),m.ValueTypeName,m.getValueSize()),++v.referenceCount,this._addInactiveBinding(v,l,f),a[d]=v}o[d].resultBuffer=v.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,n=e._clip.uuid,s=this._actionsByClip[n];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,n,i)}const t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){const s=t[i];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){const s=t[i];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){const n=this._actions,s=this._actionsByClip;let a=s[t];if(a===void 0)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=a;else{const o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=n.length,n.push(e),a.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],n=e._cacheIndex;i._cacheIndex=n,t[n]=i,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,a=this._actionsByClip,o=a[s],l=o.knownActions,c=l[l.length-1],h=e._byClipCacheIndex;c._byClipCacheIndex=h,l[h]=c,l.pop(),e._byClipCacheIndex=null;const d=o.actionByRoot,m=(e._localRoot||this._root).uuid;delete d[m],l.length===0&&delete a[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){const s=t[i];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,n=this._nActiveActions++,s=t[n];e._cacheIndex=n,t[n]=e,s._cacheIndex=i,t[i]=s}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,n=--this._nActiveActions,s=t[n];e._cacheIndex=n,t[n]=e,s._cacheIndex=i,t[i]=s}_addInactiveBinding(e,t,i){const n=this._bindingsByRootAndName,s=this._bindings;let a=n[t];a===void 0&&(a={},n[t]=a),a[i]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,n=i.rootNode.uuid,s=i.path,a=this._bindingsByRootAndName,o=a[n],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete o[s],Object.keys(o).length===0&&delete a[n]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,n=this._nActiveBindings++,s=t[n];e._cacheIndex=n,t[n]=e,s._cacheIndex=i,t[i]=s}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,n=--this._nActiveBindings,s=t[n];e._cacheIndex=n,t[n]=e,s._cacheIndex=i,t[i]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return i===void 0&&(i=new Tv(new Float32Array(2),new Float32Array(2),1,T2),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,n=--this._nActiveControlInterpolants,s=t[n];e.__cacheIndex=n,t[n]=e,s.__cacheIndex=i,t[i]=s}clipAction(e,t,i){const n=t||this._root,s=n.uuid;let a=typeof e=="string"?Yl.findByName(n,e):e;const o=a!==null?a.uuid:e,l=this._actionsByClip[o];let c=null;if(i===void 0&&(a!==null?i=a.blendMode:i=Bu),l!==void 0){const d=l.actionByRoot[s];if(d!==void 0&&d.blendMode===i)return d;c=l.knownActions[0],a===null&&(a=c._clip)}if(a===null)return null;const h=new S2(this,a,t,i);return this._bindAction(h,c),this._addInactiveAction(h,o,s),h}existingAction(e,t){const i=t||this._root,n=i.uuid,s=typeof e=="string"?Yl.findByName(i,e):e,a=s?s.uuid:e,o=this._actionsByClip[a];return o!==void 0&&o.actionByRoot[n]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,n=this.time+=e,s=Math.sign(e),a=this._accuIndex^=1;for(let c=0;c!==i;++c)t[c]._update(n,e,s,a);const o=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)o[c].apply(a);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,n=this._actionsByClip,s=n[i];if(s!==void 0){const a=s.knownActions;for(let o=0,l=a.length;o!==l;++o){const c=a[o];this._deactivateAction(c);const h=c._cacheIndex,d=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,d._cacheIndex=h,t[h]=d,t.pop(),this._removeInactiveBindingsForAction(c)}delete n[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const a in i){const o=i[a].actionByRoot,l=o[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const n=this._bindingsByRootAndName,s=n[t];if(s!==void 0)for(const a in s){const o=s[a];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(e,t){const i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}class bf{constructor(e){this.value=e}clone(){return new bf(this.value.clone===void 0?this.value:this.value.clone())}}let I2=0;class P2 extends zi{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:I2++}),this.name="",this.usage=kc,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let i=0,n=t.length;i<n;i++)this.uniforms.push(t[i].clone());return this}clone(){return new this.constructor().copy(this)}}class Ep extends ph{constructor(e,t,i=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class R2{constructor(e,t,i,n,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=n,this.count=s,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class wf{constructor(e,t,i=0,n=1/0){this.ray=new Va(e,t),this.near=i,this.far=n,this.camera=null,this.layers=new No,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return Gv(e,this,i,t),i.sort(yw),i}intersectObjects(e,t=!0,i=[]){for(let n=0,s=e.length;n<s;n++)Gv(e[n],this,i,t);return i.sort(yw),i}}function yw(r,e){return r.distance-e.distance}function Gv(r,e,t,i){if(r.layers.test(e.layers)&&r.raycast(e,t),i===!0){const n=r.children;for(let s=0,a=n.length;s<a;s++)Gv(n[s],e,t,!0)}}class ic{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(ki(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class D2{constructor(e=1,t=0,i=0){return this.radius=e,this.theta=t,this.y=i,this}set(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}clone(){return new this.constructor().copy(this)}}const _w=new ne;class zv{constructor(e=new ne(1/0,1/0),t=new ne(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=_w.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,_w).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const bw=new P,xf=new P;class ww{constructor(e=new P,t=new P){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){bw.subVectors(e,this.start),xf.subVectors(this.end,this.start);const i=xf.dot(xf);let n=xf.dot(bw)/i;return t&&(n=ki(n,0,1)),n}closestPointToPoint(e,t,i){const n=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const xw=new P;class B2 extends It{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const i=new ht,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,o=1,l=32;a<l;a++,o++){const c=a/l*Math.PI*2,h=o/l*Math.PI*2;n.push(Math.cos(c),Math.sin(c),1,Math.cos(h),Math.sin(h),1)}i.setAttribute("position",new Ne(n,3));const s=new Ji({fog:!1,toneMapped:!1});this.cone=new qn(i,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),xw.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(xw),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Zo=new P,Ef=new et,Qv=new et;class L2 extends qn{constructor(e){const t=Ew(e),i=new ht,n=[],s=[],a=new fe(0,0,1),o=new fe(0,1,0);for(let c=0;c<t.length;c++){const h=t[c];h.parent&&h.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),s.push(a.r,a.g,a.b),s.push(o.r,o.g,o.b))}i.setAttribute("position",new Ne(n,3)),i.setAttribute("color",new Ne(s,3));const l=new Ji({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,n=i.getAttribute("position");Qv.copy(this.root.matrixWorld).invert();for(let s=0,a=0;s<t.length;s++){const o=t[s];o.parent&&o.parent.isBone&&(Ef.multiplyMatrices(Qv,o.matrixWorld),Zo.setFromMatrixPosition(Ef),n.setXYZ(a,Zo.x,Zo.y,Zo.z),Ef.multiplyMatrices(Qv,o.parent.matrixWorld),Zo.setFromMatrixPosition(Ef),n.setXYZ(a+1,Zo.x,Zo.y,Zo.z),a+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function Ew(r){const e=[];r.isBone===!0&&e.push(r);for(let t=0;t<r.children.length;t++)e.push.apply(e,Ew(r.children[t]));return e}class U2 extends Fe{constructor(e,t,i){const n=new Gs(t,4,2),s=new Pn({wireframe:!0,fog:!1,toneMapped:!1});super(n,s),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const O2=new P,Cw=new fe,Mw=new fe;class k2 extends It{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="HemisphereLightHelper";const n=new eo(t);n.rotateY(Math.PI*.5),this.material=new Pn({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=n.getAttribute("position"),a=new Float32Array(s.count*3);n.setAttribute("color",new At(a,3)),this.add(new Fe(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");Cw.copy(this.light.color),Mw.copy(this.light.groundColor);for(let i=0,n=t.count;i<n;i++){const s=i<n/2?Cw:Mw;t.setXYZ(i,s.r,s.g,s.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(O2.setFromMatrixPosition(this.light.matrixWorld).negate())}}class F2 extends qn{constructor(e=10,t=10,i=4473924,n=8947848){i=new fe(i),n=new fe(n);const s=t/2,a=e/t,o=e/2,l=[],c=[];for(let m=0,f=0,v=-o;m<=t;m++,v+=a){l.push(-o,0,v,o,0,v),l.push(v,0,-o,v,0,o);const w=m===s?i:n;w.toArray(c,f),f+=3,w.toArray(c,f),f+=3,w.toArray(c,f),f+=3,w.toArray(c,f),f+=3}const h=new ht;h.setAttribute("position",new Ne(l,3)),h.setAttribute("color",new Ne(c,3));const d=new Ji({vertexColors:!0,toneMapped:!1});super(h,d),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class N2 extends qn{constructor(e=10,t=16,i=8,n=64,s=4473924,a=8947848){s=new fe(s),a=new fe(a);const o=[],l=[];if(t>1)for(let d=0;d<t;d++){const m=d/t*(Math.PI*2),f=Math.sin(m)*e,v=Math.cos(m)*e;o.push(0,0,0),o.push(f,0,v);const w=d&1?s:a;l.push(w.r,w.g,w.b),l.push(w.r,w.g,w.b)}for(let d=0;d<i;d++){const m=d&1?s:a,f=e-e/i*d;for(let v=0;v<n;v++){let w=v/n*(Math.PI*2),b=Math.sin(w)*f,y=Math.cos(w)*f;o.push(b,0,y),l.push(m.r,m.g,m.b),w=(v+1)/n*(Math.PI*2),b=Math.sin(w)*f,y=Math.cos(w)*f,o.push(b,0,y),l.push(m.r,m.g,m.b)}}const c=new ht;c.setAttribute("position",new Ne(o,3)),c.setAttribute("color",new Ne(l,3));const h=new Ji({vertexColors:!0,toneMapped:!1});super(c,h),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const Sw=new P,Cf=new P,Tw=new P;class G2 extends It{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",t===void 0&&(t=1);let n=new ht;n.setAttribute("position",new Ne([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const s=new Ji({fog:!1,toneMapped:!1});this.lightPlane=new Tr(n,s),this.add(this.lightPlane),n=new ht,n.setAttribute("position",new Ne([0,0,0,0,0,1],3)),this.targetLine=new Tr(n,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Sw.setFromMatrixPosition(this.light.matrixWorld),Cf.setFromMatrixPosition(this.light.target.matrixWorld),Tw.subVectors(Cf,Sw),this.lightPlane.lookAt(Cf),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Cf),this.targetLine.scale.z=Tw.length()}}const Mf=new P,nr=new Ol;class z2 extends qn{constructor(e){const t=new ht,i=new Ji({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],s=[],a={};o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4");function o(v,w){l(v),l(w)}function l(v){n.push(0,0,0),s.push(0,0,0),a[v]===void 0&&(a[v]=[]),a[v].push(n.length/3-1)}t.setAttribute("position",new Ne(n,3)),t.setAttribute("color",new Ne(s,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const c=new fe(16755200),h=new fe(16711680),d=new fe(43775),m=new fe(16777215),f=new fe(3355443);this.setColors(c,h,d,m,f)}setColors(e,t,i,n,s){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,i.r,i.g,i.b),a.setXYZ(33,i.r,i.g,i.b),a.setXYZ(34,i.r,i.g,i.b),a.setXYZ(35,i.r,i.g,i.b),a.setXYZ(36,i.r,i.g,i.b),a.setXYZ(37,i.r,i.g,i.b),a.setXYZ(38,n.r,n.g,n.b),a.setXYZ(39,n.r,n.g,n.b),a.setXYZ(40,s.r,s.g,s.b),a.setXYZ(41,s.r,s.g,s.b),a.setXYZ(42,s.r,s.g,s.b),a.setXYZ(43,s.r,s.g,s.b),a.setXYZ(44,s.r,s.g,s.b),a.setXYZ(45,s.r,s.g,s.b),a.setXYZ(46,s.r,s.g,s.b),a.setXYZ(47,s.r,s.g,s.b),a.setXYZ(48,s.r,s.g,s.b),a.setXYZ(49,s.r,s.g,s.b),a.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,i=1,n=1;nr.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),hr("c",t,e,nr,0,0,-1),hr("t",t,e,nr,0,0,1),hr("n1",t,e,nr,-i,-n,-1),hr("n2",t,e,nr,i,-n,-1),hr("n3",t,e,nr,-i,n,-1),hr("n4",t,e,nr,i,n,-1),hr("f1",t,e,nr,-i,-n,1),hr("f2",t,e,nr,i,-n,1),hr("f3",t,e,nr,-i,n,1),hr("f4",t,e,nr,i,n,1),hr("u1",t,e,nr,i*.7,n*1.1,-1),hr("u2",t,e,nr,-i*.7,n*1.1,-1),hr("u3",t,e,nr,0,n*2,-1),hr("cf1",t,e,nr,-i,0,1),hr("cf2",t,e,nr,i,0,1),hr("cf3",t,e,nr,0,-n,1),hr("cf4",t,e,nr,0,n,1),hr("cn1",t,e,nr,-i,0,-1),hr("cn2",t,e,nr,i,0,-1),hr("cn3",t,e,nr,0,-n,-1),hr("cn4",t,e,nr,0,n,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function hr(r,e,t,i,n,s,a){Mf.set(n,s,a).unproject(i);const o=e[r];if(o!==void 0){const l=t.getAttribute("position");for(let c=0,h=o.length;c<h;c++)l.setXYZ(o[c],Mf.x,Mf.y,Mf.z)}}const Sf=new Yi;class Q2 extends qn{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(8*3),s=new ht;s.setIndex(new At(i,1)),s.setAttribute("position",new At(n,3)),super(s,new Ji({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Sf.setFromObject(this.object),Sf.isEmpty())return;const t=Sf.min,i=Sf.max,n=this.geometry.attributes.position,s=n.array;s[0]=i.x,s[1]=i.y,s[2]=i.z,s[3]=t.x,s[4]=i.y,s[5]=i.z,s[6]=t.x,s[7]=t.y,s[8]=i.z,s[9]=i.x,s[10]=t.y,s[11]=i.z,s[12]=i.x,s[13]=i.y,s[14]=t.z,s[15]=t.x,s[16]=i.y,s[17]=t.z,s[18]=t.x,s[19]=t.y,s[20]=t.z,s[21]=i.x,s[22]=t.y,s[23]=t.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class V2 extends qn{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new ht;s.setIndex(new At(i,1)),s.setAttribute("position",new Ne(n,3)),super(s,new Ji({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class j2 extends Tr{constructor(e,t=1,i=16776960){const n=i,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new ht;a.setAttribute("position",new Ne(s,3)),a.computeBoundingSphere(),super(a,new Ji({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const o=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new ht;l.setAttribute("position",new Ne(o,3)),l.computeBoundingSphere(),this.add(new Fe(l,new Pn({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const Iw=new P;let Tf,Vv;class H2 extends It{constructor(e=new P(0,0,1),t=new P(0,0,0),i=1,n=16776960,s=i*.2,a=s*.2){super(),this.type="ArrowHelper",Tf===void 0&&(Tf=new ht,Tf.setAttribute("position",new Ne([0,0,0,0,1,0],3)),Vv=new kr(0,.5,1,5,1),Vv.translate(0,-.5,0)),this.position.copy(t),this.line=new Tr(Tf,new Ji({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Fe(Vv,new Pn({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,s,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Iw.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Iw,t)}}setLength(e,t=e*.2,i=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class W2 extends qn{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],n=new ht;n.setAttribute("position",new Ne(t,3)),n.setAttribute("color",new Ne(i,3));const s=new Ji({vertexColors:!0,toneMapped:!1});super(n,s),this.type="AxesHelper"}setColors(e,t,i){const n=new fe,s=this.geometry.attributes.color.array;return n.set(e),n.toArray(s,0),n.toArray(s,3),n.set(t),n.toArray(s,6),n.toArray(s,9),n.set(i),n.toArray(s,12),n.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class X2{constructor(){this.type="ShapePath",this.color=new fe,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new fp,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,i,n){return this.currentPath.quadraticCurveTo(e,t,i,n),this}bezierCurveTo(e,t,i,n,s,a){return this.currentPath.bezierCurveTo(e,t,i,n,s,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(y){const E=[];for(let _=0,C=y.length;_<C;_++){const M=y[_],S=new zl;S.curves=M.curves,E.push(S)}return E}function i(y,E){const _=E.length;let C=!1;for(let M=_-1,S=0;S<_;M=S++){let R=E[M],U=E[S],T=U.x-R.x,B=U.y-R.y;if(Math.abs(B)>Number.EPSILON){if(B<0&&(R=E[S],T=-T,U=E[M],B=-B),y.y<R.y||y.y>U.y)continue;if(y.y===R.y){if(y.x===R.x)return!0}else{const Q=B*(y.x-R.x)-T*(y.y-R.y);if(Q===0)return!0;if(Q<0)continue;C=!C}}else{if(y.y!==R.y)continue;if(U.x<=y.x&&y.x<=R.x||R.x<=y.x&&y.x<=U.x)return!0}}return C}const n=ma.isClockWise,s=this.subPaths;if(s.length===0)return[];let a,o,l;const c=[];if(s.length===1)return o=s[0],l=new zl,l.curves=o.curves,c.push(l),c;let h=!n(s[0].getPoints());h=e?!h:h;const d=[],m=[];let f=[],v=0,w;m[v]=void 0,f[v]=[];for(let y=0,E=s.length;y<E;y++)o=s[y],w=o.getPoints(),a=n(w),a=e?!a:a,a?(!h&&m[v]&&v++,m[v]={s:new zl,p:w},m[v].s.curves=o.curves,h&&v++,f[v]=[]):f[v].push({h:o,p:w[0]});if(!m[0])return t(s);if(m.length>1){let y=!1,E=0;for(let _=0,C=m.length;_<C;_++)d[_]=[];for(let _=0,C=m.length;_<C;_++){const M=f[_];for(let S=0;S<M.length;S++){const R=M[S];let U=!0;for(let T=0;T<m.length;T++)i(R.p,m[T].p)&&(_!==T&&E++,U?(U=!1,d[T].push(R)):y=!0);U&&d[_].push(R)}}E>0&&y===!1&&(f=d)}let b;for(let y=0,E=m.length;y<E;y++){l=m[y].s,c.push(l),b=f[y];for(let _=0,C=b.length;_<C;_++)l.holes.push(b[_].h)}return c}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Ze}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Ze);/**
* @license
* ts-browser-helpers v0.14.2
* Copyright 2022-2024 repalash <palash@shaders.app>
* MIT License
*/let jv=class{constructor(){this._eventListeners={},this.dispatchEvent=this.dispatchEvent.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.hasEventListener=this.hasEventListener.bind(this)}addEventListener(r,e){const t=this._eventListeners;t[r]===void 0&&(t[r]=[]),t[r].includes(e)||t[r].push(e)}hasEventListener(r,e){const t=this._eventListeners;return t[r]!==void 0&&t[r].includes(e)}removeEventListener(r,e){const t=this._eventListeners[r];if(t!==void 0){const i=t.indexOf(e);i!==-1&&t.splice(i,1)}}dispatchEvent(r){const e=this._eventListeners[r.type];if(e!==void 0){r.target=this;const t=e.slice(0);for(let i=0,n=t.length;i<n;i++)t[i].call(this,r)}}};async function cs(r){return new Promise(e=>setTimeout(e,Math.max(0,r)))}function nn(){return(typeof performance>"u"?Date:performance).now()}class Pw extends jv{constructor(){super(...arguments),this._onPointerDown=e=>{if(e.button!==0||!this._element)return;this._pointerUp=void 0;const t=e.clientX/this._element.clientWidth*2-1,i=-(e.clientY/this._element.clientHeight)*2+1,n=nn();this._pointerDown={x:t,y:i,time:n},this._pointer=this._pointerDown,this.dispatchEvent({type:"dragStart",pointer:this._pointerDown})},this._onPointerMove=e=>{if(!this._pointerDown||!this._pointer||!this._element)return;const t=e.clientX/this._element.clientWidth*2-1,i=-(e.clientY/this._element.clientHeight)*2+1,n=nn();this.dispatchEvent({type:"drag",pointer:this._pointer,drag:{x:t-this._pointerDown.x,y:i-this._pointerDown.y,time:n-this._pointerDown.time},delta:{x:t-this._pointer.x,y:i-this._pointer.y,time:n-this._pointer.time}}),this._pointer={x:t,y:i,time:nn()},e.buttons%2===0&&this._onPointerUp(e)},this._onPointerUp=e=>{if(e.button!==0||!this._pointerDown||!this._element)return;const t=e.clientX/this._element.clientWidth*2-1,i=-(e.clientY/this._element.clientHeight)*2+1,n=nn();this._pointerUp={x:t,y:i,time:n},this.dispatchEvent({type:"dragEnd",pointer:this._pointerUp,drag:{x:this._pointerUp.x-this._pointerDown.x,y:this._pointerUp.y-this._pointerDown.y,time:this._pointerUp.time-this._pointerDown.time}}),this._pointerDown=void 0,this._pointer=void 0}}get element(){return this._element}set element(e){this._element!==e&&(this._element&&this._removeElement(),this._element=e,this._element&&this._addElement())}_removeElement(){var e,t,i,n,s;(e=this._element)===null||e===void 0||e.removeEventListener("pointerdown",this._onPointerDown),(t=this._element)===null||t===void 0||t.removeEventListener("pointermove",this._onPointerMove),(i=this._element)===null||i===void 0||i.removeEventListener("pointerup",this._onPointerUp),(n=this._element)===null||n===void 0||n.removeEventListener("pointercancel",this._onPointerUp),(s=this._element)===null||s===void 0||s.removeEventListener("pointerout",this._onPointerUp)}_addElement(){var e,t,i,n,s;(e=this._element)===null||e===void 0||e.addEventListener("pointerdown",this._onPointerDown),(t=this._element)===null||t===void 0||t.addEventListener("pointermove",this._onPointerMove),(i=this._element)===null||i===void 0||i.addEventListener("pointerup",this._onPointerUp),(n=this._element)===null||n===void 0||n.addEventListener("pointercancel",this._onPointerUp),(s=this._element)===null||s===void 0||s.addEventListener("pointerout",this._onPointerUp)}dispose(){this.element=void 0}}/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/class rc{constructor(e=rc.DECAY_MILLISECONDS){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(e)}setDecayTime(e){this.naturalFrequency=1/Math.max(rc.MIN_DECAY_MILLISECONDS,e)}update(e,t,i,n){const s=2e-4*this.naturalFrequency;if(e==null||n===0||e===t&&this.velocity===0)return t;if(i<0)return e;const a=e-t,o=this.velocity+this.naturalFrequency*a,l=a+i*o,c=Math.exp(-this.naturalFrequency*i),h=(o-this.naturalFrequency*l)*c,d=-this.naturalFrequency*(h+o*c);return Math.abs(h)<s*Math.abs(n)&&d*a>=0?(this.velocity=0,t):(this.velocity=h,t+l*c)}}rc.SETTLING_TIME=1e4,rc.MIN_DECAY_MILLISECONDS=.001,rc.DECAY_MILLISECONDS=50;function Rw(){const r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return r.style.display="block",r}function $o({innerHTML:r="",id:e,classList:t,addToBody:i=!0,elementTag:n="div"}){const s=document.createElement(n);return e&&(s.id=e),s.innerHTML=r,t&&s.classList.add(...t),i&&document.body.appendChild(s),s}async function Dw(r){return new Promise((e,t)=>{const i=new Image;i.onload=()=>e(i),i.onerror=t,i.crossOrigin="anonymous",i.decoding="sync",i.src=r})}function Mh(r,e=document.head){const t=document.createElement("style");return t.type="text/css",t.innerText=r,e==null||e.appendChild(t),t}async function q2(r,e=document.head){return new Promise((t,i)=>{const n=document.createElement("script");n.setAttribute("src",r),n.addEventListener("load",()=>t(n)),n.addEventListener("error",i),e.appendChild(n)})}async function Y2(r,e){var t;r.innerHTML=e;const i=r.getElementsByTagName("script");for(let n=0;n<i.length;n++){const s=i[n],a=Bw(s);let o=!1;await new Promise(l=>{a.onload=l,a.onerror=()=>{o=!0,l(void 0)}}),!o&&((t=s.parentNode)===null||t===void 0||t.replaceChild(a,s))}}function Bw(r,e){e=e??document.createElement("script"),e.type=r.type||"text/javascript",e.text=r.text;for(let t=0;t<r.attributes.length;t++){const i=r.attributes[t];e.setAttribute(i.name,i.value)}return e}function If(r){if(!window)return console.warn("window is required"),"";let e="";const t=new Uint8Array(r),i=t.byteLength;for(let n=0;n<i;n++)e+=String.fromCharCode(t[n]);return window.btoa(e)}function Hv(r){if(!window)return console.warn("window is required"),new Uint8Array(0);const e=window.atob(r),t=e.length,i=new Uint8Array(t);for(let n=0;n<t;n++)i[n]=e.charCodeAt(n);return i.buffer}const Lw={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Uw(r,e){return new Lw[r](e)}function K2(r){return r.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}function J2(r){return r.replace(/([-_][a-z])/ig,e=>e.toUpperCase().replace("-","").replace("_",""))}function Wv(r){var e;if(!r||r===""||r.match(/__MACOSX\/.*\._/))return"";r=r.replace(/\?.*$/,"");const t=(e=r.split(/[\\/]/).pop())!==null&&e!==void 0?e:"",i=t.lastIndexOf(".");return t===""||i<1?"":t.slice(i+1)}function Z2(r){return r.substring(r.lastIndexOf("/")+1)}function Ow(r){return r.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function sn(r,e,t){return r.replace(new RegExp(Ow(e),"g"),t)}function $2(r,e,t,{replaceAll:i=!1,prepend:n=!1,append:s=!1,notFoundCallback:a=()=>{}}={}){if(a&&!r.includes(e))return a(),r;let o=t;return n?o=t+e:s&&(o=e+t),i?r.replaceAll(e,o):r.replace(e,o)}function eR(r){return r.sort(),r[0].split("").map((e,t)=>r[r.length-1][t]===e?e:"\0").join("").split("\0").at(0)||""}const ro=(r,...e)=>String.raw({raw:r},...e),kw=(r,...e)=>String.raw({raw:r},...e),tR=(r,...e)=>String.raw({raw:r},...e),Fw=(r,...e)=>{let t=String.raw({raw:r},...e);return t=sn(t,"%","%25"),t=sn(t,"> <","><"),t=sn(t,"; }",";}"),t=sn(t,"<","%3c"),t=sn(t,">","%3e"),t=sn(t,'"',"'"),t=sn(t,"#","%23"),t=sn(t,"{","%7b"),t=sn(t,"}","%7d"),t=sn(t,"|","%7c"),t=sn(t,"^","%5e"),t=sn(t,"`","%60"),t=sn(t,"@","%40"),t=sn(t,"&","&amp;"),t=sn(t,`
`,"%0A"),"data:image/svg+xml;charset=UTF-8,"+t};function iR(r=document.head){return Mh(kw`
      ::-webkit-scrollbar
      {
        width: 8px;  /* for vertical scrollbars */
        height: 8px; /* for horizontal scrollbars */
      }
      ::-webkit-scrollbar-track
      {
        background: rgba(64, 64, 64, 0.4);
        border-radius: 6px;
      }
      ::-webkit-scrollbar-thumb
      {
        background: rgba(128, 128, 128, 0.2);
        border-radius: 6px;
      }
      ::-webkit-scrollbar-corner {background: rgba(0,0,0,0.5);}
    `,r)}function Cp(r,e){const t=window.URL.createObjectURL(r),i=document.createElement("a");i.style.display="none",i.href=t,i.download=e,document.body.appendChild(i),i.click(),setTimeout(()=>{document.body.removeChild(i),window.URL.revokeObjectURL(t)},1e3)}async function Xv(r){return new Promise((e,t)=>{const i=new FileReader;i.onload=n=>e(i.result),i.onerror=n=>t(i.error),i.onabort=n=>t(new Error("Read aborted")),i.readAsDataURL(r)})}function Nw(r,e){return Cp(r,e??r.name)}async function Gw(r=!1,e=!1,t){const i=document.createElement("input");i.type="file",i.multiple=r,i.accept=t||"*",i.webkitdirectory=e,i.style.display="none",document.body.appendChild(i),i.click();const n=await new Promise(s=>{i.onchange=a=>{s(Array.from(i.files||[]))}});return document.body.removeChild(i),n}function rR(){let r=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(r=!0)}(navigator.userAgent||navigator.vendor||window.opera),r}function nR(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function zw(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}function sR(r,e=1,t=1){const i=document.createElement("canvas");i.width=e,i.height=t;const n=i.getContext("2d");n.fillStyle="#"+r,n.fillRect(0,0,e,t);const s=i.toDataURL();return i.remove(),s}function Qw(r,e){let t;do t=Object.getOwnPropertyDescriptor(r,e);while(!t&&(r=Object.getPrototypeOf(r)));return t}function Vw(r,e,t=!0,i=!1){const n=Qw(r,e);return!!(n!=null&&n.set)||t&&(n==null?void 0:n.writable)!==!1&&(n==null?void 0:n.get)===void 0||i&&!n}function el(r,e,t,i=!0,n=!1){return r&&Vw(r,e,i,n)?(r[e]=t,!0):!1}function sr(r,...e){return typeof r=="function"&&(r=r(...e)),r}function jw(r,e,t){for(const i of t){const n=r[i];n!==void 0&&el(e,i,n,!0)}return e}function Hw(r,e){for(const t of e)if(!r.includes(t))return!1;return!0}function Ww(r,e){for(let t=r.length-1;t>=0;t--)if(e(r[t]))return t;return-1}function aR(r,e){return function(...t){return r(),e&&e.call(this,...t)}}function Xw(r,e){return function(...t){return r(...t),e&&e.call(this,...t)}}function oR(r,e,t=!1){for(typeof r=="string"&&(r=r.split("."));r.length>0;){if(!e)return;const i=r.splice(0,1)[0];if(!(i.length<1))if(i in e)e=e[i];else{if(t)throw new Error("invalid access, check "+i+" in "+e);return}}return e}function lR(r,e){return Object.keys(r).find(t=>r[t]===e)}function An(r,e){return Object.hasOwn?Object.hasOwn(r,e):r.hasOwnProperty(e)}function qw(r,e,t=!0){const i=t?r:{},n=Object.keys(r);for(const s of n)i[s]=e(r[s],s);return i}function qv(r,e){return Object.fromEntries(Object.entries(r).map(t=>e(t)))}const Yv={priority:1/0,serialize:(r,e)=>qv(r,([t,i])=>[t,$t.Serialize(i,e,!1)]),deserialize:(r,e,t)=>Object.assign(e||{},qv(r,([i,n])=>[i,$t.Deserialize(n,e==null?void 0:e[i],t,!1)])),isType:r=>(r.constructor||Object)===Object};class $t{static GetSerializer(e){return $t.Serializers.find(t=>t.isType(e))}static RegisterSerializer(...e){var t;for(const i of e){const n=(t=i.priority)!==null&&t!==void 0?t:1e10,s=Ww($t.Serializers,a=>a.priority!==void 0&&a.priority<n);s>=0?$t.Serializers.splice(s+1,0,i):$t.Serializers.push(i)}}static UnregisterSerializer(...e){for(const t of e){const i=$t.Serializers.indexOf(t);i>=0&&$t.Serializers.splice(i,1)}}static Serialize(e,t,i=!1){var n,s;if(typeof e=="function")return;if(!i){const l=$t.GetSerializer(e);if(l)return l.serialize(e,t);if(typeof e.toJSON=="function"){const c=e.toJSON(t);return e.serializableClassId&&c&&(c.serializableClassId=e.serializableClassId),c}}let a=(n=e.constructor)!==null&&n!==void 0?n:Object;const o={};for(;a&&a!==Object;){const l=(s=$t.TypeMap.get(a))!==null&&s!==void 0?s:[];for(const[c,h]of l)o[c]=$t.Serialize(e[h],t,!1);a=Object.getPrototypeOf(a)}return e.serializableClassId&&(o.serializableClassId=e.serializableClassId),o}static Deserialize(e,t,i,n=!1){var s,a;if(e===void 0||t===e)return t;if(e&&typeof e=="object"&&(e.constructor||Object)===Object&&e.resource&&typeof e.resource=="string"&&e.uuid){const l=i==null?void 0:i[e.resource];if(l){if(e=l[e.uuid],typeof e=="object"&&(e.__useCount=e.__useCount?e.__useCount+1:1),e||console.warn(`Resource ${e.resource} with uuid ${e.uuid} not found`),t===e)return t;if(e&&typeof e=="object"){if((e.constructor||Object)!==Object)return t&&console.warn("replacing object",t,"with deserialized object from meta",e),e;console.error("Deserialize; meta should only have class instances, not js objects",e,t,i)}}else return console.warn(`Resource ${e.resource} not found`),t}if(e&&typeof e=="object"&&(e.constructor||Object)!==Object&&!Array.isArray(e)&&!e.serializableClassId){if(e instanceof Blob)return e;console.warn("Data might already be deserialized. It will be cloned, or copied to source",e,"source",t,e.constructor,e.constructor!==Object)}if(e&&typeof e=="object")if(e.serializableClassId&&(!t||t.serializableClassId!==e.serializableClassId)){const l=$t.SerializableClasses.get(e.serializableClassId);l&&(l.DataInConstructor?t=new l(e):t=new l)}else(e.constructor||Object)===Object&&!t?t={}:Array.isArray(e)&&!t&&(t=[]);if(typeof t=="function")return console.error("cannot deserialize a function",t,e),t;if(!n){const l=$t.GetSerializer(e);if(l&&l!==Yv)return l.deserialize(e,t,i)}if(!e||t===void 0||t===null||typeof t!="object")return e;if(!n&&typeof(t==null?void 0:t.fromJSON)=="function")return t.fromJSON(e,i),t;let o=(s=t.constructor)!==null&&s!==void 0?s:Object;if(o===Object)return Yv.deserialize(e,t,i);for(;o&&o!==Object;){const l=(a=$t.TypeMap.get(o))!==null&&a!==void 0?a:[];for(const[c,h]of l){const d=t[h],m=$t.Deserialize(e[c],d,i,!1);m!==d&&el(t,h,m,!0)}o=Object.getPrototypeOf(o)}return t}}$t.TypeMap=new Map,$t.SerializableClasses=new Map,$t.Serializers=[{priority:0,isType:r=>Array.isArray(r),serialize:(r,e)=>r.map(t=>$t.Serialize(t,e,!1)),deserialize:(r,e,t)=>{const i=r.length;Array.isArray(e)||(e=[]);for(let n=0;n<i;n++){const s=r[n],a=e.length>n?$t.Deserialize(s,e[n],t,!1):$t.Deserialize(s,void 0,t,!1);e.length<=n?e.push(a):e[n]=a}return e}},{priority:0,isType:r=>!r||typeof r!="object",serialize:r=>{if(r&&typeof r=="number"){if(r===1/0)return"Infinity";if(r===-1/0)return"-Infinity";if(isNaN(r))return"NaN"}return r},deserialize:(r,e)=>{if(typeof e=="number"){if(r==="Infinity")return 1/0;if(r==="-Infinity")return-1/0;if(r==="NaN")return NaN;if(typeof r=="number"||!r)return r}return r}},Yv];class ga{static callFunction(e,t,i=[]){if(!t)return e(...i);if(e.name&&t[e.name]===e)return e.call(t,...i);ga.methodMap.has(t)||ga.methodMap.set(t,new WeakMap);const n=ga.methodMap.get(t);if(!n.has(e)){let s=t;for(;s;){const a=Object.values(Object.getOwnPropertyDescriptors(s));for(let o of a)if(o.value===e)return n.set(e,!0),e.call(t,...i);s=Object.getPrototypeOf(s)}n.set(e,!1)}return n.get(e)?e.call(t,...i):e(...i)}}ga.methodMap=new WeakMap;function st(r,e="param"){if(!r)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return(t,i,n)=>{const s={get(){return this[`_oc_${i}`]},set(a){var o;const l=this[`_oc_${i}`];if(l===a)return;this[`_oc_${i}`]=a;const c=e==="param"?[i,a,l,this]:e==="object"?[{key:i,value:a,oldValue:l,target:this}]:[];typeof r=="string"?(o=this[r])===null||o===void 0||o.call(this,...c):typeof r=="function"&&ga.callFunction(r,this,c)}};if(n)return An(n,"value")&&delete n.value,An(n,"writable")&&delete n.writable,An(n,"initializer")&&delete n.initializer,Object.assign(n,s);Object.defineProperty(t,i,s)}}function Ir(r,e="void"){if(!r)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return st(r,e)}function yi(r,e="object"){if(!r)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return st(r,e)}function Yw(r){return st((e,t,i,n)=>{if(!n.dispatchEvent)throw new Error("onChangeDispatchEvent: target does not have dispatchEvent");n.dispatchEvent({type:r||`${e}-changed`,detail:{key:e,value:t,oldValue:i}})},"param")}function $(r){return(e,t)=>{const i=e.constructor;if(i===Object)throw new Error("All properties in an object are serialized by default");$t.TypeMap.has(i)||$t.TypeMap.set(i,[]),$t.TypeMap.get(i).push([r||t,t])}}function Kv(r){return e=>(e=class extends e{constructor(){super(...arguments),this.serializableClassId=r}},$t.SerializableClasses.set(r,e),e)}async function Kw(r,e,t){const i=typeof e=="string"?new TextEncoder().encode(e):e,n=await crypto.subtle.digest("SHA-256",i),s=crypto.getRandomValues(new Uint8Array(12)),a=Array.from(s).map(b=>String.fromCharCode(b)).join(""),o={name:"AES-GCM",iv:s},l=await crypto.subtle.importKey("raw",n,o,!1,["encrypt"]),c=typeof r=="string"?new TextEncoder().encode(r):r,h=await crypto.subtle.encrypt(o,l,c),d=new Uint8Array(h),m=Array.from(d),f=m.map(b=>String.fromCharCode(b)).join(""),v=t?typeof t=="string"?t:new TextDecoder().decode(t):"",w=t?typeof t=="string"?new TextEncoder().encode(t):Array.from(t):[];return typeof r=="string"?v+a+f:new Uint8Array([...w,...s,...m])}async function Jw(r,e){const t=typeof e=="string"?new TextEncoder().encode(e):e,i=await crypto.subtle.digest("SHA-256",t),n=r.slice(0,12),s={name:"AES-GCM",iv:typeof n=="string"?new Uint8Array(Array.from(n).map(c=>c.charCodeAt(0))):n},a=await crypto.subtle.importKey("raw",i,s,!1,["decrypt"]),o=r.slice(12),l=typeof o=="string"?new Uint8Array(Array.from(o).map(c=>c.charCodeAt(0))):o;try{const c=await crypto.subtle.decrypt(s,a,l);return typeof r=="string"?new TextDecoder().decode(c):new Uint8Array(c)}catch{throw new Error("Decrypt failed")}}async function cR(){return"showOpenFilePicker"in window?window.showOpenFilePicker().then(r=>r[0]):window.chooseFileSystemEntries()}function hR(){if("showSaveFilePicker"in window){const e={types:[{description:"Text file",accept:{"text/plain":[".txt"]}}]};return window.showSaveFilePicker(e)}const r={type:"save-file",accepts:[{description:"Text file",extensions:["txt"],mimeTypes:["text/plain"]}]};return window.chooseFileSystemEntries(r)}function uR(r){return r.text?r.text():pR(r)}function pR(r){return new Promise(e=>{const t=new FileReader;t.addEventListener("loadend",i=>{const n=(i.srcElement||i.target).result;e(n)}),t.readAsText(r)})}async function dR(r,e){if(r.createWriter){const i=await r.createWriter();await i.write(0,e),await i.close();return}const t=await r.createWritable();await t.write(e),await t.close()}async function mR(r,e){const t={};return e&&(t.writable=!0,t.mode="readwrite"),await r.queryPermission(t)==="granted"||await r.requestPermission(t)==="granted"}function Jv(r,e=8192,t=!1){var i;if(!r.width||!r.height)throw new Error("Invalid bitmap");const n=document.createElement("canvas");n.width=Math.min(e,r.width),n.height=Math.floor(1+n.width*r.height/r.width);const s=r instanceof ImageBitmap,a=s&&t&&Math.abs(n.width-r.width)<.5?n.getContext("bitmaprenderer"):void 0;return a?a.transferFromImageBitmap(r):(i=n.getContext("2d"))===null||i===void 0||i.drawImage(r,0,0,n.width,n.height),s&&t&&r.close(),n}function Zw(r,e=8192,t=!1,i="image/png"){if(!r.width||!r.height)return"";const n=Jv(r,e,!1),s=n.toDataURL(i);return n.remove(),t&&r instanceof ImageBitmap&&r.close(),s}async function fR(r,e=8192,t=!1,i="image/png"){if(!r.width||!r.height)return Promise.reject("Invalid bitmap");const n=Jv(r,e,!1);return new Promise((s,a)=>{n.toBlob(o=>{o?s(o):a("Could not get blob"),n.remove(),t&&r instanceof ImageBitmap&&r.close()},i)})}async function $w(r){return new Promise((e,t)=>{const i=new Image;i.addEventListener("load",()=>{const n=document.createElement("canvas");n.width=i.width,n.height=i.height;const s=n.getContext("2d");if(!s){t(new Error("Could not get 2d context"));return}s.drawImage(i,0,0,n.width,n.height);const a=s.getImageData(0,0,n.width,n.height);e(a),n.remove(),i.remove()},!1),i.addEventListener("error",n=>{i.remove(),t(n)},!1),i.src=r})}function ex(r,{backgroundColor:e="",scale:t=1,width:i=512,height:n=512}){const s=document.createElement("canvas"),a=s.getContext("2d"),o=t,l=i,c=n;return s.width=l*o,s.height=c*o,s.style.width=`${l}`,s.style.height=`${c}`,(e==null?void 0:e.length)>0&&(a.fillStyle=e,a.fillRect(0,0,s.width,s.height)),a.drawImage(r,0,0,s.width,s.height),s}function gR(r){const e=document.createElement("canvas");return e.width=r.width,e.height=r.height,e.getContext("2d").putImageData(r,0,0),e}function AR(){const r=document.createElement("canvas");return r.getContext&&r.getContext("2d")?r.toDataURL("image/webp").startsWith("data:image/webp"):!1}function Zv(r){const e=document.createElement("canvas");e.width=r.width,e.height=r.height;const t=e.getContext("2d");if(!t)throw new Error("Unable to get 2d context");return t.translate(0,r.height),t.scale(1,-1),t.drawImage(r,0,0),e}function vR(r){return new Promise((e,t)=>{const i=new Image,n=URL.createObjectURL(r);i.onload=()=>{URL.revokeObjectURL(n),e(i)},i.onerror=s=>{URL.revokeObjectURL(n),t(s)},i.src=n})}const yR=r=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='16' height='16' fill='%23${r}'/%3E%3C/svg%3E%0A`,tx=r=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='8' cy='8' r='7' fill='%23${r}'/%3E%3C/svg%3E%0A`,_R=r=>`data:image/svg+xml,%3Csvg viewBox='0 0 80 14' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext style='font: 8px "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace; fill: white;' x='9' y='9'%3E${r}%3C/text%3E%3C/svg%3E%0A`,$v=async(r,e)=>{const t=await Dw(r);return ex(t,e)},ix=async(r,e)=>await $v(r,e).then(t=>t.toDataURL("image/png")),bR=async r=>Xv(await(await fetch(r)).blob());async function wR(r,e=bR){const t=r.match(/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)/g);if(t)for(const i of t){const n=await e(i);r=r.replace(i,n)}return r}function e0(r,e,{width:t,height:i},n=!0){const s=`
<svg viewBox="0 0 ${t} ${i}" xmlns="http://www.w3.org/2000/svg">
    <style>
    ${e}
    </style>
    <foreignObject x="0" y="0" width="100%" height="100%">
        <div xmlns="http://www.w3.org/1999/xhtml" style="height: 100%; width: 100%; position: absolute: top:0; left:0">
            ${r}
        </div>
    </foreignObject>
</svg>
    `;return n?Fw(s):s}async function xR(r,e,t){const i=e0(r,e,t);return await $v(i,t)}async function ER(r,e,t){const i=e0(r,e,t);return await ix(i,t)}function rx(r,e){return Math.abs(r)>Math.abs(e)?r:e}function t0(r,e,t){const i=t?1:0,n=~(1<<e);return r&n|i<<e}function CR(r,e){const t=~(1<<e);return r&t}function MR(){const r=(i,n)=>i.toString(16).padStart(n,"0"),e=crypto.getRandomValues(new Uint8Array(16));e[6]=e[6]&15|64,e[8]=e[8]&63|128;const t=new DataView(e.buffer);return`${r(t.getUint32(0),8)}-${r(t.getUint16(4),4)}-${r(t.getUint16(6),4)}-${r(t.getUint16(8),4)}-${r(t.getUint32(10),8)}${r(t.getUint16(14),4)}`}function SR(r,e=null){var t;return(t=new URL(window.location.href).searchParams.get(r))!==null&&t!==void 0?t:e}function TR(r,e,t=!1){const i=new URLSearchParams(location.search);e==null?i.has(r)&&i.delete(r):i.set(r,e),t?window.location.search=i.toString():window.history.replaceState({},"","?"+i.toString())}function IR(r,e="/"){return r.join(e)}function PR(r,e){const t=(e?`var Module = { locateFile: function(s) { return "${e}"; } }; 
`:"")+`importScripts( "${r}" );`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))}const i0={simpleCameraHelpers:`#ifndef SIMPLE_CAMERA_HELPERS
#define SIMPLE_CAMERA_HELPERS
#ifndef USE_TRANSMISSION
uniform mat4 projectionMatrix;
#endif
vec3 viewToScreen(const in vec3 pos){vec4 projected=projectionMatrix*vec4(pos,1.0);return vec3(0.5+0.5*projected.xy/projected.w,projected.w);}vec3 screenToView(const in vec2 uv,const in float viewZ){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projectionMatrix[2][0])*viewZ/projectionMatrix[0][0];float ye=-(uv_.y+projectionMatrix[2][1])*viewZ/projectionMatrix[1][1];return vec3(xe,ye,viewZ);}
#endif
`,cameraHelpers:`#ifndef BASIC_CAMERA_HELPERS
#define BASIC_CAMERA_HELPERS
uniform mat4 projection;uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;
#ifndef THREE_PACKING_INCLUDED
#define THREE_PACKING_INCLUDED
#include <packing>
#endif
float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.0,1.0);}float depthToViewZ(const in float depth){return(depth>0.999)?-cameraNearFar.y*1000.0 :-mix(cameraNearFar.x,cameraNearFar.y,depth);}float viewZToDepth(const in float viewZ){return linstep(-cameraNearFar.x,-cameraNearFar.y,viewZ);}vec4 viewToScreen3(const in vec3 pos){vec4 projected=projection*vec4(pos,1.0);projected.z=pos.z;projected.w=1./projected.w;projected.xyz*=projected.w;projected.xy=0.5+0.5*projected.xy;return projected;}vec3 screenToView3(const in vec2 uv,const in float viewZ){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewZ/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewZ/projection[1][1];return vec3(xe,ye,viewZ);}float viewZFromNDCZ(const in float depth){
#if PERSPECTIVE_CAMERA == 1
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}
#endif
`,randomHelpers:`#ifndef BASIC_RANDOM_HELPERS
#define BASIC_RANDOM_HELPERS
float random(float n){return fract(sin(n)*43758.5453123);}float random2(vec2 n,float x){n+=x;return fract(sin(dot(n.xy,vec2(12.9898,78.233)))*43758.5453);}float random3(vec3 v){v=fract(v*443.8975);v+=dot(v,v.yzx+19.19);return fract((v.x+v.y)*v.z);}float interleavedGradientNoise(const in vec2 fragCoord,const in float seed){vec3 magic=vec3(0.06711056,0.00583715,52.9829189);return fract(magic.z*fract(dot(fragCoord.xy+seed*vec2(2.083,4.867),magic.xy)));}vec3 hash3(vec2 p){vec3 q=vec3(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)),dot(p,vec2(419.2,371.9)));return fract(sin(q)*43758.5453);}
#endif
`,defaultVertex:"varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}",voronoiNoise:`#ifndef VORONOI_HELPER
#define VORONOI_HELPER
float voronoi_distance(vec2 a,vec2 b,float metric){return distance(a,b);}float voronoi_f1_2d(in vec2 coord,in float randomness,in float flakeClamp,in float flakeRadius,inout vec3 outColor){vec2 cellPosition=floor(coord);vec2 localPosition=coord-cellPosition;float minDistance=8.0;vec2 targetOffset,targetPosition;for(int j=-1;j<=1;j++){for(int i=-1;i<=1;i++){vec2 cellOffset=vec2(i,j);vec2 pointPosition=cellOffset+hash3(cellPosition+cellOffset).xy*randomness;float distanceToPoint=voronoi_distance(pointPosition,localPosition,1.);if(distanceToPoint<minDistance){targetOffset=cellOffset;minDistance=distanceToPoint;targetPosition=pointPosition;}}}float outDistance=minDistance;float dist=step(flakeRadius,outDistance);outColor=hash3(cellPosition+hash3(cellPosition+targetOffset).xy*randomness+targetOffset);vec3 outColor1=minDistance<flakeRadius ? outColor : vec3(0.5,0.5,1.);outDistance=mix(dist,minDistance,flakeClamp);outColor=mix(outColor1,outColor,flakeClamp);return outDistance;}
#endif
`},nx={alert:async r=>window.alert(r),prompt:async(r,e,t)=>window.prompt(r,e),confirm:async r=>window.confirm(r),confirmSync:r=>window.confirm(r)};var RR=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof B_<"u"?B_:typeof self<"u"?self:{};function DR(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var sx={exports:{}};(function(r,e){(function(t,i){r.exports=i()})(RR,function(){var t=function(){function i(f){return a.appendChild(f.dom),f}function n(f){for(var v=0;v<a.children.length;v++)a.children[v].style.display=v===f?"block":"none";s=f}var s=0,a=document.createElement("div");a.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",a.addEventListener("click",function(f){f.preventDefault(),n(++s%a.children.length)},!1);var o=(performance||Date).now(),l=o,c=0,h=i(new t.Panel("FPS","#0ff","#002")),d=i(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var m=i(new t.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:a,addPanel:i,showPanel:n,begin:function(){o=(performance||Date).now()},end:function(){c++;var f=(performance||Date).now();if(d.update(f-o,200),f>l+1e3&&(h.update(1e3*c/(f-l),100),l=f,c=0,m)){var v=performance.memory;m.update(v.usedJSHeapSize/1048576,v.jsHeapSizeLimit/1048576)}return f},update:function(){o=this.end()},domElement:a,setMode:n}};return t.Panel=function(i,n,s){var a=1/0,o=0,l=Math.round,c=l(window.devicePixelRatio||1),h=80*c,d=48*c,m=3*c,f=2*c,v=3*c,w=15*c,b=74*c,y=30*c,E=document.createElement("canvas");E.width=h,E.height=d,E.style.cssText="width:80px;height:48px";var _=E.getContext("2d");return _.font="bold "+9*c+"px Helvetica,Arial,sans-serif",_.textBaseline="top",_.fillStyle=s,_.fillRect(0,0,h,d),_.fillStyle=n,_.fillText(i,m,f),_.fillRect(v,w,b,y),_.fillStyle=s,_.globalAlpha=.9,_.fillRect(v,w,b,y),{dom:E,update:function(C,M){a=Math.min(a,C),o=Math.max(o,C),_.fillStyle=s,_.globalAlpha=1,_.fillRect(0,0,h,w),_.fillStyle=n,_.fillText(l(C)+" "+i+" ("+l(a)+"-"+l(o)+")",m,f),_.drawImage(E,v+c,w,b-c,y,v,w,b-c,y),_.fillRect(v+b-c,w,c,y),_.fillStyle=s,_.globalAlpha=.9,_.fillRect(v+b-c,w,c,l((1-C/M)*y))}}},t})})(sx);var BR=sx.exports;const LR=DR(BR);class ax{constructor(e){this._stats=new LR,this._container=e,this._stats.dom.id="stats-js",this._stats.dom.style.position="absolute",this._stats.dom.style.left="unset",this._stats.dom.style.right="0"}show(){this._container.appendChild(this._stats.dom),this._stats.showPanel(0)}hide(){this._container.removeChild(this._stats.dom)}begin(){this._stats.begin()}end(){this._stats.end()}}const UR=".CustomContextMenu{position:absolute;background:#333e;min-width:8rem;color:#fff;font-size:.8rem;overflow:hidden;border-radius:8px;box-shadow:2px 2px 10px #6666;z-index:100000}.CustomContextMenu div{cursor:pointer;padding:6px 10px;transition:background-color .25s ease-in-out}.CustomContextMenu div:hover{background:#1a1a1c}#customContextMenu{background:#333e;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);border:.5px solid rgba(20,20,20,.3);width:auto;height:auto;position:absolute;display:flex;flex-direction:column;z-index:9999;padding:.4rem .25rem;border-radius:.375rem;min-width:8rem;pointer-events:auto;box-shadow:0 2px 10px #0c0c0c33}.customContextMenuItems{color:#fff;font-size:.8rem;font-family:monospace;background-color:transparent;cursor:pointer;padding:4px 8px;border-radius:.25rem;line-height:1rem;font-weight:500;transition:background-color .25s ease-in-out}.customContextMenuItems:hover{color:#fff;background-color:#017aff}",r0=class{static _initialize(){this._inited=!0,document.addEventListener("pointerdown",e=>{this.Element&&!this.Element.contains(e.target)&&e.button===0&&this.Remove()})}static Create(e,t,i,n=!0,s=!0){this._inited||this._initialize(),this.Element&&this.Remove();const a=document.createElement("div");a.id="customContextMenu",a.style.top=i+"px",a.style.left=t+"px",a.innerHTML="<style>"+UR+"</style>";for(const[o,l]of Object.entries(e)){const c=document.createElement("div");c.classList.add("customContextMenuItems"),c.innerHTML=o,a.appendChild(c),c.onclick=async()=>{await l(),s&&this.Remove()}}return this.Element=a,n&&document.body.appendChild(a),a}static Remove(){var e;(e=this.Element)==null||e.remove(),this.Element=void 0}};r0.Element=void 0,r0._inited=!1;let n0=r0;const ox=class dS{get inputEl(){return this._inputEl}get el(){return this._el}constructor(e,t,i){this._el=e,this._inputEl=t,this._listeners={drop:[],dropstart:[],droperror:[]},this._onDragover=this._onDragover.bind(this),this._onDrop=this._onDrop.bind(this),this._onSelect=this._onSelect.bind(this),e==null||e.addEventListener("dragover",this._onDragover,!1),e==null||e.addEventListener("drop",this._onDrop,!1),t==null||t.addEventListener("change",this._onSelect),i&&Object.entries(i).forEach(([n,s])=>s&&this.on(n,s))}on(e,t){return this._listeners[e].push(t),this}_emit(e,t){return this._listeners[e].forEach(i=>i(t)),this}destroy(){const e=this._el,t=this._inputEl;e==null||e.removeEventListener("dragover",this._onDragover),e==null||e.removeEventListener("drop",this._onDrop),t==null||t.removeEventListener("change",this._onSelect)}_onDrop(e){var t,i;e.stopPropagation(),e.preventDefault(),this._emit("dropstart");const n=Array.from(((t=e.dataTransfer)==null?void 0:t.files)||[]),s=Array.from(((i=e.dataTransfer)==null?void 0:i.items)||[]);if(n.length===0&&s.length===0){this._fail("Required drag-and-drop APIs are not supported in this browser.");return}if(dS.USE_DATA_TRANSFER_ITEMS&&s.length>0){const a=s.map(o=>o.webkitGetAsEntry());this._loadNextEntry(new Map,a,e);return}this._emit("drop",{nativeEvent:e,files:new Map(n.map(a=>(a.filePath=a.name,[a.filePath,a])))})}_onDragover(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")}_onSelect(e){if(!this._inputEl){console.warn("Invalid Dropzone event ",e);return}this._emit("dropstart");const t=[].slice.call(this._inputEl.files??new FileList),i=new Map;t.forEach(n=>{n.filePath=n.webkitRelativePath||n.name,i.set(n.filePath,n)}),this._emit("drop",{files:i,nativeEvent:e})}_loadNextEntry(e,t,i){const n=t.pop();if(!n){this._emit("drop",{files:e,nativeEvent:i});return}if(n.isFile)n.file(s=>{s.filePath=n.fullPath,e.set(n.fullPath,s),this._loadNextEntry(e,t,i)},s=>console.error("Could not load file: %s",n.fullPath,s,"Try setting Dropzone.USE_DATA_TRANSFER_ITEMS to false."));else if(n.isDirectory){const s=n.createReader(),a=o=>{o.length?(t=t.concat(o),s.readEntries(a)):this._loadNextEntry(e,t,i)};s.readEntries(a)}else console.warn("Unknown asset type: "+n.fullPath),this._loadNextEntry(e,t,i)}_fail(e){this._emit("droperror",{message:e})}};ox.USE_DATA_TRANSFER_ITEMS=!0;let lx=ox;function s0(r){if(!r)return oi;const e=r.extensions.has("EXT_color_buffer_half_float")||r.capabilities.isWebGL2&&r.extensions.has("EXT_color_buffer_float"),t=r.capabilities.isWebGL2||r.extensions.has("OES_texture_float")||r.extensions.has("WEBGL_color_buffer_float");return e?di:t?qt:oi}function a0(r,e,t){const i=(t==null?void 0:t.data)??new Uint8ClampedArray(r.height*r.width*4),n=r.data instanceof Float32Array,s=r.data instanceof Uint16Array;for(let a=0;a<i.length;a++)n?i[a]=r.data[a]*255:s?i[a]=Ur.fromHalfFloat(r.data[a])*255:i[a]=r.data[a],e===wi&&(i[a]=zw(i[a]/255)*255);return t??new ImageData(i,r.width,r.height)}function Pf(r,e,t=!1){let i;return r.isDataTexture?i=a0(r.image,r.colorSpace):i=r.image,cx(i,e,t)}function cx(r,e,t=!1){let i,n;window.VideoFrame||(window.VideoFrame=HTMLVideoElement),r instanceof window.VideoFrame?(i=r.displayWidth,n=r.displayHeight):(i=r.width,n=r.height),window.VideoFrame===HTMLVideoElement&&delete window.VideoFrame;const s=document.createElement("canvas");s.width=Math.min(e,i),s.height=Math.floor(1+s.width*n/i);const a=s.getContext("2d");if(!a)return console.error("textureToDataUrl: could not get canvas context"),s;t===!0&&(a.translate(0,s.height),a.scale(1,-1));let o=!1;if(r.data!==void 0){const l=r;if(i!==s.width||n!==s.height){const c=document.createElement("canvas");c.width=i,c.height=n;const h=c.getContext("2d");h?(h.putImageData(l,0,0),a.drawImage(c,0,0,s.width,s.height)):(console.error("textureToDataUrl: could not get temp canvas context"),a.putImageData(l,0,0))}else a.putImageData(l,0,0),t&&(o=!0)}else a.drawImage(r,0,0,s.width,s.height);return o?Zv(s):s}function OR(r,e,t,i,n){return Pf(r,e,t).toDataURL(i,n)}async function kR(r,e,t,i,n){const s=Pf(r,e,t);return new Promise((a,o)=>{s.toBlob(l=>{l?a(l):o(new Error("Failed to create blob"))},i,n)})}const FR=r=>(e,t)=>{var i;return((i=t==null?void 0:t.copy)==null?void 0:i.call(t,e))??new r().copy(e)},Rf=class{};(()=>{const r=[[ne,"isVector2",["x","y"]],[P,"isVector3",["x","y","z"]],[bt,"isVector4",["x","y","z","w"]],[Ct,"isQuaternion",["x","y","z","w"]],[fe,"isColor",["r","g","b"]],[Bt,"isMatrix3",["elements"]],[et,"isMatrix4",["elements"]]];$t.RegisterSerializer(...r.map(e=>({priority:1,isType:t=>t[e[1]],serialize:t=>{const i={[e[1]]:!0};for(const n of e[2])i[n]=t[n];return i},deserialize:FR(e[0])}))),$t.RegisterSerializer({priority:2,isType:e=>{var t;return e.isTexture||((t=e.metadata)==null?void 0:t.type)==="Texture"},serialize:(e,t)=>{if(!(e!=null&&e.isTexture))throw new Error("Expected a texture");if(e.isRenderTargetTexture)return;if(t!=null&&t.textures[e.uuid])return{uuid:e.uuid,resource:"textures"};const i=e.source.data,n=!e.isRenderTargetTexture&&e.userData.rootPath;let s={};const a=e.userData;try{n&&e.source.data&&(e.userData.embedUrlImagePreviews?e.source.data=Pf(e,16,e.flipY):e.source.data=null),e.userData={};const o={images:{}};s=e.toJSON(t||o),!t&&s.image&&(s.image=n&&!e.userData.embedUrlImagePreviews?void 0:o.images[s.image]),s.userData=$t.Serialize(o0({},a),t,!1)}catch(o){console.error("Threepipe Serialization: Unable to serialize texture"),console.error(o)}return e.userData=a,n&&(t&&!e.userData.embedUrlImagePreviews&&delete t.images[e.source.uuid],e.source.data=i),t!=null&&t.textures&&s&&!s.resource&&(t.textures[s.uuid]||(t.textures[s.uuid]=s),s={uuid:s.uuid,resource:"textures"}),s},deserialize:(e,t,i)=>{var n,s;if(e.isTexture)return e;if(e.resource==="textures"&&(n=i==null?void 0:i.textures)!=null&&n[e.uuid])return i.textures[e.uuid];console.warn("Cannot deserialize texture into object like primitive, since textures need to be loaded asynchronously. Trying with ObjectLoader. Load events might not work properly.",e,t);const a=(i==null?void 0:i._context.objectLoader)??new vf((s=i==null?void 0:i._context.assetImporter)==null?void 0:s.loadingManager),o={...e};if(typeof o.image=="string"&&(i!=null&&i.images?o.image=i.images[o.image]:console.error("Cannot deserialize texture with image url without meta.images",o)),!o.image||typeof o.image=="string"||!o.image.isSource&&!o.image.url)return console.error("Cannot deserialize texture",o),t;let l;i&&!o.image.isSource&&(i._context.imagePromises||(i._context.imagePromises=[]),i._context.imagePromises.push(new Promise(m=>{l=m})));const c=o.image.isSource?{[o.image.uuid]:o.image}:a.parseImages([o.image],l);o.image=Object.keys(c)[0],i!=null&&i.images&&(i.images[o.image]=c[o.image]),o.userData&&(o.userData=Rf.Deserialize(o.userData,{},i));const h=a.parseTextures([o],c),d=Object.keys(h)[0];return!d||!h[d]?(console.error("Cannot deserialize texture",o),t):(i!=null&&i.textures&&(i.textures[d]=h[d]),h[d])}}),$t.RegisterSerializer({priority:2,isType:e=>{var t;return e.isMaterial||((t=e.metadata)==null?void 0:t.type)==="Material"},serialize:(e,t)=>{if(!(e!=null&&e.isMaterial))throw new Error("Expected a material");if(t!=null&&t.materials[e.uuid])return{uuid:e.uuid,resource:"materials"};e.userData.rootPath&&console.error("TODO: handle material with root path with material inheritance/hierarchy");const i=t??{textures:{},images:{}},n={},s={},a=Object.keys(e.constructor.MaterialProperties||e);for(const c of a){if(c.startsWith("__"))continue;const h=e[c];if(h!=null&&h.isTexture){const d=$t.Serialize(h,i);n[c]=d,s[c]=h,e[c]=d?{isTexture:!0,toJSON:()=>d}:null}}const o=e.userData;e.userData={};let l={};try{l=e.toJSON(t,!0),NR(l,o,t),l.userData.uuid=o.uuid,e.constructor.TYPE&&(l.type=e.constructor.TYPE);for(const c of Object.keys(l))l[c]===void 0&&delete l[c]}catch(c){console.error("Threepipe Serialization: Unable to serialize material"),console.error(c)}e.userData=o;for(const[c,h]of Object.entries(s))e[c]=h,delete s[c];if(l)if(t){for(const[c,h]of Object.entries(n))h&&(l[c]=h);t.materials&&(t.materials[l.uuid]||(t.materials[l.uuid]=l),l={uuid:l.uuid,resource:"materials"})}else{for(const[c,h]of Object.entries(n))h&&(l[c]=h.uuid);l.textures=Object.values(i.textures),l.images=Object.values(i.images)}return l},deserialize:(e,t,i)=>{var n,s,a,o,l;function c(E){if(E.isMaterial)return t!=null&&t.isMaterial&&t.uuid===E.uuid?(t!==E&&typeof t.setValues=="function"&&(console.warn("material uuid already exists, copying values to old material"),t.setValues(E)),t):E}let h=c(e);if(h!==void 0)return h;if(e.resource==="materials"&&(n=i==null?void 0:i.materials)!=null&&n[e.uuid]){if(h=c(i.materials[e.uuid]),h!==void 0)return h;console.error("cannot find material in meta",e,h)}const d=e.type;if(!d)return console.error("Cannot deserialize material without type",e),t;const m={...e};m.userData&&(m.userData=$t.Deserialize(m.userData,void 0,i,!1));const f={};for(const[E,_]of Object.entries(m)){if(typeof _=="string"&&(s=i==null?void 0:i.textures)!=null&&s[_]&&(m[E]=i.textures[_],f[E]=i.textures[_]),!_||!_.resource||typeof _.resource!="string")continue;const C=(a=i==null?void 0:i[_.resource])==null?void 0:a[_.uuid];m[E]=C||null,_.resource==="textures"&&C!=null&&C.isTexture&&(f[E]=C)}if((!t||!t.isMaterial||t.type!==d&&((o=t.constructor)==null?void 0:o.TYPE)!==d)&&(t&&Object.keys(t).length&&console.warn("Material type mismatch during deserialize, creating a new material",t,m,d,(l=t.constructor)==null?void 0:l.type),t=null),t&&(!m.uuid||t.uuid===m.uuid))return t.fromJSON?t.fromJSON(m,i,!0):t.setValues?t.setValues(m):console.error("Cannot deserialize material, no fromJSON or setValues method",t,m),t;const v=i==null?void 0:i._context.materialManager;if(v){const E=v.create(d);if(E)return E.fromJSON?E.fromJSON(m,i,!0):E.setValues?E.setValues(m):console.error("Cannot deserialize material, no fromJSON or setValues method",E,m),E}console.warn("Legacy three.js material deserialization");const w=new xp;for(const[E,_]of Object.entries(f))m[E]=_.uuid;const b={...w.textures};w.setTextures(f);const y=w.parse(m);if(w.setTextures(b),h=c(y),h!==void 0)return h;console.error("cannot deserialize material",e,h,y)}}),$t.RegisterSerializer({priority:2,isType:e=>{var t;return e.isWebGLRenderTarget||((t=e.metadata)==null?void 0:t.type)==="RenderTarget"},serialize:(e,t)=>{var i;if(!(e!=null&&e.isWebGLRenderTarget)||!e.uuid)throw new Error("Expected a IRenderTarget");if(t!=null&&t.extras[e.uuid])return{uuid:e.uuid,resource:"extras"};const n=Array.isArray(e.texture)?e.texture[0]:e.texture;let s={metadata:{type:"RenderTarget"},uuid:e.uuid,width:e.width,height:e.height,depth:e.depth,sizeMultiplier:e.sizeMultiplier,count:Array.isArray(e.texture)?e.texture.length:void 0,isCubeRenderTarget:e.isWebGLCubeRenderTarget||void 0,isTemporary:e.isTemporary,textureName:Array.isArray(e.texture)?e.texture.map(a=>a.name):(i=e.texture)==null?void 0:i.name,options:{wrapS:n==null?void 0:n.wrapS,wrapT:n==null?void 0:n.wrapT,magFilter:n==null?void 0:n.magFilter,minFilter:n==null?void 0:n.minFilter,format:n==null?void 0:n.format,type:n==null?void 0:n.type,anisotropy:n==null?void 0:n.anisotropy,depthBuffer:!!e.depthBuffer,stencilBuffer:!!e.stencilBuffer,generateMipmaps:n==null?void 0:n.generateMipmaps,depthTexture:!!e.depthTexture,colorSpace:n==null?void 0:n.colorSpace,samples:e.samples}};return t!=null&&t.extras&&(t.extras[s.uuid]||(t.extras[s.uuid]=s),s={uuid:s.uuid,resource:"extras"}),s},deserialize:(e,t,i)=>{if((t==null?void 0:t.uuid)===e.uuid)return t;if(e.isWebGLRenderTarget)return e;const n=i==null?void 0:i._context.renderManager;if(!n)return console.error("Cannot deserialize render target without render manager",e),t;if(e.isWebGLCubeRenderTarget||e.isTemporary)return console.warn("Cannot deserialize WebGLCubeRenderTarget or temporary render target yet",e),t;const s=n.createTarget({sizeMultiplier:e.sizeMultiplier||void 0,size:e.sizeMultiplier?void 0:{width:e.width,height:e.height},textureCount:e.count,...e.options});if(e.textureName)if(Array.isArray(e.textureName)&&Array.isArray(s.texture))for(let a=0;a<e.textureName.length;a++)s.texture[a].name=e.textureName[a];else Array.isArray(s.texture)||(s.texture.name=Array.isArray(e.textureName)?e.textureName[0]:e.textureName);return s&&(s.uuid=e.uuid,i!=null&&i.extras&&(i.extras[e.uuid]=s),s)}})})(),Rf.Serialize=$t.Serialize,Rf.Deserialize=$t.Deserialize;let Kt=Rf;function Mp(r,e,t=[],i=!0){if(!e)return r;for(const n of Object.keys(e)){if(i&&t.includes(n)||n.startsWith("__"))continue;const s=e[n];if(typeof r[n]=="function"||typeof s=="function")continue;const a=!s||s.isTexture||s.isObject3D||s.isMaterial;!a&&typeof s.clone=="function"?r[n]=s.clone():!a&&(s.constructor===Object||Array.isArray(s))?r[n]=Mp(Array.isArray(s)?[]:{},s,t,!1):r[n]=s}return r}function o0(r,e,t=["uuid"],i=!0){return Mp(r,e,t,i)}function l0(r,e,t=["uuid"],i=!0){return Mp(r,e,t,i)}function Df(r,e,t=["uuid"],i=!0){return Mp(r,e,t,i)}function NR(r,e,t){var i,n;r.userData={},l0(r.userData,e);const s=t||{textures:Object.fromEntries(((i=r.textures)==null?void 0:i.map(a=>[a.uuid,a]))||[]),images:Object.fromEntries(((n=r.images)==null?void 0:n.map(a=>[a.uuid,a]))||[])};r.userData=$t.Serialize(r.userData,s),t||(Object.keys(s.textures).length>0&&(r.textures=Object.values(s.textures)),Object.keys(s.images).length>0&&(r.images=Object.values(s.images)))}function c0(r){Object.values(r).forEach(e=>{e&&Object.values(e).forEach(t=>{t.url&&(!(t.url.data instanceof ArrayBuffer)&&!Array.isArray(t.url.data)||(t.url.type==="Uint16Array"?(t.url.data instanceof Uint16Array||(t.url.data=new Uint16Array(t.url.data)),t.url.data="data:application/octet-stream;base64,"+If(t.url.data.buffer)):t.url.type==="Uint8Array"?(t.url.data instanceof Uint8Array||(t.url.data=new Uint8Array(t.url.data)),t.url.data="data:application/octet-stream;base64,"+If(t.url.data.buffer)):t.url.data instanceof ArrayBuffer?t.url.data="data:application/octet-stream;base64,"+If(t.url.data.buffer):console.warn("Unsupported buffer type",t.url.type)))})})}function hx(r){Object.values(r).forEach(e=>{e&&Object.values(e).forEach(t=>{if(!t||!t.url||typeof t.url.data!="string")return;const i=t.url.data.match(/^data:.*;base64,(.*)$/);i!=null&&i[1]?t.url.data=Hv(i==null?void 0:i[1]):(t.url.type!=="Uint8Array"&&console.error("Unsupported buffer type string for ",t.url.type,"use base64"),t.url.data=new TextEncoder().encode(t.url.data).buffer)})})}function nc(r){return{geometries:{...r==null?void 0:r.geometries},materials:{...r==null?void 0:r.materials},textures:{...r==null?void 0:r.textures},images:{...r==null?void 0:r.images},shapes:{...r==null?void 0:r.shapes},skeletons:{...r==null?void 0:r.skeletons},animations:{...r==null?void 0:r.animations},extras:{...r==null?void 0:r.extras},_context:{}}}class Bf{static async ImportMeta(e,t){var i;if(e.__isLoadedResources)return e;const n=h0();n._context=e._context,hx(e);const s=e._context.assetImporter;if(!s)throw new Error("assetImporter not found in meta context, which is required for import meta.");const a=e._context.objectLoader||new vf(s.loadingManager);n.animations=e.animations?a.parseAnimations(Object.values(e.animations)):{},t&&t.animations&&(n.animations={...n.animations,...t.animations}),n.shapes=e.shapes?a.parseShapes(Object.values(e.shapes)):{},t&&t.shapes&&(n.shapes={...n.shapes,...t.shapes}),n.geometries=e.geometries?a.parseGeometries(Object.values(e.geometries),Object.values(n.shapes)):{},t&&t.geometries&&(n.geometries={...n.geometries,...t.geometries}),n.images=e.images?await a.parseImagesAsync(Object.values(e.images)):{},t&&t.images&&(n.images={...n.images,...t.images}),Array.isArray(e.textures)&&(console.error("TODO: check file format"),e.textures=e.textures.reduce((h,d)=>(d&&(h[d.uuid]=d),h))),await Bf.LoadRootPathTextures({textures:e.textures,images:n.images},s);const o=[];for(const h of Object.values(e.textures)){const d={...h};d.userData&&(d.userData=Kt.Deserialize(d.userData,{},n)),o.push(d)}n.textures=e.textures?a.parseTextures(o,n.images):{};const l={...n.textures};for(const h of Object.values(e.textures))(i=h.rootPathPromise)==null||i.then(d=>{if(!d)return;const m=l[h.uuid];m.dispose(),m.source=d,m.source.needsUpdate=!0,m.needsUpdate=!0});for(const h of Object.entries(n.textures))h[1]=await s.processRawSingle(h[1],{}),h[1]?n.textures[h[0]]=h[1]:delete n.textures[h[0]];t&&t.textures&&(n.textures={...n.textures,...t.textures});const c=e.materials?Object.values(e.materials):[];n.materials={};for(const h of c)h!=null&&h.uuid&&(n.materials[h.uuid]=Kt.Deserialize(h,void 0,n));if(t&&t.materials&&(n.materials={...n.materials,...t.materials}),e.object&&(n.object=a.parseObject(e.object,n.geometries,n.materials,n.textures,n.animations),e.skeletons&&(n.skeletons=a.parseSkeletons(Object.values(e.skeletons),n.object),a.bindSkeletons(n.object,n.skeletons))),e.extras){n.extras=e.extras;for(const h of Object.values(e.extras))if(h.uuid){if(!h.url){n.extras[h.uuid]=Kt.Deserialize(h,void 0,n);continue}if(typeof h.url=="string"){const d=await s.importPath(h.url);(d==null?void 0:d.length)>0&&(n.extras[h.uuid]=d[0])}else if(h.url.data){const d=new File([Uw(h.url.type,h.url.data)],h.url.path),m=await s.importAsset({path:d.name,file:d});(m==null?void 0:m.length)>0&&(n.extras[h.uuid]=m[0])}else console.warn("invalid URL type while loading extra resource")}}return t&&t.extras&&(n.extras={...n.extras,...t.extras}),n.__isLoadedResources=!0,n}static async LoadRootPathTextures({textures:e,images:t},i,n=!0){var s;const a=[];for(const o of Array.isArray(e)?e:Object.values(e??{})){const l=(s=o==null?void 0:o.userData)==null?void 0:s.rootPath,c=n&&o.image&&t[o.image];if(!l)continue;const h=i.importSingle(l,{processRaw:!1}).then(d=>{const m=d==null?void 0:d.source;if(!d||!m)return null;const f=new Zr(m.data);return o.image&&(f.uuid=o.image),o.image=f.uuid,c||(t[f.uuid]=f),d.dispose(),f}).catch(d=>(console.error(d),delete o.userData.rootPath,null));c?o.rootPathPromise=h:a.push(h)}await Promise.allSettled(a)}}function Lf(r){if(!r)return{};const e={...r};return e._context&&delete e._context,e}function h0(r,e){return{...r,...nc(r),_context:{assetManager:e==null?void 0:e.assetManager,assetImporter:e==null?void 0:e.assetManager.importer,materialManager:e==null?void 0:e.assetManager.materials,renderManager:e==null?void 0:e.renderManager}}}function u0(r){const e=new Blob([JSON.stringify(r)],{type:"application/json"});return e.ext="json",e}function ux(r,e,t,i){var n,s,a;if(e!=null&&e.extras[r.uuid])return{uuid:r.uuid,resource:"extras"};let o="";if((n=r.source)!=null&&n._sourceImgBuffer||r.__sourceBuffer){const c=new Uint8Array(((s=r.source)==null?void 0:s._sourceImgBuffer)||r.__sourceBuffer),h=i||r.userData.mimeType||"";o={data:Array.from(c),type:c.constructor.name,path:((a=r.userData.__sourceBlob)==null?void 0:a.name)||r.userData.rootPath||"file."+h.split("/")[1]},h&&(o.mimeType=h)}else r.userData.rootPath?o=r.userData.rootPath:console.error("Unable to serialize LUT texture, not loaded through asset manager.");const l={uuid:r.uuid,url:o,userData:o0({},r.userData),type:r.type,name:t||r.name};return e!=null&&e.extras?(e.extras[r.uuid]=l,{uuid:r.uuid,resource:"extras"}):l}const px="shaderReplaceString: str must be passed if str is a RegExp and append/prepend is true";function ri(r,e,t,{replaceAll:i=!1,prepend:n=!1,append:s=!1,str:a=void 0}={}){const o=typeof e=="string";if(o?!r.includes(e):!e.test(r))return console.error(`${e} not found in shader`),r;let l=t;if(a=a??(o?e:void 0),n){if(typeof a!="string")throw new Error(px);l=t+a}else if(s){if(typeof a!="string")throw new Error(px);l=a+t}return i?r.replaceAll(e,l):r.replace(e,l)}function dx(r,e=0){const t=GR(r.byteLength);if(t!==r.byteLength){const i=new Uint8Array(t);if(i.set(new Uint8Array(r)),e!==0)for(let n=r.byteLength;n<t;n++)i[n]=e;return i.buffer}return r}function GR(r){return Math.ceil(r/4)*4}const mx=12,zR=1179937895,QR=2,fx=8,VR=1313821514,jR=5130562;function gx(r,e){const t=dx(r),i=new DataView(new ArrayBuffer(fx));i.setUint32(0,t.byteLength,!0),i.setUint32(4,jR,!0);const n=dx(new TextEncoder().encode(JSON.stringify(e||{})).buffer,32),s=new DataView(new ArrayBuffer(fx));s.setUint32(0,n.byteLength,!0),s.setUint32(4,VR,!0);const a=new ArrayBuffer(mx),o=new DataView(a);o.setUint32(0,zR,!0),o.setUint32(4,QR,!0);const l=mx+s.byteLength+n.byteLength+i.byteLength+t.byteLength;o.setUint32(8,l,!0);const c=new Blob([a,s,n,i,t],{type:"model/gltf+binary"});return c.ext="glb",c}function p0(r,e){let t,i;if(Array.isArray(r))for(const s of r){const a=p0(s,e);t===void 0||i===void 0?(t=a.min.clone(),i=a.max.clone()):(t.min(a.min),i.max(a.max))}const n=r;if(n.geometry!==void 0){const s=n.geometry.vertices;if(s===void 0&&n.geometry.attributes!==void 0&&"position"in n.geometry.attributes){const a=new P,o=n.geometry.attributes.position;for(let l=0;l<o.count*o.itemSize;l+=o.itemSize){a.set(o.array[l],o.array[l+1],o.array[3]);const c=a.applyMatrix4(r.matrixWorld).project(e),h=new ne(c.x,c.y);t===void 0||i===void 0?(t=h.clone(),i=h.clone()):(t.min(h),i.max(h))}}else for(const a of s){const o=a.clone().applyMatrix4(r.matrixWorld).project(e),l=new ne(o.x,o.y);t===void 0||i===void 0?(t=l.clone(),i=l.clone()):(t.min(l),i.max(l))}}if(r.children!==void 0)for(const s of r.children){const a=p0(s,e);t===void 0||i===void 0?(t=a.min.clone(),i=a.max.clone()):(t.min(a.min),i.max(a.max))}return new zv(t,i)}function Ax(r){const e={...Bn};Bn.get=(t,i,n)=>i?t.startsWith("data:")||t.startsWith("blob")||t.startsWith("chrome-extension")?Promise.resolve(void 0):r.match(t).then(s=>{if(s)switch(i){case"arraybuffer":return s.arrayBuffer();case"blob":return s.blob();case"document":return s.text().then(a=>new DOMParser().parseFromString(a,n??"text/html"));case"json":return s.json();default:if(n===void 0)return s.text();{const a=/charset="?([^;"\s]*)"?/i.exec(n),o=a&&a[1]?a[1].toLowerCase():void 0,l=new TextDecoder(o);return s.arrayBuffer().then(c=>l.decode(c))}}}):e.get(t),Bn.add=async(t,i,n)=>{if(!n)return e.add(t,i);t.startsWith("data:")||t.startsWith("blob")||t.startsWith("chrome-extension")||(await r.match(t)&&await r.delete(t),await r.put(t,new Response(i,{status:200})))},Bn.remove=(t,i)=>{if(!i)return e.remove(t);r.delete(t)}}function HR(r){const e=new pa(new Uint8Array([Math.floor(r.r*255),Math.floor(r.g*255),Math.floor(r.b*255),255]),1,1,mi,oi);return e.needsUpdate=!0,e.colorSpace=wi,e}function WR(r){const e=new pa(new Uint8Array([Math.floor(r.x*255),Math.floor(r.y*255),Math.floor(r.z*255),Math.floor(r.w*255)]),1,1,mi,oi);return e.needsUpdate=!0,e}function vx(r,e=3,t){let i,n,s,a,o;const l=r.byteLength/(e*2)|0;t=t||new Uint8ClampedArray(l*4);for(let c=0;c<l;c++){i=Ur.fromHalfFloat(r[c*e])*65504,n=Ur.fromHalfFloat(r[c*e+1])*65504,s=Ur.fromHalfFloat(r[c*e+2])*65504,a=Math.max(Math.max(i,n),s);const h=Math.ceil(Math.log2(a));o=Math.pow(2,h-8),t[c*4]=i/o|0,t[c*4+1]=n/o|0,t[c*4+2]=s/o|0,t[c*4+3]=h+128}return t}function tl({uniforms:r,propKey:e,thisTarget:t=!1,onChange:i}={}){const n=!!r,s=!!e,a=t;return(o,l,c)=>{const h=m=>{const f=a?m:n?r:m.uniforms||m._uniforms||m.extraUniforms;let v=s?e:l;a&&(v="_"+v);let w=f[v];return w||(w={value:null},f[v]=w),w},d={get(){return h(this).value},set(m){const f=h(this);f.value!==m&&(f.value=m,el(this,"uniformsNeedUpdate",!0,!0),i&&ga.callFunction(i,this,[l,m]))}};if(c)return An(c,"value")&&delete c.value,An(c,"writable")&&delete c.writable,An(c,"initializer")&&delete c.initializer,Object.assign(c,d);Object.defineProperty(o,l,d)}}function Uf(r,e,t=!1,i,n,s){const a=!!e,o=!!r;return(l,c,h)=>{const d=f=>({t:a?e:f.defines||f._defines||f.extraDefines,p:o?r:c}),m={get(){const{t:f,p:v}=d(t?this:this.material);let w=f[v];return s&&(w=s(w)),w},set(f){const{t:v,p:w}=d(t?this:this.material);n&&(f=n(f)),el(v,w,f,!0),f===void 0&&delete v[w],i&&typeof i=="function"?ga.callFunction(i,this,[w,f]):el(t?this:this.material,"needsUpdate",!0,!0)}};if(h)return An(h,"value")&&delete h.value,An(h,"writable")&&delete h.writable,An(h,"initializer")&&delete h.initializer,Object.assign(h,m);Object.defineProperty(l,c,m)}}function Sp(r,e,t=!1,i,n=!1){return Uf(r,e,t,i,s=>s?"1":n?void 0:"0",s=>!!(s&&s!=="0"))}function Tp({obj:r,key:e,onChange:t,processVal:i,invProcessVal:n}){const s=!!e;return(a,o,l)=>{const c=d=>{let m=sr(r)||d;typeof m=="string"&&(m=d[m]);const f=s&&sr(e)||o;return{t:m,p:f}},h={get(){const{t:d,p:m}=c(this);let f=d[m];return n&&(f=n(f)),f},set(d){const{t:m,p:f}=c(this);i&&(d=i(d)),el(m,f,d,!0),d===void 0&&delete m[f];let v=t;v&&(typeof v=="string"||typeof v=="symbol")&&(v=this[v]),v&&typeof v=="function"&&ga.callFunction(v,this,[f,d])}};if(l)return An(l,"value")&&delete l.value,An(l,"writable")&&delete l.writable,An(l,"initializer")&&delete l.initializer,Object.assign(l,h);Object.defineProperty(a,o,h)}}function d0(r){switch(r){case Xi:case wi:return["Linear","( value )"];case it:return["sRGB","( value )"];case _l:return["RGBM","( value, 16.0 )"];default:return console.warn("utils: Unsupported colorspace:",r),["Linear","( value )"]}}function m0(r,e){let t;return r&&r.colorSpace!==void 0?t=r.colorSpace||Xi:r&&r.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureColorSpaceFromMap: don't use render targets as textures. Use their .texture property instead."),t=r.texture.colorSpace):t=wi,e&&r&&r.isTexture&&r.format===mi&&r.type===oi&&r.colorSpace===it&&(t=wi),t}function f0(r,e){const t=d0(e);return"vec4 "+r+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function g0(r,e,t){return f0(r+"TexelToLinear",m0(e,t))+`
`}function XR(r,e){return f0(r+"TexelToLinear",e)+`
`}function yx(r,e){const t=d0(e);return"vec4 "+r+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function qR(r,e,t){return yx(r,m0(e,t))}function YR(r,e,t=!0){if(!e||!e.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!r.hasAttribute("position")||!r.hasAttribute("normal")||!r.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function i(a){if(a.normalized||a.isInterleavedBufferAttribute){const o=new Float32Array(a.count*a.itemSize);for(let l=0,c=0;l<a.count;l++)o[c++]=a.getX(l),o[c++]=a.getY(l),a.itemSize>2&&(o[c++]=a.getZ(l));return o}return a.array instanceof Float32Array?a.array:new Float32Array(a.array)}const n=r.index?r.toNonIndexed():r,s=e.generateTangents(i(n.attributes.position),i(n.attributes.normal),i(n.attributes.uv));if(t)for(let a=3;a<s.length;a+=4)s[a]*=-1;return n.setAttribute("tangent",new At(s,4)),r!==n&&r.copy(n),r}function _x(r,e=!1){const t=r[0].index!==null,i=new Set(Object.keys(r[0].attributes)),n=new Set(Object.keys(r[0].morphAttributes)),s={},a={},o=r[0].morphTargetsRelative,l=new ht;let c=0;for(let h=0;h<r.length;++h){const d=r[h];let m=0;if(t!==(d.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const f in d.attributes){if(!i.has(f))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+'. All geometries must have compatible attributes; make sure "'+f+'" attribute exists among all geometries, or in none of them.'),null;s[f]===void 0&&(s[f]=[]),s[f].push(d.attributes[f]),m++}if(m!==i.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". Make sure all geometries have the same number of attributes."),null;if(o!==d.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const f in d.morphAttributes){if(!n.has(f))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+".  .morphAttributes must be consistent throughout all geometries."),null;a[f]===void 0&&(a[f]=[]),a[f].push(d.morphAttributes[f])}if(e){let f;if(t)f=d.index.count;else if(d.attributes.position!==void 0)f=d.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". The geometry must have either an index or a position attribute"),null;l.addGroup(c,f,h),c+=f}}if(t){let h=0;const d=[];for(let m=0;m<r.length;++m){const f=r[m].index;for(let v=0;v<f.count;++v)d.push(f.getX(v)+h);h+=r[m].attributes.position.count}l.setIndex(d)}for(const h in s){const d=Of(s[h]);if(!d)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+h+" attribute."),null;l.setAttribute(h,d)}for(const h in a){const d=a[h][0].length;if(d===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[h]=[];for(let m=0;m<d;++m){const f=[];for(let w=0;w<a[h].length;++w)f.push(a[h][w][m]);const v=Of(f);if(!v)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+h+" morphAttribute."),null;l.morphAttributes[h].push(v)}}return l}function Of(r){let e,t,i,n=-1,s=0;for(let c=0;c<r.length;++c){const h=r[c];if(h.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(e===void 0&&(e=h.array.constructor),e!==h.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=h.itemSize),t!==h.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(i===void 0&&(i=h.normalized),i!==h.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(n===-1&&(n=h.gpuType),n!==h.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;s+=h.array.length}const a=new e(s);let o=0;for(let c=0;c<r.length;++c)a.set(r[c].array,o),o+=r[c].array.length;const l=new At(a,t,i);return n!==void 0&&(l.gpuType=n),l}function KR(r){return r.isInstancedInterleavedBufferAttribute||r.isInterleavedBufferAttribute?kf(r):r.isInstancedBufferAttribute?new Xo().copy(r):new At().copy(r)}function JR(r){let e,t=0,i=0;for(let c=0,h=r.length;c<h;++c){const d=r[c];if(e===void 0&&(e=d.array.constructor),e!==d.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;t+=d.array.length,i+=d.itemSize}const n=new ph(new e(t),i);let s=0;const a=[],o=["getX","getY","getZ","getW"],l=["setX","setY","setZ","setW"];for(let c=0,h=r.length;c<h;c++){const d=r[c],m=d.itemSize,f=d.count,v=new Vr(n,m,s,d.normalized);a.push(v),s+=m;for(let w=0;w<f;w++)for(let b=0;b<m;b++)v[l[b]](w,d[o[b]](w))}return a}function kf(r){const e=r.data.array.constructor,t=r.count,i=r.itemSize,n=r.normalized,s=new e(t*i);let a;r.isInstancedInterleavedBufferAttribute?a=new Xo(s,i,n,r.meshPerAttribute):a=new At(s,i,n);for(let o=0;o<t;o++)a.setX(o,r.getX(o)),i>=2&&a.setY(o,r.getY(o)),i>=3&&a.setZ(o,r.getZ(o)),i>=4&&a.setW(o,r.getW(o));return a}function ZR(r){const e=r.attributes,t=r.morphTargets,i=new Map;for(const n in e){const s=e[n];s.isInterleavedBufferAttribute&&(i.has(s)||i.set(s,kf(s)),e[n]=i.get(s))}for(const n in t){const s=t[n];s.isInterleavedBufferAttribute&&(i.has(s)||i.set(s,kf(s)),t[n]=i.get(s))}}function $R(r){let e=0;for(const i in r.attributes){const n=r.getAttribute(i);e+=n.count*n.itemSize*n.array.BYTES_PER_ELEMENT}const t=r.getIndex();return e+=t?t.count*t.itemSize*t.array.BYTES_PER_ELEMENT:0,e}function bx(r,e=1e-4){const t=e>0;e=Math.max(e,Number.EPSILON);const i={},n=r.getIndex(),s=r.getAttribute("position"),a=n?n.count:s.count;let o=0;const l=Object.keys(r.attributes),c={},h={},d=[],m=["getX","getY","getZ","getW"],f=["setX","setY","setZ","setW"];for(let y=0,E=l.length;y<E;y++){const _=l[y],C=r.attributes[_];c[_]=new At(new C.array.constructor(C.count*C.itemSize),C.itemSize,C.normalized);const M=r.morphAttributes[_];M&&(h[_]=new At(new M.array.constructor(M.count*M.itemSize),M.itemSize,M.normalized))}const v=Math.log10(1/e),w=Math.pow(10,v);for(let y=0;y<a;y++){const E=n?n.getX(y):y;let _="";for(let C=0,M=l.length;C<M&&t;C++){const S=l[C],R=r.getAttribute(S),U=R.itemSize;for(let T=0;T<U;T++)_+=`${~~(R[m[T]](E)*w)},`}if(t&&_ in i)d.push(i[_]);else{for(let C=0,M=l.length;C<M;C++){const S=l[C],R=r.getAttribute(S),U=r.morphAttributes[S],T=R.itemSize,B=c[S],Q=h[S];for(let Z=0;Z<T;Z++){const q=m[Z],X=f[Z];if(B[X](o,R[q](E)),U)for(let te=0,me=U.length;te<me;te++)Q[te][X](o,U[te][q](E))}}t&&(i[_]=o),d.push(o),o++}}const b=r.clone();for(const y in r.attributes){const E=c[y];if(b.setAttribute(y,new At(E.array.slice(0,o*E.itemSize),E.itemSize,E.normalized)),y in h)for(let _=0;_<h[y].length;_++){const C=h[y][_];b.morphAttributes[y][_]=new At(C.array.slice(0,o*C.itemSize),C.itemSize,C.normalized)}}return b.setIndex(d),b}function A0(r,e){if(e===Yd)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),r;if(e===Uc||e===Kd){let t=r.getIndex();if(t===null){const a=[],o=r.getAttribute("position");if(o!==void 0){for(let l=0;l<o.count;l++)a.push(l);r.setIndex(a),t=r.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),r}const i=t.count-2,n=[];if(e===Uc)for(let a=1;a<=i;a++)n.push(t.getX(0)),n.push(t.getX(a)),n.push(t.getX(a+1));else for(let a=0;a<i;a++)a%2===0?(n.push(t.getX(a)),n.push(t.getX(a+1)),n.push(t.getX(a+2))):(n.push(t.getX(a+2)),n.push(t.getX(a+1)),n.push(t.getX(a)));n.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=r.clone();return s.setIndex(n),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),r}function eD(r){const e=new P,t=new P,i=new P,n=new P,s=new P,a=new P,o=new P,l=new P,c=new P;function h(_e,ge,Oe,oe,be,Me,Ve,Ue){e.fromBufferAttribute(ge,be),t.fromBufferAttribute(ge,Me),i.fromBufferAttribute(ge,Ve);const rt=_e.morphTargetInfluences;if(Oe&&rt){o.set(0,0,0),l.set(0,0,0),c.set(0,0,0);for(let xt=0,mt=Oe.length;xt<mt;xt++){const Dt=rt[xt],we=Oe[xt];Dt!==0&&(n.fromBufferAttribute(we,be),s.fromBufferAttribute(we,Me),a.fromBufferAttribute(we,Ve),oe?(o.addScaledVector(n,Dt),l.addScaledVector(s,Dt),c.addScaledVector(a,Dt)):(o.addScaledVector(n.sub(e),Dt),l.addScaledVector(s.sub(t),Dt),c.addScaledVector(a.sub(i),Dt)))}e.add(o),t.add(l),i.add(c)}_e.isSkinnedMesh&&(_e.applyBoneTransform(be,e),_e.applyBoneTransform(Me,t),_e.applyBoneTransform(Ve,i)),Ue[be*3+0]=e.x,Ue[be*3+1]=e.y,Ue[be*3+2]=e.z,Ue[Me*3+0]=t.x,Ue[Me*3+1]=t.y,Ue[Me*3+2]=t.z,Ue[Ve*3+0]=i.x,Ue[Ve*3+1]=i.y,Ue[Ve*3+2]=i.z}const d=r.geometry,m=r.material;let f,v,w;const b=d.index,y=d.attributes.position,E=d.morphAttributes.position,_=d.morphTargetsRelative,C=d.attributes.normal,M=d.morphAttributes.position,S=d.groups,R=d.drawRange;let U,T,B,Q,Z,q,X;const te=new Float32Array(y.count*y.itemSize),me=new Float32Array(C.count*C.itemSize);if(b!==null)if(Array.isArray(m))for(U=0,B=S.length;U<B;U++)for(Z=S[U],q=Math.max(Z.start,R.start),X=Math.min(Z.start+Z.count,R.start+R.count),T=q,Q=X;T<Q;T+=3)f=b.getX(T),v=b.getX(T+1),w=b.getX(T+2),h(r,y,E,_,f,v,w,te),h(r,C,M,_,f,v,w,me);else for(q=Math.max(0,R.start),X=Math.min(b.count,R.start+R.count),U=q,B=X;U<B;U+=3)f=b.getX(U),v=b.getX(U+1),w=b.getX(U+2),h(r,y,E,_,f,v,w,te),h(r,C,M,_,f,v,w,me);else if(Array.isArray(m))for(U=0,B=S.length;U<B;U++)for(Z=S[U],q=Math.max(Z.start,R.start),X=Math.min(Z.start+Z.count,R.start+R.count),T=q,Q=X;T<Q;T+=3)f=T,v=T+1,w=T+2,h(r,y,E,_,f,v,w,te),h(r,C,M,_,f,v,w,me);else for(q=Math.max(0,R.start),X=Math.min(y.count,R.start+R.count),U=q,B=X;U<B;U+=3)f=U,v=U+1,w=U+2,h(r,y,E,_,f,v,w,te),h(r,C,M,_,f,v,w,me);const se=new Ne(te,3),he=new Ne(me,3);return{positionAttribute:y,normalAttribute:C,morphedPositionAttribute:se,morphedNormalAttribute:he}}function tD(r){if(r.groups.length===0)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),r;let e=r.groups;if(e=e.sort((a,o)=>a.materialIndex!==o.materialIndex?a.materialIndex-o.materialIndex:a.start-o.start),r.getIndex()===null){const a=r.getAttribute("position"),o=[];for(let l=0;l<a.count;l+=3)o.push(l,l+1,l+2);r.setIndex(o)}const t=r.getIndex(),i=[];for(let a=0;a<e.length;a++){const o=e[a],l=o.start,c=l+o.count;for(let h=l;h<c;h++)i.push(t.getX(h))}r.dispose(),r.setIndex(i);let n=0;for(let a=0;a<e.length;a++){const o=e[a];o.start=n,n+=o.count}let s=e[0];r.groups=[s];for(let a=1;a<e.length;a++){const o=e[a];s.materialIndex===o.materialIndex?s.count+=o.count:(s=o,r.groups.push(s))}return r}function iD(r,e=Math.PI/3){const t=Math.cos(e),i=(1+1e-10)*100,n=[new P,new P,new P],s=new P,a=new P,o=new P,l=new P;function c(w){const b=~~(w.x*i),y=~~(w.y*i),E=~~(w.z*i);return`${b},${y},${E}`}const h=r.toNonIndexed(),d=h.attributes.position,m={};for(let w=0,b=d.count/3;w<b;w++){const y=3*w,E=n[0].fromBufferAttribute(d,y+0),_=n[1].fromBufferAttribute(d,y+1),C=n[2].fromBufferAttribute(d,y+2);s.subVectors(C,_),a.subVectors(E,_);const M=new P().crossVectors(s,a).normalize();for(let S=0;S<3;S++){const R=n[S],U=c(R);U in m||(m[U]=[]),m[U].push(M)}}const f=new Float32Array(d.count*3),v=new At(f,3,!1);for(let w=0,b=d.count/3;w<b;w++){const y=3*w,E=n[0].fromBufferAttribute(d,y+0),_=n[1].fromBufferAttribute(d,y+1),C=n[2].fromBufferAttribute(d,y+2);s.subVectors(C,_),a.subVectors(E,_),o.crossVectors(s,a).normalize();for(let M=0;M<3;M++){const S=n[M],R=c(S),U=m[R];l.set(0,0,0);for(let T=0,B=U.length;T<B;T++){const Q=U[T];o.dot(Q)>t&&l.add(Q)}l.normalize(),v.setXYZ(y+M,l.x,l.y,l.z)}}return h.setAttribute("normal",v),h}function rD(r,e=!1){return console.warn("THREE.BufferGeometryUtils: mergeBufferGeometries() has been renamed to mergeGeometries()."),_x(r,e)}function nD(r){return console.warn("THREE.BufferGeometryUtils: mergeBufferAttributes() has been renamed to mergeAttributes()."),Of(r)}function v0(r,e=-1){return bx(r,e)}function hs(){return Zt.generateUUID()}function Sh(...r){if(r.length>1)return r.some(i=>Sh(i));const e=r[0];if(e.isTexture)return Array.from(e._appliedMaterials||[]).some(i=>Sh(i))??!1;const t=e.isObject3D?[e]:e.appliedMeshes;for(const i of t){let n=!1;if(i.traverseAncestors(s=>s.isScene&&(n=!0)),n)return!0}return!1}function wx(r,e,t=new Ct){return e.premultiply(r.getWorldQuaternion(t).invert())}function sD(r,e,t=new Ct){return e.premultiply(r.getWorldQuaternion(t))}const aD={None:Qt,Normal:ii,Additive:Oi,Subtractive:Si,Multiply:Rr,Custom:$s},oD={UV:wo,Cube:ys,CubeUV:xo,Equirectangular:_s},lD={None:"",SRGB:it,LinearSRGB:wi,RGBM16:_l,DisplayP3:Uu},cD={UnsignedByte:oi,Byte:Ld,Short:Ud,UnsignedShort:Pc,Int:vl,UnsignedInt:un,Float:qt,HalfFloat:di,UnsignedShort4444:ts,UnsignedShort5551:Au,UnsignedInt248:En},hD={Basic:xs,RGBADepthPacking:Jd};function Ip(r){return{map:r,inv:Object.fromEntries(Object.entries(r).map(([e,t])=>[t,e])),uiConfig:Object.entries(r).map(([e,t])=>({label:e,value:t}))}}const y0={Blending:Ip(aD),AnyMapping:Ip(oD),ColorSpace:Ip(lD),TextureDataType:Ip(cD),DepthPackingStrategies:Ip(hD)},_0=class O_ extends zi{constructor(e,t,i,n){super(),this.hoverEnabled=!1,this._mouseDownPos=new ne,this._onPointerMove=s=>{var a;s.isPrimary!==!1&&(this.updateMouseFromEvent(s),this.hoverEnabled&&(this.hoverObject=((a=this.checkIntersection())==null?void 0:a.intersects[0].object)??null))},this._onPointerLeave=s=>{s.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,(this.hoverEnabled||this.hoverObject)&&(this.hoverObject=null))},this._onPointerEnter=s=>{},this._onPointerCancel=s=>{},this._onPointerDown=s=>{s.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.down,this._mouseDownTime=this.time,this._mouseDownPos.copy(this.mouse))},this._onPointerUp=s=>{if(s.isPrimary===!1)return;this.domElement.style.cursor=this.cursorStyles.default,this._mouseUpTime=this.time;const a=this.mouseDownDeltaTime,o=this._mouseDownPos.distanceTo(this.mouse);a<O_.PointerClickMaxTime&&o<O_.PointerClickMaxDistance&&this._onPointerClick(s)},this._onPointerClick=s=>{if(s.isPrimary===!1)return;this.updateMouseFromEvent(s);const a=this.checkIntersection();a?this.dispatchEvent({type:"hitObject",time:this._mouseUpTime,intersects:a}):this.dispatchEvent({type:"hitObject",time:this._mouseUpTime,intersects:{selectedObject:null,intersect:null,intersects:[]}}),this.selectedObject=(a==null?void 0:a.selectedObject)||null},this._root=e,this._camera=i,this.domElement=t,this._time=this.time,this._mouseDownTime=0,this._mouseUpTime=1,this.selectionCondition=n??(s=>s.userData.userSelectable!==!1&&s.userData.bboxVisible!==!1&&s.material!=null&&s.material.type!=="ShadowMaterial"),this.raycaster=new wf,this.mouse=new ne,this._selected=[],this._hovering=[],this.cursorStyles={default:"grab",down:"grabbing"},this.domElement.style.touchAction="none",this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerleave",this._onPointerLeave),this.domElement.addEventListener("pointerout",this._onPointerLeave),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("pointerenter",this._onPointerEnter),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp)}dispose(){this.selectedObject=null,this.hoverObject=null,this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerleave",this._onPointerLeave),this.domElement.removeEventListener("pointerout",this._onPointerLeave),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("pointerenter",this._onPointerEnter),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp)}get camera(){return this._camera}set camera(e){this._camera=e}get selectedObject(){return this._selected.length>0?this._selected[0]:null}set selectedObject(e){!this._selected.length&&!e||this._selected.length===1&&this._selected[0]===e||(this._selected=e?Array.isArray(e)?[...e]:[e]:[],this.dispatchEvent({type:"selectedObjectChanged",object:this.selectedObject}))}get hoverObject(){return this._hovering.length>0?this._hovering[0]:null}set hoverObject(e){!this._hovering.length&&!e||this._hovering.length===1&&this._hovering[0]===e||(this._hovering=e?Array.isArray(e)?[...e]:[e]:[],this.dispatchEvent({type:"hoverObjectChanged",object:this.hoverObject}))}get time(){return this._time=nn(),this._time}get isMouseDown(){return this.mouseDownDeltaTime<0}get mouseDownDeltaTime(){return this._mouseUpTime-this._mouseDownTime}updateMouseFromEvent(e){const t=this.domElement.getBoundingClientRect();this.mouse.x=(e.clientX-t.x)/t.width*2-1,this.mouse.y=-((e.clientY-t.y)/t.height)*2+1}checkIntersection(){const e=this._camera;if(!e)return null;this.raycaster.setFromCamera(this.mouse,e);let t=this.raycaster.intersectObject(this._root,!0);const i=[];t=t.filter(o=>i.includes(o.object.id)?!1:(i.push(o.object.id),!0));let n=null,s;const a=[];for(const o of t){for(n=o.object,s=o;n!=null&&(!n.visible||!this.selectionCondition(n));)n=n.parent;n!=null&&a.push(o)}if(t=a,t.length>0){if(n=t[0].object,s=t[0],this._firstHit&&n.id!==this._firstHit.id)n=s.object;else for(let o=0;o<t.length;o++)if(this.selectedObject&&this.selectedObject.id===t[o].object.id){const l=o+1;if(l<t.length)s=t[l],n=s.object;else return null}this._firstHit=t[0].object}return n&&s&&n?{selectedObject:n,intersect:s,intersects:t,mouse:this.mouse.toArray()}:null}isHovering(){return this.hoverObject!=null}isSelected(){return this.selectedObject!=null}};_0.PointerClickMaxTime=200,_0.PointerClickMaxDistance=.1;let xx=_0;function Ex(r){if(!r.isMaterial&&!r.isBufferGeometry)return;const e=Array.from(r.appliedMeshes).filter(s=>!s.isInstancedMesh&&!!s.parent&&s.children.length===0&&!Array.isArray(s.material));if(e.length<2)return;const t=s=>{var a,o;return s.parent.uuid+"_"+((a=s.geometry)==null?void 0:a.uuid)+"_"+((o=s.material)==null?void 0:o.uuid)},i=new Map;for(const s of e){const a=t(s);i.has(a)||i.set(a,[]),i.get(a).push(s),s.updateMatrix()}const n=i.keys();for(const s of n){const a=i.get(s),o=a[0];if(!o||a.length<2)continue;const l=new pp(o.geometry,o.material,a.length),c=o.userData;o.userData={},l.copy(o),Df(l.userData,c);const h=o.parent;l.position.set(0,0,0),l.rotation.set(0,0,0),l.scale.set(1,1,1),l.updateMatrix();const d=new Float32Array(l.count*3),m=new Float32Array(l.count*4),f=new Float32Array(l.count*3);for(let v=0;v<a.length;v++){const w=a[v],b=w.matrix;b.determinant()<0&&(b.elements[0]*=-1,b.elements[1]*=-1,b.elements[2]*=-1),l.setMatrixAt(v,b),w.position.toArray(d,v*3),w.quaternion.toArray(m,v*4),w.scale.toArray(f,v*3),w.removeFromParent(),w.material=void 0,w.geometry=void 0}l.sourceTrs={TRANSLATION:new At(d,3),ROTATION:new At(m,4),SCALE:new At(f,3)},l.instanceMatrix.needsUpdate=!0,h.add(l),h.setDirty()}}const uD={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},pD={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`};class Cx{constructor(e){this._viewer=e,this.horizontalBlurMaterial=new yr(uD),this.verticalBlurMaterial=new yr(pD),this.horizontalBlurMaterial.depthTest=!1,this.verticalBlurMaterial.depthTest=!1}blur(e,t,i,n=1){this.horizontalBlurMaterial.uniforms.h.value=n,this.verticalBlurMaterial.uniforms.v.value=n,this._viewer.renderManager.blit(i,{material:this.horizontalBlurMaterial,clear:!0,source:e}),this._viewer.renderManager.blit(t,{material:this.verticalBlurMaterial,clear:!0,source:i.texture})}dispose(){this.horizontalBlurMaterial.dispose(),this.verticalBlurMaterial.dispose()}}const b0=class Tc extends Yi{constructor(){super(...arguments),this._vector=new P}expandByObject(e,t=!1,i=!1,n){var s;if(((s=e.userData)==null?void 0:s.bboxVisible)===!1)return this;if(!e.visible&&i)return this;if(n&&n(e))return this;if(e.updateWorldMatrix(!1,!1),e.boundingBox!==void 0)e.boundingBox===null&&e.computeBoundingBox(),Tc._box.copy(e.boundingBox),Tc._box.applyMatrix4(e.matrixWorld),this.union(Tc._box);else{const o=e.geometry;if(o!==void 0)if(t&&o.attributes!=null&&o.attributes.position!==void 0){const l=o.attributes.position;for(let c=0,h=l.count;c<h;c++)this._vector.fromBufferAttribute(l,c).applyMatrix4(e.matrixWorld),this.expandByPoint(this._vector)}else o.boundingBox===null&&o.computeBoundingBox(),Tc._box.copy(o.boundingBox),Tc._box.applyMatrix4(e.matrixWorld),this.union(Tc._box)}const a=e.children;for(let o=0,l=a.length;o<l;o++)this.expandByObject(a[o],t,i);return this}expandByObjects(e,t=!1,i=!1){for(let n=0,s=e.length;n<s;n++)this.expandByObject(e[n],t,i);return this}getPoints(){return[new P(this.min.x,this.min.y,this.min.z),new P(this.min.x,this.min.y,this.max.z),new P(this.min.x,this.max.y,this.min.z),new P(this.min.x,this.max.y,this.max.z),new P(this.max.x,this.min.y,this.min.z),new P(this.max.x,this.min.y,this.max.z),new P(this.max.x,this.max.y,this.min.z),new P(this.max.x,this.max.y,this.max.z)]}getScreenSpaceBounds(e){const t=this.getPoints(),i=new zv;for(const n of t){const s=n.project(e);i.min.min(s),i.max.max(s)}return i}};b0._box=new b0;let Vs=b0;function w0(r,e,t,i=7,n=new P(0,0,1.5),s=new Qi(45,1,.1,1e3)){const a=e.visible;e.visible=!0;const o=new Vs().expandByObject(e,!0,!0),l=o.getCenter(new P),c=o.getSize(new P);s.position.copy(l).add(n.clone().multiplyScalar(Math.max(c.x,c.y,c.z))),s.lookAt(l),e&&e.traverseVisible(d=>{d.layers.enable(i)}),i>0?s.layers.set(i):s.layers.enableAll(),r.setRenderTarget(null),r.clear(),typeof r.renderWithModes=="function"?r.renderWithModes({backgroundRender:!1},()=>{r.render(t??e,s)}):r.render(t??e,s);const h=r.domElement.toDataURL("image/png");return r.clear(),e.visible=a,e.traverseVisible(d=>{d.layers.disable(i)}),s.layers.enableAll(),h}class Mx{constructor(){this._lights=[],this.shapes={sphere:new Fe(new Gs(1)),cube:new Fe(new Bi(1,1,1)),cylinder:new Fe(new kr(.5,.5,1))};const e=new Nl;this._channel=7;const t=new mf(16777215,4473924,1);t.position.set(0,10,0),t.layers.set(this._channel),e.add(t),this._lights.push(t),this._scene=e}dispose(){[...this._lights].forEach(e=>e.dispose()),Object.values(this.shapes).forEach(e=>{e.geometry&&e.geometry.dispose()})}generate(e,t,i,n="sphere"){const s=this.shapes[n]||new Fe(new Gs(1));s.material=e,s.geometry.attributes.tangent||s.geometry.computeTangents(),this._scene.add(s),this._scene.environment=i??null;const a=e.envMapIntensity;typeof a=="number"&&(e.envMapIntensity=Math.max(a,2));const o=w0(t,s,this._scene,this._channel,new P(0,0,1.5));return typeof a=="number"&&(e.envMapIntensity=a),this._scene.remove(s),s.material=void 0,o}}const Sx=new Yi,Ff=new P;class il extends Uv{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],i=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(i),this.setAttribute("position",new Ne(e,3)),this.setAttribute("uv",new Ne(t,2))}applyMatrix4(e){const t=this.attributes.instanceStart,i=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),i.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new Ep(t,6,1);return this.setAttribute("instanceStart",new Vr(i,3,0)),this.setAttribute("instanceEnd",new Vr(i,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new Ep(t,6,1);return this.setAttribute("instanceColorStart",new Vr(i,3,0)),this.setAttribute("instanceColorEnd",new Vr(i,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new pf(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Yi);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),Sx.setFromBufferAttribute(t),this.boundingBox.union(Sx))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new zr),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const i=this.boundingSphere.center;this.boundingBox.getCenter(i);let n=0;for(let s=0,a=e.count;s<a;s++)Ff.fromBufferAttribute(e,s),n=Math.max(n,i.distanceToSquared(Ff)),Ff.fromBufferAttribute(t,s),n=Math.max(n,i.distanceToSquared(Ff));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}qe.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new ne(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},Vi.line={uniforms:Dn.merge([qe.common,qe.fog,qe.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class Pp extends yr{constructor(e){super({type:"LineMaterial",uniforms:Dn.clone(Vi.line.uniforms),vertexShader:Vi.line.vertexShader,fragmentShader:Vi.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(t){!!t!="USE_DASH"in this.defines&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(t){!!t!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),t===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const Tx=new P,Ix=new P,jr=new bt,Hr=new bt,Aa=new bt,x0=new P,E0=new et,Wr=new ww,Px=new P,Nf=new Yi,Gf=new zr,va=new bt;let ya,sc;function Rx(r,e,t){return va.set(0,0,-e,1).applyMatrix4(r.projectionMatrix),va.multiplyScalar(1/va.w),va.x=sc/t.width,va.y=sc/t.height,va.applyMatrix4(r.projectionMatrixInverse),va.multiplyScalar(1/va.w),Math.abs(Math.max(va.x,va.y))}function dD(r,e){const t=r.matrixWorld,i=r.geometry,n=i.attributes.instanceStart,s=i.attributes.instanceEnd,a=Math.min(i.instanceCount,n.count);for(let o=0,l=a;o<l;o++){Wr.start.fromBufferAttribute(n,o),Wr.end.fromBufferAttribute(s,o),Wr.applyMatrix4(t);const c=new P,h=new P;ya.distanceSqToSegment(Wr.start,Wr.end,h,c),h.distanceTo(c)<sc*.5&&e.push({point:h,pointOnLine:c,distance:ya.origin.distanceTo(h),object:r,face:null,faceIndex:o,uv:null,uv1:null})}}function mD(r,e,t){const i=e.projectionMatrix,n=r.material.resolution,s=r.matrixWorld,a=r.geometry,o=a.attributes.instanceStart,l=a.attributes.instanceEnd,c=Math.min(a.instanceCount,o.count),h=-e.near;ya.at(1,Aa),Aa.w=1,Aa.applyMatrix4(e.matrixWorldInverse),Aa.applyMatrix4(i),Aa.multiplyScalar(1/Aa.w),Aa.x*=n.x/2,Aa.y*=n.y/2,Aa.z=0,x0.copy(Aa),E0.multiplyMatrices(e.matrixWorldInverse,s);for(let d=0,m=c;d<m;d++){if(jr.fromBufferAttribute(o,d),Hr.fromBufferAttribute(l,d),jr.w=1,Hr.w=1,jr.applyMatrix4(E0),Hr.applyMatrix4(E0),jr.z>h&&Hr.z>h)continue;if(jr.z>h){const y=jr.z-Hr.z,E=(jr.z-h)/y;jr.lerp(Hr,E)}else if(Hr.z>h){const y=Hr.z-jr.z,E=(Hr.z-h)/y;Hr.lerp(jr,E)}jr.applyMatrix4(i),Hr.applyMatrix4(i),jr.multiplyScalar(1/jr.w),Hr.multiplyScalar(1/Hr.w),jr.x*=n.x/2,jr.y*=n.y/2,Hr.x*=n.x/2,Hr.y*=n.y/2,Wr.start.copy(jr),Wr.start.z=0,Wr.end.copy(Hr),Wr.end.z=0;const f=Wr.closestPointToPointParameter(x0,!0);Wr.at(f,Px);const v=Zt.lerp(jr.z,Hr.z,f),w=v>=-1&&v<=1,b=x0.distanceTo(Px)<sc*.5;if(w&&b){Wr.start.fromBufferAttribute(o,d),Wr.end.fromBufferAttribute(l,d),Wr.start.applyMatrix4(s),Wr.end.applyMatrix4(s);const y=new P,E=new P;ya.distanceSqToSegment(Wr.start,Wr.end,E,y),t.push({point:E,pointOnLine:y,distance:ya.origin.distanceTo(E),object:r,face:null,faceIndex:d,uv:null,uv1:null})}}}class Rp extends Fe{constructor(e=new il,t=new Pp({color:Math.random()*16777215})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,i=e.attributes.instanceEnd,n=new Float32Array(2*t.count);for(let a=0,o=0,l=t.count;a<l;a++,o+=2)Tx.fromBufferAttribute(t,a),Ix.fromBufferAttribute(i,a),n[o]=o===0?0:n[o-1],n[o+1]=n[o]+Tx.distanceTo(Ix);const s=new Ep(n,2,1);return e.setAttribute("instanceDistanceStart",new Vr(s,1,0)),e.setAttribute("instanceDistanceEnd",new Vr(s,1,1)),this}raycast(e,t){const i=this.material.worldUnits,n=e.camera;n===null&&!i&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const s=e.params.Line2!==void 0&&e.params.Line2.threshold||0;ya=e.ray;const a=this.matrixWorld,o=this.geometry,l=this.material;sc=l.linewidth+s,o.boundingSphere===null&&o.computeBoundingSphere(),Gf.copy(o.boundingSphere).applyMatrix4(a);let c;if(i)c=sc*.5;else{const d=Math.max(n.near,Gf.distanceToPoint(ya.origin));c=Rx(n,d,l.resolution)}if(Gf.radius+=c,ya.intersectsSphere(Gf)===!1)return;o.boundingBox===null&&o.computeBoundingBox(),Nf.copy(o.boundingBox).applyMatrix4(a);let h;if(i)h=sc*.5;else{const d=Math.max(n.near,Nf.distanceToPoint(ya.origin));h=Rx(n,d,l.resolution)}Nf.expandByScalar(h),ya.intersectsBox(Nf)!==!1&&(i?dD(this,t):mD(this,n,t))}}var fD=Object.defineProperty,gD=(r,e,t,i)=>{for(var n=void 0,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=a(e,t,n)||n);return n&&fD(e,t,n),n};const[Dx,Bx,Lx,Ux,Ox,kx]=Array(6).fill(0).map((r,e)=>e),zf=[new fe(16725587),new fe(9100032),new fe(2920447)],AD=new _f,rl=new P,ac=new Ct,Qf=new Ct,C0=new Ct,Dp=new P,vD=2*Math.PI,Fx=new wf,M0=new ne,Bp=new It;let S0=0;class T0 extends It{constructor(e,t,i="bottom-right",n=128,s=2){super(),this.orthoCamera=new ua(-1.8,1.8,1.8,-1.8,0,4),this.isViewHelper=!0,this.animating=!1,this.target=new P,this.viewport=new bt,this.offsetHeight=0,this.renderer=new sp({canvas:document.createElement("canvas"),alpha:!0,antialias:!0,preserveDrawingBuffer:!1}),this.renderer.setPixelRatio(s),this.camera=e,this.domElement=t,this.orthoCamera.position.set(0,0,2),this.backgroundSphere=bD(),this.axesLines=_D(),this.spritePoints=wD(),this.add(this.backgroundSphere,this.axesLines,...this.spritePoints),this.domContainer=yD(i,n),this.domContainer.appendChild(this.renderer.domElement),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.domElement.parentElement.appendChild(this.domContainer),this.domRect=this.domContainer.getBoundingClientRect(),this.startListening(),this.update(),this.updateOrientation()}startListening(){this.domContainer.onpointermove=e=>this.onPointerMove(e),this.domContainer.onpointerleave=e=>this.onPointerLeave(e),this.domContainer.onclick=e=>this.handleClick(e)}onPointerMove(e){this.backgroundSphere.material.opacity=.4,this.handleHover(e),this.dispatchEvent({type:"update",event:e})}onPointerLeave(e){this.backgroundSphere.material.opacity=.2,zx(this.spritePoints),this.domContainer.style.cursor="",this.dispatchEvent({type:"update",event:e})}handleClick(e){const t=Gx(e,this.domRect,this.orthoCamera,this.spritePoints);t&&this.setOrientation(t.userData.type)}handleHover(e){const t=Gx(e,this.domRect,this.orthoCamera,this.spritePoints);zx(this.spritePoints),t?(t.material.map.offset.x=.5,t.scale.multiplyScalar(1.2),this.domContainer.style.cursor="pointer"):this.domContainer.style.cursor=""}render(){const e=AD.getDelta();this.animating&&this.animate(Math.min(e,1/30));const t=this.renderer.autoClear;this.renderer.autoClear=!1,this.renderer.render(this,this.orthoCamera),this.renderer.autoClear=t}updateOrientation(e=!0){e&&(this.quaternion.copy(this.camera.quaternion).invert(),this.updateMatrixWorld()),SD(this.spritePoints,this.camera)}update(){this.domRect=this.domContainer.getBoundingClientRect(),this.offsetHeight=this.domElement.offsetHeight,Nx(this.camera,this.target),this.renderer.getViewport(this.viewport),this.updateOrientation()}animate(e){const t=e*vD;Qf.rotateTowards(C0,t),this.camera.position.set(0,0,1).applyQuaternion(Qf).multiplyScalar(S0).add(this.target),this.camera.quaternion.rotateTowards(ac,t),this.updateOrientation(),Qf.angleTo(C0)===0&&(this.animating=!1)}setOrientation(e){ED(this.camera,this.target,e),this.animating=!0,this.dispatchEvent({type:"update"})}dispose(){this.axesLines.geometry.dispose(),this.axesLines.material.dispose(),this.backgroundSphere.geometry.dispose(),this.backgroundSphere.material.dispose(),this.spritePoints.forEach(e=>{e.material.map.dispose(),e.material.dispose()}),this.domContainer.remove()}}gD([Yw()],T0.prototype,"animating");function yD(r,e){const t=document.createElement("div"),i=t.style;i.height=`${e}px`,i.width=`${e}px`,i.borderRadius="100%",i.position="absolute";const[n,s]=r.split("-");return i.transform="",i.left=s==="left"?"0":s==="center"?"50%":"",i.right=s==="right"?"0":"",i.transform+=s==="center"?"translateX(-50%)":"",i.top=n==="top"?"0":n==="bottom"?"":"50%",i.bottom=n==="bottom"?"0":"",i.transform+=n==="center"?"translateY(-50%)":"",t}function _D(){const r=Array(3).fill(0).map((i,n)=>[n?0:.9,n===1?.9:0,n===2?.9:0,0,0,0]).flat(),e=Array(6).fill(0).map((i,n)=>n<2?zf[0].toArray():n<4?zf[1].toArray():zf[2].toArray()).flat(),t=new il;return t.setPositions(r),t.setColors(e),new Rp(t,new Pp({linewidth:.02,vertexColors:!0}))}function bD(){const r=new Gs(1.6);return new Fe(r,new Pn({color:16777215,side:$e,transparent:!0,opacity:.2,depthTest:!1}))}function wD(){const r=["x","y","z"];return Array(6).fill(0).map((e,t)=>{const i=t<3,n=i?"+":"-",s=r[t%3],a=zf[t%3],o=new Om(xD(a,i?s:null));return o.userData.type=`${n}${s}`,o.scale.setScalar(i?.6:.4),o.position[s]=i?1.2:-1.2,o.renderOrder=1,o})}function xD(r,e=null){const t=document.createElement("canvas"),i=0,n=1,s=0;t.width=128*n+4*i+s*2,t.height=64*n+2*i+s*2;const a=t.getContext("2d",{alpha:!0});a.beginPath(),a.arc(32*n+i,32*n+i,32*n-i,0,2*Math.PI),a.closePath(),a.fillStyle=r.getStyle(),a.fill(),a.beginPath(),a.arc(32*n+i,32*n+i,35*n-i,0,2*Math.PI),a.closePath(),a.fillStyle="#"+r.getHexString()+"01",a.fill(),a.beginPath(),a.arc(96*n+i*3+s,32*n+i+s,32*n-i-s,0,2*Math.PI),a.closePath(),a.fillStyle="#FFF",a.fill(),a.beginPath(),a.arc(96*n+i*3+s,32*n+i+s,35+n-i-s,0,2*Math.PI),a.closePath(),a.fillStyle="#FFFFFF01",a.fill(),e!==null&&(a.font="bold calc(44px * "+n+") Arial",a.textAlign="center",a.fillStyle="#111",a.fillText(e.toUpperCase(),32*n+i,48*n+i),a.fillText(e.toUpperCase(),96*n+i*3+s,48*n+i+s));const o=new jm(t);return o.wrapS=o.wrapT=Ar,o.repeat.x=.5,o.colorSpace=it,o.minFilter=Et,o.magFilter=Et,o.generateMipmaps=!1,o.needsUpdate=!0,new ap({map:o,toneMapped:!1,transparent:!0})}function ED(r,e,t){switch(t){case"+x":rl.set(1,0,0),ac.setFromEuler(new Di(0,Math.PI*.5,0));break;case"+y":rl.set(0,1,0),ac.setFromEuler(new Di(-Math.PI*.5,0,0));break;case"+z":rl.set(0,0,1),ac.setFromEuler(new Di);break;case"-x":rl.set(-1,0,0),ac.setFromEuler(new Di(0,-Math.PI*.5,0));break;case"-y":rl.set(0,-1,0),ac.setFromEuler(new Di(Math.PI*.5,0,0));break;case"-z":rl.set(0,0,-1),ac.setFromEuler(new Di(0,Math.PI,0));break;default:console.error("ViewHelper: Invalid axis.")}Nx(r,e),CD(r,e)}function Nx(r,e){S0=r.position.distanceTo(e)}function CD(r,e){rl.multiplyScalar(S0).add(e),Bp.position.copy(e),Bp.lookAt(r.position),Qf.copy(Bp.quaternion),Bp.lookAt(rl),C0.copy(Bp.quaternion)}function MD(r,e,t){M0.x=(r.clientX-e.left)/e.width*2-1,M0.y=-((r.clientY-e.top)/e.height)*2+1,Fx.setFromCamera(M0,t)}function Gx(r,e,t,i){MD(r,e,t);const n=Fx.intersectObjects(i);return n.length?n[0].object:null}function zx(r){let e=r.length;for(;e--;){const t=e<3?.6:.4;r[e].scale.set(t,t,t),r[e].material.map.offset.x=1}}function SD(r,e){Dp.set(0,0,1),Dp.applyQuaternion(e.quaternion),Dp.x>=0?(r[Dx].material.opacity=1,r[Ux].material.opacity=.5):(r[Dx].material.opacity=.5,r[Ux].material.opacity=1),Dp.y>=0?(r[Bx].material.opacity=1,r[Ox].material.opacity=.5):(r[Bx].material.opacity=.5,r[Ox].material.opacity=1),Dp.z>=0?(r[Lx].material.opacity=1,r[kx].material.opacity=.5):(r[Lx].material.opacity=.5,r[kx].material.opacity=1)}function Qx(r,e){var t={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(r);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(r,i[n])&&(t[i[n]]=r[i[n]]);return t}var Vx=function(){};const I0=(r,e,t)=>Math.min(Math.max(t,r),e),P0=.001,TD=.01,ID=10,PD=.05,RD=1;function DD({duration:r=800,bounce:e=.25,velocity:t=0,mass:i=1}){let n,s,a=1-e;a=I0(PD,RD,a),r=I0(TD,ID,r/1e3),a<1?(n=c=>{const h=c*a,d=h*r,m=h-t,f=R0(c,a),v=Math.exp(-d);return P0-m/f*v},s=c=>{const h=c*a*r,d=h*t+t,m=Math.pow(a,2)*Math.pow(c,2)*r,f=Math.exp(-h),v=R0(Math.pow(c,2),a);return(-n(c)+P0>0?-1:1)*((d-m)*f)/v}):(n=c=>{const h=Math.exp(-c*r),d=(c-t)*r+1;return-P0+h*d},s=c=>{const h=Math.exp(-c*r),d=(t-c)*(r*r);return h*d});const o=5/r,l=LD(n,s,o);if(r=r*1e3,isNaN(l))return{stiffness:100,damping:10,duration:r};{const c=Math.pow(l,2)*i;return{stiffness:c,damping:a*2*Math.sqrt(i*c),duration:r}}}const BD=12;function LD(r,e,t){let i=t;for(let n=1;n<BD;n++)i=i-r(i)/e(i);return i}function R0(r,e){return r*Math.sqrt(1-e*e)}const UD=["duration","bounce"],OD=["stiffness","damping","mass"];function jx(r,e){return e.some(t=>r[t]!==void 0)}function kD(r){let e=Object.assign({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},r);if(!jx(r,OD)&&jx(r,UD)){const t=DD(r);e=Object.assign(Object.assign(Object.assign({},e),t),{velocity:0,mass:1}),e.isResolvedFromDuration=!0}return e}function D0(r){var{from:e=0,to:t=1,restSpeed:i=2,restDelta:n}=r,s=Qx(r,["from","to","restSpeed","restDelta"]);const a={done:!1,value:e};let{stiffness:o,damping:l,mass:c,velocity:h,duration:d,isResolvedFromDuration:m}=kD(s),f=Hx,v=Hx;function w(){const b=h?-(h/1e3):0,y=t-e,E=l/(2*Math.sqrt(o*c)),_=Math.sqrt(o/c)/1e3;if(n===void 0&&(n=Math.min(Math.abs(t-e)/100,.4)),E<1){const C=R0(_,E);f=M=>{const S=Math.exp(-E*_*M);return t-S*((b+E*_*y)/C*Math.sin(C*M)+y*Math.cos(C*M))},v=M=>{const S=Math.exp(-E*_*M);return E*_*S*(Math.sin(C*M)*(b+E*_*y)/C+y*Math.cos(C*M))-S*(Math.cos(C*M)*(b+E*_*y)-C*y*Math.sin(C*M))}}else if(E===1)f=C=>t-Math.exp(-_*C)*(y+(b+_*y)*C);else{const C=_*Math.sqrt(E*E-1);f=M=>{const S=Math.exp(-E*_*M),R=Math.min(C*M,300);return t-S*((b+E*_*y)*Math.sinh(R)+C*y*Math.cosh(R))/C}}}return w(),{next:b=>{const y=f(b);if(m)a.done=b>=d;else{const E=v(b)*1e3,_=Math.abs(E)<=i,C=Math.abs(t-y)<=n;a.done=_&&C}return a.value=a.done?t:y,a},flipTarget:()=>{h=-h,[e,t]=[t,e],w()}}}D0.needsInterpolation=(r,e)=>typeof r=="string"||typeof e=="string";const Hx=r=>0,Wx=(r,e,t)=>{const i=e-r;return i===0?1:(t-r)/i},B0=(r,e,t)=>-t*r+t*e+r,Xx=(r,e)=>t=>Math.max(Math.min(t,e),r),Lp=r=>r%1?Number(r.toFixed(5)):r,Vf=/(-)?([\d]*\.?[\d])+/g,L0=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,FD=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function Up(r){return typeof r=="string"}const jf={test:r=>typeof r=="number",parse:parseFloat,transform:r=>r},qx=Object.assign(Object.assign({},jf),{transform:Xx(0,1)});Object.assign(Object.assign({},jf),{default:1});const Op=(r=>({test:e=>Up(e)&&e.endsWith(r)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${r}`}))("%");Object.assign(Object.assign({},Op),{parse:r=>Op.parse(r)/100,transform:r=>Op.transform(r*100)});const U0=(r,e)=>t=>!!(Up(t)&&FD.test(t)&&t.startsWith(r)||e&&Object.prototype.hasOwnProperty.call(t,e)),Yx=(r,e,t)=>i=>{if(!Up(i))return i;const[n,s,a,o]=i.match(Vf);return{[r]:parseFloat(n),[e]:parseFloat(s),[t]:parseFloat(a),alpha:o!==void 0?parseFloat(o):1}},oc={test:U0("hsl","hue"),parse:Yx("hue","saturation","lightness"),transform:({hue:r,saturation:e,lightness:t,alpha:i=1})=>"hsla("+Math.round(r)+", "+Op.transform(Lp(e))+", "+Op.transform(Lp(t))+", "+Lp(qx.transform(i))+")"},ND=Xx(0,255),O0=Object.assign(Object.assign({},jf),{transform:r=>Math.round(ND(r))}),nl={test:U0("rgb","red"),parse:Yx("red","green","blue"),transform:({red:r,green:e,blue:t,alpha:i=1})=>"rgba("+O0.transform(r)+", "+O0.transform(e)+", "+O0.transform(t)+", "+Lp(qx.transform(i))+")"};function GD(r){let e="",t="",i="",n="";return r.length>5?(e=r.substr(1,2),t=r.substr(3,2),i=r.substr(5,2),n=r.substr(7,2)):(e=r.substr(1,1),t=r.substr(2,1),i=r.substr(3,1),n=r.substr(4,1),e+=e,t+=t,i+=i,n+=n),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(i,16),alpha:n?parseInt(n,16)/255:1}}const k0={test:U0("#"),parse:GD,transform:nl.transform},Hf={test:r=>nl.test(r)||k0.test(r)||oc.test(r),parse:r=>nl.test(r)?nl.parse(r):oc.test(r)?oc.parse(r):k0.parse(r),transform:r=>Up(r)?r:r.hasOwnProperty("red")?nl.transform(r):oc.transform(r)},Kx="${c}",Jx="${n}";function zD(r){var e,t,i,n;return isNaN(r)&&Up(r)&&((t=(e=r.match(Vf))===null||e===void 0?void 0:e.length)!==null&&t!==void 0?t:0)+((n=(i=r.match(L0))===null||i===void 0?void 0:i.length)!==null&&n!==void 0?n:0)>0}function Zx(r){typeof r=="number"&&(r=`${r}`);const e=[];let t=0;const i=r.match(L0);i&&(t=i.length,r=r.replace(L0,Kx),e.push(...i.map(Hf.parse)));const n=r.match(Vf);return n&&(r=r.replace(Vf,Jx),e.push(...n.map(jf.parse))),{values:e,numColors:t,tokenised:r}}function $x(r){return Zx(r).values}function e1(r){const{values:e,numColors:t,tokenised:i}=Zx(r),n=e.length;return s=>{let a=i;for(let o=0;o<n;o++)a=a.replace(o<t?Kx:Jx,o<t?Hf.transform(s[o]):Lp(s[o]));return a}}const QD=r=>typeof r=="number"?0:r;function VD(r){const e=$x(r);return e1(r)(e.map(QD))}const t1={test:zD,parse:$x,createTransformer:e1,getAnimatableNone:VD};function F0(r,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?r+(e-r)*6*t:t<1/2?e:t<2/3?r+(e-r)*(2/3-t)*6:r}function i1({hue:r,saturation:e,lightness:t,alpha:i}){r/=360,e/=100,t/=100;let n=0,s=0,a=0;if(!e)n=s=a=t;else{const o=t<.5?t*(1+e):t+e-t*e,l=2*t-o;n=F0(l,o,r+1/3),s=F0(l,o,r),a=F0(l,o,r-1/3)}return{red:Math.round(n*255),green:Math.round(s*255),blue:Math.round(a*255),alpha:i}}const jD=(r,e,t)=>{const i=r*r,n=e*e;return Math.sqrt(Math.max(0,t*(n-i)+i))},HD=[k0,nl,oc],r1=r=>HD.find(e=>e.test(r)),n1=(r,e)=>{let t=r1(r),i=r1(e),n=t.parse(r),s=i.parse(e);t===oc&&(n=i1(n),t=nl),i===oc&&(s=i1(s),i=nl);const a=Object.assign({},n);return o=>{for(const l in a)l!=="alpha"&&(a[l]=jD(n[l],s[l],o));return a.alpha=B0(n.alpha,s.alpha,o),t.transform(a)}},WD=r=>typeof r=="number",XD=(r,e)=>t=>e(r(t)),s1=(...r)=>r.reduce(XD);function a1(r,e){return WD(r)?t=>B0(r,e,t):Hf.test(r)?n1(r,e):c1(r,e)}const o1=(r,e)=>{const t=[...r],i=t.length,n=r.map((s,a)=>a1(s,e[a]));return s=>{for(let a=0;a<i;a++)t[a]=n[a](s);return t}},qD=(r,e)=>{const t=Object.assign(Object.assign({},r),e),i={};for(const n in t)r[n]!==void 0&&e[n]!==void 0&&(i[n]=a1(r[n],e[n]));return n=>{for(const s in i)t[s]=i[s](n);return t}};function l1(r){const e=t1.parse(r),t=e.length;let i=0,n=0,s=0;for(let a=0;a<t;a++)i||typeof e[a]=="number"?i++:e[a].hue!==void 0?s++:n++;return{parsed:e,numNumbers:i,numRGB:n,numHSL:s}}const c1=(r,e)=>{const t=t1.createTransformer(e),i=l1(r),n=l1(e);return i.numHSL===n.numHSL&&i.numRGB===n.numRGB&&i.numNumbers>=n.numNumbers?s1(o1(i.parsed,n.parsed),t):s=>`${s>0?e:r}`},YD=(r,e)=>t=>B0(r,e,t);function KD(r){if(typeof r=="number")return YD;if(typeof r=="string")return Hf.test(r)?n1:c1;if(Array.isArray(r))return o1;if(typeof r=="object")return qD}function JD(r,e,t){const i=[],n=t||KD(r[0]),s=r.length-1;for(let a=0;a<s;a++){let o=n(r[a],r[a+1]);if(e){const l=Array.isArray(e)?e[a]:e;o=s1(l,o)}i.push(o)}return i}function ZD([r,e],[t]){return i=>t(Wx(r,e,i))}function $D(r,e){const t=r.length,i=t-1;return n=>{let s=0,a=!1;if(n<=r[0]?a=!0:n>=r[i]&&(s=i-1,a=!0),!a){let l=1;for(;l<t&&!(r[l]>n||l===i);l++);s=l-1}const o=Wx(r[s],r[s+1],n);return e[s](o)}}function h1(r,e,{clamp:t=!0,ease:i,mixer:n}={}){const s=r.length;Vx(s===e.length),Vx(!i||!Array.isArray(i)||i.length===s-1),r[0]>r[s-1]&&(r=[].concat(r),e=[].concat(e),r.reverse(),e.reverse());const a=JD(e,i,n),o=s===2?ZD(r,a):$D(r,a);return t?l=>o(I0(r[0],r[s-1],l)):o}const Wf=r=>e=>1-r(1-e),N0=r=>e=>e<=.5?r(2*e)/2:(2-r(2*(1-e)))/2,eB=r=>e=>Math.pow(e,r),u1=r=>e=>e*e*((r+1)*e-r),tB=r=>{const e=u1(r);return t=>(t*=2)<1?.5*e(t):.5*(2-Math.pow(2,-10*(t-1)))},p1=1.525,iB=4/11,rB=8/11,nB=9/10,sB=r=>r,G0=eB(2),aB=Wf(G0),d1=N0(G0),m1=r=>1-Math.sin(Math.acos(r)),f1=Wf(m1),oB=N0(f1),z0=u1(p1),lB=Wf(z0),cB=N0(z0),hB=tB(p1),uB=4356/361,pB=35442/1805,dB=16061/1805,Xf=r=>{if(r===1||r===0)return r;const e=r*r;return r<iB?7.5625*e:r<rB?9.075*e-9.9*r+3.4:r<nB?uB*e-pB*r+dB:10.8*r*r-20.52*r+10.72},mB=Wf(Xf),fB=r=>r<.5?.5*(1-Xf(1-r*2)):.5*Xf(r*2-1)+.5;function gB(r,e){return r.map(()=>e||d1).splice(0,r.length-1)}function AB(r){const e=r.length;return r.map((t,i)=>i!==0?i/(e-1):0)}function vB(r,e){return r.map(t=>t*e)}function qf({from:r=0,to:e=1,ease:t,offset:i,duration:n=300}){const s={done:!1,value:r},a=Array.isArray(e)?e:[r,e],o=vB(i&&i.length===a.length?i:AB(a),n);function l(){return h1(o,a,{ease:Array.isArray(t)?t:gB(a,t)})}let c=l();return{next:h=>(s.value=c(h),s.done=h>=n,s),flipTarget:()=>{a.reverse(),c=l()}}}function yB({velocity:r=0,from:e=0,power:t=.8,timeConstant:i=350,restDelta:n=.5,modifyTarget:s}){const a={done:!1,value:e};let o=t*r;const l=e+o,c=s===void 0?l:s(l);return c!==l&&(o=c-e),{next:h=>{const d=-o*Math.exp(-h/i);return a.done=!(d>n||d<-n),a.value=a.done?c:c+d,a},flipTarget:()=>{}}}const g1={keyframes:qf,spring:D0,decay:yB};function _B(r){if(Array.isArray(r.to))return qf;if(g1[r.type])return g1[r.type];const e=new Set(Object.keys(r));return e.has("ease")||e.has("duration")&&!e.has("dampingRatio")?qf:e.has("dampingRatio")||e.has("stiffness")||e.has("mass")||e.has("damping")||e.has("restSpeed")||e.has("restDelta")?D0:qf}const A1=1/60*1e3,bB=typeof performance<"u"?()=>performance.now():()=>Date.now(),v1=typeof window<"u"?r=>window.requestAnimationFrame(r):r=>setTimeout(()=>r(bB()),A1);function wB(r){let e=[],t=[],i=0,n=!1,s=!1;const a=new WeakSet,o={schedule:(l,c=!1,h=!1)=>{const d=h&&n,m=d?e:t;return c&&a.add(l),m.indexOf(l)===-1&&(m.push(l),d&&n&&(i=e.length)),l},cancel:l=>{const c=t.indexOf(l);c!==-1&&t.splice(c,1),a.delete(l)},process:l=>{if(n){s=!0;return}if(n=!0,[e,t]=[t,e],t.length=0,i=e.length,i)for(let c=0;c<i;c++){const h=e[c];h(l),a.has(h)&&(o.schedule(h),r())}n=!1,s&&(s=!1,o.process(l))}};return o}const xB=40;let Q0=!0,kp=!1,V0=!1;const Fp={delta:0,timestamp:0},Np=["read","update","preRender","render","postRender"],Yf=Np.reduce((r,e)=>(r[e]=wB(()=>kp=!0),r),{}),EB=Np.reduce((r,e)=>{const t=Yf[e];return r[e]=(i,n=!1,s=!1)=>(kp||SB(),t.schedule(i,n,s)),r},{}),CB=Np.reduce((r,e)=>(r[e]=Yf[e].cancel,r),{});Np.reduce((r,e)=>(r[e]=()=>Yf[e].process(Fp),r),{});const MB=r=>Yf[r].process(Fp),y1=r=>{kp=!1,Fp.delta=Q0?A1:Math.max(Math.min(r-Fp.timestamp,xB),1),Fp.timestamp=r,V0=!0,Np.forEach(MB),V0=!1,kp&&(Q0=!1,v1(y1))},SB=()=>{kp=!0,Q0=!0,V0||v1(y1)};function _1(r,e,t=0){return r-e-t}function TB(r,e,t=0,i=!0){return i?_1(e+-r,e,t):e-(r-e)+t}function IB(r,e,t,i){return i?r>=e+t:r<=-t}const PB=r=>{const e=({delta:t})=>r(t);return{start:()=>EB.update(e,!0),stop:()=>CB.update(e)}};function j0(r){var e,t,{from:i,autoplay:n=!0,driver:s=PB,elapsed:a=0,repeat:o=0,repeatType:l="loop",repeatDelay:c=0,onPlay:h,onStop:d,onComplete:m,onRepeat:f,onUpdate:v}=r,w=Qx(r,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]);let{to:b}=w,y,E=0,_=w.duration,C,M=!1,S=!0,R;const U=_B(w);!((t=(e=U).needsInterpolation)===null||t===void 0)&&t.call(e,i,b)&&(R=h1([0,100],[i,b],{clamp:!1}),i=0,b=100);const T=U(Object.assign(Object.assign({},w),{from:i,to:b}));function B(){E++,l==="reverse"?(S=E%2===0,a=TB(a,_,c,S)):(a=_1(a,_,c),l==="mirror"&&T.flipTarget()),M=!1,f&&f()}function Q(){y.stop(),m&&m()}function Z(X){if(S||(X=-X),a+=X,!M){const te=T.next(Math.max(0,a));C=te.value,R&&(C=R(C)),M=S?te.done:a<=0}v==null||v(C),M&&(E===0&&(_??(_=a)),E<o?IB(a,_,c,S)&&B():Q())}function q(){h==null||h(),y=s(Z),y.start()}return n&&q(),{stop:()=>{d==null||d(),y.stop()}}}function RB(r){return-(Math.cos(Math.PI*r)-1)/2}const Kf={linear:sB,easeIn:G0,easeOut:aB,easeInOut:d1,circIn:m1,circOut:f1,circInOut:oB,backIn:z0,backOut:lB,backInOut:cB,anticipate:hB,bounceOut:Xf,bounceIn:mB,bounceInOut:fB,easeInOutSine:RB};function H0(r,e,t){const i=r[e],n=()=>{typeof(r==null?void 0:r.setDirty)=="function"&&r.setDirty(),t==null||t()};return i&&typeof i.copy=="function"?s=>{i.copy(s),n()}:s=>{r[e]=s,n()}}async function DB(r,e,t,i){e in r||console.error("invalid key",e,r);const n=H0(r,e),s=r[e],a=o=>{n(o),t.onUpdate&&t.onUpdate(o)};if(typeof s=="boolean"){const{duration:o}=t;return cs(o??0).then(()=>a(t.to))}else return typeof t.to=="function"&&(t={...t,to:t.to(s,r)}),b1({...t,from:s,onUpdate:a},i)}async function b1(r,e){const t=r.onComplete,i=r.onStop,n=r.onEnd;return r={...r},new Promise((s,a)=>{const o=()=>{try{n==null||n()}catch(c){return a(c),!1}return!0};r.onComplete=()=>{try{t==null||t()}catch(c){if(!o())return;a(c);return}o()&&s()},r.onStop=()=>{try{i==null||i()}catch(c){if(!o())return;a(c);return}o()&&s()};const l=j0(r);e&&e.push(l)})}function W0(r,e,t){const i=e-r;return i>=Math.PI?r+(i-Math.PI*2)*t:i<=-Math.PI?r+(i+Math.PI*2)*t:r+i*t}const Jf=Zt.lerp;function X0(r){const e=r.position.clone();e.sub(r.target);const t=new ic().setFromVector3(e);return t.makeSafe(),t}function w1(r,e){const t=r.parent,i=r.target.clone(),n=r.getWorldPosition(new P),s={position:n,target:i,zoom:r.zoom,spherical:X0({position:n,target:i})},a={position:new P,target:new P,zoom:1,spherical:new ic},o={position:e.position,target:e.target,zoom:e.zoom,spherical:X0(e)};function l(){r.position.copy(t?t.worldToLocal(a.position):a.position),r.target.copy(a.target),r.zoom=a.zoom,r.setDirty()}return{from:0,to:1,onUpdate:c=>{a.spherical.phi=W0(s.spherical.phi,o.spherical.phi,c),a.spherical.theta=W0(s.spherical.theta,o.spherical.theta,c),a.spherical.radius=Jf(s.spherical.radius,o.spherical.radius,c),a.target.copy(s.target).lerp(o.target,c),a.position.setFromSpherical(a.spherical),a.position.add(a.target),a.zoom=Jf(s.zoom,o.zoom,c),l()},onComplete:()=>{a.position.copy(o.position),a.target.copy(o.target),a.zoom=o.zoom,l()},onStop:()=>{throw new Error("Animation Stopped")}}}function x1(r,e){const t=r.parent,i=r.target.clone(),n=r.getWorldPosition(new P),s=r.getWorldQuaternion(new Ct),a={position:n,target:i,quaternion:s,zoom:r.zoom},o={position:new P,target:new P,quaternion:new Ct,zoom:1},l=e;function c(){r.position.copy(t?t.worldToLocal(o.position):o.position),r.target.copy(o.target),r.quaternion.copy(t?wx(t,o.quaternion,r.quaternion):o.quaternion),r.zoom=o.zoom,r.setDirty()}return{from:0,to:1,onUpdate:h=>{o.position.lerpVectors(a.position,l.position,h),o.target.lerpVectors(a.target,l.target,h),o.quaternion.slerpQuaternions(a.quaternion,l.quaternion,h),o.zoom=Jf(a.zoom,l.zoom,h),c()},onComplete:()=>{o.position.copy(l.position),o.target.copy(l.target),o.quaternion.copy(l.quaternion),o.zoom=l.zoom,c()},onStop:()=>{throw new Error("Animation Stopped")}}}function E1(r,e){return r.multiplyScalar(r.w*e),r.w=1,r}function BB(r,e){return E1(r,e),new fe(r.x,r.y,r.z)}function C1(r,e){const t=Math.max(r.x,Math.max(r.y,r.z));let i=Math.max(Math.min(t/e,1),0);return i=Math.ceil(i*255)/255,r.divideScalar(i*e),r.w=i,r}function LB(r,e){return C1(new bt(r.r,r.g,r.b,1),e)}const M1=class{static async GetClonedCanvas(e,{rect:t={x:0,y:0,width:e.width,height:e.height,assumeClientRect:!1},displayPixelRatio:i=1,scale:n=1}){var s,a,o;const l=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");l.width=t.width*n*i,l.height=t.height*n*i,t.assumeClientRect&&(t.x*=e.width/(i*e.clientWidth),t.y*=e.height/(i*e.clientHeight),t.width*=e.width/(i*e.clientWidth),t.height*=e.height/(i*e.clientHeight));const c=l.getContext("2d");if(!c)return console.error("snapshot: cannot create context"),l;const h=e.style.background||((s=e.parentElement)==null?void 0:s.style.background)||"";if(h.includes("url")){const d=(a=/url\("(.*)"\)/ig.exec(h))==null?void 0:a[1];if(d){const m=new Image;m.src=d,await new Promise((f,v)=>{m.onload=()=>f(),m.onerror=()=>v(),m.complete&&f()}),c.drawImage(m,m.width*t.x*i/e.width,m.height*t.y*i/e.height,m.width*t.width*i/e.width,m.height*t.height*i/e.height,0,0,l.width,l.height)}}else c.fillStyle=e.style.background||((o=e.parentElement)==null?void 0:o.style.backgroundColor)||"#00000000",c.fillRect(0,0,l.width,l.height);return c==null||c.drawImage(e,t.x*i,t.y*i,t.width*i,t.height*i,0,0,l.width,l.height),this.Debug&&(document.body.appendChild(l),l.style.position="absolute",l.style.top="0",l.style.left="0",l.style.borderWidth="2px",l.style.borderColor="#ff00ff",setTimeout(()=>l.remove(),5e3)),l}static async GetDataUrl(e,{mimeType:t="image/png",quality:i,...n}){const s=await this.GetClonedCanvas(e,n),a=s.toDataURL(t,i);return this.Debug||s.remove(),a}static async GetImage(e,t={}){const i=await this.GetDataUrl(e,t);return new Promise((n,s)=>{const a=new Image;a.onload=()=>n(a),a.onerror=()=>s(),a.src=i})}static async GetBlob(e,t={}){const i=await this.GetClonedCanvas(e,t),n=await new Promise((s,a)=>{i.toBlob(o=>{o?s(o):a()},t.mimeType??"image/png",t.quality)});return this.Debug||i.remove(),n}static async GetFile(e,t="image.png",i={}){return i.getDataUrl?await this.GetDataUrl(e,i):new File([await this.GetBlob(e,i)],t,{type:i.mimeType??"image/png",lastModified:nn()})}};M1.Debug=!1;let S1=M1;const T1=class extends zi{constructor(){super(...arguments),this._dirty=!1,this.uiConfig=void 0,this._viewerListeners={},this._onViewerEvent=e=>{var t,i;const n=e.eType;return n&&((i=(t=this._viewerListeners)[n])==null||i.call(t,e)),e},this._disabledBy=new Set,this.disable=e=>{const t=this._disabledBy.size;this._disabledBy.add(e),this.setDirty&&t!==this._disabledBy.size&&this.setDirty()},this.enable=e=>{const t=this._disabledBy.size;this._disabledBy.delete(e),this.setDirty&&t!==this._disabledBy.size&&this.setDirty()},this.isDisabled=()=>this._disabledBy.size>0||!this.enabled}dispose(){}toJSON(e){const t=Kt.Serialize(this,e,!0);return t.type=this.constructor.PluginType,t.assetType="config",this.dispatchEvent({type:"serialize",data:t}),t}fromJSON(e,t){return e.type!==this.constructor.PluginType&&e.type!==this.constructor.OldPluginType?null:(Kt.Deserialize(e,this,t,!0),this.dispatchEvent({type:"deserialize",data:e,meta:t}),this)}_storeKey(e){return(e??"webgi")+"_"+(this.constructor.PluginType||this.constructor.name)}exportState(){var e,t;return((e=this._viewer)==null?void 0:e.exportPluginConfig(this))??((t=this.toJSON)==null?void 0:t.call(this))}async importState(e){var t;this._viewer?await this._viewer.importPluginConfig(e,this):(t=this.fromJSON)==null||t.call(this,e)}get dirty(){return this.enabled&&this._dirty}set dirty(e){this._dirty=e}};T1.PluginType="AViewerPlugin";let q0=T1;class ei extends q0{onAdded(e){this._viewer=e,this._viewer.addEventListener("*",this._onViewerEvent)}onRemove(e){var t;this._viewer!==e&&e.console.error("Wrong viewer"),(t=this._viewer)==null||t.removeEventListener("*",this._onViewerEvent),this._viewer=void 0}}class UB extends q0{async onAdded(e){this._viewer=e,this._viewer.addEventListener("*",this._onViewerEvent)}async onRemove(e){var t;this._viewer!==e&&e.console.error("Wrong viewer"),(t=this._viewer)==null||t.removeEventListener("*",this._onViewerEvent),this._viewer=void 0}}/**
* @license
* uiconfig.js v0.0.12
* Copyright 2022-2024 repalash <palash@shaders.app>
* MIT License
*//**
* @license
* ts-browser-helpers v0.11.0
* Copyright 2022-2024 repalash <palash@shaders.app>
* MIT License
*/class OB{constructor(){this._eventListeners={},this.dispatchEvent=this.dispatchEvent.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.hasEventListener=this.hasEventListener.bind(this)}addEventListener(e,t){const i=this._eventListeners;i[e]===void 0&&(i[e]=[]),i[e].includes(t)||i[e].push(t)}hasEventListener(e,t){const i=this._eventListeners;return i[e]!==void 0&&i[e].includes(t)}removeEventListener(e,t){const i=this._eventListeners[e];if(i!==void 0){const n=i.indexOf(t);n!==-1&&i.splice(n,1)}}dispatchEvent(e){const t=this._eventListeners[e.type];if(t!==void 0){e.target=this;const i=t.slice(0);for(let n=0,s=i.length;n<s;n++)i[n].call(this,e)}}}async function kB(r){return new Promise(e=>setTimeout(e,Math.max(0,r)))}function FB(){return(typeof performance>"u"?Date:performance).now()}function NB({innerHTML:r="",id:e,classList:t,addToBody:i=!0,elementTag:n="div"}){const s=document.createElement(n);return e&&(s.id=e),s.innerHTML=r,t&&s.classList.add(...t),i&&document.body.appendChild(s),s}function GB(r,e){let t;do t=Object.getOwnPropertyDescriptor(r,e);while(!t&&(r=Object.getPrototypeOf(r)));return t}function zB(r,e,t=!0,i=!1){const n=GB(r,e);return!!(n!=null&&n.set)||t&&(n==null?void 0:n.writable)!==!1&&(n==null?void 0:n.get)===void 0||i&&!n}function QB(r,e,t,i=!0,n=!1){return r&&zB(r,e,i,n)?(r[e]=t,!0):!1}function sl(r,...e){return typeof r=="function"&&(r=r(...e)),r}function I1(){const r=(i,n)=>i.toString(16).padStart(n,"0"),e=crypto.getRandomValues(new Uint8Array(16));e[6]=e[6]&15|64,e[8]=e[8]&63|128;const t=new DataView(e.buffer);return`${r(t.getUint32(0),8)}-${r(t.getUint16(4),4)}-${r(t.getUint16(6),4)}-${r(t.getUint16(8),4)}-${r(t.getUint32(10),8)}${r(t.getUint16(14),4)}`}class Th{}Th.Map=new Map;function Y0(r,e,t,i){i=i??r[e];const n=i==null?void 0:i.uiConfig;let s;if(n)s=n;else{const a=VB(i);a==="folder"?s=Zf(e+"",i):a&&(s={type:a,label:e+"",property:[r,e]})}return t=t??e+"",s&&!s.label&&(s.label=t),s}function Ih(r){if(!r)return[];let e=r.constructor||Object;e===Array&&(e=Object);const t=[],i=[];for(;e&&e!==Object;)i.push(e),e=Object.getPrototypeOf(e);if(!i.length){const n=typeof r=="object"?Object.keys(r):Array.isArray(r)?r.map((s,a)=>a):[];for(const s of n){const a=r[s];if(a==null)continue;const o=()=>Y0(r,s,s+"",a);o&&t.push(o)}}return i.reverse().forEach(n=>{var s;(s=Th.Map.get(n))===null||s===void 0||s.forEach(({params:a,propKey:o,uiType:l})=>{let c;if(l||(c=()=>Y0(r,o)),c||(c={property:[r,o],type:l||"input"}),a){const h=typeof a.params=="function"?a.params(r):a.params||{},d=Object.assign({},a);if(delete d.params,typeof c=="function"){const m=c;c=()=>Object.assign(m(),Object.assign(Object.assign({},d),h))}Object.assign(c,Object.assign(Object.assign({},d),h))}t.push(c)})}),t}function Zf(r,e,t={},i="folder"){return Object.assign({type:i,label:r,children:Ih(e),uuid:I1()},t)}function VB(r){return r==null?null:Array.isArray(r)?"folder":typeof r=="boolean"?"checkbox":typeof r=="number"?"number":typeof r=="string"?"input":typeof r=="function"?"button":typeof r.x=="number"?"vec":typeof r.r=="number"?"color":r.isTexture?"image":typeof r=="object"?"folder":null}function jB(r){return(e,t)=>{const i=e.constructor;if(i===Object)throw new Error("Not possible to use uiConfig decorator on an object, use class instead");Th.Map.has(i)||Th.Map.set(i,[]),r(e,t,Th.Map.get(i))}}function ur(r,e){return jB((t,i,n)=>{const s=n.findIndex(a=>a.propKey===i);if(s&&s<0)n.push({params:e||{},propKey:i,uiType:r});else throw new Error(`Property ${i} already has a uiConfig decorator`)})}function K0(r,e,t="panel"){return i=>class extends i{constructor(){super(...arguments),this.uiConfig=Zf(sl(r,this)||"",this,e||{},t)}}}function lc(r,e){return ur("monitor",{label:r,params:e})}function Rt(r,e,t,i){return ur("slider",{label:r,bounds:e,stepSize:t,params:i})}function an(r,e,t,i){return ur("vec",{label:r,bounds:e,stepSize:t,params:i})}function js(r,e,t){return Array.isArray(e)&&typeof e[0]=="string"&&(e=e.map(i=>({label:i,value:i}))),ur("dropdown",{label:r,children:e,params:t})}function ci(r,e){return ur("button",{label:r,params:e})}function Lt(r,e){return ur("input",{label:r,params:e})}function vn(r,e){return ur("number",{label:r,params:e})}function Hs(r,e){return ur("color",{label:r,params:e})}function _a(r,e){return ur("image",{label:r,params:e})}function De(r,e){return ur("checkbox",{label:r,params:e})}function Xr(r,e){return K0(r,e,"panel")}function ti(r,e){return K0(r,e,"folder")}function Ph(r,e,t,i){function n(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function o(h){try{c(i.next(h))}catch(d){a(d)}}function l(h){try{c(i.throw(h))}catch(d){a(d)}}function c(h){h.done?s(h.value):n(h.value).then(o,l)}c((i=i.apply(r,[])).next())})}class P1{constructor(e){this._renderer=e}getBinding(e){let t=sl(e.property);const i=sl(e.path);if(!t||typeof t[0]!="object"||!t[1])return[void 0,""];if(typeof t[1]=="string"&&i&&i.length&&(t=[t[0],t[1]+"."+i]),typeof t[1]=="string"&&t[1].includes(".")){const n=t[1].split(".");let s=t[0];const a=n.pop()||"";for(const o of n)if(s=Array.isArray(s)?s[parseInt(o)]:s[o],!s)return console.warn("Cannot determine property, invalid property path",e,t),[void 0,""];t=[s,a]}return Array.isArray(t[0])&&typeof t[1]=="string"&&(t[1]=parseInt(t[1])),t}getValue(e){const[t,i]=this.getBinding(e);return t?t[i]:void 0}dispatchOnChangeSync(e,t,...i){var n,s;const a=[{type:"change",last:(n=t.last)!==null&&n!==void 0?n:!0,config:(s=t.config)!==null&&s!==void 0?s:e,configPath:[e,...t.configPath||[]],target:e,value:t.value,lastValue:t.lastValue},...i];typeof e.onChange=="function"?e.onChange(...a):Array.isArray(e.onChange)?e.onChange.flat().forEach(o=>typeof o=="function"&&(o==null?void 0:o(...a))):e.onChange&&console.error("Invalid onChange type, must be a function or array of functions",e.onChange),e.parentOnChange&&e.parentOnChange(...a)}setValue(e,t,i,n){return Ph(this,void 0,void 0,function*(){return this.runAtEvent(e,()=>{var s;const[a,o]=this.getBinding(e),l=(s=i.lastValue)!==null&&s!==void 0?s:a[o];return(!a||t===l||!QB(a,o,t,!0,!0))&&!n?!1:(this.dispatchOnChangeSync(e,Object.assign(Object.assign({},i),{value:t,lastValue:l})),!0)})})}dispatchOnChange(e,t){return Ph(this,void 0,void 0,function*(){return this.runAtEvent(e,()=>{this.dispatchOnChangeSync(e,t)})})}getLabel(e){var t;return((t=sl(e.label))!==null&&t!==void 0?t:this.getBinding(e)[1])+""}getChildren(e){var t;return((t=sl(e.children))!==null&&t!==void 0?t:[]).map(i=>sl(i)).flat(2).filter(i=>i)}clickButton(e,t){return Ph(this,void 0,void 0,function*(){return this.runAtEvent(e,()=>Ph(this,void 0,void 0,function*(){var i,n,s;const a=this.getBinding(e),o=(i=a[0])!==null&&i!==void 0?i:e,l=a[1]||"onClick",c=(n=o[l])!==null&&n!==void 0?n:o.value;typeof c=="function"?c.call(o,...sl(e.sendArgs)===!1?[]:(s=t==null?void 0:t.args)!==null&&s!==void 0?s:[]):c&&console.warn("Invalid action type for button",c),this.dispatchOnChange(e,{})}))})}runAtEvent(e,t){var i;return Ph(this,void 0,void 0,function*(){const n=(i=sl(e.dispatchMode))!==null&&i!==void 0?i:"postFrame";return n==="immediate"?t():new Promise(s=>{const a=()=>Ph(this,void 0,void 0,function*(){this._renderer.removeEventListener(n,a),s(yield t())});this._renderer.addEventListener(n,a)})})}initUiConfig(e){e&&(e.type||(console.warn("No type for config",e),e.type="input"),e.uuid||(e.uuid=I1()),e.property===void 0&&(e.binding?e.property=e.binding:e.value===void 0?(e.getValue||e.setValue)&&Object.defineProperty(e,"value",{get:()=>e.getValue&&e.getValue(),set:t=>e.setValue&&e.setValue(t)}):(e.getValue||e.setValue)&&console.warn("getValue/setValue is ignored since value is provided",e),e.property===void 0&&e.value!==void 0&&(e.property=[e,"value"])))}}class HB extends OB{constructor(e=document.body,t=!0,i){super(),this.config={type:"panel",label:"Configuration",children:[]},this._refreshQueue={preRender:[],postRender:[],preFrame:[],postFrame:[]},this._lastModeTime={preRender:0,postRender:0,preFrame:0,postFrame:0},this.methods=i||new P1(this);const n=this._createUiContainer();if(e.appendChild(n),t){this.addEventListener("preFrame",()=>this.refreshQueue("preFrame")),this.addEventListener("postFrame",()=>this.refreshQueue("postFrame")),this.addEventListener("preRender",()=>this.refreshQueue("preRender")),this.addEventListener("postRender",()=>this.refreshQueue("postRender"));const s=()=>{this.dispatchEvent({type:"preFrame"}),this.dispatchEvent({type:"preRender"}),this.dispatchEvent({type:"postRender"}),this.dispatchEvent({type:"postFrame"}),requestAnimationFrame(s)};requestAnimationFrame(s)}}refreshQueue(e){const t=this._refreshQueue[e],i=[],n=FB(),s=n-this._lastModeTime[e];t.forEach(a=>{a[1]>.001?(a[1]-=s,i.push(a)):this._refreshUiConfigObject(a[0])}),this._refreshQueue[e]=i,this._lastModeTime[e]=n}_addToRefreshQueue(e,t,i){const n=t.uuid,s=this._refreshQueue[e],a=s.find(o=>o[2]===n);a?a[1]=Math.max(a[1],i):s.push([t,i,n]),this._refreshQueue[e]=s}dispose(){}appendChild(e,t){e&&(Object.assign(e,t),this.config.children.push(e),this.refreshRoot())}removeChild(e){const t=this.config.children.indexOf(e);t!==-1&&(this.config.children.splice(t,1),this.disposeUiConfig(e),this.refreshRoot())}refreshRoot(e=!0,t="postFrame",i=0){var n,s;(s=(n=this.config).uiRefresh)===null||s===void 0||s.call(n,e,t,i)}disposeUiConfig(e,t=!0){var i,n;e&&(e.uiRef&&(t&&((n=(i=e.uiRef).dispose)===null||n===void 0||n.call(i)),e.uiRef=void 0),e.uiRefType=void 0,e.uiRefresh=void 0)}addToRefreshQueue(e,t,i,n){const s=i?this._flattenUiConfig(t):[t];for(const a of s)e==="immediate"?kB(n).then(()=>this._refreshUiConfigObject(a)):this._addToRefreshQueue(e,a,n)}_createUiContainer(){return NB({id:"uiConfigContainer",addToBody:!1})}_flattenUiConfig(e,t){var i;return t=t??[],!e||!e.uiRef||(t.push(e),(i=e.children)===null||i===void 0||i.forEach(n=>{typeof n!="function"&&n&&(Array.isArray(n)?n.forEach(s=>t=this._flattenUiConfig(s,t)):t=this._flattenUiConfig(n,t))})),t}}const R1={type:"change"},J0={type:"start"},D1={type:"end"};class Z0 extends zi{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new P,this.minDistance=1e-5,this.maxDistance=1/0,this.autoPushTarget=!0,this.autoPullTarget=!0,this.clampMax=new P(1/0,1/0,1/0),this.clampMin=new P(-1/0,-1/0,-1/0),this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.maxZoomSpeed=1,this.dollyZoom=!1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.throttleUpdate=0,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Xe.ROTATE,MIDDLE:Xe.DOLLY,RIGHT:Xe.PAN},this.touches={ONE:tt.ROTATE,TWO:tt.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return o.phi},this.getAzimuthalAngle=function(){return o.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(V){V.addEventListener("keydown",Pt),this._domElementKeyEvents=V},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Pt),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(R1),i.update(),s=n.NONE},this.update=function(){const V=new P,Ce=new Ct().setFromUnitVectors(e.up,new P(0,1,0)),Be=Ce.clone().invert(),Ae=new P,ut=new Ct,ft=new P,He=2*Math.PI,ct=0;return function(){if(this.throttleUpdate&&this.throttleUpdate>=1&&Date.now()-ct<1e3/this.throttleUpdate)return;const lt=i.object.position;V.copy(lt).sub(i.target),V.applyQuaternion(Ce),o.setFromVector3(V),i.autoRotate&&s===n.NONE&&T(R()),i.enableDamping?(o.theta+=l.theta*i.dampingFactor,o.phi+=l.phi*i.dampingFactor):(o.theta+=l.theta,o.phi+=l.phi);let I=i.minAzimuthAngle,k=i.maxAzimuthAngle;isFinite(I)&&isFinite(k)&&(I<-Math.PI?I+=He:I>Math.PI&&(I-=He),k<-Math.PI?k+=He:k>Math.PI&&(k-=He),I<=k?o.theta=Math.max(I,Math.min(k,o.theta)):o.theta=o.theta>(I+k)/2?Math.max(I,o.theta):Math.min(k,o.theta)),o.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,o.phi)),o.makeSafe(),Math.abs(l.radius)>0&&(i.dollyZoom&&(i.object.zoom=Math.max(Math.max(i.minZoom,.1),Math.min(Math.min(i.maxZoom,20),i.object.zoom*(1+l.radius*(i.enableDamping?i.dampingFactor:1)))),i.object.updateProjectionMatrix(),(i.object.zoom>=Math.min(i.maxZoom,20)||i.object.zoom<=Math.max(i.minZoom,.1))&&(l.radius=0)),o.radius*=1+l.radius*(i.enableDamping?i.dampingFactor:1)),Math.abs(c-1)>1e-5&&(i.dollyZoom&&(i.object.zoom=Math.max(Math.max(i.minZoom,.1),Math.min(Math.min(i.maxZoom,20),i.object.zoom*c)),i.object.updateProjectionMatrix(),(i.object.zoom>=Math.min(i.maxZoom,20)||i.object.zoom<=Math.max(i.minZoom,.1))&&(c=1)),o.radius*=c);let L=0;i.autoPushTarget&&o.radius<i.minDistance&&(L=i.minDistance-o.radius),i.autoPullTarget&&o.radius>i.maxDistance&&(L=i.maxDistance-o.radius),o.radius=Math.max(i.minDistance,Math.min(i.maxDistance,o.radius)),i.enableDamping===!0?i.target.addScaledVector(h,i.dampingFactor):i.target.add(h),V.setFromSpherical(o),V.applyQuaternion(Be),lt.copy(i.target).add(V),i.target.add(V.normalize().multiplyScalar(-L)),lt.clamp(i.clampMin,i.clampMax),i.target.clamp(i.clampMin,i.clampMax),i.object.lookAt(i.target);let j=!1;return i.enableDamping===!0&&Math.abs(l.theta)+Math.abs(l.phi)+Math.abs(l.radius)+h.length()>.001?(l.theta*=1-i.dampingFactor,l.phi*=1-i.dampingFactor,l.radius*=1-i.dampingFactor,h.multiplyScalar(1-i.dampingFactor),j=!0):(l.set(0,0,0),h.set(0,0,0)),c=1,d||j||Ae.distanceToSquared(i.object.position)>a||8*(1-ut.dot(i.object.quaternion))>a||ft.distanceToSquared(i.target)>0?(i.dispatchEvent(R1),Ae.copy(i.object.position),ut.copy(i.object.quaternion),ft.copy(i.target),d=!1,!0):!1}}(),this.stopDamping=function(){l.set(0,0,0),h.set(0,0,0)},this.dispose=function(){i.domElement.removeEventListener("contextmenu",G),i.domElement.removeEventListener("pointerdown",Pe),i.domElement.removeEventListener("pointercancel",Ye),i.domElement.removeEventListener("wheel",ot),i.domElement.removeEventListener("pointermove",Te),i.domElement.removeEventListener("pointerup",Ye),i._domElementKeyEvents!==null&&(i._domElementKeyEvents.removeEventListener("keydown",Pt),i._domElementKeyEvents=null)};const i=this,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=n.NONE;const a=1e-6,o=new ic,l=new ic(0,0,0);let c=1;const h=new P;let d=!1;const m=new ne,f=new ne,v=new ne,w=new ne,b=new ne,y=new ne,E=new ne,_=new ne,C=new ne,M=[],S={};function R(){return 2*Math.PI/60/60*i.autoRotateSpeed}function U(){return i.enableDamping?1:Math.pow(.95,i.zoomSpeed)}function T(V){l.theta-=V}function B(V){l.phi-=V}this.rotateUp=B,this.rotateLeft=T;const Q=function(){const V=new P;return function(Ce,Be){V.setFromMatrixColumn(Be,0),V.multiplyScalar(-Ce),h.add(V)}}(),Z=function(){const V=new P;return function(Ce,Be){i.screenSpacePanning===!0?V.setFromMatrixColumn(Be,1):(V.setFromMatrixColumn(Be,0),V.crossVectors(i.object.up,V)),V.multiplyScalar(Ce),h.add(V)}}(),q=function(){const V=new P;return function(Ce,Be){const Ae=i.domElement;if(i.object.isPerspectiveCamera){const ut=i.object.position;V.copy(ut).sub(i.target);let ft=V.length();ft*=Math.tan(i.object.fov/2*Math.PI/180),Q(2*Ce*ft/Ae.clientHeight,i.object.matrix),Z(2*Be*ft/Ae.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(Q(Ce*(i.object.right-i.object.left)/i.object.zoom/Ae.clientWidth,i.object.matrix),Z(Be*(i.object.top-i.object.bottom)/i.object.zoom/Ae.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function X(V,Ce=0){i.object.isPerspectiveCamera?(c/=V,l.radius=Math.max(-i.maxZoomSpeed,Math.min(i.maxZoomSpeed,l.radius-Ce))):i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*V)),i.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function te(V,Ce=0){i.object.isPerspectiveCamera?(c*=V,l.radius=Math.max(-i.maxZoomSpeed,Math.min(i.maxZoomSpeed,l.radius+Ce))):i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/V)),i.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}this.zoomIn=function(V){X(1,V*i.zoomSpeed)},this.zoomOut=function(V){te(1,V*i.zoomSpeed)};function me(V){m.set(V.clientX,V.clientY)}function se(V){E.set(V.clientX,V.clientY)}function he(V){w.set(V.clientX,V.clientY)}function _e(V){f.set(V.clientX,V.clientY),v.subVectors(f,m).multiplyScalar(i.rotateSpeed);const Ce=i.domElement;T(2*Math.PI*v.x/Ce.clientHeight),B(2*Math.PI*v.y/Ce.clientHeight),m.copy(f),i.update()}function ge(V){_.set(V.clientX,V.clientY),C.subVectors(_,E),C.y>0?X(U()):C.y<0&&te(U()),E.copy(_),i.update()}function Oe(V){b.set(V.clientX,V.clientY),y.subVectors(b,w).multiplyScalar(i.panSpeed),q(y.x,y.y),w.copy(b),i.update()}function oe(V){let Ce=0;switch(V.deltaMode){case 2:Ce+=V.deltaY*1;break;case 1:Ce+=V.deltaY*.4;break;default:Ce+=V.deltaY*.01;break}V.deltaY<0?te(1,Ce*i.zoomSpeed):V.deltaY>0&&X(1,-Ce*i.zoomSpeed),i.update()}function be(V){let Ce=!1;switch(V.code){case i.keys.UP:V.ctrlKey||V.metaKey||V.shiftKey?B(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):q(0,i.keyPanSpeed),Ce=!0;break;case i.keys.BOTTOM:V.ctrlKey||V.metaKey||V.shiftKey?B(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):q(0,-i.keyPanSpeed),Ce=!0;break;case i.keys.LEFT:V.ctrlKey||V.metaKey||V.shiftKey?T(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):q(i.keyPanSpeed,0),Ce=!0;break;case i.keys.RIGHT:V.ctrlKey||V.metaKey||V.shiftKey?T(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):q(-i.keyPanSpeed,0),Ce=!0;break}Ce&&(V.preventDefault(),i.update())}function Me(){if(M.length===1)m.set(M[0].pageX,M[0].pageY);else{const V=.5*(M[0].pageX+M[1].pageX),Ce=.5*(M[0].pageY+M[1].pageY);m.set(V,Ce)}}function Ve(){if(M.length===1)w.set(M[0].pageX,M[0].pageY);else{const V=.5*(M[0].pageX+M[1].pageX),Ce=.5*(M[0].pageY+M[1].pageY);w.set(V,Ce)}}function Ue(){const V=M[0].pageX-M[1].pageX,Ce=M[0].pageY-M[1].pageY,Be=Math.sqrt(V*V+Ce*Ce);E.set(0,Be)}function rt(){i.enableZoom&&Ue(),i.enablePan&&Ve()}function xt(){i.enableZoom&&Ue(),i.enableRotate&&Me()}function mt(V){if(M.length==1)f.set(V.pageX,V.pageY);else{const Be=ze(V),Ae=.5*(V.pageX+Be.x),ut=.5*(V.pageY+Be.y);f.set(Ae,ut)}v.subVectors(f,m).multiplyScalar(i.rotateSpeed);const Ce=i.domElement;T(2*Math.PI*v.x/Ce.clientHeight),B(2*Math.PI*v.y/Ce.clientHeight),m.copy(f)}function Dt(V){if(M.length===1)b.set(V.pageX,V.pageY);else{const Ce=ze(V),Be=.5*(V.pageX+Ce.x),Ae=.5*(V.pageY+Ce.y);b.set(Be,Ae)}y.subVectors(b,w).multiplyScalar(i.panSpeed),q(y.x,y.y),w.copy(b)}function we(V){const Ce=ze(V),Be=V.pageX-Ce.x,Ae=V.pageY-Ce.y,ut=Math.sqrt(Be*Be+Ae*Ae);_.set(0,ut),C.set(0,Math.pow(_.y/E.y,i.zoomSpeed*6)),X(C.y),E.copy(_)}function Y(V){i.enableZoom&&we(V),i.enablePan&&Dt(V)}function je(V){i.enableZoom&&we(V),i.enableRotate&&mt(V)}function Pe(V){i.enabled!==!1&&(M.length===0&&(i.domElement.setPointerCapture(V.pointerId),i.domElement.addEventListener("pointermove",Te),i.domElement.addEventListener("pointerup",Ye)),F(V),V.pointerType==="touch"?Li(V):Ee(V))}function Te(V){i.enabled!==!1&&(V.pointerType==="touch"?Wi(V):V.buttons?at(V):Ye(V))}function Ye(V){ye(V),M.length===0&&(i.domElement.releasePointerCapture(V.pointerId),i.domElement.removeEventListener("pointermove",Te),i.domElement.removeEventListener("pointerup",Ye)),i.dispatchEvent(D1),s=n.NONE}function Ee(V){let Ce;switch(V.button){case 0:Ce=i.mouseButtons.LEFT;break;case 1:Ce=i.mouseButtons.MIDDLE;break;case 2:Ce=i.mouseButtons.RIGHT;break;default:Ce=-1}switch(Ce){case Xe.DOLLY:if(i.enableZoom===!1)return;se(V),s=n.DOLLY;break;case Xe.ROTATE:if(V.ctrlKey||V.metaKey||V.shiftKey){if(i.enablePan===!1)return;he(V),s=n.PAN}else{if(i.enableRotate===!1)return;me(V),s=n.ROTATE}break;case Xe.PAN:if(V.ctrlKey||V.metaKey||V.shiftKey){if(i.enableRotate===!1)return;me(V),s=n.ROTATE}else{if(i.enablePan===!1)return;he(V),s=n.PAN}break;default:s=n.NONE}s!==n.NONE&&i.dispatchEvent(J0)}function at(V){switch(s){case n.ROTATE:if(i.enableRotate===!1)return;_e(V);break;case n.DOLLY:if(i.enableZoom===!1)return;ge(V);break;case n.PAN:if(i.enablePan===!1)return;Oe(V);break}}function ot(V){i.enabled===!1||i.enableZoom===!1||s!==n.NONE||(V.preventDefault(),i.dispatchEvent(J0),oe(V),i.dispatchEvent(D1))}function Pt(V){i.enabled===!1||i.enablePan===!1||be(V)}function Li(V){switch(Ge(V),M.length){case 1:switch(i.touches.ONE){case tt.ROTATE:if(i.enableRotate===!1)return;Me(),s=n.TOUCH_ROTATE;break;case tt.PAN:if(i.enablePan===!1)return;Ve(),s=n.TOUCH_PAN;break;default:s=n.NONE}break;case 2:switch(i.touches.TWO){case tt.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;rt(),s=n.TOUCH_DOLLY_PAN;break;case tt.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;xt(),s=n.TOUCH_DOLLY_ROTATE;break;default:s=n.NONE}break;default:s=n.NONE}s!==n.NONE&&i.dispatchEvent(J0)}function Wi(V){switch(Ge(V),s){case n.TOUCH_ROTATE:if(i.enableRotate===!1)return;mt(V),i.update();break;case n.TOUCH_PAN:if(i.enablePan===!1)return;Dt(V),i.update();break;case n.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;Y(V),i.update();break;case n.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;je(V),i.update();break;default:s=n.NONE}}function G(V){i.enabled!==!1&&V.preventDefault()}function F(V){M.push(V)}function ye(V){delete S[V.pointerId];for(let Ce=0;Ce<M.length;Ce++)if(M[Ce].pointerId==V.pointerId){M.splice(Ce,1);return}}function Ge(V){let Ce=S[V.pointerId];Ce===void 0&&(Ce=new ne,S[V.pointerId]=Ce),Ce.set(V.pageX,V.pageY)}function ze(V){const Ce=V.pointerId===M[0].pointerId?M[1]:M[0];return S[Ce.pointerId]}i.domElement.addEventListener("contextmenu",G),i.domElement.addEventListener("pointerdown",Pe),i.domElement.addEventListener("pointercancel",Ye),i.domElement.addEventListener("wheel",ot,{passive:!1}),this.update()}}var WB=Object.defineProperty,XB=Object.getOwnPropertyDescriptor,Mi=(r,e,t,i)=>{for(var n=i>1?void 0:i?XB(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&WB(e,t,n),n};p.OrbitControls3=class extends Z0{constructor(){super(...arguments),this.type="OrbitControls",this.enabled=!0,this.dollyZoom=!1,this.enableDamping=!0,this.dampingFactor=.08,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableZoom=!0,this.zoomSpeed=.15,this.maxZoomSpeed=.2,this.enableRotate=!0,this.rotateSpeed=2,this.enablePan=!0,this.panSpeed=1,this.autoPushTarget=!1,this.autoPullTarget=!1,this.minDistance=.35,this.maxDistance=1e3,this.minZoom=.01,this.maxZoom=1e3,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1e4,this.maxAzimuthAngle=1e4,this.clampMin=new P(-1e4,-1e4,-1e4),this.clampMax=new P(1e4,1e4,1e4),this.screenSpacePanning=!0,this.keyPanSpeed=7,this.throttleUpdate=60}},Mi([$()],p.OrbitControls3.prototype,"type",2),Mi([De()],p.OrbitControls3.prototype,"enabled",2),Mi([De(),$()],p.OrbitControls3.prototype,"dollyZoom",2),Mi([De(),$()],p.OrbitControls3.prototype,"enableDamping",2),Mi([Lt(),$()],p.OrbitControls3.prototype,"dampingFactor",2),Mi([De(),$()],p.OrbitControls3.prototype,"autoRotate",2),Mi([Lt(),$()],p.OrbitControls3.prototype,"autoRotateSpeed",2),Mi([De(),$()],p.OrbitControls3.prototype,"enableZoom",2),Mi([Lt(),$()],p.OrbitControls3.prototype,"zoomSpeed",2),Mi([Lt(),$()],p.OrbitControls3.prototype,"maxZoomSpeed",2),Mi([De(),$()],p.OrbitControls3.prototype,"enableRotate",2),Mi([Lt(),$()],p.OrbitControls3.prototype,"rotateSpeed",2),Mi([De(),$()],p.OrbitControls3.prototype,"enablePan",2),Mi([Lt(),$()],p.OrbitControls3.prototype,"panSpeed",2),Mi([Lt(),$()],p.OrbitControls3.prototype,"autoPushTarget",2),Mi([Lt(),$()],p.OrbitControls3.prototype,"autoPullTarget",2),Mi([Lt(),$()],p.OrbitControls3.prototype,"minDistance",2),Mi([Lt(),$()],p.OrbitControls3.prototype,"maxDistance",2),Mi([Lt(),$()],p.OrbitControls3.prototype,"minZoom",2),Mi([Lt(),$()],p.OrbitControls3.prototype,"maxZoom",2),Mi([Lt(),$()],p.OrbitControls3.prototype,"minPolarAngle",2),Mi([Lt(),$()],p.OrbitControls3.prototype,"maxPolarAngle",2),Mi([Lt(),$()],p.OrbitControls3.prototype,"minAzimuthAngle",2),Mi([Lt(),$()],p.OrbitControls3.prototype,"maxAzimuthAngle",2),Mi([an(),$()],p.OrbitControls3.prototype,"clampMin",2),Mi([an(),$()],p.OrbitControls3.prototype,"clampMax",2),Mi([$()],p.OrbitControls3.prototype,"screenSpacePanning",2),Mi([$()],p.OrbitControls3.prototype,"keyPanSpeed",2),p.OrbitControls3=Mi([Xr("Orbit Controls")],p.OrbitControls3);function B1(r){return[{type:"button",label:"Set View",value:()=>{var e;this.setViewToMain({ui:!0}),(e=r.uiRefresh)==null||e.call(r,!0,"postFrame")}},{type:"button",label:"Activate main",hidden:()=>this==null?void 0:this.isMainCamera,value:()=>{var e;this.activateMain({ui:!0}),(e=r.uiRefresh)==null||e.call(r,!0,"postFrame")}},{type:"button",label:"Deactivate main",hidden:()=>!(this!=null&&this.isMainCamera),value:()=>{var e;this.deactivateMain({ui:!0}),(e=r.uiRefresh)==null||e.call(r,!0,"postFrame")}},{type:"checkbox",label:"Auto LookAt Target",getValue:()=>this.userData.autoLookAtTarget??!1,setValue:e=>{var t;this.userData.autoLookAtTarget=e,(t=r.uiRefresh)==null||t.call(r,!0,"postFrame")}}]}function qB(r){if(!this)return{};if(this.uiConfig)return this.uiConfig;const e={type:"folder",label:()=>this.name||"unnamed",expanded:!0,onChange:t=>{!t.config||t.config.onChange||this.setDirty({uiChangeEvent:t,refreshScene:!1,refreshUi:!0})},children:[{type:"checkbox",label:"Visible",property:[this,"visible"]},{type:"button",label:"Pick/Focus",value:()=>{this.dispatchEvent({type:"select",ui:!0,object:this,bubbleToParent:!0,focusCamera:!0})}},{type:"button",label:"Pick Parent",hidden:()=>!this.parent,value:()=>{const t=this.parent;t&&t.dispatchEvent({type:"select",ui:!0,bubbleToParent:!0,object:t})}},{type:"input",label:"Name",property:[this,"name"],onChange:t=>{var i;t.last&&((i=this.setDirty)==null||i.call(this,{refreshScene:!0,frameFade:!1,refreshUi:!0}))}},{type:"checkbox",label:"Casts Shadow",hidden:()=>!this.isMesh,property:[this,"castShadow"]},{type:"checkbox",label:"Receive Shadow",hidden:()=>!this.isMesh,property:[this,"receiveShadow"]},{type:"checkbox",label:"Frustum culled",property:[this,"frustumCulled"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Scale",property:[this,"scale"]},{type:"input",label:"Render Order",property:[this,"renderOrder"]},{type:"button",label:"Auto Scale",hidden:()=>!this.autoScale,prompt:["Auto Scale Radius: Object will be scaled to the given radius",this.userData.autoScaleRadius||"2",!0],value:()=>{var t;const i=(this.userData.autoScaleRadius||2)+"",n=prompt("Auto Scale Radius: Object will be scaled to the given radius",i);if(n===null)return;const s=parseFloat(n||i);Math.abs(s)>0&&((t=this.autoScale)==null||t.call(this,s))}},{type:"button",label:"Auto Center",value:()=>{var t;confirm("Auto Center: Object will be centered, are you sure you want to proceed?")&&((t=this.autoCenter)==null||t.call(this,!0))}},{type:"folder",label:"Rotate model",children:["X +","X -","Y +","Y -","Z +","Z -"].map(t=>({type:"button",label:"Rotate "+t+"90",value:()=>{var i;this.rotateOnAxis(new P(t.includes("X")?1:0,t.includes("Y")?1:0,t.includes("Z")?1:0),Math.PI/2*(t.includes("-")?-1:1)),(i=this.setDirty)==null||i.call(this,{refreshScene:!0,refreshUi:!1})}}))},this.userData.license!==void 0?{type:"input",label:"License/Credits",property:[this.userData,"license"]}:{}]};if((this.isLine||this.isMesh)&&r!==!1){const t=[()=>{const i=Object.entries(this.morphTargetDictionary||{});return i.length?{label:"Morph Targets",type:"folder",children:i.map(([n,s])=>({type:"slider",label:n,bounds:[0,1],stepSize:1e-4,property:[this.morphTargetInfluences,s],onChange:a=>{var o;(o=this.setDirty)==null||o.call(this,{refreshScene:a.last,frameFade:!1,refreshUi:!1})}}))}:void 0},()=>{var i;return(i=this.geometry)==null?void 0:i.uiConfig},()=>{var i;return Array.isArray(this.material)?this.material.length<1?void 0:{label:"Materials",type:"folder",children:this.material.map(n=>n==null?void 0:n.uiConfig).filter(n=>n)}:(i=this.material)==null?void 0:i.uiConfig}];e.children.push(...t)}if(this.isCamera){const t=B1.call(this,e);e.children.push(...t)}return this.uiConfig=e,e}const Ln={setDirty:function(r){this.dispatchEvent({bubbleToObject:!0,...r,type:"geometryUpdate",geometry:this}),this.refreshUi()},refreshUi:function(){var r,e;(e=(r=this.uiConfig)==null?void 0:r.uiRefresh)==null||e.call(r,!0,"postFrame",1)},dispose:r=>function(e=!0){!e&&(this.userData.disposeOnIdle===!1||Sh(this))||r.call(this)},clone:r=>function(){return Ln.upgradeGeometry.call(r.call(this))},upgradeGeometry:YB,center:r=>function(e,t=!1){if(t){e=e?e.clone():new P,r.call(this,e),e.negate();const i=this.appliedMeshes;for(const n of i)n.updateMatrix(),n.position.copy(e).applyMatrix4(n.matrix),n.setDirty()}else r.call(this,e);return this.setDirty(),this},makeUiConfig:function(){return this.uiConfig?this.uiConfig:{label:"Geometry",type:"folder",children:[{type:"input",property:[this,"uuid"],disabled:!0},{type:"input",property:[this,"name"]},{type:"button",label:"Center Geometry",value:()=>{this.center()}},{type:"button",label:"Center Geometry (keep position)",value:()=>{this.center(void 0,!0)}},{type:"button",label:"Compute vertex normals",value:()=>{this.hasAttribute("normal")&&!confirm("Normals already exist, replace with computed normals?")||(this.computeVertexNormals(),this.setDirty())}},{type:"button",label:"Compute vertex tangents",value:()=>{this.hasAttribute("tangent")&&!confirm("Tangents already exist, replace with computed tangents?")||(this.computeTangents(),this.setDirty())}},{type:"button",label:"Normalize normals",value:()=>{this.normalizeNormals(),this.setDirty()}},{type:"button",label:"Convert to indexed",hidden:()=>!!this.index,value:()=>{if(this.attributes.index)return;const r=parseFloat(prompt("Tolerance","-1")??"-1");v0(this,r),this.setDirty()}},{type:"button",label:"Convert to non-indexed",hidden:()=>!this.index,value:()=>{this.attributes.index&&(this.toNonIndexed(),this.setDirty())}},{type:"button",label:"Create uv1 from uv",value:()=>{this.hasAttribute("uv1")&&!confirm("uv1 already exists, replace with uv data?")||(this.setAttribute("uv1",this.getAttribute("uv")),this.setDirty())}},{type:"button",label:"Remove vertex color attribute",hidden:()=>!this.hasAttribute("color"),value:()=>{if(!this.hasAttribute("color")){prompt("No color attribute found");return}confirm("Remove color attribute?")&&(this.deleteAttribute("color"),this.setDirty())}},{type:"button",label:"Auto GPU Instances",hidden:()=>!this.appliedMeshes||this.appliedMeshes.size<2,value:()=>{confirm("This action is irreversible, do you want to continue?")&&Ex(this)}},{type:"input",label:"Mesh count",getValue:()=>{var r;return((r=this.appliedMeshes)==null?void 0:r.size)??0},disabled:!0}]}}};function YB(){return this.assetType==="geometry"?this:this.isBufferGeometry?(this.assetType="geometry",this.dispose=Ln.dispose(this.dispose),this.center=Ln.center(this.center),this.clone=Ln.clone(this.clone),this.setDirty||(this.setDirty=Ln.setDirty),this.refreshUi||(this.refreshUi=Ln.refreshUi),this.appliedMeshes||(this.appliedMeshes=new Set),this.userData||(this.userData={}),this.uiConfig=Ln.makeUiConfig.call(this),this):(console.error("Geometry is not a BufferGeometry",this),this)}const L1=class{static ApplyMaterialExtensions(e,t,i,n){for(const s of i)this.ApplyMaterialExtension(e,t,s,n)}static ApplyMaterialExtension(e,t,i,n){var s;let a=sr(i.parsFragmentSnippet,n,e)??"";a.length&&(t.fragmentShader=ri(t.fragmentShader,this.VoidMain,`
`+a+`
`,{prepend:!0})),a=sr(i.parsVertexSnippet,n,e)??"",a.length&&(t.vertexShader=ri(t.vertexShader,this.VoidMain,`
`+a+`
`,{prepend:!0})),i.extraUniforms&&(t.uniforms=Object.assign(t.uniforms,qw(i.extraUniforms,o=>sr(o,t)||{value:null}))),i.extraDefines&&al(i.extraDefines,e),(s=i.shaderExtender)==null||s.call(i,t,e,n),e.lastShader=t}static CacheKeyForExtensions(e,t){let i="";for(const n of t)i+=this.CacheKeyForExtension(e,n);return i}static CacheKeyForExtension(e,t){let i="";return t.computeCacheKey?i+=sr(t.computeCacheKey,e):i+=t.uuid,t.extraDefines&&(i+=Object.values(t.extraDefines).map(n=>sr(n)??"").join("")),i}static RegisterExtensions(e,t){const i=[];if(Array.isArray(e.materialExtensions)||(e.materialExtensions=[]),t)for(const n of t)!n.isCompatible||!n.isCompatible(e)||e.materialExtensions.includes(n)||(i.push(n),n.uuid||(n.uuid=hs()),n.__setDirty||(n.__setDirty=()=>{n.updateVersion||(n.updateVersion=0),n.updateVersion++}),n.setDirty||(n.setDirty=n.__setDirty));return i.length?(e.materialExtensions=[...e.materialExtensions||[],...i].sort((n,s)=>(s.priority||0)-(n.priority||0)),e.__ext_beforeRenderListen||(e.__ext_beforeRenderListen=!0,e.addEventListener("beforeRender",U1)),e.__ext_afterRenderListen||(e.__ext_afterRenderListen=!0,e.addEventListener("afterRender",O1)),e.needsUpdate=!0,i):[]}static UnregisterExtensions(e,t){var i,n;t&&(e.materialExtensions=((i=e.materialExtensions)==null?void 0:i.filter(s=>!t.includes(s)))||[]),(n=e.materialExtensions)!=null&&n.length||(e.removeEventListener("beforeRender",U1),e.removeEventListener("afterRender",O1),e.__ext_beforeRenderListen=!1,e.__ext_afterRenderListen=!1)}};Object.assign(Ft,i0),L1.VoidMain="void main()";let Gp=L1;function al(r,e){if(!r||!e)return;(e.defines===void 0||e.defines===null)&&(e.defines={});let t=!1;const i=Object.entries(r);for(const[n,s]of i){const a=sr(s);a===void 0?e.defines[n]!==void 0&&(delete e.defines[n],t=!0):e.defines[n]!==a&&(e.defines[n]=typeof a=="boolean"?+a:a,t=!0)}t&&(e.needsUpdate=!0)}function U1({target:r,object:e,renderer:t}){var i;const n=r;if(!n||!e||!t)throw new Error("Invalid material, object or renderer");if(n.materialExtensions)for(const s of n.materialExtensions){if((i=s.onObjectRender)==null||i.call(s,e,n,t),n.lastShader){const o=sr(s.updaters)||[];for(const l of o)l&&l.updateShaderProperties(n.lastShader)}const a="_"+s.uuid+"_version";s.updateVersion!==n.userData[a]&&(n.userData[a]=s.updateVersion,n.needsUpdate=!0)}}function O1({target:r,object:e,renderer:t}){var i;const n=r;if(!n||!e||!t)throw new Error("Invalid material, object or renderer");if(n.materialExtensions)for(const s of n.materialExtensions)(i=s.onAfterRender)==null||i.call(s,e,n,t)}function k1(r,e){const t=e||hs();return{uuid:t,getUiConfig:i=>{if(i.__uiConfigs||(i.__uiConfigs={}),i.__uiConfigs[t])return i.__uiConfigs[t];const n=r(i);return i.__uiConfigs[t]=n,n},isCompatible:()=>!0}}const cc={name:"",blending:ii,side:Ie,vertexColors:!1,opacity:1,transparent:!1,blendSrc:Fn,blendDst:Ic,blendEquation:Da,blendSrcAlpha:null,blendDstAlpha:null,blendEquationAlpha:null,depthFunc:gl,depthTest:!0,depthWrite:!0,stencilWriteMask:255,stencilFunc:Ro,stencilRef:0,stencilFuncMask:255,stencilFail:na,stencilZFail:na,stencilZPass:na,stencilWrite:!1,clippingPlanes:null,clipIntersection:!1,clipShadows:!1,shadowSide:null,colorWrite:!0,precision:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0,dithering:!1,alphaToCoverage:!1,premultipliedAlpha:!1,forceSinglePass:!1,visible:!0,toneMapped:!0,userData:{},alphaTest:0},Qe={threeMaterialPropList:cc,setDirty:function(r){var e,t;(r==null?void 0:r.needsUpdate)!==!1&&(this.needsUpdate=!0),this.dispatchEvent({bubbleToObject:!0,bubbleToParent:!0,...r,type:"materialUpdate"}),(t=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||t.call(e,!0,"postFrame",1)},setValues:r=>function(e){var t;const i=(e==null?void 0:e.metadata)&&(e==null?void 0:e.metadata.version)<=4.5,n=cr.enabled;i&&(cr.enabled=!1);const s=this.constructor.MaterialProperties,a=s?jw(e,{},Array.from(Object.keys(s))):{...e};for(const l of Object.keys(a))a[l]===void 0&&delete a[l];const o=a.userData;return delete a.userData,r.call(this,a),o&&l0(this.userData,o),i&&(cr.enabled=n),(t=this.setDirty)==null||t.call(this),this},dispose:r=>function(e=!0){!e&&(this.userData.disposeOnIdle===!1||Sh(this))||r.call(this)},clone:r=>function(){var e,t;this.userData.cloneId||(this.userData.cloneId="0"),this.userData.cloneCount||(this.userData.cloneCount=0),this.userData.cloneCount+=1;const i=((t=(e=this.generator)==null?void 0:e.call(this,{}))==null?void 0:t.setValues(this,!1))??r.call(this);return i.userData.cloneId=i.userData.cloneId+"_"+this.userData.cloneCount,i.userData.cloneCount=0,i.name=i.name+"_"+i.userData.cloneId,i},dispatchEvent:r=>function(e){r.call(this,e);const t=e.type;e.bubbleToObject&&(t==="beforeDeserialize"||t==="materialUpdate"||t==="textureUpdate")&&this.appliedMeshes.forEach(i=>i.dispatchEvent({...e,material:this,type:t}))},customProgramCacheKey:function(){return Gp.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap},registerMaterialExtensions:function(r){Gp.RegisterExtensions(this,r)},unregisterMaterialExtensions:function(r){Gp.UnregisterExtensions(this,r)},onBeforeCompile:function(r,e){this.materialExtensions&&Gp.ApplyMaterialExtensions(this,r,this.materialExtensions,e),this.dispatchEvent({type:"beforeCompile",shader:r,renderer:e}),r.fragmentShader=r.fragmentShader.replaceAll("#glMarker","// "),r.vertexShader=r.vertexShader.replaceAll("#glMarker","// ")},onBeforeRender:function(r,e,t,i,n){this.envMapIntensity!==void 0&&!this.userData.separateEnvMapIntensity&&e.envMapIntensity!==void 0&&(this.userData.__envIntensity=this.envMapIntensity,this.envMapIntensity=e.envMapIntensity),this.defines&&this.envMap!==void 0&&e.fixedEnvMapDirection!==void 0&&(e.fixedEnvMapDirection?this.defines.FIX_ENV_DIRECTION||(this.defines.FIX_ENV_DIRECTION="1",this.needsUpdate=!0):this.defines.FIX_ENV_DIRECTION!==void 0&&(delete this.defines.FIX_ENV_DIRECTION,this.needsUpdate=!0)),this.dispatchEvent({type:"beforeRender",renderer:r,scene:e,camera:t,geometry:i,object:n})},onAfterRender:function(r,e,t,i,n){this.userData.__envIntensity!==void 0&&(this.envMapIntensity=this.userData.__envIntensity,delete this.userData.__envIntensity),this.dispatchEvent({type:"afterRender",renderer:r,scene:e,camera:t,geometry:i,object:n})},onBeforeCompileOverride:r=>function(e,t){Qe.onBeforeCompile.call(this,e,t),r.call(this,e,t)},onBeforeRenderOverride:r=>function(...e){r.call(this,...e),Qe.onBeforeRender.call(this,...e)},onAfterRenderOverride:r=>function(...e){r.call(this,...e),Qe.onAfterRender.call(this,...e)},customProgramCacheKeyOverride:r=>function(){return r.call(this)+Qe.customProgramCacheKey.call(this)},upgradeMaterial:KB};function KB(){return this.isMaterial?(this.setDirty||(this.setDirty=Qe.setDirty),this.appliedMeshes||(this.appliedMeshes=new Set),this.userData||(this.userData={}),this.userData.uuid=this.uuid,this.userData.setDirty||(this.userData.setDirty=r=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(r)}),this.assetType==="material"?this:(this.assetType="material",this.setValues=Qe.setValues(this.setValues),this.dispose=Qe.dispose(this.dispose),this.clone=Qe.clone(this.clone),this.dispatchEvent=Qe.dispatchEvent(this.dispatchEvent),this.extraUniformsToUpload||(this.extraUniformsToUpload={}),this.materialExtensions||(this.materialExtensions=[]),this.registerMaterialExtensions||(this.registerMaterialExtensions=Qe.registerMaterialExtensions),this.unregisterMaterialExtensions||(this.unregisterMaterialExtensions=Qe.unregisterMaterialExtensions),this.onBeforeCompile=Qe.onBeforeCompileOverride(this.onBeforeCompile),this.onBeforeRender=Qe.onBeforeRenderOverride(this.onBeforeRender),this.onAfterRender=Qe.onAfterRenderOverride(this.onAfterRender),this.customProgramCacheKey=Qe.customProgramCacheKeyOverride(this.customProgramCacheKey),this)):(console.error("Material is not a material",this),this)}const Wt={setDirty:function(r){var e;this.dispatchEvent({bubbleToParent:!0,...r,type:"objectUpdate",object:this}),(r==null?void 0:r.refreshUi)!==!1&&((e=this.refreshUi)==null||e.call(this))},upgradeObject3D:F1,makeUiConfig:qB,autoCenter:function(r=!0){const e=new Vs().expandByObject(this,!0,!0).getCenter(new P);return this.position.sub(e),this.updateMatrix(),this.userData.autoCentered=!0,this.userData.isCentered=!0,r&&this.setDirty({change:"autoCenter"}),this},autoScale:function(r,e,t=!0){const i=new Vs().expandByObject(this,!0,!0).getSize(new P).length()*.5;r===void 0&&(r=this.userData.autoScaleRadius||1);const n=r/i;return isFinite(n)?(this.userData.pseudoCentered?this.children.forEach(s=>{s.scale.multiplyScalar(n)}):this.scale.multiplyScalar(n),(e||this.userData.isCentered)&&this.position.multiplyScalar(n),this.traverse(s=>{var a,o;const l=s;l.isLight&&(o=(a=l.shadow)==null?void 0:a.camera)!=null&&o.right&&(l.shadow.camera.right*=n,l.shadow.camera.left*=n,l.shadow.camera.top*=n,l.shadow.camera.bottom*=n,s.setDirty()),l.isCamera&&l.right&&(l.right*=n,l.left*=n,l.top*=n,l.bottom*=n,s.setDirty())}),this.userData.autoScaled=!0,this.userData.autoScaleRadius=r,t&&this.setDirty({change:"autoScale"}),this):this},eventCallbacks:{onAddedToParent:function(r){var e,t;const i=((e=this.parent)==null?void 0:e.parentRoot)??this.parent;!this.objectProcessor&&i!=null&&i.objectProcessor&&this.traverse(n=>{var s;n.objectProcessor=i.objectProcessor,(s=n.objectProcessor)==null||s.processObject(n)}),i!==this.parentRoot&&this.traverse(n=>{n.parentRoot=i}),(t=this.setDirty)==null||t.call(this,{...r,change:"addedToParent"})},onRemovedFromParent:function(r){var e;(e=this.setDirty)==null||e.call(this,{...r,change:"removedFromParent"}),this.parentRoot!==void 0&&this.traverse(t=>{t.parentRoot=void 0})},onGeometryUpdate:function(r){r.bubbleToObject&&this.dispatchEvent({bubbleToParent:!0,...r,object:this,geometry:r.geometry})}},initMaterial:function(){if(An(this,"_currentMaterial"))return;this._currentMaterial=null;const r=this.material;delete this.material,Object.defineProperty(this,"material",{get:Wt.getMaterial,set:Wt.setMaterial}),Object.defineProperty(this,"materials",{get:Wt.getMaterials,set:Wt.setMaterials}),this.material=r,this.setMaterial||(this.setMaterial=e=>{const t=this.material;return console.error("setMaterial is deprecated, use material property directly"),this.material=e,t}),this.userData.setMaterial&&console.error("userData.setMaterial already defined"),this.userData.setMaterial=e=>{console.error("userData.setMaterial is deprecated, use setMaterial directly"),this.material=e}},getMaterial:function(){return this._currentMaterial||void 0},getMaterials:function(){return this._currentMaterial?Array.isArray(this._currentMaterial)?[...this._currentMaterial]:[this._currentMaterial]:[]},setMaterial:function(r){const e=(Array.isArray(r)?r:[r]).filter(n=>n);if(this.material==e||e.length===1&&this.material===e[0])return[];const t=Array.isArray(this.material)?[...this.material]:[this.material];for(const n of t)n&&n.appliedMeshes&&(n.appliedMeshes.delete(this),n.dispose(!1));const i=[];for(const n of e)n&&(n.assetType||(console.warn("Upgrading Material",n),Qe.upgradeMaterial.call(n)),i.push(n),n&&n.appliedMeshes.add(this));this._currentMaterial=i.length?i.length!==1?i:i[0]||null:null,this.dispatchEvent({type:"materialChanged",material:r,oldMaterial:t,object:this,bubbleToParent:!0}),this.refreshUi()},setMaterials:function(r){this.material=r||void 0},initGeometry:function(){const r=this.geometry;this._currentGeometry=null,delete this.geometry,Object.defineProperty(this,"geometry",{get:Wt.getGeometry,set:Wt.setGeometry}),this.geometry=r,this.setGeometry||(this.setGeometry=e=>{const t=this.geometry;return console.error("setGeometry is deprecated, use geometry property directly"),this.geometry=e,t}),this.userData.setGeometry&&console.error("userData.setGeometry already defined"),this.userData.setGeometry=e=>{console.error("userData.setGeometry is deprecated, use setGeometry directly"),this.geometry=e}},getGeometry:function(){return this._currentGeometry||void 0},setGeometry:function(r){const e=this.geometry||void 0;e!==r&&(e&&(this._onGeometryUpdate&&e.removeEventListener("geometryUpdate",this._onGeometryUpdate),e.appliedMeshes&&(e.appliedMeshes.delete(this),e.dispose(!1))),r&&(r.assetType||Ln.upgradeGeometry.call(r)),this._currentGeometry=r||null,r&&(this.updateMorphTargets(),this._onGeometryUpdate&&r.addEventListener("geometryUpdate",this._onGeometryUpdate),r.appliedMeshes.add(this)),this.dispatchEvent({type:"geometryChanged",geometry:r,oldGeometry:e,bubbleToParent:!0}),this.refreshUi())},refreshUi:function(){var r,e;(e=(r=this.uiConfig)==null?void 0:r.uiRefresh)==null||e.call(r,!0,"postFrame",1)},dispatchEvent:r=>function(e){var t,i;if(e.bubbleToParent||(i=(t=this.userData)==null?void 0:t.__autoBubbleToParentEvents)!=null&&i.includes(e.type)){const n=this.parentRoot||this.parent;this.parentRoot!==this&&(n==null||n.dispatchEvent(e))}r.call(this,e)},clone:r=>function(...e){const t=this.userData;this.userData={};const i=r.call(this,...e);this.userData=t,Df(i.userData,t);const n=this.parentRoot||void 0;return n&&n.assetType!=="model"&&console.warn("Cloning an IObject with a parent that is not an 'model' is not supported"),Wt.upgradeObject3D.call(i,n,this.objectProcessor),i.userData.cloneParent=this.uuid,i},copy:r=>function(e,...t){const i=this.isLight?this.target:null,n=e.userData;e.userData={};const s=this.userData;return r.call(this,e,...t),this.userData=s,e.userData=n,Df(this.userData,e.userData),i&&this.target&&(i.position.copy(this.target.position),i.updateMatrixWorld(),this.target=i),this},add:r=>function(...e){for(const t of e)Wt.upgradeObject3D.call(t,this.parentRoot||this,this.objectProcessor);return r.call(this,...e)},dispose:r=>function(e=!0){e&&this.parent&&(this.removeFromParent(),delete this.parentRoot),this.dispatchEvent({type:"dispose",bubbleToParent:!1});for(const t of[...this.children])t!=null&&t.dispose&&t.dispose(!1);r==null||r.call(this)}};function F1(r,e){var t,i;if(!this||(this.userData||(this.userData={}),this.userData.uuid=this.uuid,this.userData.__objectSetup))return;this.userData.__objectSetup=!0,this.objectProcessor||(this.objectProcessor=e||((t=this.parent)==null?void 0:t.objectProcessor)||(r==null?void 0:r.objectProcessor)),this.userData.__autoBubbleToParentEvents||(this.userData.__autoBubbleToParentEvents=["select"]),this.isLight?this.assetType="light":this.isCamera?this.assetType="camera":this.isWidget?this.assetType="widget":this.assetType="model",r&&(this.parentRoot=r),this.dispatchEvent=Wt.dispatchEvent(this.dispatchEvent),this.dispose=Wt.dispose(this.dispose),this.clone=Wt.clone(this.clone),this.copy=Wt.copy(this.copy),this.add=Wt.add(this.add),this.setDirty||(this.setDirty=Wt.setDirty),this.refreshUi||(this.refreshUi=Wt.refreshUi),this.autoScale||(this.autoScale=Wt.autoScale.bind(this)),this.autoCenter||(this.autoCenter=Wt.autoCenter.bind(this)),this.addEventListener("added",Wt.eventCallbacks.onAddedToParent),this.addEventListener("removed",Wt.eventCallbacks.onRemovedFromParent),(this.isMesh||this.isLine)&&!this.userData.__meshSetup&&(this.userData.__meshSetup=!0,this._onGeometryUpdate=s=>Wt.eventCallbacks.onGeometryUpdate.call(this,s),Wt.initMaterial.call(this),Wt.initGeometry.call(this),this.userData.__keepShadowDef||(this.castShadow=!0,this.receiveShadow=!0,this.userData.__keepShadowDef=!0),this.addEventListener("dispose",()=>{var s;(this.materials||[this.material]).forEach(a=>a==null?void 0:a.dispose(!1)),(s=this.geometry)==null||s.dispose(!1)})),!this.uiConfig&&(this.assetType==="model"||this.assetType==="camera")&&Wt.makeUiConfig.call(this);const n=[...this.children];for(const s of n)F1.call(s,this);!this.userData.dispose&&(this.userData.dispose=()=>{console.warn("userData.dispose is deprecated, use dispose directly"),this.dispose&&this.dispose()}),!this.modelObject&&Object.defineProperty(this,"modelObject",{get:()=>(console.error("modelObject is deprecated, use object directly"),this)}),!this.userData.setDirty&&(this.userData.setDirty=s=>{var a;console.error("object.userData.setDirty is deprecated, use object.setDirty directly"),(a=this.setDirty)==null||a.call(this,s)}),(i=this.objectProcessor)==null||i.processObject(this)}const Un={setDirty:function(r){this.controls&&this.controls.target&&this.target!==this.controls.target&&this.controls.target.copy(this.target),(!this.controls||!this.controls.enabled)&&this.userData.autoLookAtTarget&&this.lookAt(this.target),this.dispatchEvent({...r,type:"update"}),this.dispatchEvent({...r,type:"cameraUpdate",bubbleToParent:!0}),Wt.setDirty.call(this,{refreshScene:!1,...r})},activateMain:function(r={},e=!1,t=!0){if(!e)return r.camera===null?this.deactivateMain(r,e,t):this.dispatchEvent({type:"activateMain",...r,camera:this,bubbleToParent:!0});this.userData.__isMainCamera||(this.userData.__isMainCamera=!0,this.userData.__lastScale=this.scale.clone(),this.scale.divide(this.getWorldScale(new P)),t&&this.refreshCameraControls(!1),this.setDirty({change:"activateMain",...r}))},deactivateMain:function(r={},e=!1,t=!0){if(!e)return this.dispatchEvent({type:"activateMain",...r,camera:null,bubbleToParent:!0});this.userData.__isMainCamera&&(this.userData.__isMainCamera=!1,this.userData.__lastScale&&(this.scale.copy(this.userData.__lastScale),delete this.userData.__lastScale),t&&this.refreshCameraControls(!1),this.setDirty({change:"deactivateMain",...r}))},refreshUi:function(){var r,e;(e=(r=this.uiConfig)==null?void 0:r.uiRefresh)==null||e.call(r,!0,"postFrame",1)},refreshTarget:function(r=4,e=!0){var t;(t=this.controls)!=null&&t.enabled&&this.controls.target?this.controls.target!==this.target&&this.target.copy(this.controls.target):this.getWorldDirection(this.target).multiplyScalar(r).add(this.getWorldPosition(new P)),e&&this.setDirty({change:"target"})},upgradeCamera:JB,copy:r=>function(e,t,i,n,...s){var a,o;if(!e.isCamera)return console.error("ICamera.copy: camera is not a Camera",e),this;if(r.call(this,e,t,...s),(a=e.target)!=null&&a.isVector3)this.target.copy(e.target);else{const l=((o=this.controls)==null?void 0:o.minDistance)??i??4;e.getWorldDirection(this.target).multiplyScalar(l).add(this.getWorldPosition(new P))}if(n){const l=e.getWorldPosition(this.position);this.parent&&this.position.copy(this.parent.worldToLocal(l))}return this.updateMatrixWorld(!0),this.updateProjectionMatrix(),this.refreshAspect(!1),this.setDirty(),this}};function JB(){if(!this.isCamera){console.error("Object is not a camera",this);return}this.userData.__cameraSetup||(this.userData.__cameraSetup=!0,Wt.upgradeObject3D.call(this),this.copy=Un.copy(this.copy),this.target||(this.target=new P),this.refreshTarget||(this.refreshTarget=Un.refreshTarget),this.activateMain||(this.activateMain=Un.activateMain),this.deactivateMain||(this.deactivateMain=Un.deactivateMain),this.refreshUi||(this.refreshUi=Un.refreshUi),this.setDirty||(this.setDirty=Un.setDirty),this.assetType="camera")}const hc=new wf,on=new P,ol=new P,ji=new Ct,N1={X:new P(1,0,0),Y:new P(0,1,0),Z:new P(0,0,1)},$0={type:"change"},G1={type:"mouseDown"},z1={type:"mouseUp",mode:null},Q1={type:"objectChange"};class ll extends It{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const i=new W1;this._gizmo=i,this.add(i);const n=new X1;this._plane=n,this.add(n);const s=this;function a(E,_){let C=_;Object.defineProperty(s,E,{get:function(){return C!==void 0?C:_},set:function(M){C!==M&&(C=M,n[E]=M,i[E]=M,s.dispatchEvent({type:E+"-changed",value:M}),s.dispatchEvent($0))}}),s[E]=_,n[E]=_,i[E]=_}a("camera",e),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0);const o=new P,l=new P,c=new Ct,h=new Ct,d=new P,m=new Ct,f=new P,v=new P,w=new P,b=0,y=new P;a("worldPosition",o),a("worldPositionStart",l),a("worldQuaternion",c),a("worldQuaternionStart",h),a("cameraPosition",d),a("cameraQuaternion",m),a("pointStart",f),a("pointEnd",v),a("rotationAxis",w),a("rotationAngle",b),a("eye",y),this._offset=new P,this._startNorm=new P,this._endNorm=new P,this._cameraScale=new P,this._parentPosition=new P,this._parentQuaternion=new Ct,this._parentQuaternionInv=new Ct,this._parentScale=new P,this._worldScaleStart=new P,this._worldQuaternionInv=new Ct,this._worldScale=new P,this._positionStart=new P,this._quaternionStart=new Ct,this._scaleStart=new P,this._getPointer=ZB.bind(this),this._onPointerDown=eL.bind(this),this._onPointerHover=$B.bind(this),this._onPointerMove=tL.bind(this),this._onPointerUp=iL.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0||e.buttons)return;hc.setFromCamera(e,this.camera);const t=ey(this._gizmo.picker[this.mode],hc);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e.button!==0)&&this.axis!==null){hc.setFromCamera(e,this.camera);const t=ey(this._plane,hc,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,G1.mode=this.mode,this.dispatchEvent(G1)}}pointerMove(e){const t=this.axis,i=this.mode,n=this.object;let s=this.space;if(i==="scale"?s="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(s="world"),n===void 0||t===null||this.dragging===!1||e.button!==-1)return;hc.setFromCamera(e,this.camera);const a=ey(this._plane,hc,!0);if(a){if(this.pointEnd.copy(a.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),s==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),s==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),n.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(s==="local"&&(n.position.applyQuaternion(ji.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this._quaternionStart)),s==="world"&&(n.parent&&n.position.add(on.setFromMatrixPosition(n.parent.matrixWorld)),t.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(on.setFromMatrixPosition(n.parent.matrixWorld))));else if(i==="scale"){if(t.search("XYZ")!==-1){let o=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(o*=-1),ol.set(o,o,o)}else on.copy(this.pointStart),ol.copy(this.pointEnd),on.applyQuaternion(this._worldQuaternionInv),ol.applyQuaternion(this._worldQuaternionInv),ol.divide(on),t.search("X")===-1&&(ol.x=1),t.search("Y")===-1&&(ol.y=1),t.search("Z")===-1&&(ol.z=1);n.scale.copy(this._scaleStart).multiply(ol),this.scaleSnap&&(t.search("X")!==-1&&(n.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const o=20/this.worldPosition.distanceTo(on.setFromMatrixPosition(this.camera.matrixWorld));let l=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(on.copy(this.rotationAxis).cross(this.eye))*o):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(N1[t]),on.copy(N1[t]),s==="local"&&on.applyQuaternion(this.worldQuaternion),on.cross(this.eye),on.length()===0?l=!0:this.rotationAngle=this._offset.dot(on.normalize())*o),(t==="E"||l)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),s==="local"&&t!=="E"&&t!=="XYZE"?(n.quaternion.copy(this._quaternionStart),n.quaternion.multiply(ji.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),n.quaternion.copy(ji.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent($0),this.dispatchEvent(Q1)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(z1.mode=this.mode,this.dispatchEvent(z1)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent($0),this.dispatchEvent(Q1),this.pointStart.copy(this.pointEnd))}getRaycaster(){return hc}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}ll.ObjectConstructors={MeshBasicMaterial:Pn,LineBasicMaterial:Ji};function ZB(r){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:r.button,buttons:r.buttons};{const e=this.domElement.getBoundingClientRect();return{x:(r.clientX-e.left)/e.width*2-1,y:-(r.clientY-e.top)/e.height*2+1,button:r.button,buttons:r.buttons}}}function $B(r){if(this.enabled)switch(r.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(r));break}}function eL(r){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(r.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(r)),this.pointerDown(this._getPointer(r)))}function tL(r){this.enabled&&this.pointerMove(this._getPointer(r))}function iL(r){this.enabled&&(this.domElement.releasePointerCapture(r.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(r)))}function ey(r,e,t){const i=e.intersectObject(r,!0);for(let n=0;n<i.length;n++)if(i[n].object.visible||t)return i[n];return!1}const $f=new Di,Ii=new P(0,1,0),V1=new P(0,0,0),j1=new et,eg=new Ct,tg=new Ct,ba=new P,H1=new et,zp=new P(1,0,0),uc=new P(0,1,0),Qp=new P(0,0,1),ig=new P,Vp=new P,jp=new P;class W1 extends It{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new ll.ObjectConstructors.MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new ll.ObjectConstructors.LineBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=e.clone();i.opacity=.15;const n=t.clone();n.opacity=1;const s=e.clone();s.color.setHex(15663205),s.opacity=.95;const a=e.clone();a.color.setHex(2014720),a.opacity=.95;const o=e.clone();o.color.setHex(37885),o.opacity=.95;const l=e.clone();l.color.setHex(16618689),l.__color=s.color.getHex();const c=e.clone();c.color.setHex(12516474),c.__color=a.color.getHex();const h=e.clone();h.color.setHex(11397372),h.__color=o.color.getHex();const d=e.clone();d.color.setHex(15663205),d.opacity=.75;const m=e.clone();m.color.setHex(2014720),m.opacity=.75;const f=e.clone();f.color.setHex(37885),f.opacity=.75;const v=e.clone();v.color.setHex(12893629),v.opacity=.75;const w=e.clone();w.color.setHex(16777051),w.opacity=.25;const b=e.clone();b.color.setHex(7895160),b.opacity=.75;const y=new kr(0,.04,.1,12);y.translate(0,.05,0);const E=new Bi(.08,.08,.08);E.translate(0,.04,0);const _=new ht;_.setAttribute("position",new Ne([0,0,0,1,0,0],3));const C=new kr(.0075,.0075,.5,3);C.translate(0,.25,0);function M(he,_e){const ge=new wh(he,.0075,3,64,_e*Math.PI*2);return ge.rotateY(Math.PI/2),ge.rotateX(Math.PI/2),ge}function S(he,_e){const ge=new wh(he,.1,4,24,_e*Math.PI*2);return ge.rotateY(Math.PI/2),ge.rotateX(Math.PI/2),ge}function R(){const he=new ht;return he.setAttribute("position",new Ne([0,0,0,1,1,1],3)),he}const U={X:[[new Fe(y,l),[.5,0,0],[0,0,-Math.PI/2]],[new Fe(C,s),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new Fe(y,c),[0,.5,0]],[new Fe(C,a)]],Z:[[new Fe(y,h),[0,0,.5],[Math.PI/2,0,0]],[new Fe(C,o),null,[Math.PI/2,0,0]]],XYZ:[[new Fe(new eo(.1,2),v.clone()),[0,0,0]]],XY:[[new Fe(new Bi(.2,.2,.01),f.clone()),[.2,.2,0]]],YZ:[[new Fe(new Bi(.2,.2,.01),d.clone()),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new Fe(new Bi(.2,.2,.01),m.clone()),[.2,0,.2],[-Math.PI/2,0,0]]]},T={X:[[new Fe(new kr(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]]],Y:[[new Fe(new kr(.2,0,.6,4),i),[0,.3,0]]],Z:[[new Fe(new kr(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]]],XYZ:[[new Fe(new eo(.2,0),i)]],XY:[[new Fe(new Bi(.25,.25,.01),i),[.2,.2,0]]],YZ:[[new Fe(new Bi(.25,.25,.01),i),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new Fe(new Bi(.25,.25,.01),i),[.2,0,.2],[-Math.PI/2,0,0]]]},B={START:[[new Fe(new eo(.01,2),n),null,null,null,"helper"]],END:[[new Fe(new eo(.01,2),n),null,null,null,"helper"]],DELTA:[[new Tr(R(),n),null,null,null,"helper"]],X:[[new Tr(_,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Tr(_,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Tr(_,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},Q={XYZE:[[new Fe(new Gs(.1,10,8),v)],[new Fe(M(.5,1),b),null,[0,Math.PI/2,0]]],X:[[new Fe(M(.5,.5),s)],[new Fe(C,s),[0,0,0],[0,0,-Math.PI/2]],[new Fe(y.clone().translate(.5,0,0),l),[0,0,0],[-Math.PI/2,-Math.PI/2,-Math.PI/2]]],Y:[[new Fe(M(.5,.5),a),null,[0,0,-Math.PI/2]],[new Fe(C,a)],[new Fe(y.clone().rotateZ(-Math.PI/2).translate(0,.5,0),c),[0,0,0],[Math.PI/2,0,0]]],Z:[[new Fe(M(.5,.5),o),null,[0,Math.PI/2,0]],[new Fe(C,o),null,[Math.PI/2,0,0]],[new Fe(y.clone().rotateZ(-Math.PI).translate(0,0,.5),h),[0,0,0],[0,Math.PI/2,0]]]},Z={AXIS:[[new Tr(_,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},q={XYZE:[[new Fe(new Gs(.25,10,8),i)]],X:[[new Fe(S(.5,.5),i)]],Y:[[new Fe(S(.5,.5),i),[0,0,0],[0,0,-Math.PI/2]]],Z:[[new Fe(S(.5,.5),i),[0,0,0],[0,Math.PI/2,0]]]},X={X:[[new Fe(E,l),[.5,0,0],[0,0,-Math.PI/2]],[new Fe(C,s),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new Fe(E,c),[0,.5,0]],[new Fe(C,a)]],Z:[[new Fe(E,h),[0,0,.5],[Math.PI/2,0,0]],[new Fe(C,o),[0,0,0],[Math.PI/2,0,0]]],XY:[[new Fe(new Bi(.15,.15,.01),f),[.15,.15,0]]],YZ:[[new Fe(new Bi(.15,.15,.01),d),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Fe(new Bi(.15,.15,.01),m),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Fe(new Bi(.1,.1,.1),v.clone())]]},te={X:[[new Fe(new kr(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new Fe(new kr(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Fe(new kr(.2,0,.6,4),i),[0,.3,0]],[new Fe(new kr(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Fe(new kr(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new Fe(new kr(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new Fe(new Bi(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new Fe(new Bi(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Fe(new Bi(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Fe(new Bi(.2,.2,.2),i),[0,0,0]]]},me={X:[[new Tr(_,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Tr(_,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Tr(_,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function se(he){const _e=new It;for(const ge in he)for(let Oe=he[ge].length;Oe--;){const oe=he[ge][Oe][0].clone(),be=he[ge][Oe][1],Me=he[ge][Oe][2],Ve=he[ge][Oe][3],Ue=he[ge][Oe][4];oe.name=ge,oe.tag=Ue,be&&oe.position.set(be[0],be[1],be[2]),Me&&oe.rotation.set(Me[0],Me[1],Me[2]),Ve&&oe.scale.set(Ve[0],Ve[1],Ve[2]),oe.updateMatrix();const rt=oe.geometry.clone();rt.applyMatrix4(oe.matrix),oe.geometry=rt,oe.renderOrder=1/0,oe.position.set(0,0,0),oe.rotation.set(0,0,0),oe.scale.set(1,1,1),_e.add(oe)}return _e}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=se(U)),this.add(this.gizmo.rotate=se(Q)),this.add(this.gizmo.scale=se(X)),this.add(this.picker.translate=se(T)),this.add(this.picker.rotate=se(q)),this.add(this.picker.scale=se(te)),this.add(this.helper.translate=se(B)),this.add(this.helper.rotate=se(Z)),this.add(this.helper.scale=se(me)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:tg;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let n=0;n<i.length;n++){const s=i[n];s.visible=!0,s.rotation.set(0,0,0),s.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),s.scale.set(1,1,1).multiplyScalar(a*this.size/4),s.tag==="helper"){s.visible=!1,s.name==="AXIS"?(s.visible=!!this.axis,this.axis==="X"&&(ji.setFromEuler($f.set(0,0,0)),s.quaternion.copy(t).multiply(ji),Math.abs(Ii.copy(zp).applyQuaternion(t).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="Y"&&(ji.setFromEuler($f.set(0,0,Math.PI/2)),s.quaternion.copy(t).multiply(ji),Math.abs(Ii.copy(uc).applyQuaternion(t).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="Z"&&(ji.setFromEuler($f.set(0,Math.PI/2,0)),s.quaternion.copy(t).multiply(ji),Math.abs(Ii.copy(Qp).applyQuaternion(t).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="XYZE"&&(ji.setFromEuler($f.set(0,Math.PI/2,0)),Ii.copy(this.rotationAxis),s.quaternion.setFromRotationMatrix(j1.lookAt(V1,Ii,uc)),s.quaternion.multiply(ji),s.visible=this.dragging),this.axis==="E"&&(s.visible=!1)):s.name==="START"?(s.position.copy(this.worldPositionStart),s.visible=this.dragging):s.name==="END"?(s.position.copy(this.worldPosition),s.visible=this.dragging):s.name==="DELTA"?(s.position.copy(this.worldPositionStart),s.quaternion.copy(this.worldQuaternionStart),on.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),on.applyQuaternion(this.worldQuaternionStart.clone().invert()),s.scale.copy(on),s.visible=this.dragging):(s.quaternion.copy(t),this.dragging?s.position.copy(this.worldPositionStart):s.position.copy(this.worldPosition),this.axis&&(s.visible=this.axis.search(s.name)!==-1));continue}s.quaternion.copy(t),this.mode==="translate"||this.mode==="scale"?(s.name==="X"&&Math.abs(Ii.copy(zp).applyQuaternion(t).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="Y"&&Math.abs(Ii.copy(uc).applyQuaternion(t).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="Z"&&Math.abs(Ii.copy(Qp).applyQuaternion(t).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="XY"&&Math.abs(Ii.copy(Qp).applyQuaternion(t).dot(this.eye))<.2&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="YZ"&&Math.abs(Ii.copy(zp).applyQuaternion(t).dot(this.eye))<.2&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="XZ"&&Math.abs(Ii.copy(uc).applyQuaternion(t).dot(this.eye))<.2&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1)):this.mode==="rotate"&&(eg.copy(t),Ii.copy(this.eye).applyQuaternion(ji.copy(t).invert()),s.name.search("E")!==-1&&s.quaternion.setFromRotationMatrix(j1.lookAt(this.eye,V1,uc)),s.name==="X"&&(ji.setFromAxisAngle(zp,Math.atan2(-Ii.y,Ii.z)),ji.multiplyQuaternions(eg,ji),s.quaternion.copy(ji)),s.name==="Y"&&(ji.setFromAxisAngle(uc,Math.atan2(Ii.x,Ii.z)),ji.multiplyQuaternions(eg,ji),s.quaternion.copy(ji)),s.name==="Z"&&(ji.setFromAxisAngle(Qp,Math.atan2(Ii.y,Ii.x)),ji.multiplyQuaternions(eg,ji),s.quaternion.copy(ji))),s.visible=s.visible&&(s.name.indexOf("X")===-1||this.showX),s.visible=s.visible&&(s.name.indexOf("Y")===-1||this.showY),s.visible=s.visible&&(s.name.indexOf("Z")===-1||this.showZ),s.visible=s.visible&&(s.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),s.material._color=s.material._color||s.material.color.clone(),s.material._opacity=s.material._opacity||s.material.opacity,s.material.color.copy(s.material._color),s.material.opacity=s.material._opacity,this.enabled&&this.axis&&(s.name===this.axis||this.axis.split("").some(function(o){return s.name===o}))&&(s.material.__color&&s.material.color.setHex(s.material.__color),s.material.opacity=1)}super.updateMatrixWorld(e)}}class X1 extends Fe{constructor(){super(new as(1e5,1e5,2,2),new ll.ObjectConstructors.MeshBasicMaterial({visible:!1,wireframe:!0,side:dt,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),ig.copy(zp).applyQuaternion(t==="local"?this.worldQuaternion:tg),Vp.copy(uc).applyQuaternion(t==="local"?this.worldQuaternion:tg),jp.copy(Qp).applyQuaternion(t==="local"?this.worldQuaternion:tg),Ii.copy(Vp),this.mode){case"translate":case"scale":switch(this.axis){case"X":Ii.copy(this.eye).cross(ig),ba.copy(ig).cross(Ii);break;case"Y":Ii.copy(this.eye).cross(Vp),ba.copy(Vp).cross(Ii);break;case"Z":Ii.copy(this.eye).cross(jp),ba.copy(jp).cross(Ii);break;case"XY":ba.copy(jp);break;case"YZ":ba.copy(ig);break;case"XZ":Ii.copy(jp),ba.copy(Vp);break;case"XYZ":case"E":ba.set(0,0,0);break}break;case"rotate":default:ba.set(0,0,0)}ba.length()===0?this.quaternion.copy(this.cameraQuaternion):(H1.lookAt(on.set(0,0,0),ba,Ii),this.quaternion.setFromRotationMatrix(H1)),super.updateMatrixWorld(e)}}var rL=Object.defineProperty,nL=Object.getOwnPropertyDescriptor,pc=(r,e,t,i)=>{for(var n=i>1?void 0:i?nL(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&rL(e,t,n),n};p.TransformControls2=class extends ll{constructor(r,e){super(r,e),this.isWidget=!0,this.assetType="widget",this.setDirty=Wt.setDirty.bind(this),this.refreshUi=Wt.refreshUi.bind(this),this.visible=!1,this.userData.bboxVisible=!1,this.size=2,this.addEventListener("objectChange",()=>{var t;(t=this==null?void 0:this.object)==null||t.setDirty({fadeFrame:!1})}),this.addEventListener("change",()=>{this.setDirty({fadeFrame:!1})}),this._keyUpListener=this._keyUpListener.bind(this),this._keyDownListener=this._keyDownListener.bind(this),window.addEventListener("keydown",this._keyDownListener),window.addEventListener("keyup",this._keyUpListener)}_keyDownListener(r){if(this.enabled&&this.object){switch(r.code){case"KeyQ":this.space=this.space==="local"?"world":"local";break;case"ShiftLeft":this.translationSnap=.5,this.rotationSnap=Zt.degToRad(15),this.scaleSnap=.25;break;case"KeyW":this.mode="translate";break;case"KeyE":this.mode="rotate";break;case"KeyR":this.mode="scale";break;case"Equal":case"NumpadAdd":case"Plus":this.size=this.size+.1;break;case"Minus":case"NumpadSubtract":case"Underscore":this.size=Math.max(this.size-.1,.1);break;case"KeyX":this.showX=!this.showX;break;case"KeyY":this.showY=!this.showY;break;case"KeyZ":this.showZ=!this.showZ;break;case"Space":this.enabled=!this.enabled;break;default:return}this.setDirty({refreshScene:!0,frameFade:!0})}}_keyUpListener(r){if(this.enabled){switch(r.code){case"ShiftLeft":this.translationSnap=null,this.rotationSnap=null,this.scaleSnap=null;break}if(this.object)switch(r.code){}}}dispose(){window.removeEventListener("keydown",this._keyDownListener),window.removeEventListener("keyup",this._keyUpListener),super.dispose()}get modelObject(){return this}},pc([js("Mode",["translate","rotate","scale"].map(r=>({label:r})))],p.TransformControls2.prototype,"mode",2),pc([js("Space",["world","local"].map(r=>({label:r})))],p.TransformControls2.prototype,"space",2),pc([Rt("Size",[.1,10],.1)],p.TransformControls2.prototype,"size",2),pc([De("Show X")],p.TransformControls2.prototype,"showX",2),pc([De("Show Y")],p.TransformControls2.prototype,"showY",2),pc([De("Show Z")],p.TransformControls2.prototype,"showZ",2),p.TransformControls2=pc([ti("Transform Controls")],p.TransformControls2);var sL=Object.defineProperty,aL=Object.getOwnPropertyDescriptor,ln=(r,e,t,i)=>{for(var n=i>1?void 0:i?aL(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&sL(e,t,n),n};const q1=new P,ty=new ic,iy=new P,oL={type:"change"};p.FirstPersonControls2=class extends zi{constructor(r,e){super(),this.enabled=!0,this.enableKeys=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.pointerX=0,this.pointerY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.viewHalfX=0,this.viewHalfY=0,this.lat=0,this.lon=0,this.targetPosition=new P,this._lastTime=-1,this.object=r,this.domElement=e,this.onPointerMove=this.onPointerMove.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointerup",this.onPointerUp),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize(),this.setOrientation()}setOrientation(){const r=this.object.quaternion;q1.set(0,0,-1).applyQuaternion(r),ty.setFromVector3(q1),this.lat=90-Zt.radToDeg(ty.phi),this.lon=Zt.radToDeg(ty.theta)}handleResize(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}onPointerDown(r){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(r.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0;break}this.mouseDragOn=!0}onPointerUp(r){if(this.activeLook)switch(r.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1;break}this.mouseDragOn=!1}onPointerMove(r){this.domElement===document?(this.pointerX=r.pageX-this.viewHalfX,this.pointerY=r.pageY-this.viewHalfY):(this.pointerX=r.pageX-this.domElement.offsetLeft-this.viewHalfX,this.pointerY=r.pageY-this.domElement.offsetTop-this.viewHalfY)}onKeyDown(r){if(this.enableKeys)switch(r.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0;break}}onKeyUp(r){if(this.enableKeys)switch(r.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1;break}}lookAt(r,e,t){return r.isVector3?iy.copy(r):e===void 0||t===void 0?console.error("FirstPersonControls2.lookAt: y and z parameters are required"):iy.set(r,e,t),this.object.lookAt(iy),this.setOrientation(),this}update(){const r=nn(),e=(this._lastTime<0?16:Math.min(r-this._lastTime,1e3))/1e3;if(this._lastTime=r,!this.enabled)return;if(this.heightSpeed){const l=Zt.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(l*this.heightCoef)}else this.autoSpeedFactor=0;const t=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(t+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(t),this.moveLeft&&this.object.translateX(-t),this.moveRight&&this.object.translateX(t),this.moveUp&&this.object.translateY(t),this.moveDown&&this.object.translateY(-t);let i=e*this.lookSpeed;this.activeLook||(i=0);let n=1;this.constrainVertical&&(n=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.pointerX*i,this.lookVertical&&(this.lat-=this.pointerY*i*n),this.lat=Math.max(-85,Math.min(85,this.lat));let s=Zt.degToRad(90-this.lat);const a=Zt.degToRad(this.lon);this.constrainVertical&&(s=Zt.mapLinear(s,0,Math.PI,this.verticalMin,this.verticalMax));const o=this.object.position;this.targetPosition.setFromSphericalCoords(1,s,a).add(o),this.object.lookAt(this.targetPosition),this.dispatchEvent(oL)}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}onContextMenu(r){this.enableKeys&&r.preventDefault()}},ln([$(),De()],p.FirstPersonControls2.prototype,"enabled",2),ln([$(),De()],p.FirstPersonControls2.prototype,"enableKeys",2),ln([$(),Lt()],p.FirstPersonControls2.prototype,"movementSpeed",2),ln([$(),Lt()],p.FirstPersonControls2.prototype,"lookSpeed",2),ln([$(),De()],p.FirstPersonControls2.prototype,"lookVertical",2),ln([$(),De()],p.FirstPersonControls2.prototype,"autoForward",2),ln([$(),De()],p.FirstPersonControls2.prototype,"activeLook",2),ln([$(),De()],p.FirstPersonControls2.prototype,"heightSpeed",2),ln([$(),Lt()],p.FirstPersonControls2.prototype,"heightCoef",2),ln([$(),Lt()],p.FirstPersonControls2.prototype,"heightMin",2),ln([$(),Lt()],p.FirstPersonControls2.prototype,"heightMax",2),ln([$(),De()],p.FirstPersonControls2.prototype,"constrainVertical",2),ln([$(),Lt()],p.FirstPersonControls2.prototype,"verticalMin",2),ln([$(),Lt()],p.FirstPersonControls2.prototype,"verticalMax",2),ln([$(),De()],p.FirstPersonControls2.prototype,"mouseDragOn",2),p.FirstPersonControls2=ln([Xr("First Person Controls")],p.FirstPersonControls2);var lL=Object.defineProperty,cL=Object.getOwnPropertyDescriptor,Rh=(r,e,t,i)=>{for(var n=i>1?void 0:i?cL(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&lL(e,t,n),n};const Dh=new Di(0,0,0,"YXZ"),Bh=new P,hL={type:"change"},uL={type:"lock"},pL={type:"unlock"},Y1=Math.PI/2;p.PointerLockControls2=class extends zi{constructor(r,e){super(),this.isLocked=!1,this.enabled=!0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this.autoLockOnClick=!0,this._movementX=0,this._movementY=0,this._forwardDirection=new P(0,0,-1),this.domElement=e,this.object=r,this.onElementClick=this.onElementClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onPointerlockChange=this.onPointerlockChange.bind(this),this.onPointerlockError=this.onPointerlockError.bind(this),this.connect()}onElementClick(r){this.isLocked||this.autoLockOnClick&&(r.preventDefault(),this.lock())}onMouseMove(r){this.isLocked&&(this._movementX+=r.movementX||r.mozMovementX||r.webkitMovementX||0,this._movementY+=r.movementY||r.mozMovementY||r.webkitMovementY||0)}onPointerlockChange(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(uL),this.isLocked=!0):(this.dispatchEvent(pL),this.isLocked=!1)}onPointerlockError(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.addEventListener("click",this.onElementClick)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.removeEventListener("click",this.onElementClick)}dispose(){this.disconnect()}getDirection(r){return r.copy(this._forwardDirection).applyQuaternion(this.object.quaternion)}moveForward(r){Bh.setFromMatrixColumn(this.object.matrix,0),Bh.crossVectors(this.object.up,Bh),this.object.position.addScaledVector(Bh,r)}moveRight(r){Bh.setFromMatrixColumn(this.object.matrix,0),this.object.position.addScaledVector(Bh,r)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}update(){Math.abs(this._movementX)<1e-4&&Math.abs(this._movementY)<1e-4||(Dh.setFromQuaternion(this.object.quaternion),Dh.y-=this._movementX*.002*this.pointerSpeed,Dh.x-=this._movementY*.002*this.pointerSpeed,this._movementX=0,this._movementY=0,Dh.x=Math.max(Y1-this.maxPolarAngle,Math.min(Y1-this.minPolarAngle,Dh.x)),this.object.quaternion.setFromEuler(Dh),this.dispatchEvent(hL))}},Rh([De(),$()],p.PointerLockControls2.prototype,"enabled",2),Rh([Lt(),$()],p.PointerLockControls2.prototype,"minPolarAngle",2),Rh([Lt(),$()],p.PointerLockControls2.prototype,"maxPolarAngle",2),Rh([Lt(),$()],p.PointerLockControls2.prototype,"pointerSpeed",2),Rh([De(),$()],p.PointerLockControls2.prototype,"autoLockOnClick",2),p.PointerLockControls2=Rh([Xr("Pointer Lock Controls")],p.PointerLockControls2);var dL=Object.defineProperty,mL=Object.getOwnPropertyDescriptor,Hp=(r,e,t,i)=>{for(var n=i>1?void 0:i?mL(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&dL(e,t,n),n};const fL=new P(0,0,1),K1=new Di,gL=new Ct,AL=new Ct(-Math.sqrt(.5),0,0,Math.sqrt(.5)),Lh=new Ct,vL={type:"change"},yL=1e-6;p.DeviceOrientationControls2=class extends zi{constructor(r){super(),this.enabled=!1,this.lastOrder="XYZ",this.dampingFactor=.05,this.lastQuaternion=new Ct,this.onDeviceOrientationChangeEvent=e=>{this.deviceOrientation=e},this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this._initQuaternion=new Ct,this._initQuaternionInvert=new Ct,this._initQuaternionDest=new Ct,this._lastTime=-1,window.isSecureContext===!1&&console.error("DeviceOrientationControls2: DeviceOrientationEvent is only available in secure contexts (https)"),this.object=r,this.lastOrder=this.object.rotation.order,this.object.rotation.reorder("YXZ"),this.connect()}resetView(){this._initQuaternionDest.__init=!1}connect(){this.enabled||(this.onScreenOrientationChangeEvent(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(r=>{r=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(r=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",r)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0,this._initQuaternion.copy(this.object.quaternion),this._initQuaternionInvert.copy(this.object.quaternion).invert())}disconnect(){this.enabled&&(window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternion.identity(),this._initQuaternionInvert.identity(),this._initQuaternionDest=new Ct,this.object.rotation.reorder(this.lastOrder),this.lastOrder="XYZ",this.enabled=!1)}update(){if(!this.enabled)return;const r=this.deviceOrientation;if(r){const e=r.alpha!==null?Zt.degToRad(r.alpha):0,t=r.beta!==null?Zt.degToRad(r.beta):0,i=r.gamma!==null?Zt.degToRad(r.gamma):0,n=this.screenOrientation?Zt.degToRad(this.screenOrientation.angle):0;this.setObjectQuaternion(e,t,i,n),8*(1-this.lastQuaternion.dot(this.object.quaternion))>yL&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(vL))}}dispose(){this.disconnect()}setObjectQuaternion(r,e,t,i){const n=nn()/1e3;K1.set(e,r,-t,"YXZ"),Lh.setFromEuler(K1),Lh.multiply(AL),Lh.multiply(gL.setFromAxisAngle(fL,-i)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(Lh).invert(),this._initQuaternionDest.__init=!0),Lh.premultiply(this._initQuaternionDest);const s=1/60;this.object.quaternion.multiply(this._initQuaternionInvert),this.object.quaternion.slerp(Lh,this.dampingFactor/(Math.min(1,n-this._lastTime)/s)),this.object.quaternion.multiply(this._initQuaternion),this._lastTime=n}},Hp([$(),Rt("Damping",[0,1],.01)],p.DeviceOrientationControls2.prototype,"dampingFactor",2),Hp([ci("Reset View")],p.DeviceOrientationControls2.prototype,"resetView",1),Hp([ci()],p.DeviceOrientationControls2.prototype,"connect",1),Hp([ci()],p.DeviceOrientationControls2.prototype,"disconnect",1),p.DeviceOrientationControls2=Hp([Xr("Device Orientation Controls")],p.DeviceOrientationControls2);const no=new P,dc=new P,rg=new P,ry=new P,ng=new P,Uh=new P;let ny=1;const _L=new P(0,1,0);class bL extends Z0{constructor(e,t){super(e,t),this.throttleUpdate=60,this.targetOffset=new P(0,0,0);const i=this.update;this.update=()=>this._update(i)}_update(e){this.target.add(this.targetOffset),no.copy(this.object.position).sub(this.target),ny=no.length(),Uh.copy(this.target);const t=e();return Uh.sub(this.target),no.copy(this.object.position).sub(this.target),ny/=no.length(),this.target.add(Uh),this.object.position.copy(this.target).add(no),no.normalize(),dc.crossVectors(_L,no).normalize(),rg.crossVectors(no,dc).normalize(),ry.crossVectors(dc,rg).normalize().negate(),dc.length()>.1&&this.object.up.crossVectors(no.clone().normalize(),dc),this.enablePan&&(ng.set(0,0,0).addScaledVector(dc,Uh.x).addScaledVector(rg,Uh.y).addScaledVector(ry,Uh.z),this.targetOffset.add(ng),this.targetOffset.multiplyScalar(1/ny)),ng.set(0,0,0).addScaledVector(dc,-this.targetOffset.x).addScaledVector(rg,-this.targetOffset.y).addScaledVector(ry,-this.targetOffset.z),this.object.lookAt(ng.add(this.target)),this.object.updateMatrixWorld(),this.object.isCamera&&this.object.updateProjectionMatrix(),this.target.sub(this.targetOffset),t}}class J1 extends fn{constructor(){super(),this.isWidget=!0,this._object=null,this.boundingScaleMultiplier=1,this.position.set(0,0,0),this.visible=!1,this.renderOrder=100,this.userData.bboxVisible=!1,this._updater=this._updater.bind(this)}_updater(){const e=this._object;if(e){const t=new Vs().expandByObject(e,!1);t.getCenter(this.position);const i=t.getBoundingSphere(new zr).radius;this.scale.setScalar(i*this.boundingScaleMultiplier),this.setVisible(!0)}else this.setVisible(!1)}setVisible(e){var t;e!==this.visible&&(this.visible=e,(t=this.setDirty)==null||t.call(this,{sceneUpdate:!1}))}attach(e){return this.detach(),e?(this._object=e,this._object.addEventListener("objectUpdate",this._updater),this._object.addEventListener("geometryUpdate",this._updater),this._updater(),this):this}detach(){var e,t;return this._object?((e=this._object)==null||e.removeEventListener("objectUpdate",this._updater),(t=this._object)==null||t.removeEventListener("geometryUpdate",this._updater),this._object=null,this._updater(),this):this}get object(){return this._object}dispose(){this.detach()}}var wL=Object.defineProperty,xL=(r,e,t,i)=>{for(var n=void 0,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=a(e,t,n)||n);return n&&wL(e,t,n),n};const sy=class extends It{constructor(r){super(),this.modelObject=this,this.isWidget=!0,this.assetType="widget",this.visible=!0,this.uiConfig=Zf("Widget",this),this.object=r,this.object.updateMatrixWorld(),this.object.updateProjectionMatrix&&this.object.updateProjectionMatrix(),this.matrix=r.matrixWorld,this.matrixAutoUpdate=!1,this._objectUpdate=this._objectUpdate.bind(this),this.attach(r),this.traverse(e=>{e.userData.__keepShadowDef=!0,e.castShadow=!1,e.receiveShadow=!1})}dispose(){this.detach()}update(){Wt.setDirty.call(this)}_objectUpdate(){this.object&&this.update()}attach(r){var e,t;return this.object&&this.detach(),this.object=r,this.object&&(this.update(),this.object.addEventListener("objectUpdate",this._objectUpdate),this.object.addEventListener("dispose",this.dispose),this.uiConfig&&((t=(e=this.object.uiConfig)==null?void 0:e.children)==null||t.push(this.uiConfig)),this.visible=!0),this}detach(){var r,e,t,i;if(this.object){if(this.object.removeEventListener("objectUpdate",this._objectUpdate),this.object.removeEventListener("dispose",this.dispose),this.uiConfig){const n=(e=(r=this.object.uiConfig)==null?void 0:r.children)==null?void 0:e.indexOf(this.uiConfig);n!==void 0&&n>=0&&((i=(t=this.object.uiConfig)==null?void 0:t.children)==null||i.splice(n,1))}this.object=void 0,this.visible=!1}return this}};xL([De(),Ir(sy.prototype.update)],sy.prototype,"visible");let ay=sy;class Z1 extends ay{constructor(e){super(e),this.camera=e,this.traverse(t=>{t.userData.__keepShadowDef=!0,t.castShadow=!1,t.receiveShadow=!1})}}class sg extends ay{constructor(e){super(e),this.light=e,this.traverse(t=>{t.userData.__keepShadowDef=!0,t.castShadow=!1,t.receiveShadow=!1})}}function Hi(r,e){return{type:"folder",label:e+" Sampler",hidden:()=>!r[e],onChange:()=>r.setDirty(),children:[()=>({type:"vec2",label:"Repeat",stepSize:.001,property:[r[e],"repeat"]}),()=>({type:"vec2",label:"Offset",stepSize:.001,property:[r[e],"offset"]}),()=>({type:"vec2",label:"Center",stepSize:.001,property:[r[e],"center"]}),()=>({type:"input",label:"Rotation",stepSize:.001,bounds:[-Math.PI,Math.PI],property:[r[e],"rotation"]}),()=>({type:"dropdown",label:"Color space",property:[r[e],"colorSpace"],children:[["Linear",wi],["sRGB",it]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{const t=r[e];t&&(t.needsUpdate=!0)}]}),()=>({type:"dropdown",label:"UV Channel",property:[r[e],"channel"],children:[0,1,2,3].map(t=>({label:t.toString(),value:t})),onChange:()=>{const t=r[e];t&&(t.needsUpdate=!0)}}),()=>({type:"checkbox",label:"Flip Y",getValue:()=>{var t;return((t=r[e])==null?void 0:t.flipY)??!1},setValue:t=>{var i;const n=r[e];if(n&&n.flipY!==t)if(n.image&&ImageBitmap&&n.image instanceof ImageBitmap){const s=n,a=n.source.data;createImageBitmap(a,{imageOrientation:"flipY"}).then(o=>{var l;a.close&&a.close(),s.flipY=t,s.source.data=o,s.source.needsUpdate=!0,s.needsUpdate=!0,(l=r==null?void 0:r.setDirty)==null||l.call(r)})}else n.flipY=t,n.needsUpdate=!0,(i=r==null?void 0:r.setDirty)==null||i.call(r)}}),()=>({type:"dropdown",label:"Wrap S",property:[r[e],"wrapS"],children:[["ClampToEdge",ai],["MirroredRepeat",bs],["Repeat",Ar]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{r[e]&&(r[e].needsUpdate=!0)}]}),()=>({type:"dropdown",label:"Wrap T",property:[r[e],"wrapT"],children:[["ClampToEdge",ai],["MirroredRepeat",bs],["Repeat",Ar]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{r[e]&&(r[e].needsUpdate=!0)}]}),()=>({type:"input",label:"Anisotropy",bounds:[1,6],stepSize:1,property:[r[e],"anisotropy"],onChange:[()=>{r[e]&&(r[e].needsUpdate=!0),r.needsUpdate=!0}]}),()=>({type:"dropdown",label:"Min Filter",property:[r[e],"minFilter"],children:[["Linear",Et],["Nearest",Ai],["NearestMipmapNearest",es],["NearestMipmapLinear",Gn],["LinearMipmapNearest",Eo],["LinearMipmapLinear",Er]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{r[e]&&(r[e].needsUpdate=!0)}]}),()=>({type:"dropdown",label:"Mag Filter",property:[r[e],"magFilter"],children:[["Linear",Et],["Nearest",Ai]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{r[e]&&(r[e].needsUpdate=!0)}]})]}}const xi={base:r=>[{type:"input",property:[r,"name"]},{type:"checkbox",property:[r,"wireframe"]},{type:"checkbox",property:[r,"vertexColors"]},{type:"color",property:[r,"color"]},r.flatShading!==void 0?{type:"checkbox",property:[r,"flatShading"]}:{},{type:"image",property:[r,"map"]},Hi(r,"map")],blending:r=>({type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[r,"opacity"]},{type:"checkbox",property:[r,"transparent"],onChange:e=>r.setDirty({uiChangeEvent:e})},{type:"dropdown",property:[r,"depthFunc"],children:[["Never",Pd],["Always",pu],["Less",Zn],["LessEqual",gl],["Equal",du],["GreaterEqual",mu],["Greater",_o],["NotEqual",Nn]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[r,"depthTest"],onChange:e=>r.setDirty({uiChangeEvent:e})},{type:"checkbox",property:[r,"depthWrite"],onChange:e=>r.setDirty({uiChangeEvent:e})},{type:"checkbox",property:[r,"colorWrite"],onChange:e=>r.setDirty({uiChangeEvent:e})},{type:"slider",bounds:[0,1],stepSize:.001,property:[r,"alphaTest"]},{type:"checkbox",property:[r,"dithering"]},{type:"dropdown",label:"Blending",property:[r,"blending"],children:[["None",Qt],["Normal",ii],["Additive",Oi],["Subtractive",Si],["Multiply",Rr]].map(e=>({label:e[0],value:e[1]}))},r.alphaMap!==void 0?{type:"image",property:[r,"alphaMap"]}:{},r.alphaMap!==void 0?Hi(r,"alphaMap"):{},{type:"checkbox",label:"Render to Gbuffer",getValue:()=>r.userData.renderToGBuffer===!0,setValue:e=>{r.userData.renderToGBuffer=e||void 0,r.setDirty()}},r.isPhysicalMaterial?{type:"checkbox",label:"Inverse AlphaMap",hidden:()=>!r.transparent,getValue:()=>r.userData.inverseAlphaMap===!0,setValue:e=>{r.userData.inverseAlphaMap=e||void 0,r.setDirty()}}:{}]}),polygonOffset:r=>({type:"folder",label:"Polygon Offset",children:[{type:"checkbox",label:"Polygon Offset",property:[r,"polygonOffset"]},{type:"slider",label:"Polygon Offset Factor",bounds:[-10,10],property:[r,"polygonOffsetFactor"]},{type:"slider",label:"Polygon Offset Units",bounds:[-10,10],property:[r,"polygonOffsetUnits"]}]}),aoLightMap:r=>({type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[r,"aoMapIntensity"]},{type:"image",property:[r,"aoMap"]},Hi(r,"aoMap"),{type:"slider",bounds:[0,2],property:[r,"lightMapIntensity"]},{type:"image",property:[r,"lightMap"]},Hi(r,"lightMap")]}),misc:r=>[()=>{var e;return(e=r.materialExtensions)==null?void 0:e.map(t=>{var i,n;return t.uuid=t.uuid||hs(),r.__matExtUiConfigs=r.__matExtUiConfigs||{},r.__matExtUiConfigs[t.uuid]||(r.__matExtUiConfigs[t.uuid]=(n=t.getUiConfig)==null?void 0:n.call(t,r,(i=r.uiConfig)==null?void 0:i.uiRefresh)),r.__matExtUiConfigs[t.uuid]}).filter(t=>t)},{type:"dropdown",label:"Side",property:[r,"side"],children:[["Front",Ie],["Back",$e],["Double",dt]].map(e=>({label:e[0],value:e[1]}))},{type:"input",label:"Mesh count",getValue:()=>r.appliedMeshes.size||0,disabled:!0},{type:"button",label:`Download ${r.constructor.TypeSlug}`,value:()=>{const e=new Blob([JSON.stringify(r.toJSON(),null,2)],{type:"application/json"});Cp(e,`material.${r.constructor.TypeSlug}`)}},{type:"button",label:`Select ${r.constructor.TypeSlug}`,value:()=>{Gw(!1,!1,r.constructor.TypeSlug).then(async e=>{var t;return(t=e==null?void 0:e[0])==null?void 0:t.text()}).then(e=>{if(!e)return;const t=JSON.parse(e);t.uuid&&delete t.uuid,r.fromJSON(t,nc())})}}],roughMetal:r=>({type:"folder",label:"Rough/Metal",children:[{type:"slider",bounds:[0,1],property:[r,"roughness"]},{type:"slider",bounds:[0,1],property:[r,"metalness"]},{type:"image",property:[r,"roughnessMap"]},Hi(r,"roughnessMap"),{type:"image",property:[r,"metalnessMap"]},Hi(r,"metalnessMap")]}),bumpNormal:r=>({type:"folder",label:"Bump/Normal",children:[{type:"slider",bounds:[-.2,.2],stepSize:.001,property:[r,"bumpScale"],hidden:()=>!r.bumpMap},{type:"image",property:[r,"bumpMap"]},Hi(r,"bumpMap"),{type:"image",property:[r,"normalMap"]},{type:"vec2",property:[r,"normalScale"],hidden:()=>!r.normalMap},{type:"dropdown",hidden:()=>!r.normalMap,property:[r,"normalMapType"],children:[["TangentSpace",pn],["ObjectSpace",Lu]].map(e=>({label:e[0],value:e[1]}))},Hi(r,"normalMap"),{type:"input",property:[r,"displacementScale"],hidden:()=>!r.displacementMap},{type:"image",property:[r,"displacementMap"]},Hi(r,"displacementMap")]}),emission:r=>({type:"folder",label:"Emission",children:[{type:"color",property:[r,"emissive"]},{type:"slider",bounds:[0,10],property:[r,"emissiveIntensity"]},{type:"image",property:[r,"emissiveMap"]},Hi(r,"emissiveMap")]}),transmission:r=>({type:"folder",label:"Refraction",children:[{type:"slider",bounds:[0,4],property:[r,"ior"]},{type:"slider",bounds:[0,1],property:[r,"transmission"]},{type:"slider",bounds:[0,1],stepSize:.001,property:[r,"thickness"]},{type:"image",property:[r,"transmissionMap"]},Hi(r,"transmissionMap"),{type:"image",property:[r,"thicknessMap"]},Hi(r,"thicknessMap"),{type:"number",property:[r,"attenuationDistance"]},{type:"color",property:[r,"attenuationColor"]}]}),clearcoat:r=>({type:"folder",label:"Clearcoat",children:[{type:"slider",bounds:[0,1],property:[r,"clearcoat"]},{type:"slider",bounds:[0,1],hidden:()=>r.clearcoat<.001,property:[r,"clearcoatRoughness"]},{type:"image",property:[r,"clearcoatMap"]},Hi(r,"clearcoatMap"),{type:"slider",bounds:[0,1],property:[r,"clearcoatRoughness"]},{type:"image",property:[r,"clearcoatRoughnessMap"]},Hi(r,"clearcoatRoughnessMap"),{type:"image",property:[r,"clearcoatNormalMap"]},{type:"vec2",property:[r,"clearcoatNormalScale"],hidden:()=>!r.clearcoatNormalMap},Hi(r,"clearcoatNormalMap")]}),iridescence:r=>({type:"folder",label:"Iridescence",children:[{type:"slider",bounds:[0,3],label:"Intensity",property:[r,"iridescence"]},{type:"slider",bounds:[0,3],label:"IOR",property:[r,"iridescenceIOR"]},{type:"slider",bounds:[0,500],label:"Thickness0",property:[r.iridescenceThicknessRange,"0"],onChange:e=>r.setDirty({uiChangeEvent:e})},{type:"slider",bounds:[0,500],label:"Thickness1",property:[r.iridescenceThicknessRange,"1"],onChange:e=>r.setDirty({uiChangeEvent:e})},{type:"image",property:[r,"iridescenceMap"]},Hi(r,"iridescenceMap"),{type:"image",property:[r,"iridescenceThicknessMap"]},Hi(r,"iridescenceThicknessMap")]}),sheen:r=>({type:"folder",label:"Sheen",children:[{type:"slider",bounds:[0,1],property:[r,"sheen"]},{type:"color",hidden:()=>r.sheen<.001,property:[r,"sheenColor"]},{type:"image",property:[r,"sheenColorMap"]},Hi(r,"sheenColorMap"),{type:"slider",bounds:[0,1],property:[r,"sheenRoughness"]},{type:"image",property:[r,"sheenRoughnessMap"]},Hi(r,"sheenRoughnessMap")]})};var EL=Object.defineProperty,Ws=(r,e,t,i)=>{for(var n=void 0,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=a(e,t,n)||n);return n&&EL(e,t,n),n};const us=(K=class extends Pp{constructor({customMaterialExtensions:r,...e}={}){super(),this.assetType="material",this.isLineMaterial2=!0,this.appliedMeshes=new Set,this.setDirty=Qe.setDirty,this.materialExtensions=[],this.extraUniformsToUpload={},this.registerMaterialExtensions=Qe.registerMaterialExtensions,this.unregisterMaterialExtensions=Qe.unregisterMaterialExtensions,this.onAfterRender=Qe.onAfterRenderOverride(super.onAfterRender),this.uiConfig={type:"folder",label:"Line Material",uuid:"MPM2_"+this.uuid,expanded:!0,onChange:t=>{!t.config||t.config.onChange||this.setDirty({uiChangeEvent:t,needsUpdate:!!t.last,refreshUi:!!t.last})},children:[...Ih(this)||[],xi.blending(this),xi.polygonOffset(this),...xi.misc(this)]},this.fog=!1,this.setDirty=this.setDirty.bind(this),r&&this.registerMaterialExtensions(r),Qe.upgradeMaterial.call(this),this.setValues(e)}dispose(){return Qe.dispose(super.dispose).call(this)}clone(){return Qe.clone(super.clone).call(this)}dispatchEvent(r){Qe.dispatchEvent(super.dispatchEvent).call(this,r)}customProgramCacheKey(){return super.customProgramCacheKey()+Qe.customProgramCacheKey.call(this)}onBeforeCompile(r,e){const t=[["vec4 diffuseColor = ","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],i=[["#ifdef USE_COLOR","mainStart"]];for(const n of i)r.vertexShader=ri(r.vertexShader,n[0],"#glMarker "+n[1]+`
`+n[0]);for(const n of t)r.fragmentShader=ri(r.fragmentShader,n[0],"#glMarker "+n[1]+`
`+n[0]);Qe.onBeforeCompile.call(this,r,e),super.onBeforeCompile(r,e)}setValues(r,e=!0,t=void 0){return r?r.type&&!e&&!["LineMaterial",this.constructor.TYPE].includes(r.type)?(console.error("Material type is not supported:",r.type),this):(t===void 0&&(t=r.isMaterial),t&&(this.userData={}),Qe.setValues(super.setValues).call(this,r),this.userData.uuid=this.uuid,this):this}copy(r){return this.setValues(r,!1)}toJSON(r,e=!1){return e?{...super.toJSON(r),...Kt.Serialize(this,r,!0)}:Kt.Serialize(this,r,!1)}fromJSON(r,e,t=!1){return t?(Kt.Deserialize(r,this,e,!0),this.setValues(r)):(this.dispatchEvent({type:"beforeDeserialize",data:r,meta:e,bubbleToObject:!0,bubbleToParent:!0}),this)}},K.TypeSlug="lmat",K.TYPE="LineMaterial2",K.MaterialProperties={...cc,color:new fe(16777215),dashed:!1,dashScale:1,dashSize:1,dashOffset:0,gapSize:1,linewidth:1,resolution:new ne(1,1),alphaToCoverage:!1,worldUnits:!1,uniforms:{},defines:{},extensions:{},clipping:!1,fog:!0,fragmentShader:"",vertexShader:""},K.MaterialTemplate={materialType:K.TYPE,name:"line",typeSlug:K.TypeSlug,alias:["line","line_physical",K.TYPE,K.TypeSlug,"LineMaterial"],params:{color:new fe(1,1,1)},generator:r=>new K(r)},K);Ws([Lt()],us.prototype,"name"),Ws([Hs()],us.prototype,"color"),Ws([De()],us.prototype,"dashed"),Ws([vn()],us.prototype,"dashScale"),Ws([vn()],us.prototype,"dashSize"),Ws([vn()],us.prototype,"dashOffset"),Ws([vn()],us.prototype,"gapSize"),Ws([vn()],us.prototype,"linewidth"),Ws([an()],us.prototype,"resolution"),Ws([De()],us.prototype,"alphaToCoverage"),Ws([De()],us.prototype,"worldUnits");let mc=us;class $1 extends J1{constructor(){super();const e=new mc({color:"#ff2222",transparent:!0,opacity:.9,linewidth:5,resolution:new ne(1024,1024),dashed:!1,toneMapped:!1});this.lineMaterial=e;const t=new il;t.setPositions([1,1,1,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,0,1,1,0,1,1,1,0,1,0,0,1,1,0,0,1,0,1,0,0,1,0,1].map(n=>n-.5));const i=new Rp(t,e);i.computeLineDistances(),i.scale.set(1,1,1),i.visible=!0,this.add(i)}_updater(){super._updater();const e=this.object;e&&(new Vs().expandByObject(e,!1).getSize(this.scale).multiplyScalar(this.boundingScaleMultiplier).clampScalar(.1,100),this.setVisible(!0))}}class ag extends Z1{constructor(e){super(e),this._vector=new P,this._camera=new Ol;const t=new il,i=new mc({color:16777215,linewidth:.005,vertexColors:!0,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),{vertices:n,colors:s,pointMap:a}=CL();t.setPositions(n),t.setColors(s),this.line=new Rp(t,i),this.line.frustumCulled=!1,this.add(this.line),this.pointMap=a,this.update();const o=new fe(16755200),l=new fe(16711680),c=new fe(43775),h=new fe(16777215),d=new fe(3355443);this.setColors(o,l,c,h,d)}setColors(e,t,i,n,s){const a=this.line.geometry,o=a.getAttribute("instanceColorStart"),l=a.getAttribute("instanceColorEnd");function c(h,d){o.setXYZ(h/2,d.r,d.g,d.b),l.setXYZ(h/2,d.r,d.g,d.b)}c(0,e),c(2,e),c(4,e),c(6,e),c(8,e),c(10,e),c(12,e),c(14,e),c(16,e),c(18,e),c(20,e),c(22,e),c(24,t),c(26,t),c(28,t),c(30,t),c(32,i),c(34,i),c(36,i),c(38,n),c(40,s),c(42,s),c(44,s),c(46,s),c(48,s),o.needsUpdate=!0,l.needsUpdate=!0}update(){if(!this.camera)return;const e=this.line.geometry,t=this.pointMap,i=1,n=1,{_camera:s,_vector:a}=this;s.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),pr("c",t,e,s,0,0,-1,a),pr("t",t,e,s,0,0,1,a),pr("n1",t,e,s,-i,-n,-1,a),pr("n2",t,e,s,i,-n,-1,a),pr("n3",t,e,s,-i,n,-1,a),pr("n4",t,e,s,i,n,-1,a),pr("f1",t,e,s,-i,-n,1,a),pr("f2",t,e,s,i,-n,1,a),pr("f3",t,e,s,-i,n,1,a),pr("f4",t,e,s,i,n,1,a),pr("u1",t,e,s,i*.7,n*1.1,-1,a),pr("u2",t,e,s,-i*.7,n*1.1,-1,a),pr("u3",t,e,s,0,n*2,-1,a),pr("cf1",t,e,s,-i,0,1,a),pr("cf2",t,e,s,i,0,1,a),pr("cf3",t,e,s,0,-n,1,a),pr("cf4",t,e,s,0,n,1,a),pr("cn1",t,e,s,-i,0,-1,a),pr("cn2",t,e,s,i,0,-1,a),pr("cn3",t,e,s,0,-n,-1,a),pr("cn4",t,e,s,0,n,-1,a),e.getAttribute("instanceStart").needsUpdate=!0,e.getAttribute("instanceEnd").needsUpdate=!0,e.computeBoundingBox(),e.computeBoundingSphere(),super.update()}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),super.dispose()}static Check(e){return e.isCamera}static Create(e){return new ag(e)}}function pr(r,e,t,i,n,s,a,o){o.set(n,s,a).unproject(i);const l=e[r];if(l!==void 0){const c=t.getAttribute("instanceStart"),h=t.getAttribute("instanceEnd");for(let d=0,m=l.length;d<m;d++){const f=Math.floor(l[d]/2);(l[d]%2===0?c:h).setXYZ(f,o.x,o.y,o.z)}}}function CL(){const r=[],e=[],t={};i("n1","n2"),i("n2","n4"),i("n4","n3"),i("n3","n1"),i("f1","f2"),i("f2","f4"),i("f4","f3"),i("f3","f1"),i("n1","f1"),i("n2","f2"),i("n3","f3"),i("n4","f4"),i("p","n1"),i("p","n2"),i("p","n3"),i("p","n4"),i("u1","u2"),i("u2","u3"),i("u3","u1"),i("c","t"),i("p","c"),i("cn1","cn2"),i("cn3","cn4"),i("cf1","cf2"),i("cf3","cf4");function i(s,a){n(s),n(a)}function n(s){r.push(0,0,0),e.push(0,0,0),t[s]===void 0&&(t[s]=[]),t[s].push(r.length/3-1)}return{vertices:r,colors:e,pointMap:t}}class og extends il{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,i=new Float32Array(2*t);for(let n=0;n<t;n+=3)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5];return super.setPositions(i),this}setColors(e){const t=e.length-3,i=new Float32Array(2*t);for(let n=0;n<t;n+=3)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5];return super.setColors(i),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class eE extends Rp{constructor(e=new og,t=new Pp({color:Math.random()*16777215})){super(e,t),this.isLine2=!0,this.type="Line2"}}var ML=Object.defineProperty,oy=(r,e,t,i)=>{for(var n=void 0,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=a(e,t,n)||n);return n&&ML(e,t,n),n};const fc=class mS extends sg{constructor(e,t,i){super(e),this.lineWidth=5,this.size=.5,this._v1=new P,this._v2=new P,this._v3=new P,this.color=i,t!==void 0&&(this.size=t);let n=new og;this.material=new mc({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.lightPlane=new eE(n,this.material),this.add(this.lightPlane),n=new og,n.setPositions([0,0,0,0,0,1]),this.targetLine=new eE(n,this.material),this.add(this.targetLine),this.update(),this.traverse(s=>{s.userData.__keepShadowDef=!0,s.castShadow=!1,s.receiveShadow=!1})}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose(),super.dispose()}update(){!this.light||!this.lightPlane||(this._v1.setFromMatrixPosition(this.light.matrixWorld),this._v2.setFromMatrixPosition(this.light.target.matrixWorld),this._v3.subVectors(this._v2,this._v1),this.lightPlane.geometry.setPositions([-this.size,this.size,0,this.size,this.size,0,this.size,-this.size,0,-this.size,-this.size,0,-this.size,this.size,0]),this.lightPlane.lookAt(this._v2),this.lightPlane.material=this.material,this.targetLine.material=this.material,this.material.color.set(this.color??this.light.color),this.material.linewidth=this.lineWidth*.001,this.targetLine.lookAt(this._v2),this.targetLine.scale.z=this.light.intensity/3,super.update())}static Check(e){return e.isDirectionalLight}static Create(e){return new mS(e)}};oy([st(fc.prototype.update)],fc.prototype,"material"),oy([st(fc.prototype.update),Rt(void 0,[.1,20],.01)],fc.prototype,"lineWidth"),oy([st(fc.prototype.update),Rt(void 0,[.01,10],.01)],fc.prototype,"size");let tE=fc;class SL extends il{constructor(e){super(),this.isWireframeGeometry2=!0,this.type="WireframeGeometry2",this.fromWireframeGeometry(new pf(e))}}const iE=new P,rE=new P;class TL extends Fe{constructor(e=new il,t=new Pp({color:Math.random()*16777215})){super(e,t),this.isWireframe=!0,this.type="Wireframe"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,i=e.attributes.instanceEnd,n=new Float32Array(2*t.count);for(let a=0,o=0,l=t.count;a<l;a++,o+=2)iE.fromBufferAttribute(t,a),rE.fromBufferAttribute(i,a),n[o]=o===0?0:n[o-1],n[o+1]=n[o]+iE.distanceTo(rE);const s=new Ep(n,2,1);return e.setAttribute("instanceDistanceStart",new Vr(s,1,0)),e.setAttribute("instanceDistanceEnd",new Vr(s,1,1)),this}}var IL=Object.defineProperty,ly=(r,e,t,i)=>{for(var n=void 0,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=a(e,t,n)||n);return n&&IL(e,t,n),n};const gc=class fS extends sg{constructor(e,t,i){super(e),this.lineWidth=5,this.size=.5,this.color=i,t!==void 0&&(this.size=t);const n=new SL(new Gs(.5,4,2));this.material=new mc({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.lightSphere=new TL(n,this.material),this.lightSphere.computeLineDistances(),this.add(this.lightSphere),this.update(),this.traverse(s=>{s.userData.__keepShadowDef=!0,s.castShadow=!1,s.receiveShadow=!1})}dispose(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose(),super.dispose()}update(){!this.light||!this.lightSphere||(this.material.color.set(this.color??this.light.color),this.material.linewidth=this.lineWidth*.001,this.lightSphere.scale.setScalar(this.size),super.update())}static Check(e){return e.isPointLight}static Create(e){return new fS(e)}};ly([st(gc.prototype.update)],gc.prototype,"material"),ly([st(gc.prototype.update),Rt(void 0,[.1,20],.01)],gc.prototype,"lineWidth"),ly([st(gc.prototype.update),Rt(void 0,[.01,10],.01)],gc.prototype,"size");let nE=gc;var PL=Object.defineProperty,sE=(r,e,t,i)=>{for(var n=void 0,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=a(e,t,n)||n);return n&&PL(e,t,n),n};const Wp=class gS extends sg{constructor(e,t,i){super(e),this.lineWidth=5,this._v1=new P,this.color=i;let n=new il;const s=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,o=1,l=32;a<l;a++,o++){const c=a/l*Math.PI*2,h=o/l*Math.PI*2;s.push(Math.cos(c),Math.sin(c),1,Math.cos(h),Math.sin(h),1)}n.setPositions(s),this.material=new mc({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.cone=new Rp(n,this.material),this.add(this.cone),n=new og,n.setPositions([0,0,0,0,0,1]),this.update(),this.traverse(a=>{a.userData.__keepShadowDef=!0,a.castShadow=!1,a.receiveShadow=!1})}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose(),super.dispose()}update(){if(!this.light||!this.cone)return;this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),this._v1.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(this._v1),this.material.color.set(this.color??this.light.color),this.material.linewidth=this.lineWidth*.001,super.update()}static Check(e){return e.isSpotLight}static Create(e){return new gS(e)}};sE([st(Wp.prototype.update)],Wp.prototype,"material"),sE([st(Wp.prototype.update),Rt(void 0,[.1,20],.01)],Wp.prototype,"lineWidth");let aE=Wp;var RL=Object.defineProperty,DL=Object.getOwnPropertyDescriptor,Xs=(r,e,t,i)=>{for(var n=i>1?void 0:i?DL(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&RL(e,t,n),n};p.CameraView=class extends zi{constructor(r,e,t,i,n){super(),this.uuid=hs(),this.name="Camera View",this.position=new P,this.target=new P,this.quaternion=new Ct,this.zoom=1,this.isWorldSpace=!0,this.set=s=>this.dispatchEvent({type:"setView",camera:s,view:this}),this.update=s=>this.dispatchEvent({type:"updateView",camera:s,view:this}),this.delete=s=>this.dispatchEvent({type:"deleteView",camera:s,view:this}),this.animate=(s,a)=>this.dispatchEvent({type:"animateView",camera:s,duration:a,view:this}),r!==void 0&&(this.name=r),e&&this.position.copy(e),t&&this.target.copy(t),i&&this.quaternion.copy(i),n!==void 0&&(this.zoom=n)}_nameChanged(){var r,e;this.uiConfig&&(this.uiConfig.label=this.name,(e=(r=this.uiConfig).uiRefresh)==null||e.call(r))}clone(){return new p.CameraView(this.name,this.position,this.target,this.quaternion,this.zoom)}},Xs([st(p.CameraView.prototype._nameChanged),$(),Lt()],p.CameraView.prototype,"name",2),Xs([$(),an()],p.CameraView.prototype,"position",2),Xs([$(),an()],p.CameraView.prototype,"target",2),Xs([$(),an()],p.CameraView.prototype,"quaternion",2),Xs([$(),vn()],p.CameraView.prototype,"zoom",2),Xs([$()],p.CameraView.prototype,"isWorldSpace",2),Xs([ci()],p.CameraView.prototype,"set",2),Xs([ci()],p.CameraView.prototype,"update",2),Xs([ci()],p.CameraView.prototype,"delete",2),Xs([ci()],p.CameraView.prototype,"animate",2),p.CameraView=Xs([Kv("CameraView"),Xr("Camera View")],p.CameraView);var BL=Object.defineProperty,qr=(r,e,t,i)=>{for(var n=void 0,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=a(e,t,n)||n);return n&&BL(e,t,n),n};const Fi=class extends Qi{constructor(r,e,t,i,n){super(i,n),this.assetType="camera",this._currentControlsMode="",this.userData={},this.target=new P(0,0,0),this.near=.01,this.far=50,this.autoLookAtTarget=!1,this.autoNearFar=!0,this.minNearPlane=.5,this.maxFarPlane=1e3,this._interactionsDisabledBy=new Set,this.refreshUi=Un.refreshUi,this.refreshTarget=Un.refreshTarget,this.activateMain=Un.activateMain,this.deactivateMain=Un.deactivateMain,this._controlsCtors=new Map([["orbit",(s,a)=>{const o=new p.OrbitControls3(s,a?a.ownerDocument?a:a.documentElement:document.body);return o.screenSpacePanning=!0,o}]]),this._controlsChanged=()=>{this._controls&&this._controls.target&&this.refreshTarget(void 0,!1),this.setDirty({change:"controls"})},this._positionWorld=new P,this._camUi=[...Ih(this)||[],{type:"input",label:()=>(this.autoNearFar?"Min":"")+" Near",property:[this,"minNearPlane"]},{type:"input",label:()=>(this.autoNearFar?"Max":"")+" Far",property:[this,"maxFarPlane"]},{type:"input",label:"Auto Near Far",property:[this,"autoNearFar"]},()=>({type:"dropdown",label:"Controls Mode",property:[this,"controlsMode"],children:["","orbit",...this._controlsCtors.keys()].map(s=>({label:s===""?"none":s,value:s})),onChange:()=>this.refreshCameraControls()}),()=>B1.call(this,this.uiConfig)],this.uiConfig={type:"folder",label:()=>this.name||"Camera",children:[...this._camUi,()=>{var s;return(s=this._controls)!=null&&s.zoomIn?{type:"button",label:"Zoom in",value:()=>{var a;return(a=this._controls)==null?void 0:a.zoomIn(1)}}:{}},()=>{var s;return(s=this._controls)!=null&&s.zoomOut?{type:"button",label:"Zoom out",value:()=>{var a;return(a=this._controls)==null?void 0:a.zoomOut(1)}}:{}},()=>{var s;return(s=this._controls)==null?void 0:s.uiConfig}]},this._canvas=e,this.autoAspect=t??!!e,Un.upgradeCamera.call(this),this.controlsMode=r||"",this.refreshTarget(void 0,!1),this.setDirty()}get controls(){return this._controls}get isMainCamera(){return this.userData&&this.userData.__isMainCamera||!1}get interactionsEnabled(){return this._interactionsDisabledBy.size===0}setInteractions(r,e){const t=this._interactionsDisabledBy.size;r?this._interactionsDisabledBy.delete(e):this._interactionsDisabledBy.add(e),t!==this._interactionsDisabledBy.size&&this.refreshCameraControls(!0)}get canUserInteract(){return this._interactionsDisabledBy.size===0&&this.isMainCamera&&this.controlsMode!==""}setDirty(r){this._positionWorld&&(((r==null?void 0:r.key)==="fov"||(r==null?void 0:r.key)==="zoom")&&this.updateProjectionMatrix(),this.getWorldPosition(this._positionWorld),Un.setDirty.call(this,r),this._camUi.forEach(e=>{var t;return(t=e==null?void 0:e.uiRefresh)==null?void 0:t.call(e,!1,"postFrame",1)}))}refreshAspect(r=!0){var e;this.autoAspect&&(this._canvas?(this.aspect=this._canvas.clientWidth/this._canvas.clientHeight,(e=this.updateProjectionMatrix)==null||e.call(this)):console.error("cannot calculate aspect ratio without canvas/container")),r&&this.setDirty()}_nearFarChanged(){var r;this.view!==void 0&&((r=this.updateProjectionMatrix)==null||r.call(this))}setControlsCtor(r,e,t=!1){if(!t&&this._controlsCtors.has(r)){console.error(r+" already exists.");return}this._controlsCtors.set(r,e)}removeControlsCtor(r){this._controlsCtors.delete(r)}_initCameraControls(){var r,e;const t=this.controlsMode;this._controls=((r=this._controlsCtors.get(t))==null?void 0:r(this,this._canvas))??void 0,!this._controls&&t!==""&&console.error("Unable to create controls with mode "+t+". Are you missing a plugin?"),(e=this._controls)==null||e.addEventListener("change",this._controlsChanged),this._currentControlsMode=this._controls?t:""}_disposeCameraControls(){var r,e;this._controls&&(this._controls.target===this.target&&(this._controls.target=new P),(r=this._controls)==null||r.removeEventListener("change",this._controlsChanged),(e=this._controls)==null||e.dispose()),this._currentControlsMode="",this._controls=void 0}refreshCameraControls(r=!0){if(this._controlsCtors){if(this._controls?(this._currentControlsMode!==this.controlsMode||this!==this._controls.object)&&(this._disposeCameraControls(),this._initCameraControls()):this._initCameraControls(),this._controls){const e=this.canUserInteract;this._controls.enabled=e,e&&this.up.copy(It.DEFAULT_UP)}r&&this.setDirty(),this.refreshUi()}}toJSON(r,e=!1){return e?super.toJSON(r):Kt.Serialize(this,r,!0)}fromJSON(r,e){if((r.camOptions||r.aspect==="auto")&&(r={...r}),r.camOptions){const t=r.camOptions;t.fov&&(r.fov=t.fov),t.focus&&(r.focus=t.focus),t.zoom&&(r.zoom=t.zoom),t.aspect&&(r.aspect=t.aspect),t.controlsMode&&(r.controlsMode=t.controlsMode),delete r.camOptions}return r.aspect==="auto"&&(r.aspect=this.aspect,this.autoAspect=!0),Kt.Deserialize(r,this,e,!0),this.setDirty({change:"deserialize"}),this}getView(r=!0,e){var t,i;const n=new P;this.updateWorldMatrix(!0,!1);const s=this.matrixWorld;n.x=s.elements[4],n.y=s.elements[5],n.z=s.elements[6],n.normalize();const a=e||new p.CameraView;a.name=this.name,a.position.copy(this.position),a.target.copy(this.target),a.quaternion.copy(this.quaternion),a.zoom=this.zoom;const o=this.parent;return o&&(r?(a.position.applyMatrix4(o.matrixWorld),this.getWorldQuaternion(a.quaternion)):n.transformDirection(o.matrixWorld.clone().invert())),a.isWorldSpace=r,(i=(t=a.uiConfig)==null?void 0:t.uiRefresh)==null||i.call(t,!0,"postFrame"),a}setView(r){this.position.copy(r.position),this.target.copy(r.target),this.quaternion.copy(r.quaternion),this.zoom=r.zoom,this.setDirty()}setViewFromCamera(r,e,t=!0){this.copy(r,void 0,e,t)}setViewToMain(r){this.dispatchEvent({type:"setView",...r,camera:this,bubbleToParent:!0})}updateShaderProperties(r){var e,t,i,n;return(t=(e=r.uniforms.cameraPositionWorld)==null?void 0:e.value)==null||t.copy(this._positionWorld),(n=(i=r.uniforms.cameraNearFar)==null?void 0:i.value)==null||n.set(this.near,this.far),r.uniforms.projection&&(r.uniforms.projection.value=this.projectionMatrix),r.defines.PERSPECTIVE_CAMERA=this.type==="PerspectiveCamera"?"1":"0",this}dispose(){this._disposeCameraControls()}get isActiveCamera(){return this.isMainCamera}getControls(){return this._controls}get cameraObject(){return this}get modelObject(){return this}targetUpdated(r=!0){r&&this.setDirty()}};qr([Lt("Name")],Fi.prototype,"name"),qr([$("camControls")],Fi.prototype,"_controls"),qr([Ir(Fi.prototype.refreshCameraControls)],Fi.prototype,"controlsMode"),qr([$()],Fi.prototype,"userData"),qr([yi(Fi.prototype.setDirty),Rt("Field Of View",[1,180],.001),$()],Fi.prototype,"fov"),qr([yi(Fi.prototype.setDirty),$()],Fi.prototype,"focus"),qr([yi(Fi.prototype.setDirty),Rt("FoV Zoom",[.001,10],.001),$()],Fi.prototype,"zoom"),qr([an("Position",void 0,void 0,r=>({onChange:()=>r.setDirty()})),$()],Fi.prototype,"position"),qr([an("Target",void 0,void 0,r=>({onChange:()=>r.setDirty()})),$()],Fi.prototype,"target"),qr([$(),Ir(Fi.prototype.refreshAspect),De("Auto Aspect")],Fi.prototype,"autoAspect"),qr([Ir(Fi.prototype._nearFarChanged)],Fi.prototype,"near"),qr([Ir(Fi.prototype._nearFarChanged)],Fi.prototype,"far"),qr([Tp({obj:"userData",onChange:"setDirty"})],Fi.prototype,"autoLookAtTarget"),qr([Tp({obj:"userData",onChange:"setDirty"})],Fi.prototype,"autoNearFar"),qr([Tp({obj:"userData",onChange:"setDirty"})],Fi.prototype,"minNearPlane"),qr([Tp({obj:"userData",onChange:"setDirty"})],Fi.prototype,"maxFarPlane"),qr([st((r,e)=>{e||console.warn("Setting camera invisible is not supported",r,e)})],Fi.prototype,"visible");let Oh=Fi;class oE extends Oh{constructor(e,t,i,n){super(void 0,void 0,void 0,e,t||1),(i||n)&&(this.autoNearFar=!1,i&&(this.near=i,this.minNearPlane=i),n&&(this.far=n,this.maxFarPlane=n))}}const lg=class extends yr{constructor({customMaterialExtensions:e,...t}={},i=!1){super(),this.assetType="material",this.isAShaderMaterial=!0,this.appliedMeshes=new Set,this.setDirty=Qe.setDirty,this.type="ShaderMaterial",this.materialExtensions=[],this.extraUniformsToUpload={},this.registerMaterialExtensions=Qe.registerMaterialExtensions,this.unregisterMaterialExtensions=Qe.unregisterMaterialExtensions,this.isRawShaderMaterial=i,i&&(this.type="RawShaderMaterial"),e&&this.registerMaterialExtensions(e),Qe.upgradeMaterial.call(this),this.setValues(t)}dispose(){return Qe.dispose(super.dispose).call(this)}clone(){return Qe.clone(super.clone).call(this)}dispatchEvent(e){Qe.dispatchEvent(super.dispatchEvent).call(this,e)}customProgramCacheKey(){return super.customProgramCacheKey()+Qe.customProgramCacheKey.call(this)}onBeforeCompile(e,t){Qe.onBeforeCompile.call(this,e,t),super.onBeforeCompile(e,t)}onBeforeRender(e,t,i,n,s){super.onBeforeRender(e,t,i,n,s),Qe.onBeforeRender.call(this,e,t,i,n,s)}onAfterRender(e,t,i,n,s){super.onAfterRender(e,t,i,n,s),Qe.onAfterRender.call(this,e,t,i,n,s)}setValues(e){return Qe.setValues(super.setValues).call(this,e)}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,t){throw new Error("Method not supported for this material.")}get materialObject(){return this}};lg.TypeSlug="shaderMat",lg.TYPE="ShaderMaterial2",lg.MaterialProperties={...cc,fragmentShader:"",vertexShader:"",uniforms:{},defines:{},extensions:{},isRawShaderMaterial:!1,uniformsGroups:{},wireframe:!1,wireframeLinewidth:1,clipping:!1,lights:!1,fog:!1,glslVersion:null,defaultAttributeValues:{}};let cy=lg;class lE extends cy{constructor(e,t,i=!1){super(e,i),this.textures=[],this.setTextureIds(t)}setTextureIds(e){this.textures.map(t=>t.id).join(";")!==e.join(";")&&(this.textures=e.map(t=>({id:t,colorSpace:wi})),this.setDirty())}_setUniformTexSize(e,t){if(!t||!e)return;const i=(t==null?void 0:t.width)??512,n=(t==null?void 0:t.height)??512,s=e.value;s.isVector2||console.warn("uniform is not a Vector2"),s&&Math.abs(s.x-i)+Math.abs(s.y-n)>.1&&(s.x=i,s.y=n,this.uniformsNeedUpdate=!0)}onBeforeRender(e,t,i,n,s){var a;this.uniforms.screenSize&&this._setUniformTexSize(this.uniforms.screenSize,e.getRenderTarget()??e.getSize(new ne));for(const o of this.textures){const l=o.id,c=(a=this.uniforms[l])==null?void 0:a.value;c&&(this._setUniformTexSize(this.uniforms[l+"Size"],c.image),c.colorSpace!==o.colorSpace&&(o.colorSpace=c.colorSpace,this.needsUpdate=!0))}super.onBeforeRender(e,t,i,n,s)}onBeforeCompile(e,t){const i=`
`+this.textures.map(n=>`uniform sampler2D ${n.id}; 
`+g0(n.id??"input",n,t.capabilities.isWebGL2)).join(`
`);e.fragmentShader.includes("#include <encodings_pars_fragment>")?e.fragmentShader=ri(e.fragmentShader,"#include <encodings_pars_fragment>",i,{append:!0}):e.fragmentShader.includes("precision highp float;")?e.fragmentShader=ri(e.fragmentShader,"precision highp float;",i,{append:!0}):e.fragmentShader=i+e.fragmentShader,super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+this.textures.map(e=>e.id+e.colorSpace).join(";")}}const wa=class extends _p{constructor({customMaterialExtensions:e,...t}={}){super(),this.assetType="material",this.isPhysicalMaterial=!0,this.appliedMeshes=new Set,this.setDirty=Qe.setDirty,this.map=null,this.alphaMap=null,this.roughnessMap=null,this.metalnessMap=null,this.normalMap=null,this.bumpMap=null,this.displacementMap=null,this.materialExtensions=[],this.extraUniformsToUpload={},this.registerMaterialExtensions=Qe.registerMaterialExtensions,this.unregisterMaterialExtensions=Qe.unregisterMaterialExtensions,this.onAfterRender=Qe.onAfterRenderOverride(super.onAfterRender),this.uiConfig={type:"folder",label:"Physical Material",uuid:"MPM2_"+this.uuid,expanded:!0,onChange:i=>{!i.config||i.config.onChange||this.setDirty({uiChangeEvent:i,needsUpdate:!!i.last,refreshUi:!!i.last})},children:[...xi.base(this),xi.blending(this),xi.polygonOffset(this),xi.aoLightMap(this),xi.roughMetal(this),xi.bumpNormal(this),xi.emission(this),xi.transmission(this),xi.clearcoat(this),xi.iridescence(this),xi.sheen(this),...xi.misc(this)]},this.fog=!1,this.attenuationDistance=0,this.setDirty=this.setDirty.bind(this),e&&this.registerMaterialExtensions(e),Qe.upgradeMaterial.call(this),this.setValues(t)}dispose(){return Qe.dispose(super.dispose).call(this)}clone(){return Qe.clone(super.clone).call(this)}dispatchEvent(e){Qe.dispatchEvent(super.dispatchEvent).call(this,e)}customProgramCacheKey(){return super.customProgramCacheKey()+Qe.customProgramCacheKey.call(this)}onBeforeCompile(e,t){const i=[["vec3 totalDiffuse = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["#include <lights_physical_fragment>","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],n=[["#include <uv_vertex>","mainStart"]];for(const s of n)e.vertexShader=ri(e.vertexShader,s[0],"#glMarker "+s[1]+`
`+s[0]);for(const s of i)e.fragmentShader=ri(e.fragmentShader,s[0],"#glMarker "+s[1]+`
`+s[0]);Qe.onBeforeCompile.call(this,e,t),e.defines&&(e.defines.INVERSE_ALPHAMAP=this.userData.inverseAlphaMap?1:0),super.onBeforeCompile(e,t)}onBeforeRender(e,t,i,n,s){super.onBeforeRender(e,t,i,n,s),Qe.onBeforeRender.call(this,e,t,i,n,s);const a=this.userData.inverseAlphaMap?1:0;a!==this.defines.INVERSE_ALPHAMAP&&(this.defines.INVERSE_ALPHAMAP=a,this.needsUpdate=!0)}setValues(e,t=!0,i=void 0){return e?e.type&&!t&&!["MeshPhysicalMaterial","MeshStandardMaterial","MeshStandardMaterial2",this.constructor.TYPE].includes(e.type)?(console.error("Material type is not supported:",e.type),this):(typeof e.normalScale=="number"&&(e.normalScale=[e.normalScale,e.normalScale]),i===void 0&&(i=e.isMaterial),i&&(this.userData={}),Qe.setValues(super.setValues).call(this,e),isFinite(this.attenuationDistance)||(this.attenuationDistance=0),this.userData.uuid=this.uuid,this):this}copy(e){return this.setValues(e,!1)}toJSON(e,t=!1){return t?{...super.toJSON(e),...Kt.Serialize(this,e,!0)}:Kt.Serialize(this,e,!1)}fromJSON(e,t,i=!1){return i?(Kt.Deserialize(e,this,t,!0),this.setValues(e)):(this.dispatchEvent({type:"beforeDeserialize",data:e,meta:t,bubbleToObject:!0,bubbleToParent:!0}),this)}};wa.TypeSlug="pmat",wa.TYPE="PhysicalMaterial",wa.MaterialProperties={...cc,color:new fe(16777215),roughness:1,metalness:0,map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,emissive:"#000000",emissiveIntensity:1,emissiveMap:null,bumpMap:null,bumpScale:1,normalMap:null,normalMapType:pn,normalScale:new ne(1,1),displacementMap:null,displacementScale:1,displacementBias:0,roughnessMap:null,metalnessMap:null,alphaMap:null,envMap:null,envMapIntensity:1,wireframe:!1,wireframeLinewidth:1,wireframeLinecap:"round",wireframeLinejoin:"round",flatShading:!1,fog:!0,clearcoat:0,clearcoatMap:null,clearcoatRoughness:0,clearcoatRoughnessMap:null,clearcoatNormalScale:new ne(1,1),clearcoatNormalMap:null,reflectivity:.5,iridescence:0,iridescenceMap:null,iridescenceIOR:1.3,iridescenceThicknessRange:[100,400],iridescenceThicknessMap:null,sheen:0,sheenColor:new fe(0),sheenColorMap:null,sheenRoughness:1,sheenRoughnessMap:null,transmission:0,transmissionMap:null,thickness:0,thicknessMap:null,attenuationDistance:1/0,attenuationColor:new fe(1,1,1),specularIntensity:1,specularIntensityMap:null,specularColor:new fe(1,1,1),specularColorMap:null},wa.MaterialTemplate={materialType:wa.TYPE,name:"physical",typeSlug:wa.TypeSlug,alias:["standard","physical",wa.TYPE,wa.TypeSlug,"MeshStandardMaterial","MeshStandardMaterial2","MeshPhysicalMaterial"],params:{color:new fe(1,1,1)},generator:r=>new wa(r)};let xa=wa;class LL extends xa{constructor(e){super(e),console.error("MeshStandardMaterial2 is deprecated, use UnlitMaterial instead")}}const Ea=class extends Pn{constructor({customMaterialExtensions:e,...t}={}){super(),this.assetType="material",this.isUnlitMaterial=!0,this.appliedMeshes=new Set,this.setDirty=Qe.setDirty,this.envMap=null,this.materialExtensions=[],this.extraUniformsToUpload={},this.registerMaterialExtensions=Qe.registerMaterialExtensions,this.unregisterMaterialExtensions=Qe.unregisterMaterialExtensions,this.onBeforeRender=Qe.onBeforeRenderOverride(super.onBeforeRender),this.onAfterRender=Qe.onAfterRenderOverride(super.onAfterRender),this.uiConfig={type:"folder",label:"Unlit Material",uuid:"MBM2_"+this.uuid,expanded:!0,onChange:i=>{!i.config||i.config.onChange||this.setDirty({uiChangeEvent:i,needsUpdate:!!i.last,refreshUi:!!i.last})},children:[...xi.base(this),xi.blending(this),xi.polygonOffset(this),xi.aoLightMap(this),...xi.misc(this)]},!this.defines&&(this.defines={}),this.fog=!1,this.setDirty=this.setDirty.bind(this),e&&this.registerMaterialExtensions(e),Qe.upgradeMaterial.call(this),this.setValues(t)}dispose(){return Qe.dispose(super.dispose).call(this)}clone(){return Qe.clone(super.clone).call(this)}dispatchEvent(e){Qe.dispatchEvent(super.dispatchEvent).call(this,e)}customProgramCacheKey(){return super.customProgramCacheKey()+Qe.customProgramCacheKey.call(this)}onBeforeCompile(e,t){const i=[["vec3 outgoingLight = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["ReflectedLight reflectedLight = ","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],n=[["#include <uv_vertex>","mainStart"]];for(const s of n)e.vertexShader=ri(e.vertexShader,s[0],"#glMarker "+s[1]+`
`+s[0]);for(const s of i)e.fragmentShader=ri(e.fragmentShader,s[0],"#glMarker "+s[1]+`
`+s[0]);Qe.onBeforeCompile.call(this,e,t),super.onBeforeCompile(e,t)}setValues(e,t=!0,i=void 0){return e?e.type&&!t&&!["MeshBasicMaterial","MeshBasicMaterial2",this.constructor.TYPE].includes(e.type)?(console.error("Material type is not supported:",e.type),this):(i===void 0&&(i=e.isMaterial),i&&(this.userData={}),Qe.setValues(super.setValues).call(this,e),this.userData.uuid=this.uuid,this):this}copy(e){return this.setValues(e,!1)}toJSON(e,t=!1){return t?{...super.toJSON(e),...Kt.Serialize(this,e,!0)}:Kt.Serialize(this,e,!1)}fromJSON(e,t,i=!1){return i?(Kt.Deserialize(e,this,t,!0),this.setValues(e)):(this.dispatchEvent({type:"beforeDeserialize",data:e,meta:t,bubbleToObject:!0,bubbleToParent:!0}),this)}};Ea.TypeSlug="bmat",Ea.TYPE="UnlitMaterial",Ea.MaterialProperties={...cc,color:new fe(16777215),map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,specularMap:null,alphaMap:null,envMap:null,combine:vs,envMapIntensity:1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinewidth:1,wireframeLinecap:"round",wireframeLinejoin:"round",skinning:!1,fog:!0,flatShading:!1},Ea.MaterialTemplate={materialType:Ea.TYPE,name:"unlit",typeSlug:Ea.TypeSlug,alias:["basic","unlit",Ea.TYPE,Ea.TypeSlug,"MeshBasicMaterial","MeshBasicMaterial2"],params:{color:new fe(1,1,1)},generator:r=>new Ea(r)};let kh=Ea;class UL extends kh{constructor(e){super(e),console.error("MeshBasicMaterial2 is deprecated, use UnlitMaterial instead")}}const Ca=class extends Ji{constructor({customMaterialExtensions:e,...t}={}){super(),this.assetType="material",this.isUnlitLineMaterial=!0,this.appliedMeshes=new Set,this.setDirty=Qe.setDirty,this.materialExtensions=[],this.extraUniformsToUpload={},this.registerMaterialExtensions=Qe.registerMaterialExtensions,this.unregisterMaterialExtensions=Qe.unregisterMaterialExtensions,this.onBeforeRender=Qe.onBeforeRenderOverride(super.onBeforeRender),this.onAfterRender=Qe.onAfterRenderOverride(super.onAfterRender),this.uiConfig={type:"folder",label:"Unlit Line Material",uuid:"MBLM2_"+this.uuid,expanded:!0,onChange:i=>{!i.config||i.config.onChange||this.setDirty({uiChangeEvent:i,needsUpdate:!!i.last,refreshUi:!!i.last})},children:[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"vertexColors"]},{type:"color",property:[this,"color"]},Hi(this,"map"),{type:"number",property:[this,"linewidth"]},{type:"dropdown",property:[this,"linecap"],children:["butt","round","square"].map(i=>({label:i}))},{type:"dropdown",property:[this,"linejoin"],children:["bevel","round","miter"].map(i=>({label:i}))},xi.blending(this),xi.polygonOffset(this),...xi.misc(this)]},!this.defines&&(this.defines={}),this.fog=!1,this.setDirty=this.setDirty.bind(this),e&&this.registerMaterialExtensions(e),Qe.upgradeMaterial.call(this),this.setValues(t)}dispose(){return Qe.dispose(super.dispose).call(this)}clone(){return Qe.clone(super.clone).call(this)}dispatchEvent(e){Qe.dispatchEvent(super.dispatchEvent).call(this,e)}customProgramCacheKey(){return super.customProgramCacheKey()+Qe.customProgramCacheKey.call(this)}onBeforeCompile(e,t){const i=[["vec3 outgoingLight = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["ReflectedLight reflectedLight = ","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],n=[["#include <uv_vertex>","mainStart"]];for(const s of n)e.vertexShader=ri(e.vertexShader,s[0],"#glMarker "+s[1]+`
`+s[0]);for(const s of i)e.fragmentShader=ri(e.fragmentShader,s[0],"#glMarker "+s[1]+`
`+s[0]);Qe.onBeforeCompile.call(this,e,t),super.onBeforeCompile(e,t)}setValues(e,t=!0,i=void 0){return e?e.type&&!t&&!["LineBasicMaterial","LineBasicMaterial2",this.constructor.TYPE].includes(e.type)?(console.error("Material type is not supported:",e.type),this):(i===void 0&&(i=e.isMaterial),i&&(this.userData={}),Qe.setValues(super.setValues).call(this,e),this.userData.uuid=this.uuid,this):this}copy(e){return this.setValues(e,!1)}toJSON(e,t=!1){return t?{...super.toJSON(e),...Kt.Serialize(this,e,!0)}:Kt.Serialize(this,e,!1)}fromJSON(e,t,i=!1){return i?(Kt.Deserialize(e,this,t,!0),this.setValues(e)):(this.dispatchEvent({type:"beforeDeserialize",data:e,meta:t,bubbleToObject:!0,bubbleToParent:!0}),this)}};Ca.TypeSlug="blmat",Ca.TYPE="UnlitLineMaterial",Ca.MaterialProperties={...cc,color:new fe(16777215),map:null,linewidth:1,linecap:"round",linejoin:"round",fog:!0},Ca.MaterialTemplate={materialType:Ca.TYPE,name:"unlit_line",typeSlug:Ca.TypeSlug,alias:["line_basic","unlit_line",Ca.TYPE,Ca.TypeSlug,"LineBasicMaterial","LineBasicMaterial2"],params:{color:new fe(1,1,1)},generator:r=>new Ca(r)};let Xp=Ca;class OL extends Xp{constructor(e){super(e),console.error("LineBasicMaterial2 is deprecated, use UnlitLineMaterial instead")}}const Ma=class extends Vl{constructor({customMaterialExtensions:e,...t}={}){super(),this.assetType="material",this.isLegacyPhongMaterial=!0,this.appliedMeshes=new Set,this.setDirty=Qe.setDirty,this.envMap=null,this.materialExtensions=[],this.extraUniformsToUpload={},this.registerMaterialExtensions=Qe.registerMaterialExtensions,this.unregisterMaterialExtensions=Qe.unregisterMaterialExtensions,this.onBeforeRender=Qe.onBeforeRenderOverride(super.onBeforeRender),this.onAfterRender=Qe.onAfterRenderOverride(super.onAfterRender),this.uiConfig={type:"folder",label:"Phong Material",uuid:"MBM2_"+this.uuid,expanded:!0,onChange:i=>{!i.config||i.config.onChange||this.setDirty({uiChangeEvent:i,needsUpdate:!!i.last,refreshUi:!!i.last})},children:[...xi.base(this),xi.blending(this),xi.polygonOffset(this),xi.aoLightMap(this),{type:"folder",label:"Specular",children:[{type:"color",property:[this,"specular"]},{type:"image",property:[this,"specularMap"]},Hi(this,"specularMap"),{type:"slider",label:"Shininess",property:[this,"shininess"],bounds:[0,100],stepSize:.1},{type:"slider",label:"Reflectivity",property:[this,"reflectivity"],bounds:[0,1],stepSize:.01},{type:"slider",label:"Refraction Ratio",property:[this,"refractionRatio"],bounds:[0,3],stepSize:.01}]},xi.bumpNormal(this),xi.emission(this),{type:"folder",label:"Env Map",children:[{type:"image",property:[this,"envMap"]},Hi(this,"envMap"),{type:"slider",label:"Env Map Intensity",property:[this,"envMapIntensity"],bounds:[0,5],stepSize:.01}]},...xi.misc(this)]},!this.defines&&(this.defines={}),this.fog=!1,this.setDirty=this.setDirty.bind(this),e&&this.registerMaterialExtensions(e),Qe.upgradeMaterial.call(this),this.setValues(t)}dispose(){return Qe.dispose(super.dispose).call(this)}clone(){return Qe.clone(super.clone).call(this)}dispatchEvent(e){Qe.dispatchEvent(super.dispatchEvent).call(this,e)}customProgramCacheKey(){return super.customProgramCacheKey()+Qe.customProgramCacheKey.call(this)}onBeforeCompile(e,t){const i=[["vec3 outgoingLight = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["ReflectedLight reflectedLight = ","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],n=[["#include <uv_vertex>","mainStart"]];for(const s of n)e.vertexShader=ri(e.vertexShader,s[0],"#glMarker "+s[1]+`
`+s[0]);for(const s of i)e.fragmentShader=ri(e.fragmentShader,s[0],"#glMarker "+s[1]+`
`+s[0]);Qe.onBeforeCompile.call(this,e,t),super.onBeforeCompile(e,t)}setValues(e,t=!0,i=void 0){return e?e.type&&!t&&!["MeshPhongMaterial","MeshPhongMaterial2",this.constructor.TYPE].includes(e.type)?(console.error("Material type is not supported:",e.type),this):(i===void 0&&(i=e.isMaterial),i&&(this.userData={}),Qe.setValues(super.setValues).call(this,e),this.userData.uuid=this.uuid,this):this}copy(e){return this.setValues(e,!1)}toJSON(e,t=!1){return t?{...super.toJSON(e),...Kt.Serialize(this,e,!0)}:Kt.Serialize(this,e,!1)}fromJSON(e,t,i=!1){return i?(Kt.Deserialize(e,this,t,!0),this.setValues(e)):(this.dispatchEvent({type:"beforeDeserialize",data:e,meta:t,bubbleToObject:!0,bubbleToParent:!0}),this)}};Ma.TypeSlug="phongmat",Ma.TYPE="LegacyPhongMaterial",Ma.MaterialProperties={...cc,color:new fe(16777215),specular:new fe(1118481),shininess:30,map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,emissive:new fe(0),emissiveIntensity:1,emissiveMap:null,bumpMap:null,bumpScale:1,normalMap:null,normalMapType:"TangentSpaceNormalMap",normalScale:new ne(1,1),displacementMap:null,displacementScale:1,displacementBias:0,specularMap:null,alphaMap:null,envMap:null,combine:vs,envMapIntensity:1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinewidth:1,wireframeLinecap:"round",wireframeLinejoin:"round",skinning:!1,fog:!0,flatShading:!1},Ma.MaterialTemplate={materialType:Ma.TYPE,name:"phong",typeSlug:Ma.TypeSlug,alias:["phong","legacy-phong",Ma.TYPE,Ma.TypeSlug,"MeshPhongMaterial","MeshPhongMaterial2","PhongMaterial"],params:{color:new fe(1,1,1)},generator:r=>new Ma(r)};let cE=Ma;class hE extends Fe{constructor(e,t){super(e,t),this.assetType="model",this.setDirty=Wt.setDirty,this.refreshUi=Wt.refreshUi,Wt.upgradeObject3D.call(this)}get modelObject(){return this}}class kL extends ht{constructor(){super(),this.setDirty=Ln.setDirty,this.refreshUi=Ln.refreshUi,this.appliedMeshes=new Set,Ln.upgradeGeometry.call(this)}}const _r={setDirty:function(r){this.dispatchEvent({bubbleToParent:!0,...r,type:"lightUpdate",light:this,object:this}),Wt.setDirty.call(this,r)},upgradeLight:FL,refreshUi:Wt.refreshUi};function FL(r,e){this&&Wt.upgradeObject3D.call(this,r,e)}var NL=Object.defineProperty,GL=Object.getOwnPropertyDescriptor,cg=(r,e,t,i)=>{for(var n=i>1?void 0:i?GL(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&NL(e,t,n),n};p.AmbientLight2=class extends ff{constructor(r,e){super(r,e),this.assetType="light",this.setDirty=_r.setDirty,this.refreshUi=_r.refreshUi,this.isAmbientLight2=!0,_r.upgradeLight.call(this)}autoScale(){return console.warn("AutoScale not supported on Lights"),this}autoCenter(){return console.warn("AutoCenter not supported on Lights"),this}get lightObject(){return this}get modelObject(){return this}},cg([De("Enabled"),yi("setDirty")],p.AmbientLight2.prototype,"visible",2),cg([Hs("Color",r=>({onChange:()=>r.setDirty()}))],p.AmbientLight2.prototype,"color",2),cg([Rt("Intensity",[0,30],.01),yi("setDirty")],p.AmbientLight2.prototype,"intensity",2),p.AmbientLight2=cg([Xr("Ambient Light")],p.AmbientLight2);var zL=Object.defineProperty,QL=Object.getOwnPropertyDescriptor,Ac=(r,e,t,i)=>{for(var n=i>1?void 0:i?QL(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&zL(e,t,n),n};p.DirectionalLight2=class extends Ch{constructor(r,e){super(r,e),this.assetType="light",this.setDirty=_r.setDirty,this.refreshUi=_r.refreshUi,this.isDirectionalLight2=!0,this.target.position.set(0,0,-1),this.add(this.target),_r.upgradeLight.call(this)}autoScale(){return console.warn("AutoScale not supported on Lights"),this}autoCenter(){return console.warn("AutoCenter not supported on Lights"),this}get lightObject(){return this}get modelObject(){return this}},Ac([De("Enabled"),yi("setDirty")],p.DirectionalLight2.prototype,"visible",2),Ac([Hs("Color",r=>({onChange:()=>r.setDirty()}))],p.DirectionalLight2.prototype,"color",2),Ac([Rt("Intensity",[0,30],.01),yi("setDirty")],p.DirectionalLight2.prototype,"intensity",2),Ac([an("Position",void 0,void 0,r=>({onChange:()=>r.setDirty()}))],p.DirectionalLight2.prototype,"position",2),Ac([an("Rotation",void 0,void 0,r=>({onChange:()=>r.setDirty()}))],p.DirectionalLight2.prototype,"rotation",2),Ac([De("Cast Shadow"),yi("setDirty")],p.DirectionalLight2.prototype,"castShadow",2),p.DirectionalLight2=Ac([Xr("Directional Light")],p.DirectionalLight2);var VL=Object.defineProperty,jL=Object.getOwnPropertyDescriptor,Fh=(r,e,t,i)=>{for(var n=i>1?void 0:i?jL(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&VL(e,t,n),n};p.HemisphereLight2=class extends mf{constructor(r,e,t){super(r,e,t),this.assetType="light",this.setDirty=_r.setDirty,this.refreshUi=_r.refreshUi,this.isHemisphereLight2=!0,_r.upgradeLight.call(this)}autoScale(){return console.warn("AutoScale not supported on Lights"),this}autoCenter(){return console.warn("AutoCenter not supported on Lights"),this}get lightObject(){return this}get modelObject(){return this}},Fh([De("Enabled"),yi("setDirty")],p.HemisphereLight2.prototype,"visible",2),Fh([Hs("Sky Color",r=>({onChange:()=>r.setDirty()}))],p.HemisphereLight2.prototype,"color",2),Fh([Hs("Ground Color",r=>({onChange:()=>r.setDirty()}))],p.HemisphereLight2.prototype,"groundColor",2),Fh([Rt("Intensity",[0,30],.01),yi("setDirty")],p.HemisphereLight2.prototype,"intensity",2),Fh([an("Position",void 0,void 0,r=>({onChange:()=>r.setDirty()}))],p.HemisphereLight2.prototype,"position",2),p.HemisphereLight2=Fh([Xr("Hemisphere Light")],p.HemisphereLight2);var HL=Object.defineProperty,WL=Object.getOwnPropertyDescriptor,cl=(r,e,t,i)=>{for(var n=i>1?void 0:i?WL(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&HL(e,t,n),n};p.PointLight2=class extends Kl{constructor(r,e,t,i){super(r,e,t,i),this.assetType="light",this.setDirty=_r.setDirty,this.refreshUi=_r.refreshUi,this.isPointLight2=!0,_r.upgradeLight.call(this)}autoScale(){return console.warn("AutoScale not supported on Lights"),this}autoCenter(){return console.warn("AutoCenter not supported on Lights"),this}get lightObject(){return this}get modelObject(){return this}},cl([De("Enabled"),yi("setDirty")],p.PointLight2.prototype,"visible",2),cl([Hs("Color",r=>({onChange:()=>r.setDirty()}))],p.PointLight2.prototype,"color",2),cl([Rt("Intensity",[0,30],.01),yi("setDirty")],p.PointLight2.prototype,"intensity",2),cl([vn("Distance"),yi("setDirty")],p.PointLight2.prototype,"distance",2),cl([vn("Decay"),yi("setDirty")],p.PointLight2.prototype,"decay",2),cl([an("Position",void 0,void 0,r=>({onChange:()=>r.setDirty()}))],p.PointLight2.prototype,"position",2),cl([De("Cast Shadow"),yi("setDirty")],p.PointLight2.prototype,"castShadow",2),p.PointLight2=cl([Xr("Point Light")],p.PointLight2);var XL=Object.defineProperty,qL=Object.getOwnPropertyDescriptor,vc=(r,e,t,i)=>{for(var n=i>1?void 0:i?qL(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&XL(e,t,n),n};p.RectAreaLight2=class extends gf{constructor(r,e,t,i){super(r,e,t,i),this.assetType="light",this.setDirty=_r.setDirty,this.refreshUi=_r.refreshUi,this.isRectAreaLight2=!0,_r.upgradeLight.call(this)}autoScale(){return console.warn("AutoScale not supported on Lights"),this}autoCenter(){return console.warn("AutoCenter not supported on Lights"),this}get lightObject(){return this}get modelObject(){return this}},vc([De("Enabled"),yi("setDirty")],p.RectAreaLight2.prototype,"visible",2),vc([Hs("Color",r=>({onChange:()=>r.setDirty()}))],p.RectAreaLight2.prototype,"color",2),vc([Rt("Intensity",[0,30],.01),yi("setDirty")],p.RectAreaLight2.prototype,"intensity",2),vc([vn("Width"),yi("setDirty")],p.RectAreaLight2.prototype,"width",2),vc([vn("Height"),yi("setDirty")],p.RectAreaLight2.prototype,"height",2),vc([vn("Power"),yi("setDirty")],p.RectAreaLight2.prototype,"power",2),p.RectAreaLight2=vc([Xr("RectArea Light")],p.RectAreaLight2);var YL=Object.defineProperty,KL=Object.getOwnPropertyDescriptor,qs=(r,e,t,i)=>{for(var n=i>1?void 0:i?KL(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&YL(e,t,n),n};p.SpotLight2=class extends Eh{constructor(r,e,t,i,n,s){super(r,e,t,i,n,s),this.assetType="light",this.setDirty=_r.setDirty,this.refreshUi=_r.refreshUi,this.isSpotLight2=!0,this.target.position.set(0,0,-1),this.add(this.target),_r.upgradeLight.call(this)}autoScale(){return console.warn("AutoScale not supported on Lights"),this}autoCenter(){return console.warn("AutoCenter not supported on Lights"),this}get lightObject(){return this}get modelObject(){return this}},qs([De("Enabled"),yi("setDirty")],p.SpotLight2.prototype,"visible",2),qs([Hs("Color",r=>({onChange:()=>r.setDirty()}))],p.SpotLight2.prototype,"color",2),qs([Rt("Intensity",[0,30],.01),yi("setDirty")],p.SpotLight2.prototype,"intensity",2),qs([Rt("Angle",[0,2],.01),yi("setDirty")],p.SpotLight2.prototype,"angle",2),qs([Rt("Penumbra",[0,.9999],.01),yi("setDirty")],p.SpotLight2.prototype,"penumbra",2),qs([Lt("Distance"),yi("setDirty")],p.SpotLight2.prototype,"distance",2),qs([Lt("Decay"),yi("setDirty")],p.SpotLight2.prototype,"decay",2),qs([an("Position",void 0,void 0,r=>({onChange:()=>r.setDirty()}))],p.SpotLight2.prototype,"position",2),qs([an("Rotation",void 0,void 0,r=>({onChange:()=>r.setDirty()}))],p.SpotLight2.prototype,"rotation",2),qs([De("Cast Shadow"),yi("setDirty")],p.SpotLight2.prototype,"castShadow",2),p.SpotLight2=qs([Xr("Spot Light")],p.SpotLight2);function hy(){this.assetType="texture",this.userData||(this.userData={}),this._appliedMaterials||(this._appliedMaterials=new Set),this.setDirty||(this.setDirty=()=>this.needsUpdate=!0)}function uE(r){var e;return(e=this.userData)!=null&&e.__isIWebGLRenderer?this:(this.userData||(this.userData={__isIWebGLRenderer:!0}),this.userData.__isIWebGLRenderer=!0,this.renderWithModes||(this.renderWithModes=pE),this.renderManager=r,this.baseRenderer||Object.defineProperty(this,"baseRenderer",{get:()=>(console.warn("IWebGLRenderer.baseRenderer is deprecated, use IWebGLRenderer.renderManager instead"),this.renderManager)}),this)}function pE(r,e){const t=this.userData,{backgroundRender:i,transparentRender:n,shadowMapRender:s,mainRenderPass:a,opaqueRender:o,transmissionRender:l,sceneRender:c,screenSpaceRendering:h}=t;r.backgroundRender!==void 0&&(t.backgroundRender=r.backgroundRender),r.transparentRender!==void 0&&(t.transparentRender=r.transparentRender),r.shadowMapRender!==void 0&&(t.shadowMapRender=r.shadowMapRender),r.mainRenderPass!==void 0&&(t.mainRenderPass=r.mainRenderPass),r.opaqueRender!==void 0&&(t.opaqueRender=r.opaqueRender),r.sceneRender!==void 0&&(t.sceneRender=r.sceneRender),r.transmissionRender!==void 0&&(t.transmissionRender=r.transmissionRender),r.screenSpaceRendering!==void 0&&(t.screenSpaceRendering=r.screenSpaceRendering),e(),t.backgroundRender=i,t.transparentRender=n,t.shadowMapRender=s,t.mainRenderPass=a,t.opaqueRender=o,t.sceneRender=c,t.transmissionRender=l,t.screenSpaceRendering=h}const JL=pE;var ZL=Object.defineProperty,$L=Object.getOwnPropertyDescriptor,so=(r,e,t,i)=>{for(var n=i>1?void 0:i?$L(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&ZL(e,t,n),n};p.RootScene=class extends Nl{constructor(r,e){super(),this.isRootScene=!0,this.assetType="model",this._mainCamera=null,this.backgroundColor=null,this.background=null,this.backgroundIntensity=1,this.environment=null,this.envMapIntensity=1,this.fixedEnvMapDirection=!1,this._dummyCam=new Oh(""),this._mainCameraUpdate=()=>{this.setDirty({refreshScene:!1}),this.refreshActiveCameraNearFar(),this.dispatchEvent({type:"mainCameraUpdate"}),this.dispatchEvent({type:"activeCameraUpdate"})},this._sceneBounds=new Vs,this._sceneBoundingRadius=0,this.refreshUi=Wt.refreshUi.bind(this),this._v1=new P,this._v2=new P,this.autoNearFarEnabled=!0,this.setDirty=this.setDirty.bind(this),Wt.upgradeObject3D.call(this,void 0,e),this.addEventListener("materialUpdate",()=>this.dispatchEvent({type:"sceneMaterialUpdate"})),this.addEventListener("objectUpdate",this.refreshScene),this.addEventListener("geometryUpdate",this.refreshScene),this.addEventListener("geometryChanged",this.refreshScene),this.defaultCamera=r,this.modelRoot=new It,this.modelRoot.userData.rootSceneModelRoot=!0,this.modelRoot.name="Scene",this.add(this.modelRoot),this.add(this.defaultCamera),this.mainCamera=this.defaultCamera}get mainCamera(){return this._mainCamera||this._dummyCam}set mainCamera(r){const e=this.mainCamera;r||(r=this.defaultCamera),e!==r&&(e&&(e.deactivateMain(void 0,!0),e.removeEventListener("cameraUpdate",this._mainCameraUpdate)),r?(this._mainCamera=r,r.addEventListener("cameraUpdate",this._mainCameraUpdate),r.activateMain(void 0,!0)):this._mainCamera=null,this.dispatchEvent({type:"activeCameraChange",lastCamera:e,camera:r}),this.dispatchEvent({type:"mainCameraChange",lastCamera:e,camera:r}),this.setDirty())}get renderCamera(){return this._renderCamera??this.mainCamera}set renderCamera(r){const e=this._renderCamera;this._renderCamera=r,this.dispatchEvent({type:"renderCameraChange",lastCamera:e,camera:r})}addObject(r,e){return(e!=null&&e.clearSceneObjects||e!=null&&e.disposeSceneObjects)&&this.clearSceneModels(e.disposeSceneObjects),r&&(r.isObject3D?(this._addObject3D(r,e),this.dispatchEvent({type:"addSceneObject",object:r,options:e}),r):(console.error("Invalid object, cannot add to scene.",r),r))}loadModelRoot(r,e){var t,i,n;if((e!=null&&e.clearSceneObjects||e!=null&&e.disposeSceneObjects)&&this.clearSceneModels(e.disposeSceneObjects),(t=r.userData)!=null&&t.rootSceneModelRoot||console.error("Invalid model root scene object. Trying to add anyway.",r),r.userData&&(r.userData.__importData&&(this.modelRoot.userData.__importData={...this.modelRoot.userData.__importData,...r.userData.__importData}),r.userData.gltfAsset&&(this.modelRoot.userData.__gltfAsset={...this.modelRoot.userData.__gltfAsset,...r.userData.gltfAsset}),r.userData.gltfExtras&&(this.modelRoot.userData.__gltfExtras={...this.modelRoot.userData.__gltfExtras,...r.userData.gltfExtras})),(n=(i=r.userData)==null?void 0:i.gltfAsset)!=null&&n.copyright&&r.children.forEach(s=>{var a;return!s.userData.license&&(s.userData.license=(a=r.userData.gltfAsset)==null?void 0:a.copyright)}),r.animations){this.modelRoot.animations||(this.modelRoot.animations=[]);for(const s of r.animations)this.modelRoot.animations.includes(s)||this.modelRoot.animations.push(s)}return[...r.children].map(s=>this.addObject(s,{...e,clearSceneObjects:!1,disposeSceneObjects:!1}))}_addObject3D(r,{autoCenter:e=!1,centerGeometries:t=!1,centerGeometriesKeepPosition:i=!0,autoScale:n=!1,autoScaleRadius:s=2,addToRoot:a=!1,license:o}={}){var l,c;const h=r;if(!h){console.error("Invalid object, cannot add to scene.");return}a?this.add(h):this.modelRoot.add(h),e&&!h.userData.isCentered&&!h.userData.pseudoCentered?(l=h.autoCenter)==null||l.call(h):h.userData.isCentered=!0,n&&!h.userData.autoScaled?(c=h.autoScale)==null||c.call(h,h.userData.autoScaleRadius||s):h.userData.autoScaled=!0,t&&!h.userData.geometriesCentered&&this.centerAllGeometries(i,h),h.userData.geometriesCentered=!0,o&&(h.userData.license=[h.userData.license,o].filter(d=>d).join(", ")),this.setDirty({refreshScene:!0})}centerAllGeometries(r=!0,e){const t=new Set;(e??this.modelRoot).traverse(i=>i.geometry&&t.add(i.geometry)),t.forEach(i=>i.center(void 0,r))}clearSceneModels(r=!1,e=!0){if(r)return this.disposeSceneModels(e);this.modelRoot.clear(),this.modelRoot.children=[],e&&this.setDirty({refreshScene:!0})}disposeSceneModels(r=!0,e=!0){e?([...this.modelRoot.children].forEach(t=>t.dispose?t.dispose():t.removeFromParent()),this.modelRoot.clear(),r&&this.setDirty({refreshScene:!0})):this.modelRoot.children.forEach(t=>t.dispose&&t.dispose())}_onEnvironmentChange(){var r,e;((r=this.environment)==null?void 0:r.mapping)===wo&&(this.environment.mapping=_s,this.environment.needsUpdate=!0),this.dispatchEvent({type:"environmentChanged",environment:this.environment}),this.setDirty({refreshScene:!0,geometryChanged:!1}),(e=this.refreshUi)==null||e.call(this)}onBackgroundChange(){var r;this.dispatchEvent({type:"backgroundChanged",background:this.background,backgroundColor:this.backgroundColor}),this.setDirty({refreshScene:!0,geometryChanged:!1}),(r=this.refreshUi)==null||r.call(this)}add(...r){return super.add(...r),this}setBackgroundColor(r){this.backgroundColor=r?new fe(r):null}setDirty(r){return r!=null&&r.sceneUpdate&&(console.warn("sceneUpdate is deprecated, use refreshScene instead."),r.refreshScene=!0),r!=null&&r.refreshScene?this.refreshScene(r):(this.dispatchEvent({type:"update"}),Wt.setDirty.call(this,{...r,scene:this})),this}refreshScene(r){return r&&r.type==="objectUpdate"&&r.object===this?this:(r==null?void 0:r.sceneUpdate)===!1||(r==null?void 0:r.refreshScene)===!1?this.setDirty(r):(this.refreshActiveCameraNearFar(),this._sceneBounds=this.getBounds(!1,!0),this._sceneBoundingRadius=this._sceneBounds.getSize(new P).length()/2,this.dispatchEvent({...r,type:"sceneUpdate",hierarchyChanged:["addedToParent","removedFromParent"].includes((r==null?void 0:r.change)||"")}),Wt.setDirty.call(this,r),this)}dispose(r=!0){var e,t,i,n;this.disposeSceneModels(!1,r),r&&([...this.children].forEach(s=>s.dispose?s.dispose():s.removeFromParent()),this.clear()),(e=this.environment)==null||e.dispose(),(t=this.background)!=null&&t.isTexture&&((n=(i=this.background)==null?void 0:i.dispose)==null||n.call(i)),r&&(this.environment=null,this.background=null)}getBounds(r=!1,e=!0,t=!0,i){return new Vs().expandByObject(this,r,e,n=>t&&(n.isWidget||n.assetType==="widget")?!0:(i==null?void 0:i(n))??!1)}refreshActiveCameraNearFar(){const r=this.mainCamera;if(!r)return;if(!this.autoNearFarEnabled||r.userData.autoNearFar===!1){r.near=r.userData.minNearPlane??.5,r.far=r.userData.maxFarPlane??1e3;return}const e=this.getBounds(!1);r.getWorldPosition(this._v1).sub(e.getCenter(this._v2));const t=1.5*e.getSize(this._v2).length()/2,i=this._v1.length(),n=Math.max(.1,-this._v1.normalize().dot(r.getWorldDirection(new P))),s=Math.max(Math.max(r.userData.minNearPlane??.5,.001),n*(i-t)),a=Math.min(Math.max(s+t,n*(i+t)),r.userData.maxFarPlane??1e3);r.near=s,r.far=a}updateShaderProperties(r){return r.uniforms.sceneBoundingRadius?r.uniforms.sceneBoundingRadius.value=this._sceneBoundingRadius:console.warn("RootScene: no uniform: sceneBoundingRadius"),this}toJSON(r){return Kt.Serialize(this,r,!0)}fromJSON(r,e){const t=r.environment;return t!==void 0&&(this.environment=Kt.Deserialize(t,this.environment,e,!1),delete r.environment),Kt.Deserialize(r,this,e,!0),r.environment=t,this}addEventListener(r,e){r==="activeCameraChange"&&console.error("activeCameraChange is deprecated. Use mainCameraChange instead."),r==="activeCameraUpdate"&&console.error("activeCameraUpdate is deprecated. Use mainCameraUpdate instead."),r==="sceneMaterialUpdate"&&console.error("sceneMaterialUpdate is deprecated. Use materialUpdate instead."),r==="update"&&console.error("update is deprecated. Use sceneUpdate instead."),super.addEventListener(r,e)}findObjectsByName(r,e){const t=[];return(e??this).traverse(i=>{i.name===r&&t.push(i)}),t}resetCamera(r=void 0,e=new P(1,1,1),t=new P(0,0,0)){if(this._mainCamera){this.matrixWorldNeedsUpdate=!0,this.updateMatrixWorld(!0);const i=r?new Vs().expandByObject(r,!0,!0):this.getBounds(!0),n=i.getCenter(new P),s=i.getSize(new P).length()*.5;n.add(t.clone().multiplyScalar(s)),this._mainCamera.position=new P(n.x+e.x*s,n.y+e.y*s,n.z+e.z*s),this._mainCamera.target=n,this.setDirty()}}get minNearDistance(){return console.error("minNearDistance is deprecated. Use camera.userData.minNearPlane instead"),this.mainCamera.userData.minNearPlane??.02}set minNearDistance(r){console.error("minNearDistance is deprecated. Use camera.userData.minNearPlane instead"),this.mainCamera&&(this.mainCamera.userData.minNearPlane=r)}get activeCamera(){return console.error("activeCamera is deprecated. Use mainCamera instead."),this.mainCamera}set activeCamera(r){console.error("activeCamera is deprecated. Use mainCamera instead."),this.mainCamera=r}get modelObject(){return this}get environmentIntensity(){return this.envMapIntensity}set environmentIntensity(r){this.envMapIntensity=r}addSceneObject(r,e){return this.addObject(r,e)}updateScene(r){return console.warn("updateScene is deprecated. Use refreshScene instead"),this.refreshScene(r||{})}removeSceneModels(){this.clearSceneModels()}},so([Hs("Background Color",r=>({onChange:()=>r==null?void 0:r.onBackgroundChange()})),$(),Ir(p.RootScene.prototype.onBackgroundChange)],p.RootScene.prototype,"backgroundColor",2),so([Ir(p.RootScene.prototype.onBackgroundChange),$(),_a("Background Image")],p.RootScene.prototype,"background",2),so([$(),yi(p.RootScene.prototype.setDirty),Rt("Background Intensity",[0,10],.01)],p.RootScene.prototype,"backgroundIntensity",2),so([_a("Environment"),$(),Ir(p.RootScene.prototype._onEnvironmentChange)],p.RootScene.prototype,"environment",2),so([Rt("Environment Intensity",[0,10],.01),$(),yi(p.RootScene.prototype.setDirty)],p.RootScene.prototype,"envMapIntensity",2),so([De("Fixed Env Direction"),$(),yi(p.RootScene.prototype.setDirty)],p.RootScene.prototype,"fixedEnvMapDirection",2),so([ur(),$()],p.RootScene.prototype,"defaultCamera",2),so([ci(void 0,{sendArgs:!1})],p.RootScene.prototype,"centerAllGeometries",1),p.RootScene=so([ti("Root Scene")],p.RootScene);class qp{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const eU=new ua(-1,1,1,-1,0,1),uy=new ht;uy.setAttribute("position",new Ne([-1,3,0,-1,-1,0,3,-1,0],3)),uy.setAttribute("uv",new Ne([0,2,0,0,2,0],2));class dE{constructor(e){this._mesh=new Fe(uy,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,eU)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class py extends qp{constructor(e,t,i,n,s){super(),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=n,this.clearAlpha=s!==void 0?s:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new fe}render(e,t,i,n,s,a){if(!this.scene||!this.camera)return;const o=e.autoClear;e.autoClear=!1;let l,c;if(this.overrideMaterial!==void 0&&(c=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),l=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),a){const h=e.getContext();h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,a)}if(this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),a){const h=e.getContext();h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,null)}this.clearColor&&e.setClearColor(this._oldClearColor,l),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=c),e.autoClear=o}}const yc={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class dy extends qp{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof yr?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=Dn.clone(e.uniforms),this.material=new yr({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new dE(this.material),this.useExistingRenderTarget=!1}render(e,t,i){this.uniforms[this.textureID]&&i&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(this.useExistingRenderTarget||e.setRenderTarget(t||null),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}var tU=Object.defineProperty,iU=(r,e,t,i)=>{for(var n=void 0,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=a(e,t,n)||n);return n&&tU(e,t,n),n};const my=(W=class extends dy{constructor(r,...e){super(r.isMaterial?r:new lE(r,e),e.length<1?W.DEFAULT_TEX_ID:e[0]),this.overrideReadBuffer=null,this.isExtendedShaderPass=!0,this.enabled=!0,this.onDirty=[],this.setDirty=this.setDirty.bind(this)}render(r,e,t,i,n){this.enabled&&r.renderWithModes({backgroundRender:!1},()=>{super.render(r,e||null,this.overrideReadBuffer||t,i,n)})}updateShaderProperties(r){r&&(Array.isArray(r)||(r=[r]),r.forEach(e=>e==null?void 0:e.updateShaderProperties(this.material)))}dispose(){var r,e,t,i;(e=(r=this.material)==null?void 0:r.dispose)==null||e.call(r),(i=(t=this.fsQuad)==null?void 0:t.dispose)==null||i.call(t),this.onDirty=[]}setDirty(){var r;this.material&&(this.material.needsUpdate=!0),(r=this.onDirty)==null||r.forEach(e=>e())}get isShaderPass2(){return console.error("isShaderPass2 is deprecated, use isExtendedShaderPass instead"),!0}},W.DEFAULT_TEX_ID="tDiffuse",W);iU([De("Enabled"),$(),Ir(my.prototype.setDirty)],my.prototype,"enabled");let Nh=my;class mE extends Nh{constructor(e,t="c = a + b;",i="",n){super({vertexShader:yc.vertexShader,fragmentShader:`
                varying vec2 vUv;
                ${i}
                void main() {
                    vec4 a = tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) );
                    vec4 b = tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) );
                    vec4 c = vec4(0);
                    ${t}
                    c = clamp(c, vec4(0), vec4(8));
                    gl_FragColor = c;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:n},...e}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}}var rU=Object.defineProperty,nU=(r,e,t,i)=>{for(var n=void 0,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=a(e,t,n)||n);return n&&rU(e,t,n),n};class fy extends py{constructor(e,t,i=new fe(0,0,0),n=0){super(void 0,void 0,t,i,n),this.isExtendedRenderPass=!0,this.enabled=!0,this.passId="render",this._doTransmissionFix=!0,this.blurTransmissionTarget=!0,this.preserveTransparentTarget=!1,this.onDirty=[],this.uiConfig={label:"Render Pass",type:"folder",children:Ih(this)},this.renderManager=e,this._blendPass=new mE({},"c = vec4(a.rgb * (1. - b.a) + b.rgb * b.a, 1.);"),this.setDirty=this.setDirty.bind(this)}get transparentTarget(){return this._transparentTarget||(this._transparentTarget=this.renderManager.getTempTarget({sizeMultiplier:1,samples:this.renderManager.composerTarget.samples||0,colorSpace:Xi,type:this.renderManager.renderer.extensions.has("EXT_color_buffer_half_float")?di:oi,format:mi,minFilter:Et,magFilter:Et,depthBuffer:!1})),this._transparentTarget}_releaseTransparentTarget(){this._transparentTarget&&this.renderManager.releaseTempTarget(this._transparentTarget),this._transparentTarget=void 0}render(e,t,i,n,s){if(!this.enabled)return;let a=!1;if(e.userData.mainRenderPass=!0,!this._doTransmissionFix&&!this.renderManager.rgbm){super.render(e,t||null,i,n,s),this.needsSwap=a,e.userData.mainRenderPass=void 0;return}const o=e.userData;o||console.error("threejs is not patched?");const l=(this.renderManager.zPrepass||!this.renderManager.depthBuffer)&&this.renderManager.gbufferTarget;let c;if(l){const d=this.renderManager.gbufferTarget;if(d){const m=e.properties.get(d);c=m.__webglDepthRenderbuffer||m.__webglDepthbuffer}c||console.warn("No depth/gbuffer present for zPrepass.")}let h=()=>{super.render(e,null,i,n,s,c)};if(this.renderManager.rgbm){if(this.renderManager.rgbm){a=!1;const d=this.renderToScreen;if(d&&!t&&console.error("ExtendedRenderPass: renderToScreen is true but writeBuffer is not set, which is required for rgbm"),this.renderToScreen=!1,e.info&&!e.info.autoReset)throw"renderer.info.autoReset must be true";{const m=e.autoClearDepth;e.autoClearDepth=!l,e.renderWithModes({shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},h),e.autoClearDepth=m}if(!l&&i){const m=e.properties.get(i);c=m.__webglDepthRenderbuffer||m.__webglDepthbuffer}h=()=>{super.render(e,null,this.transparentTarget,n,s,c)};{const m=this.clear,f=e.autoClearDepth;e.autoClearDepth=!1,this.clear=!0,e.renderWithModes({shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!0,transmissionRender:!1},h),this.clear=m,e.autoClearDepth=f}(!e.info||e.info.render.calls>0)&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,t,i,n,s),a=!0);{const m=this.clear;this.clear=!1,o.transmissionRenderTarget=a?t:i,o.blurTransmissionTarget=this.blurTransmissionTarget&&o.transmissionRenderTarget.samples===0,e.renderWithModes({shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},h),o.blurTransmissionTarget=void 0,o.transmissionRenderTarget=void 0,this.clear=m}if((!e.info||e.info.render.calls>0)&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,t,i,n,s),a=!0),d){this.renderToScreen=!0;const m=a?t==null?void 0:t.texture:i==null?void 0:i.texture,f=Array.isArray(m)?m[0]:m;f&&this.renderManager.blit(void 0,{source:f,respectColorSpace:!0})}}}else{{const d=this.clear,m=e.autoClearDepth;e.autoClearDepth=!l,this.clear=!0,e.renderWithModes({shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!0,transmissionRender:!1},h),this.clear=d,e.autoClearDepth=m}{const d=i?Array.isArray(i.texture)?i.texture[0]:i.texture:void 0;this.renderManager.blit(t,{clear:!0,source:d});const m=this.clear;this.clear=!1,o.transmissionRenderTarget=t,o.blurTransmissionTarget=this.blurTransmissionTarget&&o.transmissionRenderTarget.samples===0,e.renderWithModes({shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},h),o.blurTransmissionTarget=void 0,o.transmissionRenderTarget=void 0,this.clear=m}a=!1}this.preserveTransparentTarget||this._releaseTransparentTarget(),this.needsSwap=a,e.userData.mainRenderPass=void 0}dispose(){var e;this._releaseTransparentTarget(),this.onDirty=[],this.scene=void 0,this.camera=void 0,(e=super.dispose)==null||e.call(this)}setDirty(){this.onDirty.forEach(e=>e())}beforeRender(e,t,i){this.scene=e,this.camera=t}get isRenderPass2(){return console.error("isRenderPass2 is deprecated, use isExtendedRenderPass instead"),!0}}nU([De("Enabled"),$()],fy.prototype,"enabled");class gy extends Nh{constructor(e,t=!0){super({uniforms:Dn.clone(yc.uniforms),vertexShader:yc.vertexShader,fragmentShader:ro`
                uniform float opacity;
                #include <alphatest_pars_fragment>
                varying vec2 vUv;
                void main() {
                    ${t?"vec4 diffuseColor = tDiffuseTexelToLinear(texture2D(tDiffuse, vUv)) * opacity;":"vec4 diffuseColor = texture2D(tDiffuse, vUv) * opacity;"}
                    #include <alphatest_fragment>
                    ${e?sr(e,"diffuseColor"):""}
                    #ifdef OPAQUE
                    diffuseColor.a = 1.0;
                    #endif
                    gl_FragColor = diffuseColor;
                    ${t?"#include <encodings_fragment>":""}
                }
            `},"tDiffuse")}}var sU=Object.defineProperty,aU=Object.getOwnPropertyDescriptor,fE=(r,e,t,i)=>{for(var n=i>1?void 0:i?aU(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&sU(e,t,n),n};p.GBufferRenderPass=class extends py{constructor(r,e,t,i=new fe(1,1,1),n=1){super(void 0,void 0,t,i,n),this.passId=r,this.target=e,this.isGBufferRenderPass=!0,this.enabled=!0,this._transparentMats=new Set,this._transmissiveMats=new Set,this.preprocessMaterial=(s,a)=>{a=a??s.userData.renderToGBuffer,s.userData.pluginsDisabled&&(a=!1),(s.transparent&&(a||s.opacity>.99)||!s.transparent&&!s.transmission&&a===!1)&&(this._transparentMats.add(s),s.transparent=!s.transparent),s.transmission&&Math.abs(s.transmission||0)>0&&a&&(this._transmissiveMats.add([s,s.transmission]),s.transmission=0)}}render(r,e,t,i,n){if(!this.scene||!this.camera)return;const s=r.getRenderTarget(),a=r.getActiveCubeFace(),o=r.getActiveMipmapLevel();this.scene.traverse(({material:l})=>{l&&(Array.isArray(l)?l.forEach(c=>this.preprocessMaterial(c)):this.preprocessMaterial(l))}),r.renderWithModes({shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(r,null,this.target,i,n)),this._transparentMats.forEach(l=>l.transparent=!l.transparent),this._transparentMats.clear(),this._transmissiveMats.forEach(([l,c])=>l.transmission=c),this._transmissiveMats.clear(),r.setRenderTarget(s,a,o)}beforeRender(r,e,t){this.scene=r,this.camera=e}},fE([De("Enabled")],p.GBufferRenderPass.prototype,"enabled",2),p.GBufferRenderPass=fE([ti(r=>r.passId+" Render Pass")],p.GBufferRenderPass);const oU=`#include <packing>
varying vec2 vUv;
#include <alphatest_pars_fragment>
void main(){vec4 diffuseColor=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));
#ifdef HAS_TRANSPARENT_TARGET
vec4 transparentColor=tTransparentTexelToLinear(texture2D(tTransparent,vUv));
#else
vec4 transparentColor=vec4(0.0);
#endif
#ifdef HAS_GBUFFER
float depth=getDepth(vUv);bool isBackground=depth>0.99&&transparentColor.a<0.001;
#endif
#glMarker
#ifdef HAS_GBUFFER
#if (defined(CLIP_BACKGROUND) && CLIP_BACKGROUND > 0) || defined(CLIP_BACKGROUND_FORCE)
if(isBackground)diffuseColor.a=0.0;if(depth>0.99&&transparentColor.a>=0.001)diffuseColor.a=transparentColor.a;
#endif
if(depth<0.00001)diffuseColor.a=0.0;
#endif
#include <alphatest_fragment>
#ifdef OPAQUE
diffuseColor.a=1.0;
#endif
gl_FragColor=diffuseColor;
#include <encodings_fragment>
}`;var lU=Object.defineProperty,cU=Object.getOwnPropertyDescriptor,hg=(r,e,t,i)=>{for(var n=i>1?void 0:i?cU(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&lU(e,t,n),n};p.ScreenPass=class extends Nh{constructor(r="",...e){super(r!=null&&r.fragmentShader||r!=null&&r.isShaderMaterial?r:hU(r),...e.length?e:["tDiffuse","tTransparent"]),this.passId="screen",this.after=["render"],this.required=["render"],this.outputColorSpace=it,this._needsReRender=!1,this.clipBackgroundForce=!1,this.clipBackground=!1,this.material.addEventListener("materialUpdate",this.setDirty)}render(r,e,t,i,n){const s=r.outputColorSpace;(!e||this.renderToScreen)&&(r.outputColorSpace=this.outputColorSpace),super.render(r,e,t,i,n),this._lastReadBuffer=t,r.outputColorSpace=s,this._needsReRender=!1}reRender(r,e,t,i){this._lastReadBuffer&&this.render(r,e,this._lastReadBuffer,t,i)}onPostFrame(r){this._needsReRender&&(this._needsReRender=!1,this.reRender(r.renderer),this.clipBackground&&!r.gbufferTarget&&console.warn("ScreenPass: clipBackground set to true but no gbufferTarget set. Try adding GBufferPlugin."))}dispose(){this._lastReadBuffer=void 0,super.dispose()}beforeRender(r,e,t){var i;this.material.uniforms.tTransparent.value=t.renderPass.preserveTransparentTarget&&((i=t.renderPass.transparentTarget)==null?void 0:i.texture)||null,this.material.defines.HAS_TRANSPARENT_TARGET=this.material.uniforms.tTransparent.value?1:void 0,this.material.defines.HAS_TRANSPARENT_TARGET||delete this.material.defines.HAS_TRANSPARENT_TARGET}setDirty(){super.setDirty(),this._needsReRender=!0}},hg([js("Output Color Space",y0.ColorSpace.uiConfig,r=>({onChange:r.setDirty}))],p.ScreenPass.prototype,"outputColorSpace",2),hg([Sp("CLIP_BACKGROUND_FORCE",void 0,void 0,p.ScreenPass.prototype.setDirty,!0)],p.ScreenPass.prototype,"clipBackgroundForce",2),hg([Sp("CLIP_BACKGROUND",void 0,void 0,p.ScreenPass.prototype.setDirty),De()],p.ScreenPass.prototype,"clipBackground",2),p.ScreenPass=hg([ti("Screen Pass")],p.ScreenPass);function hU(r){return{...yc,fragmentShader:ri(ri(oU,"void main()",(Array.isArray(r)?r[0]:(r==null?void 0:r.pars)||"")+`
`,{prepend:!0}),"#glMarker",(Array.isArray(r)?r[1]:typeof r=="string"?r:(r==null?void 0:r.main)||"")+`
`,{prepend:!0}),uniforms:{tDiffuse:{value:null},tTransparent:{value:null}},transparent:!0,blending:Qt,side:Ie}}function gE(r){const e=[],t={};for(const i of r)i.passId&&(t[i.passId]={after:i.after??[],before:i.before??[],dependencies:new Set(i.required??[])});for(const[i,n]of Object.entries(t)){const s=new Set([...n.after,...n.before]);n.dependencies.forEach(a=>s.has(a)&&s.delete(a)),s.forEach(a=>{const o=t[a];if(o){if(o.dependencies.has(i))throw console.error("cyclic",i,a),"Cyclic dependency";n.dependencies.add(a)}})}for(;;){let i=!1;const n=[...Object.entries(t)];for(const[s,a]of n)if(!e.includes(s)&&Hw(e,a.dependencies.values())){const o=Math.max(-1,...a.after.map(c=>e.indexOf(c))),l=Math.min(e.length,...a.before.map(c=>{const h=e.indexOf(c);return h<0?e.length:h}));if(o>=l)throw console.error(a,r,e,o,l),"Not possible";e.splice(a.after.length>0?o+1:l,0,s),i=!0,delete t[s]}if(Object.keys(t).length<1)break;if(!i)throw console.error(n,t,e),"Not possible 2"}return e}class AE extends qp{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const n=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0);let a,o;this.inverse?(a=0,o=1):(a=1,o=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(n.REPLACE,n.REPLACE,n.REPLACE),s.buffers.stencil.setFunc(n.ALWAYS,a,4294967295),s.buffers.stencil.setClear(o),s.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(n.EQUAL,1,4294967295),s.buffers.stencil.setOp(n.KEEP,n.KEEP,n.KEEP),s.buffers.stencil.setLocked(!0)}}class uU extends qp{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class vE{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const i=e.getSize(new ne);this._width=i.width,this._height=i.height,t=new Gr(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:di}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new dy(yc),this.clock=new _f}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;for(let n=0,s=this.passes.length;n<s;n++){const a=this.passes[n];if(a.enabled!==!1){if(a.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(n),a.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),a.needsSwap){if(i){const o=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}AE!==void 0&&(a instanceof AE?i=!0:a instanceof uU&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new ne);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(i,n),this.renderTarget2.setSize(i,n);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(i,n)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class yE extends vE{constructor(e,t){super(e,t),this.copyPass2=new gy}setPixelRatio(e,t=!0){const i=this.setSize;t||(this.setSize=()=>{}),super.setPixelRatio(e),t||(this.setSize=i)}}function _E(r={}){var e,t;return[r.sizeMultiplier,r.samples,r.colorSpace,r.type,r.format,r.depthBuffer,r.depthTexture,r.textureCount,(e=r.size)==null?void 0:e.width,(t=r.size)==null?void 0:t.height].join(";")}class bE extends zi{constructor(){super(),this._trackedTargets=[],this._trackedTempTargets=[],this._releasedTempTargets={},this.maxTempPerKey=5,this._processNewTarget=this._processNewTarget.bind(this),this._processNewTempTarget=this._processNewTempTarget.bind(this),this.trackTarget=this.trackTarget.bind(this),this.disposeTarget=this.disposeTarget.bind(this),this.createTarget=this.createTarget.bind(this),this.createTargetCustom=this.createTargetCustom.bind(this)}trackTarget(e){this._trackedTargets.push(e)}removeTrackedTarget(e){const t=this._trackedTargets.indexOf(e);t>=0&&this._trackedTargets.splice(t,1)}createTarget({sizeMultiplier:e=void 0,samples:t=0,colorSpace:i=Xi,type:n=oi,format:s=mi,depthBuffer:a=!0,depthTexture:o=!1,depthTextureType:l=un,depthTextureFormat:c=ta,size:h=void 0,textureCount:d=1,...m}={},f=!0){this.isWebGL2||(t=0),e!==void 0&&h!==void 0&&console.error("Both sizeMultiplier and size are defined. sizeMultiplier will be ignored."),h=h||this.renderSize.clone().multiplyScalar(this.renderScale*(e=e||1)),h.width=Math.floor(h.width),h.height=Math.floor(h.height);const v=o?new nv(h.width,h.height,l):void 0;v&&(v.format=c);const w=this.createTargetCustom(d>1?{width:h.width,height:h.height,count:d}:h,{samples:t,colorSpace:i,type:n,format:s,depthBuffer:a,depthTexture:v},d>1?rm:Gr);return this._processNewTarget(w,e,f),this._setTargetOptions(w,m),w}disposeTarget(e,t=!0){if(e){if(e.isTemporary)return this.releaseTempTarget(e);t&&this.removeTrackedTarget(e),e.dispose(!1)}}getTempTarget(e={}){var t;const i=_E(e);let n;return(t=this._releasedTempTargets[i])!=null&&t.length&&(n=this._releasedTempTargets[i].pop()),n?this._setTargetOptions(n,e):(n=this.createTarget(e),this._processNewTempTarget(n,i)),n}releaseTempTarget(e){const t=e.targetKey;if(!t||!e.isTemporary)throw"Not a temp target";this._releasedTempTargets[t].length>this.maxTempPerKey?(this.removeTrackedTarget(e),e.dispose()):this._releasedTempTargets[t].push(e)}createTargetCustom({width:e,height:t,count:i},n={},s){let a=[e,t];if(i&&i>1&&a.push(i),(s==null?void 0:s.prototype)===oh.prototype){if(e!==t)throw"Width and height of cube render target must be equal";a=[e]}return this._createTargetClass(s??Gr,a,{format:mi,minFilter:Et,magFilter:Et,generateMipmaps:!1,type:oi,colorSpace:Xi,...n})}dispose(e=!0){this._trackedTargets.forEach(t=>t.dispose()),Object.values(this._trackedTempTargets).forEach(t=>t.dispose()),e&&(this._trackedTargets=[],this._releasedTempTargets={},this._trackedTempTargets=[])}resizeTrackedTargets(){for(const e of this._trackedTargets)this.resizeTrackedTarget(e)}resizeTrackedTarget(e){const t=e.sizeMultiplier;if(t){const i=this.renderSize.clone().multiplyScalar(this.renderScale*t);e.setSize(Math.floor(i.width),Math.floor(i.height))}}_processNewTempTarget(e,t){return e.isTemporary=!0,e.targetKey=t,this._releasedTempTargets[t]===void 0&&(this._releasedTempTargets[t]=[]),this._trackedTempTargets.push(e),e}_setTargetOptions(e,t){const i=e.texture;for(const n of Array.isArray(i)?i:[i])this._setTargetTextureOptions(n,t)}_setTargetTextureOptions(e,t){e.minFilter=t.minFilter??Et,e.magFilter=t.magFilter??Et,e.wrapS=t.wrapS??ai,e.wrapT=t.wrapT??ai,e.generateMipmaps=t.generateMipmaps??!1,e.generateMipmaps&&e.minFilter===Et&&(e.minFilter=Al),!e.generateMipmaps&&e.minFilter===Al&&(e.minFilter=Et)}_processNewTarget(e,t,i){return t!==void 0&&(e.sizeMultiplier=t),i&&this.trackTarget(e),e}}class Pr{constructor(e,t,i,n,s){this.extensions=[],this.cls=e,this.ext=t.filter(Boolean).map(a=>a.toLowerCase()),this.mime=i.filter(Boolean).map(a=>a.toLowerCase()),this.root=n,this.onCtor=s}ctor(e){const t=this.cls&&new this.cls(e.loadingManager);return typeof this.onCtor=="function"?this.onCtor(t,e,this):t}}class Ay extends bi{load(e,t,i,n){return super.load(e,s=>{try{if(typeof s=="string")t==null||t(JSON.parse(s));else throw new Error("Invalid JSON")}catch(a){n==null||n(a)}},i,n)}}class Yp extends Ay{async loadAsync(e,t){if(!this.viewer)throw"Viewer not set in JSONMaterialLoader.";const i=await super.loadAsync(e,t);return await Yp.DeserializeMaterialJSON(i,this.viewer)}static async DeserializeMaterialJSON(e,t,i,n){i=i||nc();const s={...e};e.images&&(Array.isArray(e.images)?i.images=Object.fromEntries(e.images.map(o=>[o.uuid,o])):i.images=e.images,delete s.images),e.textures&&(Array.isArray(e.textures)?i.textures=Object.fromEntries(e.textures.map(o=>[o.uuid,o])):i.textures=e.textures,delete s.textures),e.materials&&(Array.isArray(e.materials)?i.materials=Object.fromEntries(e.materials.map(o=>[o.uuid,o])):i.materials=e.materials,delete s.materials);const a=await t.loadConfigResources(i);return Kt.Deserialize(s,n||void 0,a)}}class vy extends $i{constructor(e){super(e)}load(e,t,i,n){const s=this,a=this.path===""?Qs.extractUrlBase(e):this.path,o=new bi(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{t(s.parse(l,a))}catch(c){n?n(c):console.error(c),s.manager.itemError(e)}},i,n)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const i=e.split(`
`);let n={};const s=/\s+/,a={};for(let l=0;l<i.length;l++){let c=i[l];if(c=c.trim(),c.length===0||c.charAt(0)==="#")continue;const h=c.indexOf(" ");let d=h>=0?c.substring(0,h):c;d=d.toLowerCase();let m=h>=0?c.substring(h+1):"";if(m=m.trim(),d==="newmtl")n={name:m},a[m]=n;else if(d==="ka"||d==="kd"||d==="ks"||d==="ke"){const f=m.split(s,3);n[d]=[parseFloat(f[0]),parseFloat(f[1]),parseFloat(f[2])]}else n[d]=m}const o=new pU(this.resourcePath||t,this.materialOptions);return o.setCrossOrigin(this.crossOrigin),o.setManager(this.manager),o.setMaterials(a),o}}class pU{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:Ie,this.wrap=this.options.wrap!==void 0?this.options.wrap:Ar}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const i in e){const n=e[i],s={};t[i]=s;for(const a in n){let o=!0,l=n[a];const c=a.toLowerCase();switch(c){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(l=[l[0]/255,l[1]/255,l[2]/255]),this.options&&this.options.ignoreZeroRGBs&&l[0]===0&&l[1]===0&&l[2]===0&&(o=!1);break}o&&(s[c]=l)}}return t}async preload(){for(const e in this.materialsInfo)await this.create(e)}getIndex(e){return this.nameLookup[e]}async getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=await this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}async create(e){return this.materials[e]===void 0&&await this.createMaterial_(e),this.materials[e]}async createMaterial_(e){const t=this,i=this.materialsInfo[e],n={name:e,side:this.side};function s(c,h){return typeof h!="string"||h===""?"":/^https?:\/\//i.test(h)?h:c+h}async function a(c,h){if(n[c])return;const d=t.getTextureParams(h,n);return new Promise((m,f)=>{let v=!1,w=()=>!v&&(v=!0)&&m();const b=t.loadTexture(s(t.baseUrl,d.url),void 0,y=>{n[c]=y,w()},void 0,w);setTimeout(w,50),b.repeat.copy(d.scale),b.offset.copy(d.offset),b.wrapS=t.wrap,b.wrapT=t.wrap,(c==="map"||c==="emissiveMap")&&(b.colorSpace=it)})}const o=Array.from(Object.keys(i||{}));let l=o.includes("d")||o.includes("D");for(const c of o){const h=i[c];let d;if(h!=="")switch(c.toLowerCase()){case"kd":n.color=new fe().fromArray(h).convertSRGBToLinear();break;case"ks":n.specular=new fe().fromArray(h).convertSRGBToLinear();break;case"ke":n.emissive=new fe().fromArray(h).convertSRGBToLinear();break;case"map_kd":await a("map",h);break;case"map_ks":await a("specularMap",h);break;case"map_ke":await a("emissiveMap",h);break;case"norm":await a("normalMap",h);break;case"map_bump":case"bump":await a("bumpMap",h);break;case"map_d":await a("alphaMap",h),n.transparent=!0;break;case"ns":n.shininess=parseFloat(h);break;case"d":d=parseFloat(h),d<1&&(n.opacity=d,n.transparent=!0);break;case"tr":if(l)break;d=parseFloat(h),this.options&&this.options.invertTrProperty&&(d=1-d),d>0&&(n.opacity=1-d,n.transparent=!0);break}}return this.materials[e]=new Vl(n),this.materials[e]}getTextureParams(e,t){const i={scale:new ne(1,1),offset:new ne(0,0)},n=e.split(/\s+/);let s;return s=n.indexOf("-bm"),s>=0&&(t.bumpScale=parseFloat(n[s+1]),n.splice(s,2)),s=n.indexOf("-s"),s>=0&&(i.scale.set(parseFloat(n[s+1]),parseFloat(n[s+2])),n.splice(s,4)),s=n.indexOf("-o"),s>=0&&(i.offset.set(parseFloat(n[s+1]),parseFloat(n[s+2])),n.splice(s,4)),i.url=n.join(" ").trim(),i}loadTexture(e,t,i,n,s){const a=this.manager!==void 0?this.manager:Pv;let o=a.getHandler(e);o===null&&(o=new Ko(a)),o.setCrossOrigin&&o.setCrossOrigin(this.crossOrigin);const l=o.load(e,i,n,s);return t!==void 0&&(l.mapping=t),l}}const dU=/^[og]\s*(.+)?/,mU=/^mtllib /,fU=/^usemtl /,gU=/^usemap /,wE=/\s+/,xE=new P,yy=new P,EE=new P,CE=new P,ps=new P,ug=new fe;function AU(){const r={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=e,this.object.fromDeclaration=t!==!1;return}const i=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(n,s){const a=this._finalize(!1);a&&(a.inherited||a.groupCount<=0)&&this.materials.splice(a.index,1);const o={index:this.materials.length,name:n||"",mtllib:Array.isArray(s)&&s.length>0?s[s.length-1]:"",smooth:a!==void 0?a.smooth:this.smooth,groupStart:a!==void 0?a.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(l){const c={index:typeof l=="number"?l:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return c.clone=this.clone.bind(c),c}};return this.materials.push(o),o},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(n){const s=this.currentMaterial();if(s&&s.groupEnd===-1&&(s.groupEnd=this.geometry.vertices.length/3,s.groupCount=s.groupEnd-s.groupStart,s.inherited=!1),n&&this.materials.length>1)for(let a=this.materials.length-1;a>=0;a--)this.materials[a].groupCount<=0&&this.materials.splice(a,1);return n&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),s}},i&&i.name&&typeof i.clone=="function"){const n=i.clone(0);n.inherited=!0,this.object.materials.push(n)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/3)*3},parseNormalIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/3)*3},parseUVIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/2)*2},addVertex:function(e,t,i){const n=this.vertices,s=this.object.geometry.vertices;s.push(n[e+0],n[e+1],n[e+2]),s.push(n[t+0],n[t+1],n[t+2]),s.push(n[i+0],n[i+1],n[i+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){const n=this.normals,s=this.object.geometry.normals;s.push(n[e+0],n[e+1],n[e+2]),s.push(n[t+0],n[t+1],n[t+2]),s.push(n[i+0],n[i+1],n[i+2])},addFaceNormal:function(e,t,i){const n=this.vertices,s=this.object.geometry.normals;xE.fromArray(n,e),yy.fromArray(n,t),EE.fromArray(n,i),ps.subVectors(EE,yy),CE.subVectors(xE,yy),ps.cross(CE),ps.normalize(),s.push(ps.x,ps.y,ps.z),s.push(ps.x,ps.y,ps.z),s.push(ps.x,ps.y,ps.z)},addColor:function(e,t,i){const n=this.colors,s=this.object.geometry.colors;n[e]!==void 0&&s.push(n[e+0],n[e+1],n[e+2]),n[t]!==void 0&&s.push(n[t+0],n[t+1],n[t+2]),n[i]!==void 0&&s.push(n[i+0],n[i+1],n[i+2])},addUV:function(e,t,i){const n=this.uvs,s=this.object.geometry.uvs;s.push(n[e+0],n[e+1]),s.push(n[t+0],n[t+1]),s.push(n[i+0],n[i+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,n,s,a,o,l,c){const h=this.vertices.length;let d=this.parseVertexIndex(e,h),m=this.parseVertexIndex(t,h),f=this.parseVertexIndex(i,h);if(this.addVertex(d,m,f),this.addColor(d,m,f),o!==void 0&&o!==""){const v=this.normals.length;d=this.parseNormalIndex(o,v),m=this.parseNormalIndex(l,v),f=this.parseNormalIndex(c,v),this.addNormal(d,m,f)}else this.addFaceNormal(d,m,f);if(n!==void 0&&n!==""){const v=this.uvs.length;d=this.parseUVIndex(n,v),m=this.parseUVIndex(s,v),f=this.parseUVIndex(a,v),this.addUV(d,m,f),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let i=0,n=e.length;i<n;i++){const s=this.parseVertexIndex(e[i],t);this.addVertexPoint(s),this.addColor(s)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const i=this.vertices.length,n=this.uvs.length;for(let s=0,a=e.length;s<a;s++)this.addVertexLine(this.parseVertexIndex(e[s],i));for(let s=0,a=t.length;s<a;s++)this.addUVLine(this.parseUVIndex(t[s],n))}};return r.startObject("",!1),r}class ME extends $i{constructor(e){super(e),this.materials=null}load(e,t,i,n){const s=this,a=new bi(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),s.currentUrl=e,a.load(e,async function(o){try{t(await s.parse(o))}catch(l){n?n(l):console.error(l),s.manager.itemError(e)}s.currentUrl=void 0},i,n)}setMaterials(e){return this.materials=e,this}async parse(e){const t=new AU;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const i=e.split(`
`);let n=[];for(let a=0,o=i.length;a<o;a++){const l=i[a].trimStart();if(l.length===0)continue;const c=l.charAt(0);if(c!=="#")if(c==="v"){const h=l.split(wE);switch(h[0]){case"v":t.vertices.push(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3])),h.length>=7?(ug.setRGB(parseFloat(h[4]),parseFloat(h[5]),parseFloat(h[6])).convertSRGBToLinear(),t.colors.push(ug.r,ug.g,ug.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3]));break;case"vt":t.uvs.push(parseFloat(h[1]),parseFloat(h[2]));break}}else if(c==="f"){const h=l.slice(1).trim().split(wE),d=[];for(let f=0,v=h.length;f<v;f++){const w=h[f];if(w.length>0){const b=w.split("/");d.push(b)}}const m=d[0];for(let f=1,v=d.length-1;f<v;f++){const w=d[f],b=d[f+1];t.addFace(m[0],w[0],b[0],m[1],w[1],b[1],m[2],w[2],b[2])}}else if(c==="l"){const h=l.substring(1).trim().split(" ");let d=[];const m=[];if(l.indexOf("/")===-1)d=h;else for(let f=0,v=h.length;f<v;f++){const w=h[f].split("/");w[0]!==""&&d.push(w[0]),w[1]!==""&&m.push(w[1])}t.addLineGeometry(d,m)}else if(c==="p"){const h=l.slice(1).trim().split(" ");t.addPointGeometry(h)}else if((n=dU.exec(l))!==null){const h=(" "+n[0].slice(1).trim()).slice(1);t.startObject(h)}else if(fU.test(l))t.object.startMaterial(l.substring(7).trim(),t.materialLibraries);else if(mU.test(l)){t.materialLibraries.push(l.substring(7).trim());let h=l.substring(7).trim(),d=this.manager.getHandler(h);if(!d&&h.trim().split("?")[0].endsWith(".mtl")&&(d=new vy(this.manager),d.setPath(this.path),d.setWithCredentials(this.withCredentials),d.setRequestHeader(this.requestHeader),d.setResourcePath(this.resourcePath),d.setCrossOrigin(this.crossOrigin)),this.currentUrl.startsWith("http")&&!h.startsWith("http")&&(h=this.currentUrl.substring(0,this.currentUrl.lastIndexOf("/")+1)+h),!d)console.warn("OBJLoader2: Regiser MTLLoader2 or any other material loader to loading manager to load the material file:",h);else{const m=await d.loadAsync(h).catch(f=>{console.warn(f)});m&&this.setMaterials(m)}}else if(gU.test(l))console.warn('OBJLoader2: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(c==="s"){if(n=l.split(" "),n.length>1){const d=n[1].trim().toLowerCase();t.object.smooth=d!=="0"&&d!=="off"}else t.object.smooth=!0;const h=t.object.currentMaterial();h&&(h.smooth=t.object.smooth)}else{if(l==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+l+'"')}}t.finalize();const s=new fn;if(s.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0))for(let a=0,o=t.objects.length;a<o;a++){const l=t.objects[a],c=l.geometry,h=l.materials,d=c.type==="Line",m=c.type==="Points";let f=!1;if(c.vertices.length===0)continue;const v=new ht;v.setAttribute("position",new Ne(c.vertices,3)),c.normals.length>0&&v.setAttribute("normal",new Ne(c.normals,3)),c.colors.length>0&&(f=!0,v.setAttribute("color",new Ne(c.colors,3))),c.hasUVIndices===!0&&v.setAttribute("uv",new Ne(c.uvs,2));const w=[];for(let y=0,E=h.length;y<E;y++){const _=h[y],C=_.name+"_"+_.smooth+"_"+f;let M=t.materials[C];if(this.materials!==null){if(M=await this.materials.create(_.name),d&&M&&!(M instanceof Ji)){const S=new Ji;Ki.prototype.copy.call(S,M),S.color.copy(M.color),M=S}else if(m&&M&&!(M instanceof da)){const S=new da({size:10,sizeAttenuation:!1});Ki.prototype.copy.call(S,M),S.color.copy(M.color),S.map=M.map,M=S}}M===void 0&&(d?M=new Ji:m?M=new da({size:1,sizeAttenuation:!1}):M=new fa,M.name=_.name,M.flatShading=!_.smooth,M.vertexColors=f,t.materials[C]=M),w.push(M)}let b;if(w.length>1){for(let y=0,E=h.length;y<E;y++){const _=h[y];v.addGroup(_.groupStart,_.groupCount,y)}d?b=new qn(v,w):m?b=new Gl(v,w):b=new Fe(v,w)}else d?b=new qn(v,w[0]):m?b=new Gl(v,w[0]):b=new Fe(v,w[0]);b.name=l.name,s.add(b)}else if(t.vertices.length>0){const a=new da({size:1,sizeAttenuation:!1}),o=new ht;o.setAttribute("position",new Ne(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(o.setAttribute("color",new Ne(t.colors,3)),a.vertexColors=!0);const l=new Gl(o,a);s.add(l)}return s}}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var SE={},_y=function(r){return URL.createObjectURL(new Blob([r],{type:"text/javascript"}))},TE=function(r){return new Worker(r)};try{URL.revokeObjectURL(_y(""))}catch{_y=function(r){return"data:application/javascript;charset=UTF-8,"+encodeURI(r)},TE=function(r){return new Worker(r,{type:"module"})}}var vU=function(r,e,t,i,n){var s=TE(SE[e]||(SE[e]=_y(r)));return s.onerror=function(a){return n(a.error,null)},s.onmessage=function(a){return n(null,a.data)},s.postMessage(t,i),s},ni=Uint8Array,Fr=Uint16Array,ao=Uint32Array,Gh=new ni([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),zh=new ni([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Kp=new ni([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),IE=function(r,e){for(var t=new Fr(31),i=0;i<31;++i)t[i]=e+=1<<r[i-1];for(var n=new ao(t[30]),i=1;i<30;++i)for(var s=t[i];s<t[i+1];++s)n[s]=s-t[i]<<5|i;return[t,n]},PE=IE(Gh,2),by=PE[0],pg=PE[1];by[28]=258,pg[258]=28;for(var RE=IE(zh,0),DE=RE[0],wy=RE[1],Jp=new Fr(32768),Ni=0;Ni<32768;++Ni){var hl=(Ni&43690)>>>1|(Ni&21845)<<1;hl=(hl&52428)>>>2|(hl&13107)<<2,hl=(hl&61680)>>>4|(hl&3855)<<4,Jp[Ni]=((hl&65280)>>>8|(hl&255)<<8)>>>1}for(var ds=function(e,t,i){for(var n=e.length,s=0,a=new Fr(t);s<n;++s)++a[e[s]-1];var o=new Fr(t);for(s=0;s<t;++s)o[s]=o[s-1]+a[s-1]<<1;var l;if(i){l=new Fr(1<<t);var c=15-t;for(s=0;s<n;++s)if(e[s])for(var h=s<<4|e[s],d=t-e[s],m=o[e[s]-1]++<<d,f=m|(1<<d)-1;m<=f;++m)l[Jp[m]>>>c]=h}else for(l=new Fr(n),s=0;s<n;++s)e[s]&&(l[s]=Jp[o[e[s]-1]++]>>>15-e[s]);return l},oo=new ni(288),Ni=0;Ni<144;++Ni)oo[Ni]=8;for(var Ni=144;Ni<256;++Ni)oo[Ni]=9;for(var Ni=256;Ni<280;++Ni)oo[Ni]=7;for(var Ni=280;Ni<288;++Ni)oo[Ni]=8;for(var Qh=new ni(32),Ni=0;Ni<32;++Ni)Qh[Ni]=5;var BE=ds(oo,9,0),LE=ds(oo,9,1),UE=ds(Qh,5,0),OE=ds(Qh,5,1),dg=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},ms=function(r,e,t){var i=e/8|0;return(r[i]|r[i+1]<<8)>>(e&7)&t},mg=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},Zp=function(r){return(r/8|0)+(r&7&&1)},fs=function(r,e,t){(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length);var i=new(r instanceof Fr?Fr:r instanceof ao?ao:ni)(t-e);return i.set(r.subarray(e,t)),i},$p=function(r,e,t){var i=r.length;if(!i||t&&!t.l&&i<5)return e||new ni(0);var n=!e||t,s=!t||t.i;t||(t={}),e||(e=new ni(i*3));var a=function(Ue){var rt=e.length;if(Ue>rt){var xt=new ni(Math.max(rt*2,Ue));xt.set(e),e=xt}},o=t.f||0,l=t.p||0,c=t.b||0,h=t.l,d=t.d,m=t.m,f=t.n,v=i*8;do{if(!h){t.f=o=ms(r,l,1);var w=ms(r,l+1,3);if(l+=3,w)if(w==1)h=LE,d=OE,m=9,f=5;else if(w==2){var b=ms(r,l,31)+257,y=ms(r,l+10,15)+4,E=b+ms(r,l+5,31)+1;l+=14;for(var _=new ni(E),C=new ni(19),M=0;M<y;++M)C[Kp[M]]=ms(r,l+M*3,7);l+=y*3;for(var S=dg(C),R=(1<<S)-1,U=ds(C,S,1),M=0;M<E;){var T=U[ms(r,l,R)];l+=T&15;var B=T>>>4;if(B<16)_[M++]=B;else{var Q=0,Z=0;for(B==16?(Z=3+ms(r,l,3),l+=2,Q=_[M-1]):B==17?(Z=3+ms(r,l,7),l+=3):B==18&&(Z=11+ms(r,l,127),l+=7);Z--;)_[M++]=Q}}var q=_.subarray(0,b),X=_.subarray(b);m=dg(q),f=dg(X),h=ds(q,m,1),d=ds(X,f,1)}else throw"invalid block type";else{var B=Zp(l)+4,te=r[B-4]|r[B-3]<<8,me=B+te;if(me>i){if(s)throw"unexpected EOF";break}n&&a(c+te),e.set(r.subarray(B,me),c),t.b=c+=te,t.p=l=me*8;continue}if(l>v){if(s)throw"unexpected EOF";break}}n&&a(c+131072);for(var se=(1<<m)-1,he=(1<<f)-1,_e=l;;_e=l){var Q=h[mg(r,l)&se],ge=Q>>>4;if(l+=Q&15,l>v){if(s)throw"unexpected EOF";break}if(!Q)throw"invalid length/literal";if(ge<256)e[c++]=ge;else if(ge==256){_e=l,h=null;break}else{var Oe=ge-254;if(ge>264){var M=ge-257,oe=Gh[M];Oe=ms(r,l,(1<<oe)-1)+by[M],l+=oe}var be=d[mg(r,l)&he],Me=be>>>4;if(!be)throw"invalid distance";l+=be&15;var X=DE[Me];if(Me>3){var oe=zh[Me];X+=mg(r,l)&(1<<oe)-1,l+=oe}if(l>v){if(s)throw"unexpected EOF";break}n&&a(c+131072);for(var Ve=c+Oe;c<Ve;c+=4)e[c]=e[c-X],e[c+1]=e[c+1-X],e[c+2]=e[c+2-X],e[c+3]=e[c+3-X];c=Ve}}t.l=h,t.p=_e,t.b=c,h&&(o=1,t.m=m,t.d=d,t.n=f)}while(!o);return c==e.length?e:fs(e,0,c)},Sa=function(r,e,t){t<<=e&7;var i=e/8|0;r[i]|=t,r[i+1]|=t>>>8},Vh=function(r,e,t){t<<=e&7;var i=e/8|0;r[i]|=t,r[i+1]|=t>>>8,r[i+2]|=t>>>16},fg=function(r,e){for(var t=[],i=0;i<r.length;++i)r[i]&&t.push({s:i,f:r[i]});var n=t.length,s=t.slice();if(!n)return[lo,0];if(n==1){var a=new ni(t[0].s+1);return a[t[0].s]=1,[a,1]}t.sort(function(M,S){return M.f-S.f}),t.push({s:-1,f:25001});var o=t[0],l=t[1],c=0,h=1,d=2;for(t[0]={s:-1,f:o.f+l.f,l:o,r:l};h!=n-1;)o=t[t[c].f<t[d].f?c++:d++],l=t[c!=h&&t[c].f<t[d].f?c++:d++],t[h++]={s:-1,f:o.f+l.f,l:o,r:l};for(var m=s[0].s,i=1;i<n;++i)s[i].s>m&&(m=s[i].s);var f=new Fr(m+1),v=gg(t[h-1],f,0);if(v>e){var i=0,w=0,b=v-e,y=1<<b;for(s.sort(function(S,R){return f[R.s]-f[S.s]||S.f-R.f});i<n;++i){var E=s[i].s;if(f[E]>e)w+=y-(1<<v-f[E]),f[E]=e;else break}for(w>>>=b;w>0;){var _=s[i].s;f[_]<e?w-=1<<e-f[_]++-1:++i}for(;i>=0&&w;--i){var C=s[i].s;f[C]==e&&(--f[C],++w)}v=e}return[new ni(f),v]},gg=function(r,e,t){return r.s==-1?Math.max(gg(r.l,e,t+1),gg(r.r,e,t+1)):e[r.s]=t},xy=function(r){for(var e=r.length;e&&!r[--e];);for(var t=new Fr(++e),i=0,n=r[0],s=1,a=function(l){t[i++]=l},o=1;o<=e;++o)if(r[o]==n&&o!=e)++s;else{if(!n&&s>2){for(;s>138;s-=138)a(32754);s>2&&(a(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(a(n),--s;s>6;s-=6)a(8304);s>2&&(a(s-3<<5|8208),s=0)}for(;s--;)a(n);s=1,n=r[o]}return[t.subarray(0,i),e]},jh=function(r,e){for(var t=0,i=0;i<e.length;++i)t+=r[i]*e[i];return t},ed=function(r,e,t){var i=t.length,n=Zp(e+2);r[n]=i&255,r[n+1]=i>>>8,r[n+2]=r[n]^255,r[n+3]=r[n+1]^255;for(var s=0;s<i;++s)r[n+s+4]=t[s];return(n+4+i)*8},Ey=function(r,e,t,i,n,s,a,o,l,c,h){Sa(e,h++,t),++n[256];for(var d=fg(n,15),m=d[0],f=d[1],v=fg(s,15),w=v[0],b=v[1],y=xy(m),E=y[0],_=y[1],C=xy(w),M=C[0],S=C[1],R=new Fr(19),U=0;U<E.length;++U)R[E[U]&31]++;for(var U=0;U<M.length;++U)R[M[U]&31]++;for(var T=fg(R,7),B=T[0],Q=T[1],Z=19;Z>4&&!B[Kp[Z-1]];--Z);var q=c+5<<3,X=jh(n,oo)+jh(s,Qh)+a,te=jh(n,m)+jh(s,w)+a+14+3*Z+jh(R,B)+(2*R[16]+3*R[17]+7*R[18]);if(q<=X&&q<=te)return ed(e,h,r.subarray(l,l+c));var me,se,he,_e;if(Sa(e,h,1+(te<X)),h+=2,te<X){me=ds(m,f,0),se=m,he=ds(w,b,0),_e=w;var ge=ds(B,Q,0);Sa(e,h,_-257),Sa(e,h+5,S-1),Sa(e,h+10,Z-4),h+=14;for(var U=0;U<Z;++U)Sa(e,h+3*U,B[Kp[U]]);h+=3*Z;for(var Oe=[E,M],oe=0;oe<2;++oe)for(var be=Oe[oe],U=0;U<be.length;++U){var Me=be[U]&31;Sa(e,h,ge[Me]),h+=B[Me],Me>15&&(Sa(e,h,be[U]>>>5&127),h+=be[U]>>>12)}}else me=BE,se=oo,he=UE,_e=Qh;for(var U=0;U<o;++U)if(i[U]>255){var Me=i[U]>>>18&31;Vh(e,h,me[Me+257]),h+=se[Me+257],Me>7&&(Sa(e,h,i[U]>>>23&31),h+=Gh[Me]);var Ve=i[U]&31;Vh(e,h,he[Ve]),h+=_e[Ve],Ve>3&&(Vh(e,h,i[U]>>>5&8191),h+=zh[Ve])}else Vh(e,h,me[i[U]]),h+=se[i[U]];return Vh(e,h,me[256]),h+se[256]},kE=new ao([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),lo=new ni(0),FE=function(r,e,t,i,n,s){var a=r.length,o=new ni(i+a+5*(1+Math.ceil(a/7e3))+n),l=o.subarray(i,o.length-n),c=0;if(!e||a<8)for(var h=0;h<=a;h+=65535){var d=h+65535;d<a?c=ed(l,c,r.subarray(h,d)):(l[h]=s,c=ed(l,c,r.subarray(h,a)))}else{for(var m=kE[e-1],f=m>>>13,v=m&8191,w=(1<<t)-1,b=new Fr(32768),y=new Fr(w+1),E=Math.ceil(t/3),_=2*E,C=function(Pe){return(r[Pe]^r[Pe+1]<<E^r[Pe+2]<<_)&w},M=new ao(25e3),S=new Fr(288),R=new Fr(32),U=0,T=0,h=0,B=0,Q=0,Z=0;h<a;++h){var q=C(h),X=h&32767,te=y[q];if(b[X]=te,y[q]=X,Q<=h){var me=a-h;if((U>7e3||B>24576)&&me>423){c=Ey(r,l,0,M,S,R,T,B,Z,h-Z,c),B=U=T=0,Z=h;for(var se=0;se<286;++se)S[se]=0;for(var se=0;se<30;++se)R[se]=0}var he=2,_e=0,ge=v,Oe=X-te&32767;if(me>2&&q==C(h-Oe))for(var oe=Math.min(f,me)-1,be=Math.min(32767,h),Me=Math.min(258,me);Oe<=be&&--ge&&X!=te;){if(r[h+he]==r[h+he-Oe]){for(var Ve=0;Ve<Me&&r[h+Ve]==r[h+Ve-Oe];++Ve);if(Ve>he){if(he=Ve,_e=Oe,Ve>oe)break;for(var Ue=Math.min(Oe,Ve-2),rt=0,se=0;se<Ue;++se){var xt=h-Oe+se+32768&32767,mt=b[xt],Dt=xt-mt+32768&32767;Dt>rt&&(rt=Dt,te=xt)}}}X=te,te=b[X],Oe+=X-te+32768&32767}if(_e){M[B++]=268435456|pg[he]<<18|wy[_e];var we=pg[he]&31,Y=wy[_e]&31;T+=Gh[we]+zh[Y],++S[257+we],++R[Y],Q=h+he,++U}else M[B++]=r[h],++S[r[h]]}}c=Ey(r,l,s,M,S,R,T,B,Z,h-Z,c),!s&&c&7&&(c=ed(l,c+1,lo))}return fs(o,0,i+Zp(c)+n)},NE=function(){for(var r=new ao(256),e=0;e<256;++e){for(var t=e,i=9;--i;)t=(t&1&&3988292384)^t>>>1;r[e]=t}return r}(),Hh=function(){var r=-1;return{p:function(e){for(var t=r,i=0;i<e.length;++i)t=NE[t&255^e[i]]^t>>>8;r=t},d:function(){return~r}}},Cy=function(){var r=1,e=0;return{p:function(t){for(var i=r,n=e,s=t.length,a=0;a!=s;){for(var o=Math.min(a+2655,s);a<o;++a)n+=i+=t[a];i=(i&65535)+15*(i>>16),n=(n&65535)+15*(n>>16)}r=i,e=n},d:function(){return r%=65521,e%=65521,(r&255)<<24|r>>>8<<16|(e&255)<<8|e>>>8}}},_c=function(r,e,t,i,n){return FE(r,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(r.length)))*1.5):12+e.mem,t,i,!n)},td=function(r,e){var t={};for(var i in r)t[i]=r[i];for(var i in e)t[i]=e[i];return t},GE=function(r,e,t){for(var i=r(),n=r.toString(),s=n.slice(n.indexOf("[")+1,n.lastIndexOf("]")).replace(/ /g,"").split(","),a=0;a<i.length;++a){var o=i[a],l=s[a];if(typeof o=="function"){e+=";"+l+"=";var c=o.toString();if(o.prototype)if(c.indexOf("[native code]")!=-1){var h=c.indexOf(" ",8)+1;e+=c.slice(h,c.indexOf("(",h))}else{e+=c;for(var d in o.prototype)e+=";"+l+".prototype."+d+"="+o.prototype[d].toString()}else e+=c}else t[l]=o}return[e,t]},Ag=[],yU=function(r){var e=[];for(var t in r)(r[t]instanceof ni||r[t]instanceof Fr||r[t]instanceof ao)&&e.push((r[t]=new r[t].constructor(r[t])).buffer);return e},zE=function(r,e,t,i){var n;if(!Ag[t]){for(var s="",a={},o=r.length-1,l=0;l<o;++l)n=GE(r[l],s,a),s=n[0],a=n[1];Ag[t]=GE(r[o],s,a)}var c=td({},Ag[t][1]);return vU(Ag[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,c,yU(c),i)},Wh=function(){return[ni,Fr,ao,Gh,zh,Kp,by,DE,LE,OE,Jp,ds,dg,ms,mg,Zp,fs,$p,Kh,ul,My]},Xh=function(){return[ni,Fr,ao,Gh,zh,Kp,pg,wy,BE,oo,UE,Qh,Jp,kE,lo,ds,Sa,Vh,fg,gg,xy,jh,ed,Ey,Zp,fs,FE,_c,id,ul]},QE=function(){return[Ty,Py,Ei,Hh,NE]},VE=function(){return[Iy,WE]},jE=function(){return[Ry,Ei,Cy]},HE=function(){return[XE]},ul=function(r){return postMessage(r,[r.buffer])},My=function(r){return r&&r.size&&new ni(r.size)},qh=function(r,e,t,i,n,s){var a=zE(t,i,n,function(o,l){a.terminate(),s(o,l)});return a.postMessage([r,e],e.consume?[r.buffer]:[]),function(){a.terminate()}},gs=function(r){return r.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return r.push(e.data[0],e.data[1])}},Yh=function(r,e,t,i,n){var s,a=zE(r,i,n,function(o,l){o?(a.terminate(),e.ondata.call(e,o)):(l[1]&&a.terminate(),e.ondata.call(e,o,l[0],l[1]))});a.postMessage(t),e.push=function(o,l){if(s)throw"stream finished";if(!e.ondata)throw"no stream handler";a.postMessage([o,s=l],[o.buffer])},e.terminate=function(){a.terminate()}},yn=function(r,e){return r[e]|r[e+1]<<8},dr=function(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24)>>>0},Sy=function(r,e){return dr(r,e)+dr(r,e+4)*4294967296},Ei=function(r,e,t){for(;t;++e)r[e]=t,t>>>=8},Ty=function(r,e){var t=e.filename;if(r[0]=31,r[1]=139,r[2]=8,r[8]=e.level<2?4:e.level==9?2:0,r[9]=3,e.mtime!=0&&Ei(r,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){r[3]=8;for(var i=0;i<=t.length;++i)r[i+10]=t.charCodeAt(i)}},Iy=function(r){if(r[0]!=31||r[1]!=139||r[2]!=8)throw"invalid gzip data";var e=r[3],t=10;e&4&&(t+=r[10]|(r[11]<<8)+2);for(var i=(e>>3&1)+(e>>4&1);i>0;i-=!r[t++]);return t+(e&2)},WE=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},Py=function(r){return 10+(r.filename&&r.filename.length+1||0)},Ry=function(r,e){var t=e.level,i=t==0?0:t<6?1:t==9?3:2;r[0]=120,r[1]=i<<6|(i?32-2*i:1)},XE=function(r){if((r[0]&15)!=8||r[0]>>>4>7||(r[0]<<8|r[1])%31)throw"invalid zlib data";if(r[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Dy(r,e){return!e&&typeof r=="function"&&(e=r,r={}),this.ondata=e,r}var Ta=function(){function r(e,t){!t&&typeof e=="function"&&(t=e,e={}),this.ondata=t,this.o=e||{}}return r.prototype.p=function(e,t){this.ondata(_c(e,this.o,0,0,!t),t)},r.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},r}(),qE=function(){function r(e,t){Yh([Xh,function(){return[gs,Ta]}],this,Dy.call(this,e,t),function(i){var n=new Ta(i.data);onmessage=gs(n)},6)}return r}();function YE(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return qh(r,e,[Xh],function(i){return ul(id(i.data[0],i.data[1]))},0,t)}function id(r,e){return _c(r,e||{},0,0)}var On=function(){function r(e){this.s={},this.p=new ni(0),this.ondata=e}return r.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,i=new ni(t+e.length);i.set(this.p),i.set(e,t),this.p=i},r.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,i=$p(this.p,this.o,this.s);this.ondata(fs(i,t,this.s.b),this.d),this.o=fs(i,this.s.b-32768),this.s.b=this.o.length,this.p=fs(this.p,this.s.p/8|0),this.s.p&=7},r.prototype.push=function(e,t){this.e(e),this.c(t)},r}(),By=function(){function r(e){this.ondata=e,Yh([Wh,function(){return[gs,On]}],this,0,function(){var t=new On;onmessage=gs(t)},7)}return r}();function Ly(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return qh(r,e,[Wh],function(i){return ul(Kh(i.data[0],My(i.data[1])))},1,t)}function Kh(r,e){return $p(r,e)}var vg=function(){function r(e,t){this.c=Hh(),this.l=0,this.v=1,Ta.call(this,e,t)}return r.prototype.push=function(e,t){Ta.prototype.push.call(this,e,t)},r.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var i=_c(e,this.o,this.v&&Py(this.o),t&&8,!t);this.v&&(Ty(i,this.o),this.v=0),t&&(Ei(i,i.length-8,this.c.d()),Ei(i,i.length-4,this.l)),this.ondata(i,t)},r}(),KE=function(){function r(e,t){Yh([Xh,QE,function(){return[gs,Ta,vg]}],this,Dy.call(this,e,t),function(i){var n=new vg(i.data);onmessage=gs(n)},8)}return r}();function JE(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return qh(r,e,[Xh,QE,function(){return[yg]}],function(i){return ul(yg(i.data[0],i.data[1]))},2,t)}function yg(r,e){e||(e={});var t=Hh(),i=r.length;t.p(r);var n=_c(r,e,Py(e),8),s=n.length;return Ty(n,e),Ei(n,s-8,t.d()),Ei(n,s-4,i),n}var _g=function(){function r(e){this.v=1,On.call(this,e)}return r.prototype.push=function(e,t){if(On.prototype.e.call(this,e),this.v){var i=this.p.length>3?Iy(this.p):4;if(i>=this.p.length&&!t)return;this.p=this.p.subarray(i),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}On.prototype.c.call(this,t)},r}(),ZE=function(){function r(e){this.ondata=e,Yh([Wh,VE,function(){return[gs,On,_g]}],this,0,function(){var t=new _g;onmessage=gs(t)},9)}return r}();function $E(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return qh(r,e,[Wh,VE,function(){return[bg]}],function(i){return ul(bg(i.data[0]))},3,t)}function bg(r,e){return $p(r.subarray(Iy(r),-8),e||new ni(WE(r)))}var Uy=function(){function r(e,t){this.c=Cy(),this.v=1,Ta.call(this,e,t)}return r.prototype.push=function(e,t){Ta.prototype.push.call(this,e,t)},r.prototype.p=function(e,t){this.c.p(e);var i=_c(e,this.o,this.v&&2,t&&4,!t);this.v&&(Ry(i,this.o),this.v=0),t&&Ei(i,i.length-4,this.c.d()),this.ondata(i,t)},r}(),_U=function(){function r(e,t){Yh([Xh,jE,function(){return[gs,Ta,Uy]}],this,Dy.call(this,e,t),function(i){var n=new Uy(i.data);onmessage=gs(n)},10)}return r}();function bU(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return qh(r,e,[Xh,jE,function(){return[wg]}],function(i){return ul(wg(i.data[0],i.data[1]))},4,t)}function wg(r,e){e||(e={});var t=Cy();t.p(r);var i=_c(r,e,2,4);return Ry(i,e),Ei(i,i.length-4,t.d()),i}var xg=function(){function r(e){this.v=1,On.call(this,e)}return r.prototype.push=function(e,t){if(On.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}On.prototype.c.call(this,t)},r}(),eC=function(){function r(e){this.ondata=e,Yh([Wh,HE,function(){return[gs,On,xg]}],this,0,function(){var t=new xg;onmessage=gs(t)},11)}return r}();function tC(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return qh(r,e,[Wh,HE,function(){return[co]}],function(i){return ul(co(i.data[0],My(i.data[1])))},5,t)}function co(r,e){return $p((XE(r),r.subarray(2,-4)),e)}var iC=function(){function r(e){this.G=_g,this.I=On,this.Z=xg,this.ondata=e}return r.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var i=new ni(this.p.length+e.length);i.set(this.p),i.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var n=this,s=function(){n.ondata.apply(n,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(s):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(s):new this.Z(s),this.s.push(this.p,t),this.p=null}}},r}(),wU=function(){function r(e){this.G=ZE,this.I=By,this.Z=eC,this.ondata=e}return r.prototype.push=function(e,t){iC.prototype.push.call(this,e,t)},r}();function xU(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return r[0]==31&&r[1]==139&&r[2]==8?$E(r,e,t):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?Ly(r,e,t):tC(r,e,t)}function EU(r,e){return r[0]==31&&r[1]==139&&r[2]==8?bg(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?Kh(r,e):co(r,e)}var Oy=function(r,e,t,i){for(var n in r){var s=r[n],a=e+n;s instanceof ni?t[a]=[s,i]:Array.isArray(s)?t[a]=[s[0],td(i,s[1])]:Oy(s,a+"/",t,i)}},rC=typeof TextEncoder<"u"&&new TextEncoder,ky=typeof TextDecoder<"u"&&new TextDecoder,nC=0;try{ky.decode(lo,{stream:!0}),nC=1}catch{}var sC=function(r){for(var e="",t=0;;){var i=r[t++],n=(i>127)+(i>223)+(i>239);if(t+n>r.length)return[e,fs(r,t-1)];n?n==3?(i=((i&15)<<18|(r[t++]&63)<<12|(r[t++]&63)<<6|r[t++]&63)-65536,e+=String.fromCharCode(55296|i>>10,56320|i&1023)):n&1?e+=String.fromCharCode((i&31)<<6|r[t++]&63):e+=String.fromCharCode((i&15)<<12|(r[t++]&63)<<6|r[t++]&63):e+=String.fromCharCode(i)}},CU=function(){function r(e){this.ondata=e,nC?this.t=new TextDecoder:this.p=lo}return r.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var i=new ni(this.p.length+e.length);i.set(this.p),i.set(e,this.p.length);var n=sC(i),s=n[0],a=n[1];if(t){if(a.length)throw"invalid utf-8 data";this.p=null}else this.p=a;this.ondata(s,t)},r}(),MU=function(){function r(e){this.ondata=e}return r.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(pl(e),this.d=t||!1)},r}();function pl(r,e){if(e){for(var t=new ni(r.length),i=0;i<r.length;++i)t[i]=r.charCodeAt(i);return t}if(rC)return rC.encode(r);for(var n=r.length,s=new ni(r.length+(r.length>>1)),a=0,o=function(d){s[a++]=d},i=0;i<n;++i){if(a+5>s.length){var l=new ni(a+8+(n-i<<1));l.set(s),s=l}var c=r.charCodeAt(i);c<128||e?o(c):c<2048?(o(192|c>>6),o(128|c&63)):c>55295&&c<57344?(c=65536+(c&1047552)|r.charCodeAt(++i)&1023,o(240|c>>18),o(128|c>>12&63),o(128|c>>6&63),o(128|c&63)):(o(224|c>>12),o(128|c>>6&63),o(128|c&63))}return fs(s,0,a)}function rd(r,e){if(e){for(var t="",i=0;i<r.length;i+=16384)t+=String.fromCharCode.apply(null,r.subarray(i,i+16384));return t}else{if(ky)return ky.decode(r);var n=sC(r),s=n[0],a=n[1];if(a.length)throw"invalid utf-8 data";return s}}var aC=function(r){return r==1?3:r<6?2:r==9?1:0},oC=function(r,e){return e+30+yn(r,e+26)+yn(r,e+28)},lC=function(r,e,t){var i=yn(r,e+28),n=rd(r.subarray(e+46,e+46+i),!(yn(r,e+8)&2048)),s=e+46+i,a=dr(r,e+20),o=t&&a==4294967295?cC(r,s):[a,dr(r,e+24),dr(r,e+42)],l=o[0],c=o[1],h=o[2];return[yn(r,e+10),l,c,n,s+yn(r,e+30)+yn(r,e+32),h]},cC=function(r,e){for(;yn(r,e)!=1;e+=4+yn(r,e+2));return[Sy(r,e+12),Sy(r,e+4),Sy(r,e+20)]},dl=function(r){var e=0;if(r)for(var t in r){var i=r[t].length;if(i>65535)throw"extra field too long";e+=i+4}return e},Jh=function(r,e,t,i,n,s,a,o){var l=i.length,c=t.extra,h=o&&o.length,d=dl(c);Ei(r,e,a!=null?33639248:67324752),e+=4,a!=null&&(r[e++]=20,r[e++]=t.os),r[e]=20,e+=2,r[e++]=t.flag<<1|(s==null&&8),r[e++]=n&&8,r[e++]=t.compression&255,r[e++]=t.compression>>8;var m=new Date(t.mtime==null?Date.now():t.mtime),f=m.getFullYear()-1980;if(f<0||f>119)throw"date not in range 1980-2099";if(Ei(r,e,f<<25|m.getMonth()+1<<21|m.getDate()<<16|m.getHours()<<11|m.getMinutes()<<5|m.getSeconds()>>>1),e+=4,s!=null&&(Ei(r,e,t.crc),Ei(r,e+4,s),Ei(r,e+8,t.size)),Ei(r,e+12,l),Ei(r,e+14,d),e+=16,a!=null&&(Ei(r,e,h),Ei(r,e+6,t.attrs),Ei(r,e+10,a),e+=14),r.set(i,e),e+=l,d)for(var v in c){var w=c[v],b=w.length;Ei(r,e,+v),Ei(r,e+2,b),r.set(w,e+4),e+=4+b}return h&&(r.set(o,e),e+=h),e},Fy=function(r,e,t,i,n){Ei(r,e,101010256),Ei(r,e+8,t),Ei(r,e+10,t),Ei(r,e+12,i),Ei(r,e+16,n)},nd=function(){function r(e){this.filename=e,this.c=Hh(),this.size=0,this.compression=0}return r.prototype.process=function(e,t){this.ondata(null,e,t)},r.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},r}(),SU=function(){function r(e,t){var i=this;t||(t={}),nd.call(this,e),this.d=new Ta(t,function(n,s){i.ondata(null,n,s)}),this.compression=8,this.flag=aC(t.level)}return r.prototype.process=function(e,t){try{this.d.push(e,t)}catch(i){this.ondata(i,null,t)}},r.prototype.push=function(e,t){nd.prototype.push.call(this,e,t)},r}(),TU=function(){function r(e,t){var i=this;t||(t={}),nd.call(this,e),this.d=new qE(t,function(n,s,a){i.ondata(n,s,a)}),this.compression=8,this.flag=aC(t.level),this.terminate=this.d.terminate}return r.prototype.process=function(e,t){this.d.push(e,t)},r.prototype.push=function(e,t){nd.prototype.push.call(this,e,t)},r}(),IU=function(){function r(e){this.ondata=e,this.u=[],this.d=1}return r.prototype.add=function(e){var t=this;if(this.d&2)throw"stream finished";var i=pl(e.filename),n=i.length,s=e.comment,a=s&&pl(s),o=n!=e.filename.length||a&&s.length!=a.length,l=n+dl(e.extra)+30;if(n>65535)throw"filename too long";var c=new ni(l);Jh(c,0,e,i,o);var h=[c],d=function(){for(var b=0,y=h;b<y.length;b++){var E=y[b];t.ondata(null,E,!1)}h=[]},m=this.d;this.d=0;var f=this.u.length,v=td(e,{f:i,u:o,o:a,t:function(){e.terminate&&e.terminate()},r:function(){if(d(),m){var b=t.u[f+1];b?b.r():t.d=1}m=1}}),w=0;e.ondata=function(b,y,E){if(b)t.ondata(b,y,E),t.terminate();else if(w+=y.length,h.push(y),E){var _=new ni(16);Ei(_,0,134695760),Ei(_,4,e.crc),Ei(_,8,w),Ei(_,12,e.size),h.push(_),v.c=w,v.b=l+w+16,v.crc=e.crc,v.size=e.size,m&&v.r(),m=1}else m&&d()},this.u.push(v)},r.prototype.end=function(){var e=this;if(this.d&2)throw this.d&1?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){e.d&1&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},r.prototype.e=function(){for(var e=0,t=0,i=0,n=0,s=this.u;n<s.length;n++){var a=s[n];i+=46+a.f.length+dl(a.extra)+(a.o?a.o.length:0)}for(var o=new ni(i+22),l=0,c=this.u;l<c.length;l++){var a=c[l];Jh(o,e,a,a.f,a.u,a.c,t,a.o),e+=46+a.f.length+dl(a.extra)+(a.o?a.o.length:0),t+=a.b}Fy(o,e,this.u.length,i,t),this.ondata(null,o,!0),this.d=2},r.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){var i=t[e];i.t()}this.d=2},r}();function PU(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var i={};Oy(r,"",i,e);var n=Object.keys(i),s=n.length,a=0,o=0,l=s,c=new Array(s),h=[],d=function(){for(var w=0;w<h.length;++w)h[w]()},m=function(){var w=new ni(o+22),b=a,y=o-a;o=0;for(var E=0;E<l;++E){var _=c[E];try{var C=_.c.length;Jh(w,o,_,_.f,_.u,C);var M=30+_.f.length+dl(_.extra),S=o+M;w.set(_.c,S),Jh(w,a,_,_.f,_.u,C,o,_.m),a+=16+M+(_.m?_.m.length:0),o=S+C}catch(R){return t(R,null)}}Fy(w,a,c.length,y,b),t(null,w)};s||m();for(var f=function(w){var b=n[w],y=i[b],E=y[0],_=y[1],C=Hh(),M=E.length;C.p(E);var S=pl(b),R=S.length,U=_.comment,T=U&&pl(U),B=T&&T.length,Q=dl(_.extra),Z=_.level==0?0:8,q=function(X,te){if(X)d(),t(X,null);else{var me=te.length;c[w]=td(_,{size:M,crc:C.d(),c:te,f:S,m:T,u:R!=b.length||T&&U.length!=B,compression:Z}),a+=30+R+Q+me,o+=76+2*(R+Q)+(B||0)+me,--s||m()}};if(R>65535&&q("filename too long",null),!Z)q(null,E);else if(M<16e4)try{q(null,id(E,_))}catch(X){q(X,null)}else h.push(YE(E,_,q))},v=0;v<l;++v)f(v);return d}function hC(r,e){e||(e={});var t={},i=[];Oy(r,"",t,e);var n=0,s=0;for(var a in t){var o=t[a],l=o[0],c=o[1],h=c.level==0?0:8,d=pl(a),m=d.length,f=c.comment,v=f&&pl(f),w=v&&v.length,b=dl(c.extra);if(m>65535)throw"filename too long";var y=h?id(l,c):l,E=y.length,_=Hh();_.p(l),i.push(td(c,{size:l.length,crc:_.d(),c:y,f:d,m:v,u:m!=a.length||v&&f.length!=w,o:n,compression:h})),n+=30+m+b+E,s+=76+2*(m+b)+(w||0)+E}for(var C=new ni(s+22),M=n,S=s-n,R=0;R<i.length;++R){var d=i[R];Jh(C,d.o,d,d.f,d.u,d.c.length);var U=30+d.f.length+dl(d.extra);C.set(d.c,d.o+U),Jh(C,n,d,d.f,d.u,d.c.length,d.o,d.m),n+=16+U+(d.m?d.m.length:0)}return Fy(C,n,i.length,S,M),C}var uC=function(){function r(){}return r.prototype.push=function(e,t){this.ondata(null,e,t)},r.compression=0,r}(),RU=function(){function r(){var e=this;this.i=new On(function(t,i){e.ondata(null,t,i)})}return r.prototype.push=function(e,t){try{this.i.push(e,t)}catch(i){this.ondata(i,e,t)}},r.compression=8,r}(),DU=function(){function r(e,t){var i=this;t<32e4?this.i=new On(function(n,s){i.ondata(null,n,s)}):(this.i=new By(function(n,s,a){i.ondata(n,s,a)}),this.terminate=this.i.terminate)}return r.prototype.push=function(e,t){this.i.terminate&&(e=fs(e,0)),this.i.push(e,t)},r.compression=8,r}(),BU=function(){function r(e){this.onfile=e,this.k=[],this.o={0:uC},this.p=lo}return r.prototype.push=function(e,t){var i=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var n=Math.min(this.c,e.length),s=e.subarray(0,n);if(this.c-=n,this.d?this.d.push(s,!this.c):this.k[0].push(s),e=e.subarray(n),e.length)return this.push(e,t)}else{var a=0,o=0,l=void 0,c=void 0;this.p.length?e.length?(c=new ni(this.p.length+e.length),c.set(this.p),c.set(e,this.p.length)):c=this.p:c=e;for(var h=c.length,d=this.c,m=d&&this.d,f=function(){var y,E=dr(c,o);if(E==67324752){a=1,l=o,v.d=null,v.c=0;var _=yn(c,o+6),C=yn(c,o+8),M=_&2048,S=_&8,R=yn(c,o+26),U=yn(c,o+28);if(h>o+30+R+U){var T=[];v.k.unshift(T),a=2;var B=dr(c,o+18),Q=dr(c,o+22),Z=rd(c.subarray(o+30,o+=30+R),!M);B==4294967295?(y=S?[-2]:cC(c,o),B=y[0],Q=y[1]):S&&(B=-1),o+=U,v.c=B;var q,X={name:Z,compression:C,start:function(){if(!X.ondata)throw"no callback";if(!B)X.ondata(null,lo,!0);else{var te=i.o[C];if(!te)throw"unknown compression type "+C;q=B<0?new te(Z):new te(Z,B,Q),q.ondata=function(_e,ge,Oe){X.ondata(_e,ge,Oe)};for(var me=0,se=T;me<se.length;me++){var he=se[me];q.push(he,!1)}i.k[0]==T&&i.c?i.d=q:q.push(lo,!0)}},terminate:function(){q&&q.terminate&&q.terminate()}};B>=0&&(X.size=B,X.originalSize=Q),v.onfile(X)}return"break"}else if(d){if(E==134695760)return l=o+=12+(d==-2&&8),a=3,v.c=0,"break";if(E==33639248)return l=o-=4,a=3,v.c=0,"break"}},v=this;o<h-4;++o){var w=f();if(w==="break")break}if(this.p=lo,d<0){var b=a?c.subarray(0,l-12-(d==-2&&8)-(dr(c,l-16)==134695760&&4)):c.subarray(0,o);m?m.push(b,!!a):this.k[+(a==2)].push(b)}if(a&2)return this.push(c.subarray(o),t);this.p=c.subarray(o)}if(t){if(this.c)throw"invalid zip file";this.p=null}},r.prototype.register=function(e){this.o[e.compression]=e},r}();function LU(r,e){if(typeof e!="function")throw"no callback";for(var t=[],i=function(){for(var m=0;m<t.length;++m)t[m]()},n={},s=r.length-22;dr(r,s)!=101010256;--s)if(!s||r.length-s>65558){e("invalid zip file",null);return}var a=yn(r,s+8);a||e(null,{});var o=a,l=dr(r,s+16),c=l==4294967295;if(c){if(s=dr(r,s-12),dr(r,s)!=101075792){e("invalid zip file",null);return}o=a=dr(r,s+32),l=dr(r,s+48)}for(var h=function(m){var f=lC(r,l,c),v=f[0],w=f[1],b=f[2],y=f[3],E=f[4],_=f[5],C=oC(r,_);l=E;var M=function(R,U){R?(i(),e(R,null)):(n[y]=U,--a||e(null,n))};if(!v)M(null,fs(r,C,C+w));else if(v==8){var S=r.subarray(C,C+w);if(w<32e4)try{M(null,Kh(S,new ni(b)))}catch(R){M(R,null)}else t.push(Ly(S,{size:b},M))}else M("unknown compression type "+v,null)},d=0;d<o;++d)h();return i}function Ny(r){for(var e={},t=r.length-22;dr(r,t)!=101010256;--t)if(!t||r.length-t>65558)throw"invalid zip file";var i=yn(r,t+8);if(!i)return{};var n=dr(r,t+16),s=n==4294967295;if(s){if(t=dr(r,t-12),dr(r,t)!=101075792)throw"invalid zip file";i=dr(r,t+32),n=dr(r,t+48)}for(var a=0;a<i;++a){var o=lC(r,n,s),l=o[0],c=o[1],h=o[2],d=o[3],m=o[4],f=o[5],v=oC(r,f);if(n=m,!l)e[d]=fs(r,v,v+c);else if(l==8)e[d]=Kh(r.subarray(v,v+c),new ni(h));else throw"unknown compression type "+l}return e}class pC extends bi{load(e,t,i,n){return this.setResponseType("arraybuffer"),super.load(e,s=>{const a=Ny(new Uint8Array(s)),o=new Map(Object.entries(a).map(([l,c])=>[l,new File([c],l)]));t==null||t(o)},i,n)}}class _i extends $i{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new NU(t)}),this.register(function(t){return new XU(t)}),this.register(function(t){return new qU(t)}),this.register(function(t){return new YU(t)}),this.register(function(t){return new zU(t)}),this.register(function(t){return new QU(t)}),this.register(function(t){return new VU(t)}),this.register(function(t){return new jU(t)}),this.register(function(t){return new FU(t)}),this.register(function(t){return new HU(t)}),this.register(function(t){return new GU(t)}),this.register(function(t){return new WU(t)}),this.register(function(t){return new OU(t)}),this.register(function(t){return new KU(t)}),this.register(function(t){return new JU(t)})}load(e,t,i,n){const s=this;let a;this.resourcePath!==""?a=this.resourcePath:this.path!==""?a=this.path:a=Qs.extractUrlBase(e),this.manager.itemStart(e);const o=function(c){n?n(c):console.error(c),s.manager.itemError(e),s.manager.itemEnd(e)},l=new bi(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{s.parse(c,a,function(h){t(h),s.manager.itemEnd(e)},o,e)}catch(h){o(h)}},i,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,n,s){let a;const o={},l={},c=new TextDecoder;if(typeof e=="string")a=JSON.parse(e);else if(e instanceof ArrayBuffer)if(c.decode(new Uint8Array(e,0,4))===dC){try{o[hi.KHR_BINARY_GLTF]=new fC(e)}catch(d){n&&n(d);return}a=JSON.parse(o[hi.KHR_BINARY_GLTF].content)}else a=JSON.parse(c.decode(e));else a=e;if(a.asset===void 0||a.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const h=new hO(a,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let d=0;d<this.pluginCallbacks.length;d++){const m=this.pluginCallbacks[d](h);l[m.name]=m,o[m.name]=!0}if(a.extensionsUsed)for(let d=0;d<a.extensionsUsed.length;++d){const m=a.extensionsUsed[d],f=a.extensionsRequired||[];switch(m){case hi.KHR_MATERIALS_UNLIT:o[m]=new kU;break;case hi.KHR_DRACO_MESH_COMPRESSION:o[m]=new ZU(a,this.dracoLoader);break;case hi.KHR_TEXTURE_TRANSFORM:o[m]=new $U;break;case hi.KHR_MESH_QUANTIZATION:o[m]=new eO;break;default:f.indexOf(m)>=0&&l[m]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+m+'".')}}h.setExtensions(o),h.setPlugins(l),h.parse(i,n)}parseAsync(e,t){const i=this;return new Promise(function(n,s){i.parse(e,t,n,s)})}}_i.ObjectConstructors={DirectionalLight:Ch,PointLight:Kl,SpotLight:Eh,MeshStandardMaterial:fa,MeshBasicMaterial:Pn,MeshPhysicalMaterial:_p,LineBasicMaterial:Ji,PointsMaterial:da,PerspectiveCamera:Qi,OrthographicCamera:ua};function UU(){let r={};return{get:function(e){return r[e]},add:function(e,t){r[e]=t},remove:function(e){delete r[e]},removeAll:function(){r={}}}}const hi={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class OU{constructor(e){this.parser=e,this.name=hi.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,n=t.length;i<n;i++){const s=t[i];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let n=t.cache.get(i);if(n)return n;const s=t.json,a=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let o;const l=new fe(16777215);a.color!==void 0&&l.fromArray(a.color);const c=a.range!==void 0?a.range:0;switch(a.type){case"directional":o=new _i.ObjectConstructors.DirectionalLight(l),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new _i.ObjectConstructors.PointLight(l),o.distance=c;break;case"spot":o=new _i.ObjectConstructors.SpotLight(l),o.distance=c,a.spot=a.spot||{},a.spot.innerConeAngle=a.spot.innerConeAngle!==void 0?a.spot.innerConeAngle:0,a.spot.outerConeAngle=a.spot.outerConeAngle!==void 0?a.spot.outerConeAngle:Math.PI/4,o.angle=a.spot.outerConeAngle,o.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return o.position.set(0,0,0),o.decay=2,uo(o,a),a.intensity!==void 0&&(o.intensity=a.intensity),o.name=t.createUniqueName(a.name||"light_"+e),n=Promise.resolve(o),t.cache.add(i,n),n}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,n=i.json.nodes[e],s=(n.extensions&&n.extensions[this.name]||{}).light;return s===void 0?null:this._loadLight(s).then(function(a){return i._getNodeRef(t.cache,s,a)})}}let kU=class{constructor(){this.name=hi.KHR_MATERIALS_UNLIT}getMaterialType(){return _i.ObjectConstructors.MeshBasicMaterial}extendParams(r,e,t){const i=[];r.color=new fe(1,1,1),r.opacity=1;const n=e.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){const s=n.baseColorFactor;r.color.fromArray(s),r.opacity=s[3]}n.baseColorTexture!==void 0&&i.push(t.assignTexture(r,"map",n.baseColorTexture,it))}return Promise.all(i)}},FU=class{constructor(r){this.parser=r,this.name=hi.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(r,e){const t=this.parser.json.materials[r];if(!t.extensions||!t.extensions[this.name])return Promise.resolve();const i=t.extensions[this.name].emissiveStrength;return i!==void 0&&(e.emissiveIntensity=i),Promise.resolve()}},NU=class{constructor(r){this.parser=r,this.name=hi.KHR_MATERIALS_CLEARCOAT}getMaterialType(r){const e=this.parser.json.materials[r];return!e.extensions||!e.extensions[this.name]?null:_i.ObjectConstructors.MeshPhysicalMaterial}extendMaterialParams(r,e){const t=this.parser,i=t.json.materials[r];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],s=i.extensions[this.name];if(s.clearcoatFactor!==void 0&&(e.clearcoat=s.clearcoatFactor),s.clearcoatTexture!==void 0&&n.push(t.assignTexture(e,"clearcoatMap",s.clearcoatTexture)),s.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=s.clearcoatRoughnessFactor),s.clearcoatRoughnessTexture!==void 0&&n.push(t.assignTexture(e,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),s.clearcoatNormalTexture!==void 0&&(n.push(t.assignTexture(e,"clearcoatNormalMap",s.clearcoatNormalTexture)),s.clearcoatNormalTexture.scale!==void 0)){const a=s.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new ne(a,a)}return Promise.all(n)}},GU=class{constructor(r){this.parser=r,this.name=hi.KHR_MATERIALS_IRIDESCENCE}getMaterialType(r){const e=this.parser.json.materials[r];return!e.extensions||!e.extensions[this.name]?null:_i.ObjectConstructors.MeshPhysicalMaterial}extendMaterialParams(r,e){const t=this.parser,i=t.json.materials[r];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],s=i.extensions[this.name];return s.iridescenceFactor!==void 0&&(e.iridescence=s.iridescenceFactor),s.iridescenceTexture!==void 0&&n.push(t.assignTexture(e,"iridescenceMap",s.iridescenceTexture)),s.iridescenceIor!==void 0&&(e.iridescenceIOR=s.iridescenceIor),e.iridescenceThicknessRange===void 0&&(e.iridescenceThicknessRange=[100,400]),s.iridescenceThicknessMinimum!==void 0&&(e.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),s.iridescenceThicknessMaximum!==void 0&&(e.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),s.iridescenceThicknessTexture!==void 0&&n.push(t.assignTexture(e,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(n)}},zU=class{constructor(r){this.parser=r,this.name=hi.KHR_MATERIALS_SHEEN}getMaterialType(r){const e=this.parser.json.materials[r];return!e.extensions||!e.extensions[this.name]?null:_i.ObjectConstructors.MeshPhysicalMaterial}extendMaterialParams(r,e){const t=this.parser,i=t.json.materials[r];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[];e.sheenColor=new fe(0,0,0),e.sheenRoughness=0,e.sheen=1;const s=i.extensions[this.name];return s.sheenColorFactor!==void 0&&e.sheenColor.fromArray(s.sheenColorFactor),s.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=s.sheenRoughnessFactor),s.sheenColorTexture!==void 0&&n.push(t.assignTexture(e,"sheenColorMap",s.sheenColorTexture,it)),s.sheenRoughnessTexture!==void 0&&n.push(t.assignTexture(e,"sheenRoughnessMap",s.sheenRoughnessTexture)),i.extras&&i.extras.sheenFactor!==void 0&&(e.sheen=i.extras.sheenFactor,delete i.extras.sheenFactor),Promise.all(n)}},QU=class{constructor(r){this.parser=r,this.name=hi.KHR_MATERIALS_TRANSMISSION}getMaterialType(r){const e=this.parser.json.materials[r];return!e.extensions||!e.extensions[this.name]?null:_i.ObjectConstructors.MeshPhysicalMaterial}extendMaterialParams(r,e){const t=this.parser,i=t.json.materials[r];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],s=i.extensions[this.name];return s.transmissionFactor!==void 0&&(e.transmission=s.transmissionFactor),s.transmissionTexture!==void 0&&n.push(t.assignTexture(e,"transmissionMap",s.transmissionTexture)),Promise.all(n)}},VU=class{constructor(r){this.parser=r,this.name=hi.KHR_MATERIALS_VOLUME}getMaterialType(r){const e=this.parser.json.materials[r];return!e.extensions||!e.extensions[this.name]?null:_i.ObjectConstructors.MeshPhysicalMaterial}extendMaterialParams(r,e){const t=this.parser,i=t.json.materials[r];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],s=i.extensions[this.name];e.thickness=s.thicknessFactor!==void 0?s.thicknessFactor:0,s.thicknessTexture!==void 0&&n.push(t.assignTexture(e,"thicknessMap",s.thicknessTexture)),e.attenuationDistance=s.attenuationDistance||1/0;const a=s.attenuationColor||[1,1,1];return e.attenuationColor=new fe(a[0],a[1],a[2]),Promise.all(n)}},jU=class{constructor(r){this.parser=r,this.name=hi.KHR_MATERIALS_IOR}getMaterialType(r){const e=this.parser.json.materials[r];return!e.extensions||!e.extensions[this.name]?null:_i.ObjectConstructors.MeshPhysicalMaterial}extendMaterialParams(r,e){const t=this.parser.json.materials[r];if(!t.extensions||!t.extensions[this.name])return Promise.resolve();const i=t.extensions[this.name];return e.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}},HU=class{constructor(r){this.parser=r,this.name=hi.KHR_MATERIALS_SPECULAR}getMaterialType(r){const e=this.parser.json.materials[r];return!e.extensions||!e.extensions[this.name]?null:_i.ObjectConstructors.MeshPhysicalMaterial}extendMaterialParams(r,e){const t=this.parser,i=t.json.materials[r];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],s=i.extensions[this.name];e.specularIntensity=s.specularFactor!==void 0?s.specularFactor:1,s.specularTexture!==void 0&&n.push(t.assignTexture(e,"specularIntensityMap",s.specularTexture));const a=s.specularColorFactor||[1,1,1];return e.specularColor=new fe(a[0],a[1],a[2]),s.specularColorTexture!==void 0&&n.push(t.assignTexture(e,"specularColorMap",s.specularColorTexture,it)),Promise.all(n)}},WU=class{constructor(r){this.parser=r,this.name=hi.KHR_MATERIALS_ANISOTROPY}getMaterialType(r){const e=this.parser.json.materials[r];return!e.extensions||!e.extensions[this.name]?null:_p}extendMaterialParams(r,e){const t=this.parser,i=t.json.materials[r];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],s=i.extensions[this.name];return s.anisotropyStrength!==void 0&&(e.anisotropy=s.anisotropyStrength),s.anisotropyRotation!==void 0&&(e.anisotropyRotation=s.anisotropyRotation),s.anisotropyTexture!==void 0&&n.push(t.assignTexture(e,"anisotropyMap",s.anisotropyTexture)),Promise.all(n)}};class XU{constructor(e){this.parser=e,this.name=hi.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,n=i.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const s=n.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,a)}}class qU{constructor(e){this.parser=e,this.name=hi.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,s=n.textures[e];if(!s.extensions||!s.extensions[t])return null;const a=s.extensions[t],o=n.images[a.source];let l=i.textureLoader;if(o.uri){const c=i.options.manager.getHandler(o.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,a.source,l);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class YU{constructor(e){this.parser=e,this.name=hi.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,s=n.textures[e];if(!s.extensions||!s.extensions[t])return null;const a=s.extensions[t],o=n.images[a.source];let l=i.textureLoader;if(o.uri){const c=i.options.manager.getHandler(o.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,a.source,l);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class KU{constructor(e){this.name=hi.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const n=i.extensions[this.name],s=this.parser.getDependency("buffer",n.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(o){const l=n.byteOffset||0,c=n.byteLength||0,h=n.count,d=n.byteStride,m=new Uint8Array(o,l,c);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(h,d,m,n.mode,n.filter).then(function(f){return f.buffer}):a.ready.then(function(){const f=new ArrayBuffer(h*d);return a.decodeGltfBuffer(new Uint8Array(f),h,d,m,n.mode,n.filter),f})})}else return null}}class JU{constructor(e){this.name=hi.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const n=t.meshes[i.mesh];for(const l of n.primitives)if(l.mode!==As.TRIANGLES&&l.mode!==As.TRIANGLE_STRIP&&l.mode!==As.TRIANGLE_FAN&&l.mode!==void 0)return null;const s=i.extensions[this.name].attributes,a=[],o={};for(const l in s)a.push(this.parser.getDependency("accessor",s[l]).then(c=>(o[l]=c,o[l])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(l=>{const c=l.pop(),h=c.isGroup?c.children:[c],d=l[0].count,m=[];for(const f of h){const v=new et,w=new P,b=new Ct,y=new P(1,1,1),E=new pp(f.geometry,f.material,d);for(let _=0;_<d;_++)o.TRANSLATION&&w.fromBufferAttribute(o.TRANSLATION,_),o.ROTATION&&b.fromBufferAttribute(o.ROTATION,_),o.SCALE&&y.fromBufferAttribute(o.SCALE,_),E.setMatrixAt(_,v.compose(w,b,y));E.sourceTrs=o;for(const _ in o)_!=="TRANSLATION"&&_!=="ROTATION"&&_!=="SCALE"&&f.geometry.setAttribute(_,o[_]);It.prototype.copy.call(E,f),this.parser.assignFinalMaterial(E),m.push(E)}return c.isGroup?(c.clear(),c.add(...m),c):m[0]}))}}const dC="glTF",sd=12,mC={JSON:1313821514,BIN:5130562};class fC{constructor(e){this.name=hi.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,sd),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==dC)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-sd,s=new DataView(e,sd);let a=0;for(;a<n;){const o=s.getUint32(a,!0);a+=4;const l=s.getUint32(a,!0);if(a+=4,l===mC.JSON){const c=new Uint8Array(e,sd+a,o);this.content=i.decode(c)}else if(l===mC.BIN){const c=sd+a;this.body=e.slice(c,c+o)}a+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ZU{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=hi.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,n=this.dracoLoader,s=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},l={},c={};for(const h in a){const d=zy[h]||h.toLowerCase();o[d]=a[h]}for(const h in e.attributes){const d=zy[h]||h.toLowerCase();if(a[h]!==void 0){const m=i.accessors[e.attributes[h]],f=Zh[m.componentType];c[d]=f.name,l[d]=m.normalized===!0}}return t.getDependency("bufferView",s).then(function(h){return new Promise(function(d){n.decodeDracoFile(h,function(m){for(const f in m.attributes){const v=m.attributes[f],w=l[f];w!==void 0&&(v.normalized=w)}d(m)},o,c)})})}}class $U{constructor(){this.name=hi.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e.__hasGLTFUuid||(e=e.clone()),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class eO{constructor(){this.name=hi.KHR_MESH_QUANTIZATION}}class gC extends xh{constructor(e,t,i,n){super(e,t,i,n)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,s=e*n*3+n;for(let a=0;a!==n;a++)t[a]=i[s+a];return t}interpolate_(e,t,i,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=o*2,c=o*3,h=n-t,d=(i-t)/h,m=d*d,f=m*d,v=e*c,w=v-c,b=-2*f+3*m,y=f-m,E=1-b,_=y-m+d;for(let C=0;C!==o;C++){const M=a[w+C+o],S=a[w+C+l]*h,R=a[v+C+o],U=a[v+C]*h;s[C]=E*M+_*S+b*R+y*U}return s}}const tO=new Ct;class iO extends gC{interpolate_(e,t,i,n){const s=super.interpolate_(e,t,i,n);return tO.fromArray(s).normalize().toArray(s),s}}const As={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Zh={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},AC={9728:Ai,9729:Et,9984:es,9985:Eo,9986:Gn,9987:Er},vC={33071:ai,33648:bs,10497:Ar},Gy={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},zy={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ml={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},rO={CUBICSPLINE:void 0,LINEAR:Cn,STEP:Kr},Qy={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function nO(r){return r.DefaultMaterial===void 0&&(r.DefaultMaterial=new _i.ObjectConstructors.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Ie})),r.DefaultMaterial}function ho(r,e,t){for(const i in t.extensions)r[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function uo(r,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(r.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function sO(r,e,t){let i=!1,n=!1,s=!1;for(let c=0,h=e.length;c<h;c++){const d=e[c];if(d.POSITION!==void 0&&(i=!0),d.NORMAL!==void 0&&(n=!0),d.COLOR_0!==void 0&&(s=!0),i&&n&&s)break}if(!i&&!n&&!s)return Promise.resolve(r);const a=[],o=[],l=[];for(let c=0,h=e.length;c<h;c++){const d=e[c];if(i){const m=d.POSITION!==void 0?t.getDependency("accessor",d.POSITION):r.attributes.position;a.push(m)}if(n){const m=d.NORMAL!==void 0?t.getDependency("accessor",d.NORMAL):r.attributes.normal;o.push(m)}if(s){const m=d.COLOR_0!==void 0?t.getDependency("accessor",d.COLOR_0):r.attributes.color;l.push(m)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l)]).then(function(c){const h=c[0],d=c[1],m=c[2];return i&&(r.morphAttributes.position=h),n&&(r.morphAttributes.normal=d),s&&(r.morphAttributes.color=m),r.morphTargetsRelative=!0,r})}function aO(r,e){if(r.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)r.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(r.morphTargetInfluences.length===t.length){r.morphTargetDictionary={};for(let i=0,n=t.length;i<n;i++)r.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function oO(r){let e;const t=r.extensions&&r.extensions[hi.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+Vy(t.attributes):e=r.indices+":"+Vy(r.attributes)+":"+r.mode,r.targets!==void 0)for(let i=0,n=r.targets.length;i<n;i++)e+=":"+Vy(r.targets[i]);return e}function Vy(r){let e="";const t=Object.keys(r).sort();for(let i=0,n=t.length;i<n;i++)e+=t[i]+":"+r[t[i]]+";";return e}function jy(r){switch(r){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function lO(r){return r.search(/\.jpe?g($|\?)/i)>0||r.search(/^data\:image\/jpeg/)===0?"image/jpeg":r.search(/\.webp($|\?)/i)>0||r.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const cO=new et;class hO{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new UU,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,n=!1,s=-1;typeof navigator<"u"&&(i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,n=navigator.userAgent.indexOf("Firefox")>-1,s=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||i||n&&s<98?this.textureLoader=new Ko(this.options.manager):this.textureLoader=new hw(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new bi(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,n=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(a){const o={scene:a[0][n.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:n.asset,parser:i,userData:{}};ho(s,o,n),uo(o,n),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(o)})).then(function(){e(o)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let n=0,s=t.length;n<s;n++){const a=t[n].joints;for(let o=0,l=a.length;o<l;o++)e[a[o]].isBone=!0}for(let n=0,s=e.length;n<s;n++){const a=e[n];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(i[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const n=i.clone(),s=(a,o)=>{const l=this.associations.get(a);l!=null&&this.associations.set(o,l);for(const[c,h]of a.children.entries())s(h,o.children[c])};return s(i,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const n=e(t[i]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let n=0;n<t.length;n++){const s=e(t[n]);s&&i.push(s)}return i}getDependency(e,t){const i=e+":"+t;let n=this.cache.get(i);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":n=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":n=this.loadCamera(t);break;default:if(n=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!n)throw new Error("Unknown type: "+e);break}this.cache.add(i,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,n=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(n.map(function(s,a){return i.getDependency(e,a)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[hi.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(s,a){i.load(Qs.resolveURL(t.uri,n.path),s,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const n=t.byteLength||0,s=t.byteOffset||0;return i.slice(s,s+n)})}loadAccessor(e){const t=this,i=this.json,n=this.json.accessors[e];if(n.bufferView===void 0&&n.sparse===void 0){const a=Gy[n.type],o=Zh[n.componentType],l=n.normalized===!0,c=new o(n.count*a);return Promise.resolve(new At(c,a,l))}const s=[];return n.bufferView!==void 0?s.push(this.getDependency("bufferView",n.bufferView)):s.push(null),n.sparse!==void 0&&(s.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(s).then(function(a){const o=a[0],l=Gy[n.type],c=Zh[n.componentType],h=c.BYTES_PER_ELEMENT,d=h*l,m=n.byteOffset||0,f=n.bufferView!==void 0?i.bufferViews[n.bufferView].byteStride:void 0,v=n.normalized===!0;let w,b;if(f&&f!==d){const y=Math.floor(m/f),E="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+y+":"+n.count;let _=t.cache.get(E);_||(w=new c(o,y*f,n.count*f/h),_=new ph(w,f/h),t.cache.add(E,_)),b=new Vr(_,l,m%f/h,v)}else o===null?w=new c(n.count*l):w=new c(o,m,n.count*l),b=new At(w,l,v);if(n.sparse!==void 0){const y=Gy.SCALAR,E=Zh[n.sparse.indices.componentType],_=n.sparse.indices.byteOffset||0,C=n.sparse.values.byteOffset||0,M=new E(a[1],_,n.sparse.count*y),S=new c(a[2],C,n.sparse.count*l);o!==null&&(b=new At(b.array.slice(),b.itemSize,b.normalized));for(let R=0,U=M.length;R<U;R++){const T=M[R];if(b.setX(T,S[R*l]),l>=2&&b.setY(T,S[R*l+1]),l>=3&&b.setZ(T,S[R*l+2]),l>=4&&b.setW(T,S[R*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return b})}loadTexture(e){const t=this.json,i=this.options,n=t.textures[e].source,s=t.images[n];let a=this.textureLoader;if(s.uri){const o=i.manager.getHandler(s.uri);o!==null&&(a=o)}return this.loadTextureImage(e,n,a)}loadTextureImage(e,t,i){const n=this,s=this.json,a=s.textures[e],o=s.images[t],l=(o.uri||o.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,i).then(function(h){h.name=a.name||o.name||"",h.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(h.name=o.uri);const d=(s.samplers||{})[a.sampler]||{};return h.magFilter=AC[d.magFilter]||Et,h.minFilter=AC[d.minFilter]||Er,h.wrapS=vC[d.wrapS]||Ar,h.wrapT=vC[d.wrapT]||Ar,d.extras&&d.extras.uuid!==void 0&&(h.uuid=d.extras.uuid,h.__hasGLTFUuid=!0),n.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t,i=!1,n=!1){const s=this,a=this.json,o=this.options;if(!n&&this.sourceCache[e]!==void 0)return this.sourceCache[e].then(v=>v.clone());const l=a.images[e],c=self.URL||self.webkitURL;l.uri===void 0&&l.extras&&l.extras.uri&&(l.uri=l.extras.uri);let h=l.uri||"",d=!1,m=null;if(l.bufferView!==void 0&&(!i||!h))h=s.getDependency("bufferView",l.bufferView).then(function(v){d=!0;const w=new Blob([v],{type:l.mimeType});return h=c.createObjectURL(w),m=w,h});else if(l.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const f=Promise.resolve(h).then(function(v){return new Promise(function(w,b){let y=w;t.isImageBitmapLoader===!0&&(y=function(E){const _=new Ti(E);_.needsUpdate=!0,w(_)}),t.load(Qs.resolveURL(v,o.path),y,void 0,function(E){t.isImageBitmapLoader===!0?(t=new Ko(s.options.manager),y=w,t.setCrossOrigin(s.options.crossOrigin),t.setRequestHeader(s.options.requestHeader),t.load(Qs.resolveURL(v,o.path),y,void 0,b)):b(E)})})}).then(function(v){if(d===!0&&c.revokeObjectURL(h),v.userData.mimeType=l.mimeType||lO(l.uri),v.flipY=!1,l.extras){if(l.extras.flipY!==void 0){if(t.isImageBitmapLoader===!0&&typeof createImageBitmap!==void 0){let w=v;const b=l.extras.flipY&&!w.flipY;createImageBitmap(w.source.data,{imageOrientation:b?"flipY":"none"}).then(function(y){w._newTex&&(w=w._newTex),w.source.data.close&&w.source.data.close(),w.source.data=y,w.source.needsUpdate=!0,w.needsUpdate=!0})}v.flipY=l.extras.flipY,v.needsUpdate=!0,delete l.extras.flipY}l.extras.uuid!==void 0&&(v.source.uuid=l.extras.uuid),l.extras.t_uuid!==void 0&&(v.uuid=l.extras.t_uuid,v.__hasGLTFUuid=!0)}return l.uri&&typeof l.uri=="string"&&d===!1&&!l.uri.startsWith("/")&&(v.userData.rootPath=Qs.resolveURL(l.uri,o.path)),m&&(v.userData.__sourceBlob=m),!i&&l.uri&&l.uri!==h&&s.loadImageSource(e,t,!0,!0).then(function(w){v.source.data&&v.source.data.close&&v.source.data.close(),v.dispose(),v.source=w.source,v.source.needsUpdate=!0,v.needsUpdate=!0,v.uuid=w.uuid,w.__hasGLTFUuid&&(v.__hasGLTFUuid=!0),v.flipY=w.flipY,v.userData=w.userData,v.setDirty&&v.setDirty(),w._newTex=v}),v}).catch(function(v){throw console.error("THREE.GLTFLoader: Couldn't load texture",h),v});return this.sourceCache[e]=f,f}assignTexture(e,t,i,n){const s=this;return this.getDependency("texture",i.index).then(function(a){if(!a)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(a=a.clone(),a.channel=i.texCoord),s.extensions[hi.KHR_TEXTURE_TRANSFORM]){const o=i.extensions!==void 0?i.extensions[hi.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const l=s.associations.get(a);a=s.extensions[hi.KHR_TEXTURE_TRANSFORM].extendTexture(a,o),s.associations.set(a,l)}}return n!==void 0&&(a.colorSpace=n),e[t]=a,a})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const n=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,a=t.attributes.normal===void 0;if(e.isPoints){const l="PointsMaterial:"+i.uuid;let c=this.cache.get(l);c||(c=new _i.ObjectConstructors.PointsMaterial,Ki.prototype.copy.call(c,i),c.color.copy(i.color),c.map=i.map,c.sizeAttenuation=!1,this.cache.add(l,c)),i=c}else if(e.isLine){const l="LineBasicMaterial:"+i.uuid;let c=this.cache.get(l);c||(c=new _i.ObjectConstructors.LineBasicMaterial,Ki.prototype.copy.call(c,i),c.color.copy(i.color),c.map=i.map,this.cache.add(l,c)),i=c}const o=i.userData&&i.userData.gltfExtensions?!!i.userData.gltfExtensions.WEBGI_material_extras:!1;if((n||s||a)&&!o){let l="ClonedMaterial:"+i.uuid+":";n&&(l+="derivative-tangents:"),s&&(l+="vertex-colors:"),a&&(l+="flat-shading:");let c=this.cache.get(l);c||(c=i.clone(),s&&(c.vertexColors=!0),a&&(c.flatShading=!0),n&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(l,c),this.associations.set(c,this.associations.get(i))),i=c}e.material=i}getMaterialType(){return _i.ObjectConstructors.MeshStandardMaterial}loadMaterial(e){const t=this,i=this.json,n=this.extensions,s=i.materials[e];let a;const o={},l=s.extensions||{},c=[];if(l[hi.KHR_MATERIALS_UNLIT]){const d=n[hi.KHR_MATERIALS_UNLIT];a=d.getMaterialType(),c.push(d.extendParams(o,s,t))}else{const d=s.pbrMetallicRoughness||{};if(o.color=new fe(1,1,1),o.opacity=1,Array.isArray(d.baseColorFactor)){const m=d.baseColorFactor;o.color.fromArray(m),o.opacity=m[3]}d.baseColorTexture!==void 0&&c.push(t.assignTexture(o,"map",d.baseColorTexture,it)),o.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,o.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(o,"metalnessMap",d.metallicRoughnessTexture)),c.push(t.assignTexture(o,"roughnessMap",d.metallicRoughnessTexture))),a=this._invokeOne(function(m){return m.getMaterialType&&m.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(m){return m.extendMaterialParams&&m.extendMaterialParams(e,o)})))}s.doubleSided===!0&&(o.side=dt);const h=s.alphaMode||Qy.OPAQUE;if(h===Qy.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,h===Qy.MASK&&(o.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&a!==_i.ObjectConstructors.MeshBasicMaterial&&(c.push(t.assignTexture(o,"normalMap",s.normalTexture)),o.normalScale=new ne(1,1),s.normalTexture.scale!==void 0)){const d=s.normalTexture.scale;o.normalScale.set(d,d)}return s.occlusionTexture!==void 0&&a!==_i.ObjectConstructors.MeshBasicMaterial&&(c.push(t.assignTexture(o,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&a!==_i.ObjectConstructors.MeshBasicMaterial&&(o.emissive=new fe().fromArray(s.emissiveFactor)),s.emissiveTexture!==void 0&&a!==_i.ObjectConstructors.MeshBasicMaterial&&c.push(t.assignTexture(o,"emissiveMap",s.emissiveTexture,it)),Promise.all(c).then(function(){const d=new a(o);return s.extras&&s.extras.uuid&&(d.uuid=s.extras.uuid),s.name&&(d.name=s.name),uo(d,s),t.associations.set(d,{materials:e}),s.extensions&&ho(n,d,s),d})}createUniqueName(e){const t=Ht.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,n=this.primitiveCache;function s(o){return i[hi.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,t).then(function(l){return yC(l,o,t)})}const a=[];for(let o=0,l=e.length;o<l;o++){const c=e[o],h=oO(c),d=n[h];if(d)a.push(d.promise);else{let m;c.extensions&&c.extensions[hi.KHR_DRACO_MESH_COMPRESSION]?m=s(c):m=yC(new ht,c,t),n[h]={primitive:c,promise:m},a.push(m)}}return Promise.all(a)}loadMesh(e){const t=this,i=this.json,n=this.extensions,s=i.meshes[e],a=s.primitives,o=[];for(let l=0,c=a.length;l<c;l++){const h=a[l].material===void 0?nO(this.cache):this.getDependency("material",a[l].material);o.push(h)}return o.push(t.loadGeometries(a)),Promise.all(o).then(function(l){const c=l.slice(0,l.length-1),h=l[l.length-1],d=[];for(let f=0,v=h.length;f<v;f++){const w=h[f],b=a[f];let y;const E=c[f];if(b.mode===As.TRIANGLES||b.mode===As.TRIANGLE_STRIP||b.mode===As.TRIANGLE_FAN||b.mode===void 0)y=s.isSkinnedMesh===!0?new Nm(w,E):new Fe(w,E),y.isSkinnedMesh===!0&&y.normalizeSkinWeights(),b.mode===As.TRIANGLE_STRIP?y.geometry=A0(y.geometry,Kd):b.mode===As.TRIANGLE_FAN&&(y.geometry=A0(y.geometry,Uc));else if(b.mode===As.LINES)y=new qn(w,E);else if(b.mode===As.LINE_STRIP)y=new Tr(w,E);else if(b.mode===As.LINE_LOOP)y=new cv(w,E);else if(b.mode===As.POINTS)y=new Gl(w,E);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+b.mode);Object.keys(y.geometry.morphAttributes).length>0&&aO(y,s),y.name=t.createUniqueName(s.name||"mesh_"+e),y.geometry&&s.extras&&s.extras.isGeometryUserData?(uo(y.geometry,s),b.extensions&&ho(n,y.geometry,b)):(uo(y,s),b.extensions&&ho(n,y,b)),t.assignFinalMaterial(y),d.push(y)}s.extensions&&d.forEach(f=>ho(n,f,s));for(let f=0,v=d.length;f<v;f++)t.associations.set(d[f],{meshes:e,primitives:f});if(d.length===1)return s.extensions&&ho(n,d[0],s),d[0];const m=new fn;s.extensions&&ho(n,m,s),t.associations.set(m,{meshes:e});for(let f=0,v=d.length;f<v;f++)m.add(d[f]);return m})}loadCamera(e){let t;const i=this.json.cameras[e],n=i[i.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new _i.ObjectConstructors.PerspectiveCamera(Zt.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):i.type==="orthographic"&&(t=new _i.ObjectConstructors.OrthographicCamera(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),uo(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let n=0,s=t.joints.length;n<s;n++)i.push(this._loadNodeShallow(t.joints[n]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(n){const s=n.pop(),a=n,o=[],l=[];for(let c=0,h=a.length;c<h;c++){const d=a[c];if(d){o.push(d);const m=new et;s!==null&&m.fromArray(s.array,c*16),l.push(m)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new yh(o,l)})}loadAnimation(e){const t=this.json.animations[e],i=t.name?t.name:"animation_"+e,n=[],s=[],a=[],o=[],l=[];for(let c=0,h=t.channels.length;c<h;c++){const d=t.channels[c],m=t.samplers[d.sampler],f=d.target,v=f.node,w=t.parameters!==void 0?t.parameters[m.input]:m.input,b=t.parameters!==void 0?t.parameters[m.output]:m.output;f.node!==void 0&&(n.push(this.getDependency("node",v)),s.push(this.getDependency("accessor",w)),a.push(this.getDependency("accessor",b)),o.push(m),l.push(f))}return Promise.all([Promise.all(n),Promise.all(s),Promise.all(a),Promise.all(o),Promise.all(l)]).then(function(c){const h=c[0],d=c[1],m=c[2],f=c[3],v=c[4],w=[];for(let b=0,y=h.length;b<y;b++){const E=h[b],_=d[b],C=m[b],M=f[b],S=v[b];if(E===void 0)continue;E.updateMatrix();let R;switch(ml[S.path]){case ml.weights:R=Wl;break;case ml.rotation:R=to;break;case ml.position:case ml.scale:default:R=ql;break}const U=E.name?E.name:E.uuid,T=M.interpolation!==void 0?rO[M.interpolation]:Cn,B=[];ml[S.path]===ml.weights?E.traverse(function(Z){Z.morphTargetInfluences&&B.push(Z.name?Z.name:Z.uuid)}):B.push(U);let Q=C.array;if(C.normalized){const Z=jy(Q.constructor),q=new Float32Array(Q.length);for(let X=0,te=Q.length;X<te;X++)q[X]=Q[X]*Z;Q=q}for(let Z=0,q=B.length;Z<q;Z++){const X=new R(B[Z]+"."+ml[S.path],_.array,Q,T);M.interpolation==="CUBICSPLINE"&&(X.createInterpolant=function(te){const me=this instanceof to?iO:gC;return new me(this.times,this.values,this.getValueSize()/3,te)},X.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),w.push(X)}}return new Yl(i,void 0,w)})}createNodeMesh(e){const t=this.json,i=this,n=t.nodes[e];return n.mesh===void 0?null:i.getDependency("mesh",n.mesh).then(function(s){const a=i._getNodeRef(i.meshCache,n.mesh,s);return n.weights!==void 0&&a.traverse(function(o){if(o.isMesh)for(let l=0,c=n.weights.length;l<c;l++)o.morphTargetInfluences[l]=n.weights[l]}),a})}loadNode(e){const t=this.json,i=this,n=t.nodes[e],s=i._loadNodeShallow(e),a=[],o=n.children||[];for(let c=0,h=o.length;c<h;c++)a.push(i.getDependency("node",o[c]));const l=n.skin===void 0?Promise.resolve(null):i.getDependency("skin",n.skin);return Promise.all([s,Promise.all(a),l]).then(function(c){const h=c[0],d=c[1],m=c[2];m!==null&&h.traverse(function(f){f.isSkinnedMesh&&f.bind(m,cO)});for(let f=0,v=d.length;f<v;f++)h.add(d[f]);return h})}_loadNodeShallow(e){const t=this.json,i=this.extensions,n=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=t.nodes[e],a=s.name?n.createUniqueName(s.name):"",o=[],l=n._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&o.push(l),s.camera!==void 0&&o.push(n.getDependency("camera",s.camera).then(function(c){return n._getNodeRef(n.cameraCache,s.camera,c)})),n._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){o.push(c)}),this.nodeCache[e]=Promise.all(o).then(function(c){let h;if(s.isBone===!0?h=new vh:c.length>1?h=new fn:c.length===1?h=c[0]:h=new It,h!==c[0])for(let d=0,m=c.length;d<m;d++)h.add(c[d]);if(s.name&&(h.userData.name=s.name,h.name=a),uo(h,s),s.extensions&&ho(i,h,s),s.matrix!==void 0){const d=new et;d.fromArray(s.matrix),h.applyMatrix4(d)}else s.translation!==void 0&&h.position.fromArray(s.translation),s.rotation!==void 0&&h.quaternion.fromArray(s.rotation),s.scale!==void 0&&h.scale.fromArray(s.scale);return n.associations.has(h)||n.associations.set(h,{}),n.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],n=this,s=new fn;i.name&&(s.name=n.createUniqueName(i.name)),uo(s,i),i.extensions&&ho(t,s,i);const a=i.nodes||[],o=[];for(let l=0,c=a.length;l<c;l++)o.push(n.getDependency("node",a[l]));return Promise.all(o).then(function(l){for(let h=0,d=l.length;h<d;h++)s.add(l[h]);const c=h=>{const d=new Map;for(const[m,f]of n.associations)(m instanceof Ki||m instanceof Ti)&&d.set(m,f);return h.traverse(m=>{const f=n.associations.get(m);f!=null&&d.set(m,f)}),d};return n.associations=c(s),s})}}function uO(r,e,t){const i=e.attributes,n=new Yi;if(i.POSITION!==void 0){const o=t.json.accessors[i.POSITION],l=o.min,c=o.max;if(l!==void 0&&c!==void 0){if(n.set(new P(l[0],l[1],l[2]),new P(c[0],c[1],c[2])),o.normalized){const h=jy(Zh[o.componentType]);n.min.multiplyScalar(h),n.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const o=new P,l=new P;for(let c=0,h=s.length;c<h;c++){const d=s[c];if(d.POSITION!==void 0){const m=t.json.accessors[d.POSITION],f=m.min,v=m.max;if(f!==void 0&&v!==void 0){if(l.setX(Math.max(Math.abs(f[0]),Math.abs(v[0]))),l.setY(Math.max(Math.abs(f[1]),Math.abs(v[1]))),l.setZ(Math.max(Math.abs(f[2]),Math.abs(v[2]))),m.normalized){const w=jy(Zh[m.componentType]);l.multiplyScalar(w)}o.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(o)}r.boundingBox=n;const a=new zr;n.getCenter(a.center),a.radius=n.min.distanceTo(n.max)/2,r.boundingSphere=a}function yC(r,e,t){const i=e.attributes,n=[];function s(a,o){return t.getDependency("accessor",a).then(function(l){r.setAttribute(o,l)})}for(const a in i){const o=zy[a]||a.toLowerCase();o in r.attributes||n.push(s(i[a],o))}if(e.indices!==void 0&&!r.index){const a=t.getDependency("accessor",e.indices).then(function(o){r.setIndex(o)});n.push(a)}return uo(r,e),uO(r,e,t),Promise.all(n).then(function(){return e.targets!==void 0?sO(r,e.targets,t):r})}const po=class{};po.WebGiLightExtrasExtension="WEBGI_light_extras",po.Import=r=>({name:"__"+po.WebGiLightExtrasExtension,afterRoot:async e=>{(e.scenes||(e.scene?[e.scene]:[])).forEach(t=>{t.traverse(i=>{var n,s;if(!i.isLight)return;const a=(s=(n=i.userData)==null?void 0:n.gltfExtensions)==null?void 0:s[po.WebGiLightExtrasExtension];a&&(!i.shadow&&a.shadow&&console.error("Light has no shadow, cannot import",i,a),a.shadow&&i.shadow&&(a.shadow.bias!==void 0&&(i.shadow.bias=a.shadow.bias),a.shadow.normalBias!==void 0&&(i.shadow.normalBias=a.shadow.normalBias),a.shadow.radius!==void 0&&(i.shadow.radius=a.shadow.radius),a.shadow.mapSize!==void 0&&i.shadow.mapSize.fromArray(a.shadow.mapSize),a.shadow.camera!==void 0&&(i.shadow.camera=new vf().parseObject(a.shadow.camera,{},{},{},{}))),delete i.userData.gltfExtensions[po.WebGiLightExtrasExtension])})})}}),po.Export=r=>({writeNode:(e,t)=>{if(!(e!=null&&e.isLight))return;t.extensions||(t.extensions={});const i={};e.shadow&&(i.shadow=e.shadow.toJSON()),Object.keys(i).length>0&&(t.extensions[po.WebGiLightExtrasExtension]=i,r.extensionsUsed[po.WebGiLightExtrasExtension]=!0)}});let Hy=po;const Yn=class{};Yn.WebGiMaterialExtrasExtension="WEBGI_material_extras",Yn.Import=r=>e=>({name:"__"+Yn.WebGiMaterialExtrasExtension,afterRoot:async t=>{var i,n;const s=t.scenes||(t.scene?[t.scene]:[]);for(const a of s){const o=(n=(i=a.userData)==null?void 0:i.gltfExtensions)==null?void 0:n[Yn.WebGiMaterialExtrasExtension],l=o!=null&&o.resources?await r(o.resources):{};a.traverse(c=>{var h,d;const m=c==null?void 0:c.material;if(!(m!=null&&m.isMaterial))return;const f=(d=(h=m.userData)==null?void 0:h.gltfExtensions)==null?void 0:d[Yn.WebGiMaterialExtrasExtension];f&&(f.emissiveIntensity!==void 0&&(m.emissiveIntensity=f.emissiveIntensity),f.fog!==void 0&&(m.fog=f.fog),f.flatShading!==void 0&&(m.flatShading=f.flatShading),f.blending!==void 0&&(m.blending=f.blending),f.side!==void 0&&(m.side=f.side),f.shadowSide!==void 0&&(m.shadowSide=f.shadowSide),f.depthFunc!==void 0&&(m.depthFunc=f.depthFunc),f.depthTest!==void 0&&(m.depthTest=f.depthTest),f.depthWrite!==void 0&&(m.depthWrite=f.depthWrite),f.colorWrite!==void 0&&(m.colorWrite=f.colorWrite),f.vertexColors!==void 0&&(m.vertexColors=f.vertexColors),f.alphaTest!==void 0&&(m.alphaTest=f.alphaTest),f.wireframe!==void 0&&(m.wireframe=f.wireframe),f.wireframeLinewidth!==void 0&&(m.wireframeLinewidth=f.wireframeLinewidth),f.wireframeLinecap!==void 0&&(m.wireframeLinecap=f.wireframeLinecap),f.wireframeLinejoin!==void 0&&(m.wireframeLinejoin=f.wireframeLinejoin),f.rotation!==void 0&&(m.rotation=f.rotation),f.polygonOffset!==void 0&&(m.polygonOffset=f.polygonOffset),f.polygonOffsetFactor!==void 0&&(m.polygonOffsetFactor=f.polygonOffsetFactor),f.polygonOffsetUnits!==void 0&&(m.polygonOffsetUnits=f.polygonOffsetUnits),f.dithering!==void 0&&(m.dithering=f.dithering),f.alphaToCoverage!==void 0&&(m.alphaToCoverage=f.alphaToCoverage),f.premultipliedAlpha!==void 0&&(m.premultipliedAlpha=f.premultipliedAlpha),f.toneMapped!==void 0&&(m.toneMapped=f.toneMapped),f.normalScale!==void 0&&m.normalScale!==void 0&&(Array.isArray(f.normalScale)?m.normalScale.fromArray(f.normalScale):typeof f.normalScale=="number"?m.normalScale.set(f.normalScale,f.normalScale):console.warn("normalScale is not an array or number",f.normalScale)),f.reflectivity!==void 0&&(m.reflectivity=f.reflectivity),Object.entries(f).forEach(([v,w])=>{v.startsWith("_")||w&&w.resource&&typeof w.resource=="string"&&(m[v]=Kt.Deserialize(w,m[v],l))}),delete m.userData.gltfExtensions[Yn.WebGiMaterialExtrasExtension])}),o&&delete a.userData.gltfExtensions[Yn.WebGiMaterialExtrasExtension]}}}),Yn.Export=r=>({writeMaterial(e,t){if(!(e!=null&&e.isMaterial))return;t.extensions||(t.extensions={});const i={};e.fog!==void 0&&(i.fog=e.fog),e.flatShading!==void 0&&(i.flatShading=e.flatShading),e.blending!==void 0&&(i.blending=e.blending),e.side!==void 0&&e.side!==dt&&(i.side=e.side),e.shadowSide!==void 0&&(i.shadowSide=e.shadowSide),e.depthFunc!==void 0&&(i.depthFunc=e.depthFunc),e.depthTest!==void 0&&(i.depthTest=e.depthTest),e.depthWrite!==void 0&&(i.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(i.colorWrite=e.colorWrite),e.vertexColors!==void 0&&(i.vertexColors=e.vertexColors),e.alphaTest!==void 0&&(i.alphaTest=e.alphaTest),e.wireframe!==void 0&&(i.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(i.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(i.rotation=e.rotation),e.polygonOffset!==void 0&&(i.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(i.dithering=e.dithering),e.alphaToCoverage!==void 0&&(i.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(i.premultipliedAlpha=e.premultipliedAlpha),e.toneMapped!==void 0&&(i.toneMapped=e.toneMapped),e.normalScale!==void 0&&(i.normalScale=[e.normalScale.x,e.normalScale.y]);const n=this.materialExternalResources[e.uuid];n&&Object.entries(n).forEach(([s,a])=>{var o;if(s.startsWith("_"))return;let l=!1;a!=null&&a.userData&&a.userData.embedUrlImagePreviews===void 0&&(a.userData.embedUrlImagePreviews=(o=r.options.exporterOptions)==null?void 0:o.embedUrlImagePreviews,l=!0),i[s]=Kt.Serialize(a,this.serializedMeta),a!=null&&a.userData&&l&&delete a.userData.embedUrlImagePreviews}),Object.keys(i).length>0&&(t.extensions[Yn.WebGiMaterialExtrasExtension]=i,r.extensionsUsed[Yn.WebGiMaterialExtrasExtension]=!0)},materialExternalResources:{},serializedMeta:{images:{},textures:{}},beforeParse(e){if(this.materialExternalResources={},!r.options.externalImagesInExtras)return;const t=[];(Array.isArray(e)?e:[e]).forEach(i=>{i==null||i.traverse(n=>{var s;n&&(s=n.material)!=null&&s.isMaterial&&t.push(n.material)})}),t.forEach(i=>{i&&(this.materialExternalResources[i.uuid]||(this.materialExternalResources[i.uuid]={}),this.materialExternalResources[i.uuid].__materialRef=i,Object.entries(i).forEach(([n,s])=>{n.startsWith("_")||s&&s.isTexture&&s.userData.rootPath&&(s.userData.rootPath.startsWith("http")||s.userData.rootPath.startsWith("data:"))&&(i[n]=null,this.materialExternalResources[i.uuid][n]=s)}))})},afterParse(e){const t=Object.values(this.materialExternalResources);if(t.length<1)return;t.forEach(n=>{const s=n.__materialRef;s&&(Object.entries(n).forEach(([a,o])=>{a.startsWith("_")||o&&(s[a]=o)}),delete this.materialExternalResources[s.uuid])});const i=r.json.scenes[r.json.scene||0];i.extensions||(i.extensions={}),i.extensions[Yn.WebGiMaterialExtrasExtension]={resources:this.serializedMeta},r.extensionsUsed[Yn.WebGiMaterialExtrasExtension]=!0}});let Wy=Yn;const Eg=class{};Eg.WebGiMaterialsAlphaMapExtension="WEBGI_materials_alphamap",Eg.Import=r=>new pO(r),Eg.Export=r=>new dO(r);let ad=Eg;class pO{constructor(e){this.parser=e,this.name=ad.WebGiMaterialsAlphaMapExtension}async extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],a=n.extensions[this.name];return a.alphaTexture!==void 0&&s.push(i.assignTexture(t,"alphaMap",a.alphaTexture)),Promise.all(s)}}class dO{constructor(e){this.writer=e,this.name=ad.WebGiMaterialsAlphaMapExtension}writeMaterial(e,t){if(!e.isMeshStandardMaterial||!e.alphaMap)return;const i=this.writer,n=i.extensionsUsed,s={};if(e.alphaMap){const a={index:i.processTexture(e.alphaMap)};i.applyTextureTransform(a,e.alphaMap),s.alphaTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=s,n[this.name]=!0}}const Cg=class{};Cg.WebGiMaterialsBumpMapExtension="WEBGI_materials_bumpmap",Cg.Import=r=>new mO(r),Cg.Export=r=>new fO(r);let od=Cg;class mO{constructor(e){this.parser=e,this.name=od.WebGiMaterialsBumpMapExtension}async extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],a=n.extensions[this.name];return a.bumpScale!==void 0&&(t.bumpScale=a.bumpScale),a.bumpTexture!==void 0&&s.push(i.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(s)}}class fO{constructor(e){this.writer=e,this.name=od.WebGiMaterialsBumpMapExtension}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.bumpScale===0)return;const i=this.writer,n=i.extensionsUsed,s={};if(s.bumpScale=e.bumpScale,e.bumpMap){const a={index:i.processTexture(e.bumpMap)};i.applyTextureTransform(a,e.bumpMap),s.bumpTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=s,n[this.name]=!0}}const Mg=class{};Mg.WebGiMaterialsDisplacementMapExtension="WEBGI_materials_displacementmap",Mg.Import=r=>new gO(r),Mg.Export=r=>new AO(r);let ld=Mg;class gO{constructor(e){this.parser=e,this.name=ld.WebGiMaterialsDisplacementMapExtension}async extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],a=n.extensions[this.name];return a.displacementScale!==void 0&&(t.displacementScale=a.displacementScale),a.displacementBias!==void 0&&(t.displacementBias=a.displacementBias),a.displacementTexture!==void 0&&s.push(i.assignTexture(t,"displacementMap",a.displacementTexture)),Promise.all(s)}}class AO{constructor(e){this.writer=e,this.name=ld.WebGiMaterialsDisplacementMapExtension}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.displacementScale===0)return;const i=this.writer,n=i.extensionsUsed,s={};if(s.displacementScale=e.displacementScale,s.displacementBias=e.displacementBias,e.displacementMap){const a={index:i.processTexture(e.displacementMap)};i.applyTextureTransform(a,e.displacementMap),s.displacementTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=s,n[this.name]=!0}}const Sg=class{};Sg.WebGiMaterialsLightMapExtension="WEBGI_materials_lightmap",Sg.Import=r=>new vO(r),Sg.Export=r=>new yO(r);let cd=Sg;class vO{constructor(e){this.parser=e,this.name=cd.WebGiMaterialsLightMapExtension}async extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],a=n.extensions[this.name];return a.lightMapIntensity!==void 0&&(t.lightMapIntensity=a.lightMapIntensity),a.lightMapTexture!==void 0&&s.push(i.assignTexture(t,"lightMap",a.lightMapTexture)),Promise.all(s)}}class yO{constructor(e){this.writer=e,this.name=cd.WebGiMaterialsLightMapExtension}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.lightMapIntensity===0)return;const i=this.writer,n=i.extensionsUsed,s={};if(s.lightMapIntensity=e.lightMapIntensity,e.lightMap){const a={index:i.processTexture(e.lightMap)};i.applyTextureTransform(a,e.lightMap),s.lightMapTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=s,n[this.name]=!0}}const mo=class{};mo.WebGiObject3DExtrasExtension="WEBGI_object3d_extras",mo.Import=r=>({name:"__"+mo.WebGiObject3DExtrasExtension,afterRoot:async e=>{(e.scenes||(e.scene?[e.scene]:[])).forEach(t=>{t.traverse(i=>{var n,s;if(!i||!i.isObject3D)return;const a=(s=(n=i.userData)==null?void 0:n.gltfExtensions)==null?void 0:s[mo.WebGiObject3DExtrasExtension];if(!a){i.isLight&&!i.isAmbientLight&&(i.castShadow=!0);return}const o=a.castShadow!==void 0||a.receiveShadow!==void 0;a.castShadow!==void 0&&(i.castShadow=a.castShadow),a.receiveShadow!==void 0&&(i.receiveShadow=a.receiveShadow),a.visible!==void 0&&(i.visible=a.visible),a.frustumCulled!==void 0&&(i.frustumCulled=a.frustumCulled),a.renderOrder!==void 0&&(i.renderOrder=a.renderOrder),a.layers!==void 0&&(i.layers.mask=a.layers),o&&(i.userData.__keepShadowDef=!0),delete i.userData.gltfExtensions[mo.WebGiObject3DExtrasExtension]})})}}),mo.Export=r=>({writeNode:(e,t)=>{if(!(e!=null&&e.isObject3D))return;t.extensions||(t.extensions={});const i={};e.castShadow!==void 0&&(i.castShadow=e.castShadow),e.receiveShadow!==void 0&&(i.receiveShadow=e.receiveShadow),e.visible===!1&&(i.visible=!1),e.frustumCulled===!1&&(i.frustumCulled=!1),e.renderOrder!==0&&(i.renderOrder=e.renderOrder),e.layers.mask!==1&&(i.layers=e.layers.mask),e.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),Object.keys(i).length>0&&(t.extensions[mo.WebGiObject3DExtrasExtension]=i,r.extensionsUsed[mo.WebGiObject3DExtrasExtension]=!0)}});let Xy=mo;class _C extends bi{constructor(e){super(e),this.type=di}async loadAsync(e,t){const i=await this.parseAsync(e,t,!1),n=new pa(i.data,i.width,i.height,mi,this.type);return n.needsUpdate=!0,n.flipY=!0,n.colorSpace=it,n.minFilter=Et,n.magFilter=Et,n.source.data.complete=!0,n}async parseAsync(e,t,i=!1){let n=!1;if(!e.startsWith("data:")&&!e.startsWith("blob:")){this.responseType="blob";const o=await super.loadAsync(e,t);e=URL.createObjectURL(o),n=!0}const s=await $w(e);n&&URL.revokeObjectURL(e);let a=Uint8Array;return this.type===di?a=Uint16Array:this.type===qt&&(a=Float32Array),{data:_O(s.data,4,a,i),width:s.width,height:s.height}}setDataType(e){return this.type=e,this}}function _O(r,e=3,t=Uint16Array,i=!1){let n;const s=r.byteLength>>2,a=new t(s*e);for(let o=0;o<s;o++)n=Math.pow(2,r[o*4+3]-136),i?(a[o*e]=Math.min(r[o*4]*n,65504),a[o*e+1]=Math.min(r[o*4+1]*n,65504),a[o*e+2]=Math.min(r[o*4+2]*n,65504)):(a[o*e]=Ur.toHalfFloat(Math.min(r[o*4]*n,65504)),a[o*e+1]=Ur.toHalfFloat(Math.min(r[o*4+1]*n,65504)),a[o*e+2]=Ur.toHalfFloat(Math.min(r[o*4+2]*n,65504))),e===4&&(a[o*e+3]=Ur.toHalfFloat(1));return a}const bC=class{static async ImportViewerConfig(e,t,i,n){var s;if(!n){const c=e.json.scenes||[];if(c.length!==1){for(const h of c)await this.ImportViewerConfig(e,t,[i[c.indexOf(h)]],h);return{}}n=c[0]}const a=i.length>0?i[0]:void 0,o=(s=n.extensions)==null?void 0:s[this.ViewerConfigGLTFExtension];if(!o)return{};const l={type:"ThreeViewer",version:"0",plugins:[],assetType:"config",...o};if(l.resources){await this._parseArrayBuffers(l.resources,e);const c=await this._parseExtraResources(l.resources,e,t);l.resources=await t.loadConfigResources(l.resources||{},c)}return a&&(a.importedViewerConfig=l),l}static async _parseExtraResources(e,t,i){const n={textures:{},materials:{}};if(e.textures&&t.json.textures)for(const[s,a]of[...Object.entries(e.textures)]){if(a.uuid||!s)continue;delete e.textures[s];const o=t.json.textures.findIndex(l=>{var c,h,d,m,f,v,w;return((c=l.extras)==null?void 0:c.uuid)===s||((m=(d=(h=t.json.samplers)==null?void 0:h[l.sampler])==null?void 0:d.extras)==null?void 0:m.uuid)===s||((w=(v=(f=t.json.images)==null?void 0:f[l.source])==null?void 0:v.extras)==null?void 0:w.t_uuid)===s});o>=0&&(n.textures[s]=await t.getDependency("texture",o))}if(e.materials&&t.json.materials)for(const[s,a]of[...Object.entries(e.materials)]){if(a.uuid||!s)continue;delete e.materials[s];const o=t.json.materials.findIndex(l=>{var c;return((c=l.extras)==null?void 0:c.uuid)===s});if(o>=0){const l=await t.getDependency("material",o);n.materials[s]=i.assetManager.materials.convertToIMaterial(l)}}return n}static async _parseArrayBuffers(e,t){const i=[];Object.values(e).forEach(n=>{Object.values(n).forEach(s=>{s.url&&(s.url.type==="Uint16Array"&&s.url.data&&i.push(s.url),s.url.type==="Uint8Array"&&s.url.data&&i.push(s.url))})});for(const n of i){const s=n.data.image,a=t.json.images[s],o=await t.getDependency("bufferView",a.bufferView);if(a.mimeType.startsWith("image/")&&n.type==="Uint16Array"&&n.encoding==="rgbe"){const l=new Blob([o]);let c=URL.createObjectURL(l);const h=n.encodingVersion||1;h<2&&(c="data:image/png;base64,"+btoa(await l.text())),n.data=(await new _C().parseAsync(c,void 0,h<3)).data,URL.revokeObjectURL(c),delete n.encoding,delete n.encodingVersion}else n.data=o}}static ExportViewerConfig(e,t){const i=e.toJSON(!0,void 0),n=t.json;this._bundleExtraResources(n,i),this._bundleArrayBuffers(i,t);const s=t.json.scenes[t.json.scene||0];s.extensions||(s.extensions={}),t.extensionsUsed[this.ViewerConfigGLTFExtension]=!0,s.extensions[this.ViewerConfigGLTFExtension]=i}static _bundleArrayBuffers(e,t){const i=[];Object.values(e.resources).forEach(n=>{n&&Object.values(n).forEach(s=>{s.url&&(s.url.type==="Uint16Array"&&s.url.data&&(s.url.data instanceof Uint16Array||(s.url.data=new Uint16Array(s.url.data)),i.push(s.url)),s.url.type==="Uint8Array"&&s.url.data&&(s.url.data instanceof Uint8Array||(s.url.data=new Uint8Array(s.url.data)),i.push(s.url)))})});for(const n of i){let s="application/octet-stream";if(n.mimeType&&(s=n.mimeType),t.options.exporterOptions.encodeUint16Rgbe&&n.type==="Uint16Array"&&n.width>0&&n.height>0){const c=vx(n.data,4),h=new ImageData(c,n.width,n.height),d=Qc.getDataURL(h,!0).split(",")[1];s="image/png",n.data=Uint8Array.from(atob(d),m=>m.charCodeAt(0)),n.encoding="rgbe",n.encodingVersion=3}t.json.images||(t.json.images=[]);const a={mimeType:s},o=t.json.images.push(a)-1,l=n.data;a.bufferView=t.processBufferViewImageBuffer(l),n.data={image:o}}}static _bundleExtraResources(e,t){e.textures&&e.samplers&&e.images&&t.resources.textures&&[...Object.entries(t.resources.textures)].forEach(([i,n])=>{e.textures.find(s=>{var a,o,l,c,h;return((a=s.extras)==null?void 0:a.uuid)===i||((l=(o=e.samplers[s.sampler])==null?void 0:o.extras)==null?void 0:l.uuid)===i||((h=(c=e.images[s.source])==null?void 0:c.extras)==null?void 0:h.t_uuid)===i})&&(n.image&&t.resources.images&&t.resources.images[n.image]&&delete t.resources.images[n.image],t.resources.textures[i]={})}),e.materials&&t.resources.materials&&[...Object.entries(t.resources.materials)].forEach(([i,n])=>{e.materials.find(s=>{var a;return((a=s.extras)==null?void 0:a.uuid)===i})&&(t.resources.materials[i]={})})}};bC.ViewerConfigGLTFExtension="WEBGI_viewer";let qy=bC;const wC=async(r,e)=>{if(!r||!(r instanceof ArrayBuffer)||!r.byteLength||!e.encrypt)return r;if(!e.encryptKey&&window&&window.prompt&&(e.encryptKey=window.prompt("GLTFEncryption: Enter encryption key/password")||""),!e.encryptKey)return console.warn("GLTF Export: encryption key not provided, skipping encryption"),r;const t=await Kw(new Uint8Array(r),e.encryptKey);return gx(t,{asset:{version:"2.0",generator:"ThreePipeGLBWrapper",encryption:{type:"aesgcm",version:1}}})},xC={key:(r,e,t)=>r.key||window&&window.prompt&&window.prompt("GLTFEncryption: Please enter the password/key for the model: "+t)||"",async process(r,e){var t;if(typeof r=="string")return r;const i=100;if(!new TextDecoder().decode(new Uint8Array(r,0,i)).includes("GLBWrapper"))return r;const n=new fC(r),s=JSON.parse(n.content||"{}");let a=n.body||r;const o=(t=s.asset)==null?void 0:t.encryption;if(!o)return a;const l=o.type,c=o.version;if(l==="aesgcm"&&c===1){const h=await sr(this.key,o,s,e)||"";try{a=(await Jw(new Uint8Array(a),h)).buffer}catch{throw new ErrorEvent("decryption error")}}return a}},EC=class AS extends _i{constructor(e){super(e),this.isGLTFLoader2=!0,this.preparsers=[],this.gltfViewerParser=t=>i=>{var n,s,a,o,l,c,h,d,m;const f=i.getDependency;i.getDependency=async(E,_)=>{const C=await f.call(i,E,_);if(C&&C.userData){const M=C.userData.gltfExtensions;delete C.userData.gltfExtensions,C.userData=Kt.Deserialize(C.userData,{}),C.userData.gltfExtensions=M}return C};const v=hs()+".drc",w=hs()+".ktx2",b=(a=(s=(n=i.json)==null?void 0:n.extensionsRequired)==null?void 0:s.includes)==null?void 0:a.call(s,"KHR_draco_mesh_compression");if(b){const E=t.assetManager.importer.registerFile(v);E&&this.setDRACOLoader(E)}(c=(l=(o=i.json)==null?void 0:o.extensionsUsed)==null?void 0:l.includes)!=null&&c.call(l,"EXT_meshopt_compression")&&(window.MeshoptDecoder?(this.setMeshoptDecoder(window.MeshoptDecoder),i.options.meshoptDecoder=window.MeshoptDecoder):console.error("Add GLTFMeshOptPlugin(and initialize it) to viewer to enable EXT_meshopt_compression decode"));const y=(m=(d=(h=i.json)==null?void 0:h.extensionsUsed)==null?void 0:d.includes)==null?void 0:m.call(d,"KHR_texture_basisu");if(y){const E=t.assetManager.importer.registerFile(w);E&&(this.setKTX2Loader(E),i.options.ktx2Loader=E)}return{name:"GLTF2_HELPER_PLUGIN",afterRoot:async E=>{b&&t.assetManager.importer.unregisterFile(v),y&&t.assetManager.importer.unregisterFile(w),await qy.ImportViewerConfig(i,t,E.scenes||[E.scene])}}},this.preparsers.push(xC),_i.ObjectConstructors.DirectionalLight=p.DirectionalLight2,_i.ObjectConstructors.PointLight=p.PointLight2,_i.ObjectConstructors.SpotLight=p.SpotLight2,_i.ObjectConstructors.MeshStandardMaterial=xa,_i.ObjectConstructors.MeshBasicMaterial=kh,_i.ObjectConstructors.MeshPhysicalMaterial=xa,_i.ObjectConstructors.LineBasicMaterial=Xp,_i.ObjectConstructors.PerspectiveCamera=oE,_i.ObjectConstructors.OrthographicCamera=ua}async preparse(e,t){for(const i of this.preparsers)e=await i.process(e,t);return e}parse(e,t,i,n,s){this.preparse.call(this,e,s||t).then(a=>a?super.parse(a,t,i,n):n&&n(new ErrorEvent("no data"))).catch(a=>{console.error(a),n&&n(a??new ErrorEvent("unknown error"))})}transform(e,t){const i=e?e.scene||!!e.scenes&&e.scenes.length>0&&e.scenes[0]:void 0;if(i)return e.animations.length>0&&(i.animations=e.animations),i.traverse(n=>{n.userData.gltfUUID&&(el(n,"uuid",n.userData.gltfUUID,!0,!0),delete n.userData.gltfUUID)}),i.userData||(i.userData={}),e.userData&&(i.userData.gltfExtras=e.userData),e.cameras&&e.cameras.forEach(n=>!n.parent&&i.add(n)),e.asset&&(i.userData.gltfAsset=e.asset),i}register(e){return super.register(e)}setup(e,t){this.register(Wy.Import(e.loadConfigResources));for(const i of t)this.register(i);for(const i of AS.ImportExtensions)this.register(i);return this.register(this.gltfViewerParser(e)),this}};EC.ImportExtensions=[Xy.Import,Hy.Import,od.Import,ld.Import,cd.Import,ad.Import];let CC=EC;const Yy=new WeakMap;class bO extends $i{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,n){const s=new bi(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,a=>{this.parse(a,t,n)},i,n)}parse(e,t,i){this.decodeDracoFile(e,t,null,null,it).catch(i)}decodeDracoFile(e,t,i,n,s=wi){const a={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!i,vertexColorSpace:s};return this.decodeGeometry(e,a).then(t)}decodeGeometry(e,t){const i=JSON.stringify(t);if(Yy.has(e)){const l=Yy.get(e);if(l.key===i)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const s=this.workerNextTaskID++,a=e.byteLength,o=this._getWorker(s,a).then(l=>(n=l,new Promise((c,h)=>{n._callbacks[s]={resolve:c,reject:h},n.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return o.catch(()=>!0).then(()=>{n&&s&&this._releaseTask(n,s)}),Yy.set(e,{key:i,promise:o}),o}_createGeometry(e){const t=new ht;e.index&&t.setIndex(new At(e.index.array,1));for(let i=0;i<e.attributes.length;i++){const n=e.attributes[i],s=n.name,a=n.array,o=n.itemSize,l=new At(a,o);s==="color"&&(this._assignVertexColorSpace(l,n.vertexColorSpace),l.normalized=!(a instanceof Float32Array)),t.setAttribute(s,l)}return t}_assignVertexColorSpace(e,t){if(t!==it)return;const i=new fe;for(let n=0,s=e.count;n<s;n++)i.fromBufferAttribute(e,n).convertSRGBToLinear(),e.setXYZ(n,i.r,i.g,i.b)}_loadLibrary(e,t){const i=new bi(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((n,s)=>{i.load(e,n,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{const n=i[0];e||(this.decoderConfig.wasmBinary=i[1]);const s=wO,a=["/* draco decoder */",n,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(s){const a=s.data;switch(a.type){case"decode":n._callbacks[a.id].resolve(a);break;case"error":n._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,s){return n._taskLoad>s._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}const wO=`
function DRACOWorker() {

	let decoderConfig;
	let decoderPending;

	onmessage = function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':
				decoderConfig = message.decoderConfig;
				decoderPending = new Promise( function ( resolve/*, reject*/ ) {

					decoderConfig.onModuleLoaded = function ( draco ) {

						// Module is Promise-like. Wrap before resolving to avoid loop.
						resolve( { draco: draco } );

					};

					DracoDecoderModule( decoderConfig ); // eslint-disable-line no-undef

				} );
				break;

			case 'decode':
				const buffer = message.buffer;
				const taskConfig = message.taskConfig;
				decoderPending.then( ( module ) => {

					const draco = module.draco;
					const decoder = new draco.Decoder();

					try {

						const geometry = decodeGeometry( draco, decoder, new Int8Array( buffer ), taskConfig );

						const buffers = geometry.attributes.map( ( attr ) => attr.array.buffer );

						if ( geometry.index ) buffers.push( geometry.index.array.buffer );

						self.postMessage( { type: 'decode', id: message.id, geometry }, buffers );

					} catch ( error ) {

						console.error( error );

						self.postMessage( { type: 'error', id: message.id, error: error.message } );

					} finally {

						draco.destroy( decoder );

					}

				} );
				break;

		}

	};

	function decodeGeometry( draco, decoder, array, taskConfig ) {

		const attributeIDs = taskConfig.attributeIDs;
		const attributeTypes = taskConfig.attributeTypes;

		let dracoGeometry;
		let decodingStatus;

		const geometryType = decoder.GetEncodedGeometryType( array );

		if ( geometryType === draco.TRIANGULAR_MESH ) {

			dracoGeometry = new draco.Mesh();
			decodingStatus = decoder.DecodeArrayToMesh( array, array.byteLength, dracoGeometry );

		} else if ( geometryType === draco.POINT_CLOUD ) {

			dracoGeometry = new draco.PointCloud();
			decodingStatus = decoder.DecodeArrayToPointCloud( array, array.byteLength, dracoGeometry );

		} else {

			throw new Error( 'THREE.DRACOLoader: Unexpected geometry type.' );

		}

		if ( ! decodingStatus.ok() || dracoGeometry.ptr === 0 ) {

			throw new Error( 'THREE.DRACOLoader: Decoding failed: ' + decodingStatus.error_msg() );

		}

		const geometry = { index: null, attributes: [] };

		// Gather all vertex attributes.
		for ( const attributeName in attributeIDs ) {

			const attributeType = self[ attributeTypes[ attributeName ] ];

			let attribute;
			let attributeID;

			// A Draco file may be created with default vertex attributes, whose attribute IDs
			// are mapped 1:1 from their semantic name (POSITION, NORMAL, ...). Alternatively,
			// a Draco file may contain a custom set of attributes, identified by known unique
			// IDs. glTF files always do the latter, and .drc files typically do the former.
			if ( taskConfig.useUniqueIDs ) {

				attributeID = attributeIDs[ attributeName ];
				attribute = decoder.GetAttributeByUniqueId( dracoGeometry, attributeID );

			} else {

				attributeID = decoder.GetAttributeId( dracoGeometry, draco[ attributeIDs[ attributeName ] ] );

				if ( attributeID === - 1 ) continue;

				attribute = decoder.GetAttribute( dracoGeometry, attributeID );

			}

			const attributeResult = decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute );

			if ( attributeName === 'color' ) {

				attributeResult.vertexColorSpace = taskConfig.vertexColorSpace;

			}

			geometry.attributes.push( attributeResult );

		}

		// Add index.
		if ( geometryType === draco.TRIANGULAR_MESH ) {

			geometry.index = decodeIndex( draco, decoder, dracoGeometry );

		}

		draco.destroy( dracoGeometry );

		return geometry;

	}

	function decodeIndex( draco, decoder, dracoGeometry ) {

		const numFaces = dracoGeometry.num_faces();
		const numIndices = numFaces * 3;
		const byteLength = numIndices * 4;

		const ptr = draco._malloc( byteLength );
		decoder.GetTrianglesUInt32Array( dracoGeometry, byteLength, ptr );
		const index = new Uint32Array( draco.HEAPF32.buffer, ptr, numIndices ).slice();
		draco._free( ptr );

		return { array: index, itemSize: 1 };

	}

	function decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute ) {

		const numComponents = attribute.num_components();
		const numPoints = dracoGeometry.num_points();
		const numValues = numPoints * numComponents;
		const byteLength = numValues * attributeType.BYTES_PER_ELEMENT;
		const dataType = getDracoDataType( draco, attributeType );

		const ptr = draco._malloc( byteLength );
		decoder.GetAttributeDataArrayForAllPoints( dracoGeometry, attribute, dataType, byteLength, ptr );
		const array = new attributeType( draco.HEAPF32.buffer, ptr, numValues ).slice();
		draco._free( ptr );

		return {
			name: attributeName,
			array: array,
			itemSize: numComponents
		};

	}

	function getDracoDataType( draco, attributeType ) {

		switch ( attributeType ) {

			case Float32Array: return draco.DT_FLOAT32;
			case Int8Array: return draco.DT_INT8;
			case Int16Array: return draco.DT_INT16;
			case Int32Array: return draco.DT_INT32;
			case Uint8Array: return draco.DT_UINT8;
			case Uint16Array: return draco.DT_UINT16;
			case Uint32Array: return draco.DT_UINT32;

		}

	}

}
`,Ky=class Sd extends bO{constructor(e){super(e),this.encoderPending=null,this.encoderConfig={type:"js"},this.setDecoderPath(Sd.DRACO_LIBRARY_PATH),this.setDecoderConfig({type:"js"})}transform(e,t){var i;return(i=e.attributes)!=null&&i.normal||e.computeVertexNormals(),e?new Fe(e,new xa({color:new fe(1,1,1)})):void 0}preload(e=!0,t=!1){return e&&super.preload(),t&&this.initEncoder(),this}async initEncoder(){if(this.encoderPending)return this.encoderPending;const e=typeof WebAssembly!="object"||this.encoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_encoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_encoder.wasm","arraybuffer"))),this.encoderPending=Promise.all(t).then(i=>{var n;const s=i[0];return e||(this.encoderConfig.wasmBinary=i[1]),(n=(0,eval)(s+`
DracoEncoderModule;`))==null?void 0:n()}),this.encoderPending}async initDecoder(){var e;await this._initDecoder();const t=await fetch(this.workerSourceURL).then(async i=>i.text()).then(i=>{const n=i.indexOf("/* worker */");if(n<1)throw new Error("unable to load decoder module");return i.substring(0,n-1)});return(e=(0,eval)(t+`
DracoDecoderModule;`))==null?void 0:e()}async _loadLibrary(e,t){return Sd.LibraryValueMap[e]?Sd.LibraryValueMap[e]:Sd.LibraryValueMap[e]=await super._loadLibrary(e,t)}static SetDecoderJsString(e){this.LibraryValueMap["draco_decoder.js"]=e}};Ky.DRACO_LIBRARY_PATH="https://cdn.jsdelivr.net/gh/google/draco@1.5.6/javascript/",Ky.LibraryValueMap={};let MC=Ky;const Jy=new WeakMap;class xO extends $i{constructor(e){super(e),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.url="",this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[],this.warnings=[]}setLibraryPath(e){return this.libraryPath=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,n){const s=new bi(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),this.url=e,s.load(e,a=>{if(Jy.has(a))return Jy.get(a).promise.then(t).catch(n);this.decodeObjects(a,e).then(o=>{o.userData.warnings=this.warnings,this.warnings=[],t(o)}).catch(o=>n(o))},i,n)}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}decodeObjects(e,t){let i,n;const s=e.byteLength,a=this._getWorker(s).then(o=>(i=o,n=this.workerNextTaskID++,new Promise((l,c)=>{i._callbacks[n]={resolve:l,reject:c},i.postMessage({type:"decode",id:n,buffer:e},[e])}))).then(o=>this._createGeometry(o.data)).catch(o=>{throw o});return a.catch(()=>!0).then(()=>{i&&n&&this._releaseTask(i,n)}),Jy.set(e,{url:t,promise:a}),a}parse(e,t,i){this.decodeObjects(e,"").then(n=>{n.userData.warnings=this.warnings,t(n)}).catch(n=>i(n))}_compareMaterials(e){if(this.materials.includes(e))return e;const t={};t.name=e.name,t.color={},t.color.r=e.color.r,t.color.g=e.color.g,t.color.b=e.color.b,t.type=e.type;const i=JSON.stringify(t);for(let n=0;n<this.materials.length;n++){const s=this.materials[n],a={};if(a.name=s.name,a.color={},a.color.r=s.color.r,a.color.g=s.color.g,a.color.b=s.color.b,a.type=s.type,JSON.stringify(a)===i)return s}return this.materials.push(e),e}_createMaterial(e){if(e===void 0)return new fa({color:new fe(1,1,1),metalness:.8,name:"default",side:dt});const t=e.diffuseColor,i=new fe(t.r/255,t.g/255,t.b/255);t.r===0&&t.g===0&&t.b===0&&(i.r=1,i.g=1,i.b=1);const n=new fa({color:i,name:e.name,side:dt,transparent:e.transparency>0,opacity:1-e.transparency}),s=new Ko;for(let a=0;a<e.textures.length;a++){const o=e.textures[a];if(o.image!==null){const l=s.load(o.image);switch(o.type){case"Diffuse":n.map=l;break;case"Bump":n.bumpMap=l;break;case"Transparency":n.alphaMap=l,n.transparent=!0;break;case"Emap":n.envMap=l;break}l.wrapS=o.wrapU===0?Ar:ai,l.wrapT=o.wrapV===0?Ar:ai,l.repeat.set(o.repeat[0],o.repeat[1])}}return n}_createGeometry(e){const t=new It,i=[],n=[],s=[];t.userData.layers=e.layers,t.userData.groups=e.groups,t.userData.settings=e.settings,t.userData.strings=e.strings,t.userData.objectType="File3dm",t.userData.materials=null,t.name=this.url;let a=e.objects;const o=e.materials;for(let l=0;l<a.length;l++){const c=a[l],h=c.attributes;switch(c.objectType){case"InstanceDefinition":n.push(c);break;case"InstanceReference":s.push(c);break;default:let d;if(h.materialIndex>=0){const f=o[h.materialIndex];let v=this._createMaterial(f);v=this._compareMaterials(v),d=this._createObject(c,v)}else{const f=this._createMaterial();d=this._createObject(c,f)}if(d===void 0)continue;const m=e.layers[h.layerIndex];d.visible=m?m.visible:!0,h.isInstanceDefinitionObject?i.push(d):t.add(d);break}}for(let l=0;l<n.length;l++){const c=n[l];a=[];for(let h=0;h<c.attributes.objectIds.length;h++){const d=c.attributes.objectIds[h];for(let m=0;m<i.length;m++){const f=i[m].userData.attributes.id;d===f&&a.push(i[m])}}for(let h=0;h<s.length;h++){const d=s[h];if(d.geometry.parentIdefId===c.attributes.id){const m=d.geometry.xform.array,f=new et;if(f.set(...m),a.length===1){const v=a[0].clone(!0);if(v.name=d.attributes.name||v.name,v.applyMatrix4(f),d.attributes.materialIndex>=0&&d.attributes.materialIndex!==a[0].userData.attributes.materialIndex){const w=o[d.attributes.materialIndex],b=this._createMaterial(w);v.material=this._compareMaterials(b)}if(v.userData.defAttributes=v.userData.attributes,v.userData.defObjectType=v.userData.objectType,v.userData.attributes={...v.userData.attributes,...d.attributes},v.userData.objectType=d.objectType,d.attributes.layerIndex!==void 0){const w=e.layers[d.attributes.layerIndex];v.visible=w?w.visible:v.visible}t.add(v)}else{console.warn("THREE.Rhino3dmLoader: InstanceReference with multiple/no objects, not all properties will be copied.");const v=new It;v.applyMatrix4(f);for(let w=0;w<a.length;w++)v.add(a[w].clone(!0));t.add(v)}}}}return t.userData.materials=this.materials,t}_createObject(e,t){const i=new Ov,n=e.attributes;let s,a,o,l;switch(e.objectType){case"Point":case"PointSet":s=i.parse(e.geometry),s.attributes.hasOwnProperty("color")?a=new da({vertexColors:!0,sizeAttenuation:!1,size:2}):(o=n.drawColor,l=new fe(o.r/255,o.g/255,o.b/255),a=new da({color:l,sizeAttenuation:!1,size:2})),a=this._compareMaterials(a);const c=new Gl(s,a);return c.userData.attributes=n,c.userData.objectType=e.objectType,n.name&&(c.name=n.name),c;case"Mesh":case"Extrusion":case"SubD":case"Brep":if(e.geometry===null)return;s=i.parse(e.geometry),s.attributes.hasOwnProperty("color")&&(t.vertexColors=!0),t===null&&(t=this._createMaterial(),t=this._compareMaterials(t));const h=new Fe(s,t);return h.castShadow=n.castsShadows,h.receiveShadow=n.receivesShadows,h.userData.attributes=n,h.userData.objectType=e.objectType,n.name&&(h.name=n.name,s.name=n.name),h;case"Curve":s=i.parse(e.geometry),o=n.drawColor,l=new fe(o.r/255,o.g/255,o.b/255),a=new Ji({color:l}),a=this._compareMaterials(a);const d=new Tr(s,a);return d.userData.attributes=n,d.userData.objectType=e.objectType,n.name&&(d.name=n.name),d;case"TextDot":s=e.geometry;const m=document.createElement("canvas").getContext("2d"),f=`${s.fontHeight}px ${s.fontFace}`;m.font=f;const v=m.measureText(s.text).width+10,w=s.fontHeight+10,b=window.devicePixelRatio;m.canvas.width=v*b,m.canvas.height=w*b,m.canvas.style.width=v+"px",m.canvas.style.height=w+"px",m.setTransform(b,0,0,b,0,0),m.font=f,m.textBaseline="middle",m.textAlign="center",l=n.drawColor,m.fillStyle=`rgba(${l.r},${l.g},${l.b},${l.a})`,m.fillRect(0,0,v,w),m.fillStyle="white",m.fillText(s.text,v/2,w/2);const y=new jm(m.canvas);y.minFilter=Et,y.wrapS=ai,y.wrapT=ai,a=new ap({map:y,depthTest:!1});const E=new Om(a);return E.position.set(s.point[0],s.point[1],s.point[2]),E.scale.set(v/10,w/10,1),E.userData.attributes=n,E.userData.objectType=e.objectType,n.name&&(E.name=n.name),E;case"Light":s=e.geometry;let _;switch(s.lightStyle.name){case"LightStyle_WorldPoint":_=new Kl,_.castShadow=n.castsShadows,_.position.set(s.location[0],s.location[1],s.location[2]),_.shadow.normalBias=.1;break;case"LightStyle_WorldSpot":_=new Eh,_.castShadow=n.castsShadows,_.position.set(s.location[0],s.location[1],s.location[2]),_.target.position.set(s.direction[0],s.direction[1],s.direction[2]),_.angle=s.spotAngleRadians,_.shadow.normalBias=.1;break;case"LightStyle_WorldRectangular":_=new gf;const C=Math.abs(s.width[2]),M=Math.abs(s.length[0]);_.position.set(s.location[0]-M/2,s.location[1],s.location[2]-C/2),_.height=M,_.width=C,_.lookAt(s.direction[0],s.direction[1],s.direction[2]);break;case"LightStyle_WorldDirectional":_=new Ch,_.castShadow=n.castsShadows,_.position.set(s.location[0],s.location[1],s.location[2]),_.target.position.set(s.direction[0],s.direction[1],s.direction[2]),_.shadow.normalBias=.1;break}return _&&(_.intensity=s.intensity,o=s.diffuse,l=new fe(o.r/255,o.g/255,o.b/255),_.color=l,_.userData.attributes=n,_.userData.objectType=e.objectType),_}}_initLibrary(){if(!this.libraryPending){const e=new bi(this.manager);e.setPath(this.libraryPath);const t=new Promise((s,a)=>{e.load("rhino3dm.js",s,void 0,a)}),i=new bi(this.manager);i.setPath(this.libraryPath),i.setResponseType("arraybuffer");const n=new Promise((s,a)=>{i.load("rhino3dm.wasm",s,void 0,a)});this.libraryPending=Promise.all([t,n]).then(([s,a])=>{this.libraryConfig.wasmBinary=a;const o=EO,l=["/* rhino3dm.js */",s,"/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([l]))})}return this.libraryPending}_getWorker(e){return this._initLibrary().then(()=>{if(this.workerPool.length<this.workerLimit){const i=new Worker(this.workerSourceURL);i._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",libraryConfig:this.libraryConfig}),i.onmessage=n=>{const s=n.data;switch(s.type){case"warning":this.warnings.push(s.data),console.warn(s.data);break;case"decode":i._callbacks[s.id].resolve(s);break;case"error":i._callbacks[s.id].reject(s);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(i)}else this.workerPool.sort(function(i,n){return i._taskLoad>n._taskLoad?-1:1});const t=this.workerPool[this.workerPool.length-1];return t._taskLoad+=e,t})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}const EO=`
function Rhino3dmWorker() {

	let libraryPending;
	let libraryConfig;
	let rhino;
	let taskID;

	onmessage = function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':

				// console.log(message)
				libraryConfig = message.libraryConfig;
				const wasmBinary = libraryConfig.wasmBinary;
				let RhinoModule;
				libraryPending = new Promise( function ( resolve ) {

					/* Like Basis Loader */
					RhinoModule = { wasmBinary, onRuntimeInitialized: resolve };

					rhino3dm( RhinoModule ); // eslint-disable-line no-undef

				 } ).then( () => {

					rhino = RhinoModule;

				 } );

				break;

			case 'decode':

				taskID = message.id;
				const buffer = message.buffer;
				libraryPending.then( () => {

					try {

						const data = decodeObjects( rhino, buffer );
						self.postMessage( { type: 'decode', id: message.id, data } );

					} catch ( error ) {

						self.postMessage( { type: 'error', id: message.id, error } );

					}

				} );

				break;

		}

	};

	function decodeObjects( rhino, buffer ) {

		const arr = new Uint8Array( buffer );
		const doc = rhino.File3dm.fromByteArray( arr );

		const objects = [];
		const materials = [];
		const layers = [];
		const views = [];
		const namedViews = [];
		const groups = [];
		const strings = [];

		//Handle objects

		const objs = doc.objects();
		const cnt = objs.count;

		for ( let i = 0; i < cnt; i ++ ) {

			const _object = objs.get( i );

			const object = extractObjectData( _object, doc );

			_object.delete();

			if ( object ) {

				objects.push( object );

			}

		}

		// Handle instance definitions
		// console.log( \`Instance Definitions Count: \${doc.instanceDefinitions().count()}\` );

		for ( let i = 0; i < doc.instanceDefinitions().count(); i ++ ) {

			const idef = doc.instanceDefinitions().get( i );
			const idefAttributes = extractProperties( idef );
			idefAttributes.objectIds = idef.getObjectIds();

			objects.push( { geometry: null, attributes: idefAttributes, objectType: 'InstanceDefinition' } );

		}

		// Handle materials

		const textureTypes = [
			// rhino.TextureType.Bitmap,
			rhino.TextureType.Diffuse,
			rhino.TextureType.Bump,
			rhino.TextureType.Transparency,
			rhino.TextureType.Opacity,
			rhino.TextureType.Emap
		];

		const pbrTextureTypes = [
			rhino.TextureType.PBR_BaseColor,
			rhino.TextureType.PBR_Subsurface,
			rhino.TextureType.PBR_SubsurfaceScattering,
			rhino.TextureType.PBR_SubsurfaceScatteringRadius,
			rhino.TextureType.PBR_Metallic,
			rhino.TextureType.PBR_Specular,
			rhino.TextureType.PBR_SpecularTint,
			rhino.TextureType.PBR_Roughness,
			rhino.TextureType.PBR_Anisotropic,
			rhino.TextureType.PBR_Anisotropic_Rotation,
			rhino.TextureType.PBR_Sheen,
			rhino.TextureType.PBR_SheenTint,
			rhino.TextureType.PBR_Clearcoat,
			rhino.TextureType.PBR_ClearcoatBump,
			rhino.TextureType.PBR_ClearcoatRoughness,
			rhino.TextureType.PBR_OpacityIor,
			rhino.TextureType.PBR_OpacityRoughness,
			rhino.TextureType.PBR_Emission,
			rhino.TextureType.PBR_AmbientOcclusion,
			rhino.TextureType.PBR_Displacement
		];

		for ( let i = 0; i < doc.materials().count(); i ++ ) {

			const _material = doc.materials().get( i );
			const _pbrMaterial = _material.physicallyBased();

			let material = extractProperties( _material );

			const textures = [];

			for ( let j = 0; j < textureTypes.length; j ++ ) {

				const _texture = _material.getTexture( textureTypes[ j ] );
				if ( _texture ) {

					let textureType = textureTypes[ j ].constructor.name;
					textureType = textureType.substring( 12, textureType.length );
					const texture = { type: textureType };

					const image = doc.getEmbeddedFileAsBase64( _texture.fileName );

					texture.wrapU = _texture.wrapU;
					texture.wrapV = _texture.wrapV;
					texture.wrapW = _texture.wrapW;
					const uvw = _texture.uvwTransform.toFloatArray( true );
					texture.repeat = [ uvw[ 0 ], uvw[ 5 ] ];

					if ( image ) {

						texture.image = 'data:image/png;base64,' + image;

					} else {

						self.postMessage( { type: 'warning', id: taskID, data: {
							message: \`THREE.3DMLoader: Image for \${textureType} texture not embedded in file.\`,
							type: 'missing resource'
						}

						} );

						texture.image = null;

					}

					textures.push( texture );

					_texture.delete();

				}

			}

			material.textures = textures;

			if ( _pbrMaterial.supported ) {

				for ( let j = 0; j < pbrTextureTypes.length; j ++ ) {

					const _texture = _material.getTexture( pbrTextureTypes[ j ] );
					if ( _texture ) {

						const image = doc.getEmbeddedFileAsBase64( _texture.fileName );
						let textureType = pbrTextureTypes[ j ].constructor.name;
						textureType = textureType.substring( 12, textureType.length );
						const texture = { type: textureType, image: 'data:image/png;base64,' + image };
						textures.push( texture );

						_texture.delete();

					}

				}

				const pbMaterialProperties = extractProperties( _material.physicallyBased() );

				material = Object.assign( pbMaterialProperties, material );

			}

			materials.push( material );

			_material.delete();
			_pbrMaterial.delete();

		}

		// Handle layers

		for ( let i = 0; i < doc.layers().count(); i ++ ) {

			const _layer = doc.layers().get( i );
			const layer = extractProperties( _layer );

			layers.push( layer );

			_layer.delete();

		}

		// Handle views

		for ( let i = 0; i < doc.views().count(); i ++ ) {

			const _view = doc.views().get( i );
			const view = extractProperties( _view );

			views.push( view );

			_view.delete();

		}

		// Handle named views

		for ( let i = 0; i < doc.namedViews().count(); i ++ ) {

			const _namedView = doc.namedViews().get( i );
			const namedView = extractProperties( _namedView );

			namedViews.push( namedView );

			_namedView.delete();

		}

		// Handle groups

		for ( let i = 0; i < doc.groups().count(); i ++ ) {

			const _group = doc.groups().get( i );
			const group = extractProperties( _group );

			groups.push( group );

			_group.delete();

		}

		// Handle settings

		const settings = extractProperties( doc.settings() );

		//TODO: Handle other document stuff like dimstyles, instance definitions, bitmaps etc.

		// Handle dimstyles
		// console.log( \`Dimstyle Count: \${doc.dimstyles().count()}\` );

		// Handle bitmaps
		// console.log( \`Bitmap Count: \${doc.bitmaps().count()}\` );

		// Handle strings
		// console.log( \`Document Strings Count: \${doc.strings().count()}\` );
		// Note: doc.strings().documentUserTextCount() counts any doc.strings defined in a section
		//console.log( \`Document User Text Count: \${doc.strings().documentUserTextCount()}\` );

		const strings_count = doc.strings().count();

		for ( let i = 0; i < strings_count; i ++ ) {

			strings.push( doc.strings().get( i ) );

		}

		doc.delete();

		return { objects, materials, layers, views, namedViews, groups, strings, settings };

	}

	function extractObjectData( object, doc ) {

		const _geometry = object.geometry();
		const _attributes = object.attributes();
		let objectType = _geometry.objectType;
		let geometry, attributes, position, data, mesh;

		// skip instance definition objects
		//if( _attributes.isInstanceDefinitionObject ) { continue; }

		// TODO: handle other geometry types
		switch ( objectType ) {

			case rhino.ObjectType.Curve:

				const pts = curveToPoints( _geometry, 100 );

				position = {};
				attributes = {};
				data = {};

				position.itemSize = 3;
				position.type = 'Float32Array';
				position.array = [];

				for ( let j = 0; j < pts.length; j ++ ) {

					position.array.push( pts[ j ][ 0 ] );
					position.array.push( pts[ j ][ 1 ] );
					position.array.push( pts[ j ][ 2 ] );

				}

				attributes.position = position;
				data.attributes = attributes;

				geometry = { data };

				break;

			case rhino.ObjectType.Point:

				const pt = _geometry.location;

				position = {};
				const color = {};
				attributes = {};
				data = {};

				position.itemSize = 3;
				position.type = 'Float32Array';
				position.array = [ pt[ 0 ], pt[ 1 ], pt[ 2 ] ];

				const _color = _attributes.drawColor( doc );

				color.itemSize = 3;
				color.type = 'Float32Array';
				color.array = [ _color.r / 255.0, _color.g / 255.0, _color.b / 255.0 ];

				attributes.position = position;
				attributes.color = color;
				data.attributes = attributes;

				geometry = { data };

				break;

			case rhino.ObjectType.PointSet:
			case rhino.ObjectType.Mesh:

				geometry = _geometry.toThreejsJSON();

				break;

			case rhino.ObjectType.Brep:

				const faces = _geometry.faces();
				mesh = new rhino.Mesh();

				for ( let faceIndex = 0; faceIndex < faces.count; faceIndex ++ ) {

					const face = faces.get( faceIndex );
					const _mesh = face.getMesh( rhino.MeshType.Any );

					if ( _mesh ) {

						mesh.append( _mesh );
						_mesh.delete();

					}

					face.delete();

				}

				if ( mesh.faces().count > 0 ) {

					mesh.compact();
					geometry = mesh.toThreejsJSON();
					faces.delete();

				}

				mesh.delete();

				break;

			case rhino.ObjectType.Extrusion:

				mesh = _geometry.getMesh( rhino.MeshType.Any );

				if ( mesh ) {

					geometry = mesh.toThreejsJSON();
					mesh.delete();

				}

				break;

			case rhino.ObjectType.TextDot:

				geometry = extractProperties( _geometry );

				break;

			case rhino.ObjectType.Light:

				geometry = extractProperties( _geometry );

				if ( geometry.lightStyle.name === 'LightStyle_WorldLinear' ) {

					self.postMessage( { type: 'warning', id: taskID, data: {
						message: \`THREE.3DMLoader: No conversion exists for \${objectType.constructor.name} \${geometry.lightStyle.name}\`,
						type: 'no conversion',
						guid: _attributes.id
					}

					} );

				}

				break;

			case rhino.ObjectType.InstanceReference:

				geometry = extractProperties( _geometry );
				geometry.xform = extractProperties( _geometry.xform );
				geometry.xform.array = _geometry.xform.toFloatArray( true );

				break;

			case rhino.ObjectType.SubD:

				// TODO: precalculate resulting vertices and faces and warn on excessive results
				_geometry.subdivide( 3 );
				mesh = rhino.Mesh.createFromSubDControlNet( _geometry );
				if ( mesh ) {

					geometry = mesh.toThreejsJSON();
					mesh.delete();

				}

				break;

				/*
				case rhino.ObjectType.Annotation:
				case rhino.ObjectType.Hatch:
				case rhino.ObjectType.ClipPlane:
				*/

			default:

				self.postMessage( { type: 'warning', id: taskID, data: {
					message: \`THREE.3DMLoader: Conversion not implemented for \${objectType.constructor.name}\`,
					type: 'not implemented',
					guid: _attributes.id
				}

				} );

				break;

		}

		if ( geometry ) {

			attributes = extractProperties( _attributes );
			attributes.geometry = extractProperties( _geometry );

			if ( _attributes.groupCount > 0 ) {

				attributes.groupIds = _attributes.getGroupList();

			}

			if ( _attributes.userStringCount > 0 ) {

				attributes.userStrings = _attributes.getUserStrings();

			}

			if ( _geometry.userStringCount > 0 ) {

				attributes.geometry.userStrings = _geometry.getUserStrings();

			}

			attributes.drawColor = _attributes.drawColor( doc );

			objectType = objectType.constructor.name;
			objectType = objectType.substring( 11, objectType.length );

			return { geometry, attributes, objectType };

		} else {

			self.postMessage( { type: 'warning', id: taskID, data: {
				message: \`THREE.3DMLoader: \${objectType.constructor.name} has no associated mesh geometry.\`,
				type: 'missing mesh',
				guid: _attributes.id
			}

			} );

		}

	}

	function extractProperties( object ) {

		const result = {};

		for ( const property in object ) {

			const value = object[ property ];

			if ( typeof value !== 'function' ) {

				if ( typeof value === 'object' && value !== null && value.hasOwnProperty( 'constructor' ) ) {

					result[ property ] = { name: value.constructor.name, value: value.value };

				} else {

					result[ property ] = value;

				}

			} else {

				// these are functions that could be called to extract more data.
				//console.log( \`\${property}: \${object[ property ].constructor.name}\` );

			}

		}

		return result;

	}

	function curveToPoints( curve, pointLimit ) {

		let pointCount = pointLimit;
		let rc = [];
		const ts = [];

		if ( curve instanceof rhino.LineCurve ) {

			return [ curve.pointAtStart, curve.pointAtEnd ];

		}

		if ( curve instanceof rhino.PolylineCurve ) {

			pointCount = curve.pointCount;
			for ( let i = 0; i < pointCount; i ++ ) {

				rc.push( curve.point( i ) );

			}

			return rc;

		}

		if ( curve instanceof rhino.PolyCurve ) {

			const segmentCount = curve.segmentCount;

			for ( let i = 0; i < segmentCount; i ++ ) {

				const segment = curve.segmentCurve( i );
				const segmentArray = curveToPoints( segment, pointCount );
				rc = rc.concat( segmentArray );
				segment.delete();

			}

			return rc;

		}

		if ( curve instanceof rhino.ArcCurve ) {

			pointCount = Math.floor( curve.angleDegrees / 5 );
			pointCount = pointCount < 2 ? 2 : pointCount;
			// alternative to this hardcoded version: https://stackoverflow.com/a/18499923/2179399

		}

		if ( curve instanceof rhino.NurbsCurve && curve.degree === 1 ) {

			const pLine = curve.tryGetPolyline();

			for ( let i = 0; i < pLine.count; i ++ ) {

				rc.push( pLine.get( i ) );

			}

			pLine.delete();

			return rc;

		}

		const domain = curve.domain;
		const divisions = pointCount - 1.0;

		for ( let j = 0; j < pointCount; j ++ ) {

			const t = domain[ 0 ] + ( j / divisions ) * ( domain[ 1 ] - domain[ 0 ] );

			if ( t === domain[ 0 ] || t === domain[ 1 ] ) {

				ts.push( t );
				continue;

			}

			const tan = curve.tangentAt( t );
			const prevTan = curve.tangentAt( ts.slice( - 1 )[ 0 ] );

			// Duplicated from THREE.Vector3
			// How to pass imports to worker?

			const tS = tan[ 0 ] * tan[ 0 ] + tan[ 1 ] * tan[ 1 ] + tan[ 2 ] * tan[ 2 ];
			const ptS = prevTan[ 0 ] * prevTan[ 0 ] + prevTan[ 1 ] * prevTan[ 1 ] + prevTan[ 2 ] * prevTan[ 2 ];

			const denominator = Math.sqrt( tS * ptS );

			let angle;

			if ( denominator === 0 ) {

				angle = Math.PI / 2;

			} else {

				const theta = ( tan.x * prevTan.x + tan.y * prevTan.y + tan.z * prevTan.z ) / denominator;
				angle = Math.acos( Math.max( - 1, Math.min( 1, theta ) ) );

			}

			if ( angle < 0.1 ) continue;

			ts.push( t );

		}

		rc = ts.map( t => curve.pointAt( t ) );
		return rc;

	}

}
`,$h=class yo extends xO{constructor(e){super(e),this.materials=[],this.setLibraryPath(yo.LIBRARY_PATH)}_createMaterial(e){return yo.ImportMaterials?super._createMaterial(e):this.materials[0]||new fa({color:new fe(1,1,1),metalness:.8,name:"default",side:dt})}async loadAsync(e,t){const i=await super.loadAsync(e,t);i.rotateX(-Math.PI/2),i.userData.materials&&delete i.userData.materials;const n=i.userData.layers;return i.traverse(s=>{var a,o,l,c;const h=(a=s.userData.attributes)==null?void 0:a.castsShadows,d=(o=s.userData.attributes)==null?void 0:o.receivesShadows;s.castShadow=h,s.receiveShadow=d;const m=((l=s.userData.attributes)==null?void 0:l.layerIndex)??((c=s.userData.defAttributes)==null?void 0:c.layerIndex),f=n[m];f&&(s.userData.rhinoLayer=f),s.userData.rhino3dmRoot=i.uuid,this._hideLineMesh(s),this._useInstancedMesh(s),this._useMaterialSource(s,f)}),this.materials=[],i}_useMaterialSource(e,t){var i,n,s,a,o;if(!yo.ImportMaterials)return;const l=e;if(((i=l.material)==null?void 0:i.name)==="default"||yo.ForceLayerMaterials){const c=((n=l.userData.attributes)==null?void 0:n.materialSource)||((s=l.userData.defAttributes)==null?void 0:s.materialSource),h=((a=l.userData.attributes)==null?void 0:a.colorSource)||((o=l.userData.defAttributes)==null?void 0:o.colorSource);if(!yo.ForceLayerMaterials&&!c&&!h)return;yo.ForceLayerMaterials||(c==null?void 0:c.value)===0||(c==null?void 0:c.value)===1&&(h==null?void 0:h.value)===0?t&&(l.material=this._compareMaterials(this._createMaterial({diffuseColor:t.color,name:t.name,transparency:0,textures:[]}))):(c==null?void 0:c.value)===3||(c==null?void 0:c.value)===1&&(h==null?void 0:h.value)===3?l.traverseAncestors(d=>{d!=null&&d.material&&(l.material=d.material)}):c&&c.value!==1&&console.warn("Unknown material source",c,l,l.userData.attributes)}}_useInstancedMesh(e){if(!yo.ReplaceWithInstancedMesh||e.children.length<=0)return;const t=e.children,i=t.map(n=>n.geometry);i.filter((n,s)=>i.indexOf(n)===s).forEach(n=>{var s;const a=t.filter(l=>l.geometry===n),o=a.length>0?a.filter(l=>l.material===a[0].material):[];if(o.length>1){const l=new pp(n,o[0].material,o.length);l.userData={...o[0].userData},l.userData.instanceUserData=[],l.userData.attributes=l.userData.defAttributes||l.userData.attributes,l.userData.defAttributes&&delete l.userData.defAttributes,l.name=((s=l.userData.attributes)==null?void 0:s.name)||o[0].name,o.forEach((c,h)=>{l.setMatrixAt(h,c.matrix),e.remove(c),l.userData.instanceUserData.push(c.userData)}),e.add(l)}})}_hideLineMesh(e){if(!yo.HideLineMesh||e.children.length<=0)return;const t=[];e.traverse(i=>{i&&(i.isLine||i.isLineSegments||i.isPoints)&&t.push(i)}),t.forEach(i=>{i.userData.visible_3dm=i.visible,i.visible=!1})}};$h.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/rhino3dm@7.15.0/",$h.ImportMaterials=!0,$h.ForceLayerMaterials=!1,$h.ReplaceWithInstancedMesh=!1,$h.HideLineMesh=!1;let eu=$h;class SC extends zi{constructor(e=!1){super(),this._logger=console.log,this._loaderCache=[],this._fileDatabase=new Map,this._cachedAssets=[],this.importers=[new Pr(Ay,["json","vjson"],["application/json"],!1),new Pr(bi,["txt"],["text/plain"],!1)],e||(this._logger=()=>{}),this._onLoad=this._onLoad.bind(this),this._onProgress=this._onProgress.bind(this),this._onError=this._onError.bind(this),this._onStart=this._onStart.bind(this),this._urlModifier=this._urlModifier.bind(this),this._loadingManager=new df(this._onLoad,this._onProgress,this._onError),this._loadingManager.onStart=this._onStart,this._loadingManager.setURLModifier(this._urlModifier)}get loadingManager(){return this._loadingManager}get cachedAssets(){return this._cachedAssets}addImporter(...e){for(const t of e){if(this.importers.includes(t)){console.warn("AssetImporter: Importer already added",t);return}this.importers.push(t)}}removeImporter(...e){for(const t of e){const i=this.importers.indexOf(t);i>=0&&this.importers.splice(i,1)}}async import(e,t){return e?Array.isArray(e)?(await Promise.all(e.map(async i=>this.import(i,t)))).flat(1):e instanceof File?await this.importFile(e,t):typeof e=="object"?await this.importAsset(e,t):typeof e=="string"?await this.importPath(e,t):(console.error("AssetImporter: Invalid asset or path",e),[]):[]}async importSingle(e,t){var i;return(i=await this.import(e,t))==null?void 0:i[0]}async importPath(e,t={}){const i={...t};delete i.pathOverride,delete i.forceImport,delete i.reimportDisposed,delete i.fileHandler,delete i.importedFile;const n=JSON.stringify(i),s=this._cachedAssets.find(o=>o.path===e&&o._options===n);let a;return s?a=s:a={path:e},a._options=n,t.importedFile&&(a.file=t.importedFile),await this.importAsset(a,t)}async importAsset(e,t={},i){var n,s;if(!e)return[];if(!e.path&&!e.file&&!t.pathOverride)return[e];if(!this._cachedAssets.includes(e)){if(Object.entries(e).length===1&&e.path){const c=this._cachedAssets.find(h=>h.path===e.path);c&&Object.assign(e,c)}const l=this._cachedAssets.findIndex(c=>c.path===e.path);l>=0&&this._cachedAssets.splice(l,1),this._cachedAssets.push(e)}let a=e==null?void 0:e.preImported;!a&&e!=null&&e.preImportedRaw&&(a=await e.preImportedRaw);const o=t.pathOverride||e.path;if(!t.forceImport&&a)return await this.processRaw(a,t,o);if(e.preImportedRaw=this._loadFile(o,typeof((n=e.file)==null?void 0:n.arrayBuffer)=="function"?e.file:void 0,t,i),a=await e.preImportedRaw,a&&(a=await this.processRaw(a,t,o)),a){t.processRaw!==!1&&(e.preImported=a);const l=[];Array.isArray(a)?l.push(...a):(s=a.userData)!=null&&s.rootSceneModelRoot?l.push(...a.children):l.push(a),l.forEach(c=>{var h;return(h=c.addEventListener)==null?void 0:h.call(c,"dispose",()=>{e!=null&&e.preImportedRaw&&(e.preImportedRaw=void 0),e!=null&&e.preImported&&(e.preImported=void 0)})})}return a}async importFile(e,t={},i){return e?e instanceof File?this.importAsset(this._cachedAssets.find(n=>n.file===e)??{path:e.name||e.webkitRelativePath,file:e},t,i):(console.error("AssetImporter: Invalid file",e),[]):[]}async importFiles(e,t={}){const i=new Map;let{allowedExtensions:n}=t;if(n&&n.length<1&&(n=void 0),e.size===0)return i;this.dispatchEvent({type:"importFiles",files:e,state:"start"});const s=[],a=[];if(e.forEach((o,l)=>{this.registerFile(l,o);const c=o.ext,h=o.mime;(c||h)&&((n==null?void 0:n.includes((c||h||"").toLowerCase()))??!0)&&(this._isRootFile(c)?s.push(l):a.push(l))}),s.length>0)for(const o of s){let l=await this._loadFile(o,void 0,t);l&&(l=await this.processRaw(l,t,o)),i.set(o,l)}else for(const o of a){let l=await this._loadFile(o,void 0,t);l&&(l=await this.processRaw(l,t,o)),i.set(o,l)}return this.dispatchEvent({type:"importFiles",files:e,state:"end"}),e.forEach((o,l)=>this.unregisterFile(l)),i}async _loadFile(e,t,i={},n){var s,a;if(t!=null&&t.__loadedAsset)return t.__loadedAsset;this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:0});let o;try{const l=this.registerFile(e,t);if(!l)throw new Error("AssetImporter: Unable to find loader for "+e);this._rootContext={path:e,rootUrl:Qs.extractUrlBase(e)},o=await l.loadAsync(e+(i.queryString?(e.includes("?")?"&":"?")+i.queryString:""),c=>{n&&n(c),this.dispatchEvent({type:"importFile",path:e,state:"downloading",loadedBytes:c.loaded||void 0,totalBytes:c.total||void 0,progress:c.total>0?c.loaded/c.total:1})}),l.transform&&(o=await l.transform(o,i)),this._rootContext=void 0,this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:1}),this.dispatchEvent({type:"importFile",path:e,state:"adding"}),t?this._logger("AssetImporter: loaded",e):this._logger("AssetImporter: downloaded",e),t&&this.unregisterFile(e)}catch(l){return console.error("AssetImporter: Unable to import file",e,t),console.error(l),console.error(l==null?void 0:l.stack),this.dispatchEvent({type:"importFile",path:e,state:"error",error:l}),t&&this.unregisterFile(e),[]}if(this.dispatchEvent({type:"importFile",path:e,state:"done"}),t){t.__loadedAsset=o;let l=[];Array.isArray(o)?l=o.flat(2):(s=o==null?void 0:o.userData)!=null&&s.rootSceneModelRoot?l.push(...o.children):l.push(o);for(const c of l)(a=c==null?void 0:c.addEventListener)==null||a.call(c,"dispose",()=>t.__loadedAsset=void 0)}if(o&&typeof o=="object"&&!Array.isArray(o)){o.__rootPath=e;const l=t||this._fileDatabase.get(e);l&&(o.__rootBlob=l)}return o}registerFile(e,t){var i;const n=e.startsWith("data:")||!1;n||(e=e.replace(/\?.*$/,""));const s=n?void 0:(t==null?void 0:t.ext)??((i=Wv((t==null?void 0:t.name)??e.trim()))==null?void 0:i.toLowerCase()),a=((t==null?void 0:t.mime)??n)&&e.slice(0,e.indexOf(";")).split(":")[1]||void 0;return t&&(t.name===void 0&&(t.name=e),t.ext||(t.ext=s),t.mime||(t.mime=a),this._fileDatabase.has(e)&&(console.warn("AssetImporter: File already registered, replacing",e),this.unregisterFile(e)),this._fileDatabase.set(e,t)),this._getLoader(e)||this._createLoader(e,s,a)}unregisterFile(e){e=e.replace(/\?.*$/,"");const t=this._fileDatabase.get(e);t!=null&&t.objectUrl&&(URL.revokeObjectURL(t.objectUrl),t.objectUrl=void 0),t&&this._fileDatabase.delete(e)}async processRaw(e,t,i){var n,s;if(!e)return[];if(t.processImported!==void 0&&(console.error("AssetImporter: processImported is deprecated, use processRaw instead"),t.processRaw=t.processImported),Array.isArray(e)){const a=[];for(const o of e)a.push(...await this.processRaw(o,t,i));return a}if(t.processRaw===!1)return[e];if(e.assetImporterProcessed&&!t.forceImporterReprocess)return[e];if(this.dispatchEvent({type:"processRawStart",data:e,options:t,path:i}),e.isTexture&&t._testDataTextureComplete&&(e.isDataTexture&&(n=e.image)!=null&&n.data&&(e.image.complete=!0),(s=e.image)!=null&&s.complete&&(e.needsUpdate=!0)),e.userData){const a=e.userData,o=e.__rootPath;!a.rootPath&&o&&!o.startsWith("blob:")&&!o.startsWith("/")&&(a.rootPath=o),e.__rootBlob&&(a.__sourceBlob=e.__rootBlob,a.__needsSourceBuffer&&(a.__sourceBuffer=await e.__rootBlob.arrayBuffer(),delete a.__needsSourceBuffer))}return e.assetImporterProcessed=!0,this.dispatchEvent({type:"processRaw",data:e,options:t,path:i}),e instanceof Map&&t.autoImportZipContents!==!1?[...(await this.importFiles(e,t)).values()].flat():[e]}async processRawSingle(e,t,i){return(await this.processRaw(e,t,i))[0]}dispose(){this.clearCache()}clearCache(){this._cachedAssets=[],this.unregisterAllFiles(),this.clearLoaderCache()}unregisterAllFiles(){const e=[...this._fileDatabase.keys()];for(const t of e)this.unregisterFile(t)}clearLoaderCache(){var e,t;for(const i of this._loaderCache)(e=i.loader)!=null&&e.dispose&&((t=i.loader)==null||t.dispose());this._loaderCache=[]}resolveURL(e){return this._loadingManager.resolveURL(e)}_urlModifier(e){var t;let i=decodeURI(e);const n=(t=this._rootContext)==null?void 0:t.rootUrl;!i.includes("://")&&n&&!i.startsWith(n)&&(i=n+i),i=i.replace("./",""),i=i.replace(/^(\/\/)/,"/"),i=i.replace(/\?.*$/,"");const s=this._fileDatabase.get(i);return s?s.ext?(s.objectUrl||(s.objectUrl=URL.createObjectURL(s)+"#"+i),s.objectUrl):(console.error("Unable to determine file extension",s),e):e}_isRootFile(e,t){return t=t==null?void 0:t.toLowerCase(),e=e==null?void 0:e.toLowerCase(),this.importers.find(i=>i.root&&(e&&i.ext.includes(e.toLowerCase())||t&&i.mime.includes(t.toLowerCase())))!=null}_getImporter(e,t,i,n=!1){return i=i==null?void 0:i.toLowerCase(),t=t==null?void 0:t.toLowerCase(),this.importers.find(s=>{var a;return n&&!s.root?!1:!!(i&&(a=s.mime)!=null&&a.find(o=>i===o)||s.ext.find(o=>{var l;return t&&o===t||((l=e==null?void 0:e.toLowerCase())==null?void 0:l.endsWith("."+o))||(o==null?void 0:o.startsWith("data:"))&&(e==null?void 0:e.startsWith(o))}))})}_getLoader(e,t,i){var n;return!t&&!i&&e&&(t=Wv(e).toLowerCase()),i=i==null?void 0:i.toLowerCase().trim(),t=t==null?void 0:t.toLowerCase().trim(),(e?this._loadingManager.getHandler(e.trim()):void 0)||((n=this._loaderCache.find(s=>t&&s.ext.includes(t)||i&&s.mime.includes(i)))==null?void 0:n.loader)}_createLoader(e,t,i){var n;const s=this._getImporter(e,t,i);if(!s)return;const a=s.ctor(this);if(a)return s.ext.forEach(o=>{const l=new RegExp(o.startsWith("data:")?"^"+o+"\\/":"\\."+o+"$","i");this._loadingManager.addHandler(l,a)}),(n=s.mime)==null||n.forEach(o=>{const l=new RegExp("^data:"+o+"$","i");this._loadingManager.addHandler(l,a)}),this._loaderCache.push({loader:a,ext:s.ext,mime:s.mime}),this.dispatchEvent({type:"loaderCreate",loader:a}),a}addEventListener(e,t){if(super.addEventListener(e,t),e==="loaderCreate")for(const i of this._loaderCache)this.dispatchEvent({type:"loaderCreate",loader:i.loader})}_onLoad(){this.dispatchEvent({type:"onLoad"})}_onProgress(e,t,i){this.dispatchEvent({type:"onProgress",url:e,loaded:t,total:i})}_onError(e){this.dispatchEvent({type:"onError",url:e})}_onStart(e,t,i){this.dispatchEvent({type:"onStart",url:e,loaded:t,total:i})}async processImported(e,t,i){return console.error("processImported is deprecated. Use processRaw instead."),await this.processRaw(e,t,i)}}let Tg,Zy,tu,Ig;function $y(r,e=1/0,t=null){Zy||(Zy=new as(2,2,1,1)),tu||(tu=new yr({uniforms:{blitTexture:new bf(r)},vertexShader:`
            varying vec2 vUv;
            void main(){
                vUv = uv;
                gl_Position = vec4(position.xy * 1.0,0.,.999999);
            }`,fragmentShader:`
            uniform sampler2D blitTexture; 
            varying vec2 vUv;

            void main(){ 
                gl_FragColor = vec4(vUv.xy, 0, 1);
                
                #ifdef IS_SRGB
                gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
                #else
                gl_FragColor = texture2D( blitTexture, vUv);
                #endif
            }`})),tu.uniforms.blitTexture.value=r,tu.defines.IS_SRGB=r.colorSpace==it,tu.needsUpdate=!0,Ig||(Ig=new Fe(Zy,tu),Ig.frustrumCulled=!1);const i=new Qi,n=new Nl;n.add(Ig),t||(t=Tg=new sp({antialias:!1})),t.setSize(Math.min(r.image.width,e),Math.min(r.image.height,e)),t.clear(),t.render(n,i);const s=new Ti(t.domElement);return s.minFilter=r.minFilter,s.magFilter=r.magFilter,s.wrapS=r.wrapS,s.wrapT=r.wrapT,s.name=r.name,Tg&&(Tg.dispose(),Tg=null),s}const TC={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class Pg{constructor(){this.pluginCallbacks=[],this.register(function(e){return new BO(e)}),this.register(function(e){return new LO(e)}),this.register(function(e){return new kO(e)}),this.register(function(e){return new FO(e)}),this.register(function(e){return new NO(e)}),this.register(function(e){return new GO(e)}),this.register(function(e){return new UO(e)}),this.register(function(e){return new OO(e)}),this.register(function(e){return new zO(e)}),this.register(function(e){return new QO(e)}),this.register(function(e){return new VO(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,n,s){const a=s||new UC,o=[];for(let l=0,c=this.pluginCallbacks.length;l<c;l++)o.push(this.pluginCallbacks[l](a));a.setPlugins(o),a.write(e,t,n).catch(i)}parseAsync(e,t){const i=this;return new Promise(function(n,s){i.parse(e,n,s,t)})}}const si={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},e_="KHR_mesh_quantization",Kn={};Kn[Ai]=si.NEAREST,Kn[es]=si.NEAREST_MIPMAP_NEAREST,Kn[Gn]=si.NEAREST_MIPMAP_LINEAR,Kn[Et]=si.LINEAR,Kn[Eo]=si.LINEAR_MIPMAP_NEAREST,Kn[Er]=si.LINEAR_MIPMAP_LINEAR,Kn[ai]=si.CLAMP_TO_EDGE,Kn[Ar]=si.REPEAT,Kn[bs]=si.MIRRORED_REPEAT;const IC={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},CO=new fe,PC=12,MO=1179937895,SO=2,RC=8,TO=1313821514,IO=5130562;function hd(r,e){return r.length===e.length&&r.every(function(t,i){return t===e[i]})}function PO(r){return new TextEncoder().encode(r).buffer}function RO(r){return hd(r.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function DO(r,e,t){const i={min:new Array(r.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(r.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let n=e;n<e+t;n++)for(let s=0;s<r.itemSize;s++){let a;r.itemSize>4?a=r.array[n*r.itemSize+s]:(s===0?a=r.getX(n):s===1?a=r.getY(n):s===2?a=r.getZ(n):s===3&&(a=r.getW(n)),r.normalized===!0&&(a=Zt.normalize(a,r.array))),i.min[s]=Math.min(i.min[s],a),i.max[s]=Math.max(i.max[s],a)}return i}function DC(r){return Math.ceil(r/4)*4}function Rg(r,e=0){const t=DC(r.byteLength);if(t!==r.byteLength){const i=new Uint8Array(t);if(i.set(new Uint8Array(r)),e!==0)for(let n=r.byteLength;n<t;n++)i[n]=e;return i.buffer}return r}function BC(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function LC(r,e){if(r.toBlob!==void 0)return new Promise(i=>r.toBlob(i,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),r.convertToBlob({type:e,quality:t})}class UC{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,i={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const n=this,s=n.buffers,a=n.json;i=n.options;const o=n.extensionsUsed,l=n.extensionsRequired,c=new Blob(s,{type:"application/octet-stream"}),h=Object.keys(o),d=Object.keys(l);if(h.length>0&&(a.extensionsUsed=h),d.length>0&&(a.extensionsRequired=d),a.buffers&&a.buffers.length>0&&(a.buffers[0].byteLength=c.size),i.binary===!0){const m=new FileReader;m.readAsArrayBuffer(c),m.onloadend=function(){const f=Rg(m.result),v=new DataView(new ArrayBuffer(RC));v.setUint32(0,f.byteLength,!0),v.setUint32(4,IO,!0);const w=Rg(PO(JSON.stringify(a)),32),b=new DataView(new ArrayBuffer(RC));b.setUint32(0,w.byteLength,!0),b.setUint32(4,TO,!0);const y=new ArrayBuffer(PC),E=new DataView(y);E.setUint32(0,MO,!0),E.setUint32(4,SO,!0);const _=PC+b.byteLength+w.byteLength+v.byteLength+f.byteLength;E.setUint32(8,_,!0);const C=new Blob([y,b,w,v,f],{type:"application/octet-stream"}),M=new FileReader;M.readAsArrayBuffer(C),M.onloadend=function(){t(M.result)}}}else if(a.buffers&&a.buffers.length>0){const m=new FileReader;m.readAsDataURL(c),m.onloadend=function(){const f=m.result;a.buffers[0].uri=f,t(a)}}else t(a)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const i=this.options,n=this.extensionsUsed;try{const s=JSON.parse(JSON.stringify(e.userData));if(i.includeCustomExtensions&&s.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const a in s.gltfExtensions)t.extensions[a]=s.gltfExtensions[a],n[a]=!0;delete s.gltfExtensions}Object.keys(s).length>0&&(t.extras=s)}catch(s){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+s.message),console.warn({...e.userData})}}getUID(e,t=!1){if(this.uids.has(e)===!1){const i=new Map;i.set(!0,this.uid++),i.set(!1,this.uid++),this.uids.set(e,i)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new P;for(let i=0,n=e.count;i<n;i++)if(Math.abs(t.fromBufferAttribute(e,i).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const i=e.clone(),n=new P;for(let s=0,a=i.count;s<a;s++)n.fromBufferAttribute(i,s),n.x===0&&n.y===0&&n.z===0?n.setX(1):n.normalize(),i.setXYZ(s,n.x,n.y,n.z);return t.attributesNormalized.set(e,i),i}applyTextureTransform(e,t){let i=!1;const n={};(t.offset.x!==0||t.offset.y!==0)&&(n.offset=t.offset.toArray(),i=!0),t.rotation!==0&&(n.rotation=t.rotation,i=!0),(t.repeat.x!==1||t.repeat.y!==1)&&(n.scale=t.repeat.toArray(),i=!0),i&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=n,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function i(m){return m.colorSpace===it?function(f){return f<.04045?f*.0773993808:Math.pow(f*.9478672986+.0521327014,2.4)}:function(f){return f}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof qo&&(e=$y(e)),t instanceof qo&&(t=$y(t));const n=e?e.image:null,s=t?t.image:null,a=Math.max(n?n.width:0,s?s.width:0),o=Math.max(n?n.height:0,s?s.height:0),l=BC();l.width=a,l.height=o;const c=l.getContext("2d");c.fillStyle="#00ffff",c.fillRect(0,0,a,o);const h=c.getImageData(0,0,a,o);if(n){c.drawImage(n,0,0,a,o);const m=i(e),f=c.getImageData(0,0,a,o).data;for(let v=2;v<f.length;v+=4)h.data[v]=m(f[v]/256)*256}if(s){c.drawImage(s,0,0,a,o);const m=i(t),f=c.getImageData(0,0,a,o).data;for(let v=1;v<f.length;v+=4)h.data[v]=m(f[v]/256)*256}c.putImageData(h,0,0);const d=(e||t).clone();return d.source=new Zr(l),d.colorSpace=Xi,d.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),d}processBuffer(e){const t=this.json,i=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),i.push(e),0}processBufferView(e,t,i,n,s){const a=this.json;a.bufferViews||(a.bufferViews=[]);let o;switch(t){case si.BYTE:case si.UNSIGNED_BYTE:o=1;break;case si.SHORT:case si.UNSIGNED_SHORT:o=2;break;default:o=4}const l=DC(n*e.itemSize*o),c=new DataView(new ArrayBuffer(l));let h=0;for(let m=i;m<i+n;m++)for(let f=0;f<e.itemSize;f++){let v;e.itemSize>4?v=e.array[m*e.itemSize+f]:(f===0?v=e.getX(m):f===1?v=e.getY(m):f===2?v=e.getZ(m):f===3&&(v=e.getW(m)),e.normalized===!0&&(v=Zt.normalize(v,e.array))),t===si.FLOAT?c.setFloat32(h,v,!0):t===si.INT?c.setInt32(h,v,!0):t===si.UNSIGNED_INT?c.setUint32(h,v,!0):t===si.SHORT?c.setInt16(h,v,!0):t===si.UNSIGNED_SHORT?c.setUint16(h,v,!0):t===si.BYTE?c.setInt8(h,v):t===si.UNSIGNED_BYTE&&c.setUint8(h,v),h+=o}const d={buffer:this.processBuffer(c.buffer),byteOffset:this.byteOffset,byteLength:l};return s!==void 0&&(d.target=s),s===si.ARRAY_BUFFER&&(d.byteStride=e.itemSize*o),this.byteOffset+=l,a.bufferViews.push(d),{id:a.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,i=t.json;return i.bufferViews||(i.bufferViews=[]),new Promise(function(n){const s=new FileReader;s.readAsArrayBuffer(e),s.onloadend=function(){const a=Rg(s.result),o={buffer:t.processBuffer(a),byteOffset:t.byteOffset,byteLength:a.byteLength};t.byteOffset+=a.byteLength,n(i.bufferViews.push(o)-1)}})}processBufferViewImageBuffer(e){const t=this,i=t.json;i.bufferViews||(i.bufferViews=[]),e=Rg(e);const n={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};return t.byteOffset+=e.byteLength,i.bufferViews.push(n)-1}processAccessor(e,t,i,n){const s=this.json,a={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let o;if(e.array.constructor===Float32Array)o=si.FLOAT;else if(e.array.constructor===Int32Array)o=si.INT;else if(e.array.constructor===Uint32Array)o=si.UNSIGNED_INT;else if(e.array.constructor===Int16Array)o=si.SHORT;else if(e.array.constructor===Uint16Array)o=si.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)o=si.BYTE;else if(e.array.constructor===Uint8Array)o=si.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);if(i===void 0&&(i=0),n===void 0&&(n=e.count),n===0)return null;const l=DO(e,i,n);let c;t!==void 0&&(c=e===t.index?si.ELEMENT_ARRAY_BUFFER:si.ARRAY_BUFFER);const h=this.processBufferView(e,o,i,n,c),d={bufferView:h.id,byteOffset:h.byteOffset,componentType:o,count:n,max:l.max,min:l.min,type:a[e.itemSize]};return e.normalized===!0&&(d.normalized=!0),s.accessors||(s.accessors=[]),s.accessors.push(d)-1}processImage(e,t,i,n="image/png",s=void 0,a=void 0){if(e!==null){const o=this,l=o.cache,c=o.json,h=o.options,d=o.pending;l.images.has(e)||l.images.set(e,{});const m=l.images.get(e),f=n+":flipY/"+i.toString()+(s||a?";"+s+";"+a:"");if(m[f]!==void 0)return m[f];c.images||(c.images=[]);const v={mimeType:n},w=BC();w.width=Math.min(s||e.width,h.maxTextureSize),w.height=Math.min(a||e.height,h.maxTextureSize);const b=w.getContext("2d");if(i===!0&&(b.translate(0,w.height),b.scale(1,-1)),e.data!==void 0){t!==mi&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),(e.width>h.maxTextureSize||e.height>h.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const E=new Uint8ClampedArray(e.height*e.width*4);for(let _=0;_<E.length;_+=4)E[_+0]=e.data[_+0],E[_+1]=e.data[_+1],E[_+2]=e.data[_+2],E[_+3]=e.data[_+3];b.putImageData(new ImageData(E,e.width,e.height),0,0)}else b.drawImage(e,0,0,w.width,w.height);h.binary===!0?d.push(LC(w,n).then(E=>o.processBufferViewImage(E)).then(E=>{v.bufferView=E})):w.toDataURL!==void 0?v.uri=w.toDataURL(n):d.push(LC(w,n).then(E=>new FileReader().readAsDataURL(E)).then(E=>{v.uri=E}));const y=c.images.push(v)-1;return m[f]=y,y}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const i={magFilter:Kn[e.magFilter],minFilter:Kn[e.minFilter],wrapS:Kn[e.wrapS],wrapT:Kn[e.wrapT]};return t.samplers.push(i)-1}processTexture(e){const t=this.options,i=this.cache,n=this.json;if(i.textures.has(e))return i.textures.get(e);n.textures||(n.textures=[]),e instanceof qo&&(e=$y(e,t.maxTextureSize));let s=e.userData.mimeType;s==="image/webp"&&(s="image/png"),s==="image/jpg"&&(s="image/jpeg");const a=["image/jpeg","image/png"],o={sampler:this.processSampler(e),source:!s||a.includes(s)?this.processImage(e.image,e.format,e.flipY,s):null};e.name&&(o.name=e.name),this._invokeAll(function(c){c.writeTexture&&c.writeTexture(e,o)}),o.source===null&&console.error("GLTFExporter: Unsupported mime type: "+s+". Cannot export texture.",e);const l=n.textures.push(o)-1;return i.textures.set(e,l),l}processMaterial(e){const t=this.cache,i=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;i.materials||(i.materials=[]);const n={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const s=e.color.toArray().concat([e.opacity]);if(hd(s,[1,1,1,1])||(n.pbrMetallicRoughness.baseColorFactor=s),e.isMeshStandardMaterial?(n.pbrMetallicRoughness.metallicFactor=e.metalness,n.pbrMetallicRoughness.roughnessFactor=e.roughness):(n.pbrMetallicRoughness.metallicFactor=.5,n.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const o=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),l={index:this.processTexture(o),channel:o.channel};this.applyTextureTransform(l,o),n.pbrMetallicRoughness.metallicRoughnessTexture=l}if(e.map){const o={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(o,e.map),n.pbrMetallicRoughness.baseColorTexture=o}if(e.emissive){const o=e.emissive;if(Math.max(o.r,o.g,o.b)>0&&(n.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const l={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(l,e.emissiveMap),n.emissiveTexture=l}}if(e.normalMap){const o={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(o.scale=e.normalScale.x),this.applyTextureTransform(o,e.normalMap),n.normalTexture=o}if(e.aoMap){const o={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(o.strength=e.aoMapIntensity),this.applyTextureTransform(o,e.aoMap),n.occlusionTexture=o}e.transparent?n.alphaMode="BLEND":e.alphaTest>0&&(n.alphaMode="MASK",n.alphaCutoff=e.alphaTest),e.side===dt&&(n.doubleSided=!0),e.name!==""&&(n.name=e.name),this.serializeUserData(e,n),this._invokeAll(function(o){o.writeMaterial&&o.writeMaterial(e,n)});const a=i.materials.push(n)-1;return t.materials.set(e,a),a}processMesh(e){const t=this.cache,i=this.json,n=[e.geometry.uuid];if(Array.isArray(e.material))for(let _=0,C=e.material.length;_<C;_++)n.push(e.material[_].uuid);else n.push(e.material.uuid);const s=n.join(":");if(t.meshes.has(s))return t.meshes.get(s);const a=e.geometry;let o;e.isLineSegments?o=si.LINES:e.isLineLoop?o=si.LINE_LOOP:e.isLine?o=si.LINE_STRIP:e.isPoints?o=si.POINTS:o=e.material.wireframe?si.LINES:si.TRIANGLES;const l={},c={},h=[],d=[],m={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},f=a.getAttribute("normal");f!==void 0&&!this.isNormalizedNormalAttribute(f)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),a.setAttribute("normal",this.createNormalizedNormalAttribute(f)));let v=null;for(let _ in a.attributes){if(_.slice(0,5)==="morph")continue;const C=a.attributes[_];if(_=m[_]||_.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(_)||(_="_"+_),t.attributes.has(this.getUID(C))){c[_]=t.attributes.get(this.getUID(C));continue}v=null;const M=C.array;_==="JOINTS_0"&&!(M instanceof Uint16Array)&&!(M instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),v=new At(new Uint16Array(M),C.itemSize,C.normalized));const S=this.processAccessor(v||C,a);S!==null&&(_.startsWith("_")||this.detectMeshQuantization(_,C),c[_]=S,t.attributes.set(this.getUID(C),S))}if(f!==void 0&&a.setAttribute("normal",f),Object.keys(c).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const _=[],C=[],M={};if(e.morphTargetDictionary!==void 0)for(const S in e.morphTargetDictionary)M[e.morphTargetDictionary[S]]=S;for(let S=0;S<e.morphTargetInfluences.length;++S){const R={};let U=!1;for(const T in a.morphAttributes){if(T!=="position"&&T!=="normal"){U||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),U=!0);continue}const B=a.morphAttributes[T][S],Q=T.toUpperCase(),Z=a.attributes[T];if(t.attributes.has(this.getUID(B,!0))){R[Q]=t.attributes.get(this.getUID(B,!0));continue}const q=B.clone();if(!a.morphTargetsRelative)for(let X=0,te=B.count;X<te;X++)for(let me=0;me<B.itemSize;me++)me===0&&q.setX(X,B.getX(X)-Z.getX(X)),me===1&&q.setY(X,B.getY(X)-Z.getY(X)),me===2&&q.setZ(X,B.getZ(X)-Z.getZ(X)),me===3&&q.setW(X,B.getW(X)-Z.getW(X));R[Q]=this.processAccessor(q,a),t.attributes.set(this.getUID(Z,!0),R[Q])}d.push(R),_.push(e.morphTargetInfluences[S]),e.morphTargetDictionary!==void 0&&C.push(M[S])}l.weights=_,C.length>0&&(l.extras={},l.extras.targetNames=C)}const w=Array.isArray(e.material);if(w&&a.groups.length===0)return null;const b=w?e.material:[e.material],y=w?a.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let _=0,C=y.length;_<C;_++){const M={mode:o,attributes:c};if(this.serializeUserData(a,M),d.length>0&&(M.targets=d),a.index!==null){let R=this.getUID(a.index);(y[_].start!==void 0||y[_].count!==void 0)&&(R+=":"+y[_].start+":"+y[_].count),t.attributes.has(R)?M.indices=t.attributes.get(R):(M.indices=this.processAccessor(a.index,a,y[_].start,y[_].count),t.attributes.set(R,M.indices)),M.indices===null&&delete M.indices}const S=this.processMaterial(b[y[_].materialIndex]);S!==null&&(M.material=S),h.push(M)}l.primitives=h,i.meshes||(i.meshes=[]),this._invokeAll(function(_){_.writeMesh&&_.writeMesh(e,l)});const E=i.meshes.push(l)-1;return t.meshes.set(s,E),E}detectMeshQuantization(e,t){if(this.extensionsUsed[e_])return;let i;switch(t.array.constructor){case Int8Array:i="byte";break;case Uint8Array:i="unsigned byte";break;case Int16Array:i="short";break;case Uint16Array:i="unsigned short";break;default:return}t.normalized&&(i+=" normalized");const n=e.split("_",1)[0];TC[n]&&TC[n].includes(i)&&(this.extensionsUsed[e_]=!0,this.extensionsRequired[e_]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const i=e.isOrthographicCamera,n={type:i?"orthographic":"perspective"};return i?n.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:n.perspective={aspectRatio:e.aspect,yfov:Zt.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(n.name=e.type),t.cameras.push(n)-1}processAnimation(e,t){const i=this.json,n=this.nodeMap;i.animations||(i.animations=[]),e=Pg.Utils.mergeMorphTargetTracks(e.clone(),t);const s=e.tracks,a=[],o=[];for(let l=0;l<s.length;++l){const c=s[l],h=Ht.parseTrackName(c.name);let d=Ht.findNode(t,h.nodeName);const m=IC[h.propertyName];if(h.objectName==="bones"&&(d.isSkinnedMesh===!0?d=d.skeleton.getBoneByName(h.objectIndex):d=void 0),!d||!m)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',c.name),null;const f=1;let v=c.values.length/c.times.length;m===IC.morphTargetInfluences&&(v/=d.morphTargetInfluences.length);let w;c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(w="CUBICSPLINE",v/=3):c.getInterpolation()===Kr?w="STEP":w="LINEAR",o.push({input:this.processAccessor(new At(c.times,f)),output:this.processAccessor(new At(c.values,v)),interpolation:w}),a.push({sampler:o.length-1,target:{node:n.get(d),path:m}})}return i.animations.push({name:e.name||"clip_"+i.animations.length,samplers:o,channels:a}),i.animations.length-1}processSkin(e){const t=this.json,i=this.nodeMap,n=t.nodes[i.get(e)],s=e.skeleton;if(s===void 0)return null;const a=e.skeleton.bones[0];if(a===void 0)return null;const o=[],l=new Float32Array(s.bones.length*16),c=new et;for(let h=0;h<s.bones.length;++h)o.push(i.get(s.bones[h])),c.copy(s.boneInverses[h]),c.multiply(e.bindMatrix).toArray(l,h*16);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new At(l,16)),joints:o,skeleton:i.get(a)}),n.skin=t.skins.length-1}processNode(e){const t=this.json,i=this.options,n=this.nodeMap;t.nodes||(t.nodes=[]);const s={};if(i.trs){const o=e.quaternion.toArray(),l=e.position.toArray(),c=e.scale.toArray();hd(o,[0,0,0,1])||(s.rotation=o),hd(l,[0,0,0])||(s.translation=l),hd(c,[1,1,1])||(s.scale=c)}else e.matrixAutoUpdate&&e.updateMatrix(),RO(e.matrix)===!1&&(s.matrix=e.matrix.elements);if(e.name!==""&&(s.name=String(e.name)),this.serializeUserData(e,s),e.isMesh||e.isLine||e.isPoints){const o=this.processMesh(e);o!==null&&(s.mesh=o)}else e.isCamera&&(s.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const o=[];for(let l=0,c=e.children.length;l<c;l++){const h=e.children[l];if(h.visible||i.onlyVisible===!1){const d=this.processNode(h);d!==null&&o.push(d)}}o.length>0&&(s.children=o)}this._invokeAll(function(o){o.writeNode&&o.writeNode(e,s)});const a=t.nodes.push(s)-1;return n.set(e,a),a}processScene(e){const t=this.json,i=this.options;t.scenes||(t.scenes=[],t.scene=0);const n={};e.name!==""&&(n.name=e.name),t.scenes.push(n);const s=[];for(let a=0,o=e.children.length;a<o;a++){const l=e.children[a];if(l.visible||i.onlyVisible===!1){const c=this.processNode(l);c!==null&&s.push(c)}}s.length>0&&(n.nodes=s),this.serializeUserData(e,n)}processObjects(e){const t=new Nl;t.name="AuxScene";for(let i=0;i<e.length;i++)t.children.push(e[i]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(n){n.beforeParse&&n.beforeParse(e)});const i=[];for(let n=0;n<e.length;n++)e[n]instanceof Nl?this.processScene(e[n]):i.push(e[n]);i.length>0&&this.processObjects(i);for(let n=0;n<this.skins.length;++n)this.processSkin(this.skins[n]);for(let n=0;n<t.animations.length;++n)this.processAnimation(t.animations[n],e[0]);this._invokeAll(function(n){n.afterParse&&n.afterParse(e)})}_invokeAll(e){for(let t=0,i=this.plugins.length;t<i;t++)e(this.plugins[t])}}class BO{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const i=this.writer,n=i.json,s=i.extensionsUsed,a={};e.name&&(a.name=e.name),a.color=e.color.toArray(),a.intensity=e.intensity,e.isDirectionalLight?a.type="directional":e.isPointLight?(a.type="point",e.distance>0&&(a.range=e.distance)):e.isSpotLight&&(a.type="spot",e.distance>0&&(a.range=e.distance),a.spot={},a.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,a.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),s[this.name]||(n.extensions=n.extensions||{},n.extensions[this.name]={lights:[]},s[this.name]=!0);const o=n.extensions[this.name].lights;o.push(a),t.extensions=t.extensions||{},t.extensions[this.name]={light:o.length-1}}}class LO{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const i=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},i[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class UO{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const i=this.writer,n=i.extensionsUsed,s={};if(s.clearcoatFactor=e.clearcoat,e.clearcoatMap){const a={index:i.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};i.applyTextureTransform(a,e.clearcoatMap),s.clearcoatTexture=a}if(s.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const a={index:i.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};i.applyTextureTransform(a,e.clearcoatRoughnessMap),s.clearcoatRoughnessTexture=a}if(e.clearcoatNormalMap){const a={index:i.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};i.applyTextureTransform(a,e.clearcoatNormalMap),s.clearcoatNormalTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=s,n[this.name]=!0}}class OO{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const i=this.writer,n=i.extensionsUsed,s={};if(s.iridescenceFactor=e.iridescence,e.iridescenceMap){const a={index:i.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};i.applyTextureTransform(a,e.iridescenceMap),s.iridescenceTexture=a}if(s.iridescenceIor=e.iridescenceIOR,s.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],s.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const a={index:i.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};i.applyTextureTransform(a,e.iridescenceThicknessMap),s.iridescenceThicknessTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=s,n[this.name]=!0}}class kO{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const i=this.writer,n=i.extensionsUsed,s={};if(s.transmissionFactor=e.transmission,e.transmissionMap){const a={index:i.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};i.applyTextureTransform(a,e.transmissionMap),s.transmissionTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=s,n[this.name]=!0}}class FO{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const i=this.writer,n=i.extensionsUsed,s={};if(s.thicknessFactor=e.thickness,e.thicknessMap){const a={index:i.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};i.applyTextureTransform(a,e.thicknessMap),s.thicknessTexture=a}s.attenuationDistance=e.attenuationDistance,s.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=s,n[this.name]=!0}}class NO{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const i=this.writer.extensionsUsed,n={};n.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class GO{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(CO)&&!e.specularIntensityMap&&!e.specularColorTexture)return;const i=this.writer,n=i.extensionsUsed,s={};if(e.specularIntensityMap){const a={index:i.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};i.applyTextureTransform(a,e.specularIntensityMap),s.specularTexture=a}if(e.specularColorMap){const a={index:i.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};i.applyTextureTransform(a,e.specularColorMap),s.specularColorTexture=a}s.specularFactor=e.specularIntensity,s.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=s,n[this.name]=!0}}class zO{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.sheen<.001)return;const i=this.writer,n=i.extensionsUsed,s={};if(e.sheenRoughnessMap){const a={index:i.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};i.applyTextureTransform(a,e.sheenRoughnessMap),s.sheenRoughnessTexture=a}if(e.sheenColorMap){const a={index:i.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};i.applyTextureTransform(a,e.sheenColorMap),s.sheenColorTexture=a}s.sheenRoughnessFactor=e.sheenRoughness,s.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=s,t.extras=t.extras||{},t.extras.sheenFactor=e.sheen,n[this.name]=!0}}class QO{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.anisotropy==0)return;const i=this.writer,n=i.extensionsUsed,s={};if(e.anisotropyMap){const a={index:i.processTexture(e.anisotropyMap)};i.applyTextureTransform(a,e.anisotropyMap),s.anisotropyTexture=a}s.anisotropyStrength=e.anisotropy,s.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=s,n[this.name]=!0}}class VO{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const i=this.writer.extensionsUsed,n={};n.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}Pg.Utils={GLTFWriter:UC,insertKeyframe:function(r,e){const t=r.getValueSize(),i=new r.TimeBufferType(r.times.length+1),n=new r.ValueBufferType(r.values.length+t),s=r.createInterpolant(new r.ValueBufferType(t));let a;if(r.times.length===0){i[0]=e;for(let o=0;o<t;o++)n[o]=0;a=0}else if(e<r.times[0]){if(Math.abs(r.times[0]-e)<.001)return 0;i[0]=e,i.set(r.times,1),n.set(s.evaluate(e),0),n.set(r.values,t),a=0}else if(e>r.times[r.times.length-1]){if(Math.abs(r.times[r.times.length-1]-e)<.001)return r.times.length-1;i[i.length-1]=e,i.set(r.times,0),n.set(r.values,0),n.set(s.evaluate(e),r.values.length),a=i.length-1}else for(let o=0;o<r.times.length;o++){if(Math.abs(r.times[o]-e)<.001)return o;if(r.times[o]<e&&r.times[o+1]>e){i.set(r.times.slice(0,o+1),0),i[o+1]=e,i.set(r.times.slice(o+1),o+2),n.set(r.values.slice(0,(o+1)*t),0),n.set(s.evaluate(e),(o+1)*t),n.set(r.values.slice((o+1)*t),(o+2)*t),a=o+1;break}}return r.times=i,r.values=n,a},mergeMorphTargetTracks:function(r,e){const t=[],i={},n=r.tracks;for(let s=0;s<n.length;++s){let a=n[s];const o=Ht.parseTrackName(a.name),l=Ht.findNode(e,o.nodeName);if(o.propertyName!=="morphTargetInfluences"||o.propertyIndex===void 0){t.push(a);continue}if(a.createInterpolant!==a.InterpolantFactoryMethodDiscrete&&a.createInterpolant!==a.InterpolantFactoryMethodLinear){if(a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),a=a.clone(),a.setInterpolation(Cn)}const c=l.morphTargetInfluences.length,h=l.morphTargetDictionary[o.propertyIndex];if(h===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+o.propertyIndex);let d;if(i[l.uuid]===void 0){d=a.clone();const f=new d.ValueBufferType(c*d.times.length);for(let v=0;v<d.times.length;v++)f[v*c+h]=d.values[v];d.name=(o.nodeName||"")+".morphTargetInfluences",d.values=f,i[l.uuid]=d,t.push(d);continue}const m=a.createInterpolant(new a.ValueBufferType(1));d=i[l.uuid];for(let f=0;f<d.times.length;f++)d.values[f*c+h]=m.evaluate(d.times[f]);for(let f=0;f<a.times.length;f++){const v=this.insertKeyframe(d,a.times[f]);d.values[v*c+h]=a.values[f]}}return r.tracks=t,r}};class OC extends Pg.Utils.GLTFWriter{constructor(){super(...arguments),this._defaultMaterial=new fa}serializeUserData(e,t){const i=e.userData,n={};i.__disposed&&console.error("Serializing a disposed object",e),Object.entries(i).forEach(([a,o])=>{(!o||typeof o=="function"||o.isObject3D||o.isTexture||o.isMaterial||o.assetType!=null||a.startsWith("_"))&&(n[a]=o,delete i[a])});const s=Kt.Serialize(i);Object.entries(n).forEach(([a,o])=>{i[a]=o,delete n[a]}),e.userData=s,super.serializeUserData(e,t),e.userData=i}processObjects(e){var t;e.length===1&&(t=e[0])!=null&&t.userData.rootSceneModelRoot?this.processScene(e[0]):super.processObjects(e)}processMaterial(e){if(this.cache.materials.has(e))return this.cache.materials.get(e);let t=e;(!t||t.isShaderMaterial)&&(t=this._defaultMaterial);const i=super.processMaterial(t);if(i===null)return console.error("GLTFWriter2: Unexpected error: Failed to process material",e),null;if(!e||t===e)return i;const n=JSON.stringify(this.json.materials[i]),s=JSON.parse(n);this.serializeUserData(e,s),this._invokeAll(o=>{o.writeMaterial&&o.writeMaterial(e,s)});const a=this.json.materials.push(s)-1;return this.cache.materials.set(e,a),a}processImageBlob(e,t){if(!e)return-1;const i=this.cache,n=this.options,s=this.pending,a=this.json,o=t.image;i.images.has(o)||i.images.set(o,{});const l=i.images.get(o),c=e.type+":flipY/"+t.flipY.toString();if(l[c]!==void 0)return l[c];a.images||(a.images=[]);const h={mimeType:e.type};n.binary===!0?s.push(new Promise(m=>{this.processBufferViewImage(e).then(f=>{h.bufferView=f,m()})})):s.push(Xv(e).then(m=>{h.uri=m}));const d=a.images.push(h)-1;return l[c]=d,d}processSampler(e){return super.processSampler(e)}processTexture(e){const t=this.cache,i=this.json;if(t.textures.has(e))return t.textures.get(e);const n=e.source.data,s=e.userData.mimeType;e.userData.rootPath&&!this.options.exporterOptions.embedUrlImages&&(e.userData.rootPath.startsWith("http")||e.userData.rootPath.startsWith("data:"))&&(e.source.data&&(!this.options.exporterOptions.embedUrlImagePreviews||e.isDataTexture?e.source.data=null:e.source.data._savePreview=!0),delete e.userData.mimeType);const a=super.processTexture(e),o=i.textures[a];if(!o)return console.error("No texture def",a,e),a;const l=i.images?i.images[o.source]:null;if(l&&(l.extras||(l.extras={}),e.source&&(l.extras.uuid=e.source.uuid),l.extras.t_uuid=e.uuid),e.userData.rootPath&&!this.options.exporterOptions.embedUrlImages&&(e.userData.rootPath.startsWith("http")||e.userData.rootPath.startsWith("data:"))){if(e.source.data?delete e.source.data._savePreview:e.source.data=n,e.userData.mimeType=s,!o)return console.error("textureDef is null",a,e),a;if(o.source>=0){const c=this.json.images[o.source];c.uri?console.warn("uri already set",c.uri):(c.uri=e.userData.rootPath,c.mimeType=s,c.extras||(c.extras={}),c.extras.flipY=e.flipY,c.extras.uri=e.userData.rootPath)}else o.source=this.processImageUri(e.image,e.userData.rootPath,e.flipY,s)}return o.source<0&&console.error("textureDef.source cannot be saved",o,e),a}processImage(e,t,i,n="image/png"){return e?super.processImage(e,t,i,n,e._savePreview?32:void 0,e._savePreview?32:void 0):-1}processImageUri(e,t,i,n="image/png"){const s=this.cache,a=this.json;s.images.has(e)||s.images.set(e,{});const o=s.images.get(e),l=n+":flipY/"+i.toString();if(o[l]!==void 0)return o[l];a.images||(a.images=[]);const c={mimeType:n,uri:t,extras:{flipY:i}},h=a.images.push(c)-1;return o[l]=h,h}}const kC=class vS extends Pg{constructor(){super(),this.processors=[],this.processors.push(wC)}register(e){return super.register(e)}async parseAsync(e,t){if(!e)throw new Error("No object to export");let i=!e.__isGLTFOutput&&(Array.isArray(e)||e.isObject3D)?await new Promise((n,s)=>this.parse(e,n,s,t)):e;for(const n of this.processors)i=await n(i,t);if(i&&i instanceof Blob)return i;if(i&&typeof i=="object"&&!i.byteLength)return new Blob([JSON.stringify(i,(n,s)=>n.startsWith("__")?void 0:s,t.jsonSpaces??2)],{type:"model/gltf+json"});if(i)return new Blob([i],{type:"model/gltf+binary"});throw new Error("GLTFExporter2.parse() failed")}parse(e,t,i,n={}){const s={binary:!1,trs:n.trs??!1,onlyVisible:n.onlyVisible??!1,truncateDrawRange:n.truncateDrawRange??!0,externalImagesInExtras:!n.embedUrlImages&&n.externalImagesInExtras||!1,maxTextureSize:n.maxTextureSize??1/0,animations:n.animations??[],includeCustomExtensions:n.includeCustomExtensions??!0,forceIndices:n.forceIndices??!1,exporterOptions:n};return n.exportExt==="glb"&&(s.binary=!0),n.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(a=>a.traverse(o=>{o.uuid&&(o.userData.gltfUUID=o.uuid)})),(Array.isArray(e)?e:[e]).forEach(a=>a.traverse(o=>{if(o.animations)for(const l of o.animations)l.__gltfExport!==!1&&!s.animations.includes(l)&&s.animations.push(...o.animations)})),super.parse(e,a=>{n.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(o=>o.traverse(l=>{delete l.userData.gltfUUID})),t(Object.assign(a,{__isGLTFOutput:!0}))},i,s,new OC)}setup(e,t){for(const i of vS.ExportExtensions)this.register(i);if(t)for(const i of t)this.register(i);return this.register(this.gltfViewerWriter(e)),this}gltfViewerWriter(e){return t=>({afterParse:i=>{var n,s,a,o;i=Array.isArray(i)?i[0]:i,!(!((n=i==null?void 0:i.userData)!=null&&n.rootSceneModelRoot)||((a=(s=t.options)==null?void 0:s.exporterOptions)==null?void 0:a.viewerConfig)===!1||((o=i==null?void 0:i.userData)==null?void 0:o.__exportViewerConfig)===!1)&&qy.ExportViewerConfig(e,t)}})}};kC.ExportExtensions=[Wy.Export,Xy.Export,Hy.Export,od.Export,ld.Export,cd.Export,ad.Export];let FC=kC;class NC{async parseAsync(e,{jsonSpaces:t=2}){return new Blob([JSON.stringify(e,null,t)],{type:"application/json"})}}class GC{async parseAsync(e,t){return new Blob([e],{type:"text/plain"})}}const jO=new TextEncoder,HO=3;class WO{parse(e,t,i){if(!XO(e,t))return;const n=qO(t,i),s=YO(e,t,n),a=KO(s,n),o=JO(a,n);return t3(o,n)}}function XO(r,e){if(e.isWebGLRenderTarget&&(!r||!r.isWebGLRenderer))return console.error("EXRExporter.parse: Unsupported first parameter, expected instance of WebGLRenderer."),!1;if(!e||!e.isWebGLRenderTarget&&!e.isDataTexture)return console.error("EXRExporter.parse: Unsupported second parameter, expected instance of WebGLRenderTarget or DataTexture."),!1;const t=e.isWebGLRenderTarget?e.texture:e;return t.type!==qt&&t.type!==di?(console.error("EXRExporter.parse: Unsupported WebGLRenderTarget or DataTexture texture type."),!1):t.format!==mi?(console.error("EXRExporter.parse: Unsupported WebGLRenderTarget or DataTexture texture format, expected RGBAFormat."),!1):!0}function qO(r,e={}){const t={0:1,2:1,3:16},i=r.isTexture?r:r.texture,n=r.isWebGLRenderTarget?r.width:r.image.width,s=r.isWebGLRenderTarget?r.height:r.image.height,a=i.type,o=i.format,l=i.colorSpace,c=e.compression!==void 0?e.compression:HO,h=e.type!==void 0?e.type:di,d=h===qt?2:1,m=t[c];return{width:n,height:s,type:a,format:o,colorSpace:l,compression:c,blockLines:m,dataType:d,dataSize:2*d,numBlocks:Math.ceil(s/m),numInputChannels:4,numOutputChannels:4,flipY:r.isDataTexture&&r.flipY,textureIndex:e.textureIndex||0}}function YO(r,e,t){if(e.isDataTexture)return e.image.data;let i;return t.type===qt?i=new Float32Array(t.width*t.height*t.numInputChannels):i=new Uint16Array(t.width*t.height*t.numInputChannels),r.readRenderTargetPixels(e,0,0,t.width,t.height,i,void 0,t.textureIndex),i}function KO(r,e){const t=e.width,i=e.height,n={r:0,g:0,b:0,a:0},s={value:0},a=e.numOutputChannels==4?1:0,o=e.type==qt?o3:a3,l=e.dataType==1?r3:t_,c=new Uint8Array(e.width*e.height*e.numOutputChannels*e.dataSize),h=new DataView(c.buffer);for(let d=0;d<i;++d)for(let m=0;m<t;++m){const f=d*t*4+m*4,v=o(r,f),w=o(r,f+1),b=o(r,f+2),y=o(r,f+3),E=(e.flipY?d:i-d-1)*t*(3+a)*e.dataSize;i3(n,v,w,b,y),s.value=E+m*e.dataSize,l(h,n.a,s),s.value=E+a*t*e.dataSize+m*e.dataSize,l(h,n.b,s),s.value=E+(1+a)*t*e.dataSize+m*e.dataSize,l(h,n.g,s),s.value=E+(2+a)*t*e.dataSize+m*e.dataSize,l(h,n.r,s)}return c}function JO(r,e){let t,i,n=0;const s={data:new Array,totalSize:0},a=e.width*e.numOutputChannels*e.blockLines*e.dataSize;switch(e.compression){case 0:t=ZO;break;case 2:case 3:t=$O;break}e.compression!==0&&(i=new Uint8Array(a));for(let o=0;o<e.numBlocks;++o){const l=r.subarray(a*o,a*(o+1)),c=t(l,i);n+=c.length,s.data.push({dataChunk:c,size:c.length})}return s.totalSize=n,s}function ZO(r){return r}function $O(r,e){let t=0,i=Math.floor((r.length+1)/2),n=0;const s=r.length-1;for(;!(n>s||(e[t++]=r[n++],n>s));)e[i++]=r[n++];let a=e[0];for(let o=1;o<e.length;o++){const l=e[o]-a+384;a=e[o],e[o]=l}return wg(e)}function e3(r,e,t){const i={value:0},n=new DataView(r.buffer);fi(n,20000630,i),fi(n,2,i),br(n,"compression",i),br(n,"compression",i),fi(n,1,i),ud(n,t.compression,i),br(n,"screenWindowCenter",i),br(n,"v2f",i),fi(n,8,i),fi(n,0,i),fi(n,0,i),br(n,"screenWindowWidth",i),br(n,"float",i),fi(n,4,i),t_(n,1,i),br(n,"pixelAspectRatio",i),br(n,"float",i),fi(n,4,i),t_(n,1,i),br(n,"lineOrder",i),br(n,"lineOrder",i),fi(n,1,i),ud(n,0,i),br(n,"dataWindow",i),br(n,"box2i",i),fi(n,16,i),fi(n,0,i),fi(n,0,i),fi(n,t.width-1,i),fi(n,t.height-1,i),br(n,"displayWindow",i),br(n,"box2i",i),fi(n,16,i),fi(n,0,i),fi(n,0,i),fi(n,t.width-1,i),fi(n,t.height-1,i),br(n,"channels",i),br(n,"chlist",i),fi(n,t.numOutputChannels*18+1,i),br(n,"A",i),fi(n,t.dataType,i),i.value+=4,fi(n,1,i),fi(n,1,i),br(n,"B",i),fi(n,t.dataType,i),i.value+=4,fi(n,1,i),fi(n,1,i),br(n,"G",i),fi(n,t.dataType,i),i.value+=4,fi(n,1,i),fi(n,1,i),br(n,"R",i),fi(n,t.dataType,i),i.value+=4,fi(n,1,i),fi(n,1,i),ud(n,0,i),ud(n,0,i);let s=i.value+t.numBlocks*8;for(let a=0;a<e.data.length;++a)n3(n,s,i),s+=e.data[a].size+8}function t3(r,e){const t=e.numBlocks*8,i=259+18*e.numOutputChannels,n={value:i+t},s=new Uint8Array(i+t+r.totalSize+e.numBlocks*8),a=new DataView(s.buffer);e3(s,r,e);for(let o=0;o<r.data.length;++o){const l=r.data[o].dataChunk,c=r.data[o].size;fi(a,o*e.blockLines,n),fi(a,c,n),s.set(l,n.value),n.value+=c}return s}function i3(r,e,t,i,n){r.r=e,r.g=t,r.b=i,r.a=n}function ud(r,e,t){r.setUint8(t.value,e),t.value+=1}function fi(r,e,t){r.setUint32(t.value,e,!0),t.value+=4}function r3(r,e,t){r.setUint16(t.value,Ur.toHalfFloat(e),!0),t.value+=2}function t_(r,e,t){r.setFloat32(t.value,e,!0),t.value+=4}function n3(r,e,t){r.setBigUint64(t.value,BigInt(e),!0),t.value+=8}function br(r,e,t){const i=jO.encode(e+"\0");for(let n=0;n<i.length;++n)ud(r,i[n],t)}function s3(r){const e=(r&31744)>>10,t=r&1023;return(r>>15?-1:1)*(e?e===31?t?NaN:1/0:Math.pow(2,e-15)*(1+t/1024):6103515625e-14*(t/1024))}function a3(r,e){return s3(r[e])}function o3(r,e){return r[e]}class i_ extends WO{async parseAsync(e,t){const i=e;if(i.isWebGLRenderTarget&&!i.renderManager)throw new Error("No renderManager on renderTarget");if(!i.isWebGLRenderTarget&&!e.isDataTexture)throw new Error("Invalid object type");i.isWebGLMultipleRenderTargets&&t.textureIndex===void 0&&console.warn("No textureIndex specified for WebGLMultipleRenderTargets");const n=i.isWebGLRenderTarget?this.parse(i.renderManager.webglRenderer,i,t):this.parse(void 0,e,t);return new Blob([n],{type:"image/x-exr"})}}class zC extends zi{constructor(){super(),this.exporters=[{ctor:()=>new NC,ext:["json"]},{ctor:()=>new GC,ext:["txt","text"]},{ctor:()=>new i_,ext:["exr"]}],this._cachedParsers=[]}addExporter(...e){for(const t of e){if(this.exporters.includes(t)){console.warn("Exporter already added",t);return}this.exporters.push(t)}}removeExporter(...e){for(const t of e){const i=this.exporters.indexOf(t);i>=0&&this.exporters.splice(i,1)}}getExporter(...e){return this.exporters.find(t=>t.ext.some(i=>e.includes(i)))}async exportObject(e,t={}){var i;if(!(e!=null&&e.assetType)){console.error("Object has no asset type");return}const n=[];e.assetType==="model"&&e.traverse(a=>{a.userData.excludeFromExport&&a.visible&&(a.visible=!1,n.push(a))});const s=await this._exportFile(e,t);return e.assetType==="model"&&n.forEach(a=>a.visible=!0),(i=e==null?void 0:e.userData)!=null&&i.rootSceneModelRoot&&t.viewerConfig===!1&&delete e.userData.__exportViewerConfig,s}async _exportFile(e,t={}){let i;try{this.dispatchEvent({type:"exportFile",obj:e,state:"processing",exportOptions:t});const n=await this.processBeforeExport(e,t),s=t.exportExt||(n==null?void 0:n.typeExt)||(n==null?void 0:n.ext);if(!n||!s)throw console.error(n,t,e),new Error(`Unable to preprocess before export ${s}`);if(n.blob)i=n.blob;else{const a=this._getParser(s);this.dispatchEvent({type:"exportFile",obj:e,state:"exporting"}),i=await a.parseAsync(n.obj,{exportExt:n.ext??s,...t}),i.ext=n.ext}this.dispatchEvent({type:"exportFile",obj:e,state:"done"})}catch(n){throw console.error("AssetExporter: Unable to Export file",e),this.dispatchEvent({type:"exportFile",obj:e,state:"error",error:n}),n}return i}_createParser(e){const t=this.exporters.find(n=>n.ext.includes(e));if(!t)throw new Error(`No exporter found for extension ${e}`);const i=t==null?void 0:t.ctor(this,t);if(!i)throw new Error(`Unable to create parser for extension ${e}`);return this._cachedParsers.push({ext:t.ext,parser:i}),this.dispatchEvent({type:"exporterCreate",exporter:t,parser:i}),i}_getParser(e){var t;return((t=this._cachedParsers.find(i=>i.ext.includes(e)))==null?void 0:t.parser)??this._createParser(e)}async processBeforeExport(e,t={}){var i;switch(e.assetType){case"light":console.error("AssetExporter: light export not implemented");return;case"model":return{obj:e,ext:"glb"};case"material":return{obj:e.toJSON(),ext:((i=e.constructor)==null?void 0:i.TypeSlug)||"json",typeExt:"json"};case"texture":return t.exportExt?{obj:e,ext:t.exportExt}:{obj:e.toJSON(),ext:"json"};case"renderTarget":if(e.isWebGLMultipleRenderTargets)console.error("AssetExporter: WebGLMultipleRenderTargets export not supported");else if(e.renderManager){const n=e.renderManager.exportRenderTarget(e,t.exportExt&&t.exportExt!=="auto"?t.exportExt==="exr"?"image/x-exr":"image/"+t.exportExt:"auto");return{obj:e,ext:n.ext,blob:n}}else return{obj:e,ext:"exr"};break;default:console.error("AssetExporter: unknown asset type",e.assetType)}}dispose(){}}class QC extends zi{constructor(){super(),this.templates=[xa.MaterialTemplate,kh.MaterialTemplate,Xp.MaterialTemplate,mc.MaterialTemplate,cE.MaterialTemplate],this._materials=[],this._disposeMaterial=e=>{const t=e.target;!t||t.assetType!=="material"||(t.setDirty(),this._getMapsForMaterial(t).forEach(i=>!i.isRenderTargetTexture&&i.userData.disposeOnIdle!==!1&&i.dispose&&!Sh(i)&&i.dispose()))},this._materialMaps=new Map,this._materialUpdate=e=>{const t=e.material||e.target;!t||t.assetType!=="material"||this._refreshTextureRefs(t)},this._textureUpdate=function(e){!this||this.assetType!=="material"||this.dispatchEvent({texture:e.target,bubbleToParent:!0,bubbleToObject:!0,...e,type:"textureUpdate"})},this._materialExtensions=[]}findOrCreate(e,t){let i=this.findMaterial(e);return i||(i=this.create(e,t)),i}create(e,t={},i=!0){let n={materialType:e,name:e};for(;!n.generator;){const a=this.findTemplate(n.materialType);if(!a){console.warn("Template has no generator or materialType",n,e);return}n={...n,...a}}const s=this._create(n,t);return s&&i&&this.registerMaterial(s),s}_create(e,t){if(!e.generator){console.error("Template has no generator",e);return}const i=(t==null?void 0:t.metadata)&&(t==null?void 0:t.metadata.version)<=4.5,n=cr.enabled;i&&(cr.enabled=!1);const s=e.generator(e.params||{});return t&&s&&s.setValues(t,!0),i&&(cr.enabled=n),s}findTemplate(e,t=!1){if(e)return this.templates.find(i=>(i.name===e||i.materialType===e)&&(!t||i.generator))||this.templates.find(i=>{var n;return((n=i.alias)==null?void 0:n.includes(e))&&(!t||i.generator)})}_getMapsForMaterial(e){const t=new Set;for(const i of Object.values(e))i&&i.isTexture&&t.add(i);for(const i of Object.values(e.userData??{}))i&&i.isTexture&&t.add(i);return t}_refreshTextureRefs(e){e.__textureUpdate||(e.__textureUpdate=this._textureUpdate.bind(e));const t=this._getMapsForMaterial(e),i=this._materialMaps.get(e.uuid)||new Set;for(const n of t)i.has(n)||(n._appliedMaterials||(n._appliedMaterials=new Set),n._appliedMaterials.add(e),n.addEventListener("update",e.__textureUpdate));for(const n of i){if(t.has(n)||(n.removeEventListener("update",e.__textureUpdate),!n._appliedMaterials))continue;const s=n._appliedMaterials;s==null||s.delete(e),!(!s||n.userData.disposeOnIdle===!1)&&s.size===0&&n.dispose()}this._materialMaps.set(e.uuid,t)}registerMaterial(e){var t;if(!e||this._materials.includes(e))return;const i=this.findMaterial(e.uuid);if(i){console.warn("Material UUID already exists",e,i);return}e.addEventListener("dispose",this._disposeMaterial),e.addEventListener("materialUpdate",this._materialUpdate),(t=e.registerMaterialExtensions)==null||t.call(e,this._materialExtensions),this._materials.push(e),this._refreshTextureRefs(e)}registerMaterials(e){e.forEach(t=>this.registerMaterial(t))}unregisterMaterial(e){var t;this._materials=this._materials.filter(i=>i.uuid!==e.uuid),(t=e.unregisterMaterialExtensions)==null||t.call(e,this._materialExtensions),e.removeEventListener("dispose",this._disposeMaterial),e.removeEventListener("materialUpdate",this._materialUpdate)}clearMaterials(){[...this._materials].forEach(e=>this.unregisterMaterial(e))}registerMaterialTemplate(e){e.templateUUID||(e.templateUUID=hs());const t=this.templates.find(i=>i.templateUUID===e.templateUUID);if(t){console.error("MaterialTemplate already exists",e,t);return}this.templates.push(e)}unregisterMaterialTemplate(e){const t=this.templates.findIndex(i=>i.templateUUID===e.templateUUID);t>=0&&this.templates.splice(t,1)}dispose(e=!0){const t=this._materials;this._materials=[];for(const i of t){if(!e&&i.userData.runtimeMaterial){this._materials.push(i);continue}i.dispose()}}findMaterial(e){return e?this._materials.find(t=>t.uuid===e):void 0}findMaterialsByName(e,t=!1){return this._materials.filter(i=>typeof e!="string"||t?i.name.match(typeof e=="string"?"^"+e+"$":e)!==null:i.name===e)}getMaterialsOfType(e){return e?this._materials.filter(t=>t.constructor.TypeSlug===e):[]}getAllMaterials(){return[...this._materials]}convertToIMaterial(e,{useSourceMaterial:t=!0,materialTemplate:i,createFromTemplate:n=!0}={}){var s,a;if(!e)return;if(e.assetType)return e;if((s=e.iMaterial)!=null&&s.assetType)return e.iMaterial;const o=((a=e.userData)==null?void 0:a.uuid)||e.uuid;let l=this.findMaterial(o);if(!l&&n!==!1){const c=t===!1||!e.isMaterial,h=i||!c&&e.type&&e.type||"physical";l=this.create(h,c?void 0:e)}else l&&(console.warn("Material with the same uuid already exists, copying properties"),e.type!==l.type&&console.error("Material type mismatch, delete previous material first?",e,l),l.setValues(e));return l?(l.uuid=o,l.userData.uuid=o,e.iMaterial=l):(console.warn("Failed to convert material to IMaterial, just upgrading",e,t,i),l=Qe.upgradeMaterial.call(e)),l}registerMaterialExtension(e){var t;if(!this._materialExtensions.includes(e)){this._materialExtensions.push(e);for(const i of this._materials)(t=i.registerMaterialExtensions)==null||t.call(i,[e])}}unregisterMaterialExtension(e){var t;const i=this._materialExtensions.indexOf(e);if(!(i<0)){this._materialExtensions.splice(i,1);for(const n of this._materials)(t=n.unregisterMaterialExtensions)==null||t.call(n,[e])}}clearExtensions(){[...this._materialExtensions].forEach(e=>this.unregisterMaterialExtension(e))}exportMaterial(e,t,i=!0,n=!1){const s=e.toJSON(),a=JSON.stringify(s,null,i?0:2),o=(t||e.name||"physical_material")+"."+e.constructor.TypeSlug,l=new File([a],o,{type:"application/json"});return n&&Nw(l),l}applyMaterial(e,t){const i=Object.getPrototypeOf(e).constructor.TYPE;let n=this.findMaterialsByName(t,!0);(!n||n.length<1)&&(n=[this.findMaterial(t)]);let s=!1;for(const a of n)if(!(!a||a===e||a.userData.__isVariation))if(Object.getPrototypeOf(a).constructor.TYPE===i){const o=a.name;a.setValues(e),a.name=o,s=!0}else{const o=a["__"+i]||this.create(i);if(!o)continue;const l=a.name;o.setValues(e),o.name=l;const c=a.appliedMeshes;for(const h of[...c??[]])h&&(h.material=o,s=!0);a["__"+i]=o}return s}}class l3 extends Rv{constructor(e){super(e),this.type=di}parse(e){const t=function(d,m){switch(d){case 1:console.error("THREE.RGBELoader Read Error: "+(m||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(m||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(m||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(m||""))}return-1},i=`
`,n=function(d,m,f){m=m||1024;let v=d.pos,w=-1,b=0,y="",E=String.fromCharCode.apply(null,new Uint16Array(d.subarray(v,v+128)));for(;0>(w=E.indexOf(i))&&b<m&&v<d.byteLength;)y+=E,b+=E.length,v+=128,E+=String.fromCharCode.apply(null,new Uint16Array(d.subarray(v,v+128)));return-1<w?(d.pos+=b+w+1,y+E.slice(0,w)):!1},s=function(d){const m=/^#\?(\S+)/,f=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,v=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,w=/^\s*FORMAT=(\S+)\s*$/,b=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,y={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let E,_;if(d.pos>=d.byteLength||!(E=n(d)))return t(1,"no header found");if(!(_=E.match(m)))return t(3,"bad initial token");for(y.valid|=1,y.programtype=_[1],y.string+=E+`
`;E=n(d),E!==!1;){if(y.string+=E+`
`,E.charAt(0)==="#"){y.comments+=E+`
`;continue}if((_=E.match(f))&&(y.gamma=parseFloat(_[1])),(_=E.match(v))&&(y.exposure=parseFloat(_[1])),(_=E.match(w))&&(y.valid|=2,y.format=_[1]),(_=E.match(b))&&(y.valid|=4,y.height=parseInt(_[1],10),y.width=parseInt(_[2],10)),y.valid&2&&y.valid&4)break}return y.valid&2?y.valid&4?y:t(3,"missing image size specifier"):t(3,"missing format specifier")},a=function(d,m,f){const v=m;if(v<8||v>32767||d[0]!==2||d[1]!==2||d[2]&128)return new Uint8Array(d);if(v!==(d[2]<<8|d[3]))return t(3,"wrong scanline width");const w=new Uint8Array(4*m*f);if(!w.length)return t(4,"unable to allocate buffer space");let b=0,y=0;const E=4*v,_=new Uint8Array(4),C=new Uint8Array(E);let M=f;for(;M>0&&y<d.byteLength;){if(y+4>d.byteLength)return t(1);if(_[0]=d[y++],_[1]=d[y++],_[2]=d[y++],_[3]=d[y++],_[0]!=2||_[1]!=2||(_[2]<<8|_[3])!=v)return t(3,"bad rgbe scanline format");let S=0,R;for(;S<E&&y<d.byteLength;){R=d[y++];const T=R>128;if(T&&(R-=128),R===0||S+R>E)return t(3,"bad scanline data");if(T){const B=d[y++];for(let Q=0;Q<R;Q++)C[S++]=B}else C.set(d.subarray(y,y+R),S),S+=R,y+=R}const U=v;for(let T=0;T<U;T++){let B=0;w[b]=C[T+B],B+=v,w[b+1]=C[T+B],B+=v,w[b+2]=C[T+B],B+=v,w[b+3]=C[T+B],b+=4}M--}return w},o=function(d,m,f,v){const w=d[m+3],b=Math.pow(2,w-128)/255;f[v+0]=d[m+0]*b,f[v+1]=d[m+1]*b,f[v+2]=d[m+2]*b,f[v+3]=1},l=function(d,m,f,v){const w=d[m+3],b=Math.pow(2,w-128)/255;f[v+0]=Ur.toHalfFloat(Math.min(d[m+0]*b,65504)),f[v+1]=Ur.toHalfFloat(Math.min(d[m+1]*b,65504)),f[v+2]=Ur.toHalfFloat(Math.min(d[m+2]*b,65504)),f[v+3]=Ur.toHalfFloat(1)},c=new Uint8Array(e);c.pos=0;const h=s(c);if(h!==-1){const d=h.width,m=h.height,f=a(c.subarray(c.pos),d,m);if(f!==-1){let v,w,b;switch(this.type){case qt:b=f.length/4;const y=new Float32Array(b*4);for(let _=0;_<b;_++)o(f,_*4,y,_*4);v=y,w=qt;break;case di:b=f.length/4;const E=new Uint16Array(b*4);for(let _=0;_<b;_++)l(f,_*4,E,_*4);v=E,w=di;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:d,height:m,data:v,header:h.string,gamma:h.gamma,exposure:h.exposure,type:w}}}return null}setDataType(e){return this.type=e,this}load(e,t,i,n){function s(a,o){switch(a.type){case qt:case di:a.colorSpace=wi,a.minFilter=Et,a.magFilter=Et,a.generateMipmaps=!1,a.flipY=!0;break}t&&t(a,o)}return super.load(e,s,i,n)}}function VC(r,e,t){const i=t.length-r-1;if(e>=t[i])return i-1;if(e<=t[r])return r;let n=r,s=i,a=Math.floor((n+s)/2);for(;e<t[a]||e>=t[a+1];)e<t[a]?s=a:n=a,a=Math.floor((n+s)/2);return a}function c3(r,e,t,i){const n=[],s=[],a=[];n[0]=1;for(let o=1;o<=t;++o){s[o]=e-i[r+1-o],a[o]=i[r+o]-e;let l=0;for(let c=0;c<o;++c){const h=a[c+1],d=s[o-c],m=n[c]/(h+d);n[c]=l+h*m,l=d*m}n[o]=l}return n}function h3(r,e,t,i){const n=VC(r,i,e),s=c3(n,i,r,e),a=new bt(0,0,0,0);for(let o=0;o<=r;++o){const l=t[n-r+o],c=s[o],h=l.w*c;a.x+=l.x*h,a.y+=l.y*h,a.z+=l.z*h,a.w+=l.w*c}return a}function u3(r,e,t,i,n){const s=[];for(let d=0;d<=t;++d)s[d]=0;const a=[];for(let d=0;d<=i;++d)a[d]=s.slice(0);const o=[];for(let d=0;d<=t;++d)o[d]=s.slice(0);o[0][0]=1;const l=s.slice(0),c=s.slice(0);for(let d=1;d<=t;++d){l[d]=e-n[r+1-d],c[d]=n[r+d]-e;let m=0;for(let f=0;f<d;++f){const v=c[f+1],w=l[d-f];o[d][f]=v+w;const b=o[f][d-1]/o[d][f];o[f][d]=m+v*b,m=w*b}o[d][d]=m}for(let d=0;d<=t;++d)a[0][d]=o[d][t];for(let d=0;d<=t;++d){let m=0,f=1;const v=[];for(let w=0;w<=t;++w)v[w]=s.slice(0);v[0][0]=1;for(let w=1;w<=i;++w){let b=0;const y=d-w,E=t-w;d>=w&&(v[f][0]=v[m][0]/o[E+1][y],b=v[f][0]*o[y][E]);const _=y>=-1?1:-y,C=d-1<=E?w-1:t-d;for(let S=_;S<=C;++S)v[f][S]=(v[m][S]-v[m][S-1])/o[E+1][y+S],b+=v[f][S]*o[y+S][E];d<=E&&(v[f][w]=-v[m][w-1]/o[E+1][d],b+=v[f][w]*o[d][E]),a[w][d]=b;const M=m;m=f,f=M}}let h=t;for(let d=1;d<=i;++d){for(let m=0;m<=t;++m)a[d][m]*=h;h*=t-d}return a}function p3(r,e,t,i,n){const s=n<r?n:r,a=[],o=VC(r,i,e),l=u3(o,i,r,s,e),c=[];for(let h=0;h<t.length;++h){const d=t[h].clone(),m=d.w;d.x*=m,d.y*=m,d.z*=m,c[h]=d}for(let h=0;h<=s;++h){const d=c[o-r].clone().multiplyScalar(l[h][0]);for(let m=1;m<=r;++m)d.add(c[o-r+m].clone().multiplyScalar(l[h][m]));a[h]=d}for(let h=s+1;h<=n+1;++h)a[h]=new bt(0,0,0);return a}function d3(r,e){let t=1;for(let n=2;n<=r;++n)t*=n;let i=1;for(let n=2;n<=e;++n)i*=n;for(let n=2;n<=r-e;++n)i*=n;return t/i}function m3(r){const e=r.length,t=[],i=[];for(let s=0;s<e;++s){const a=r[s];t[s]=new P(a.x,a.y,a.z),i[s]=a.w}const n=[];for(let s=0;s<e;++s){const a=t[s].clone();for(let o=1;o<=s;++o)a.sub(n[s-o].clone().multiplyScalar(d3(s,o)*i[o]));n[s]=a.divideScalar(i[0])}return n}function f3(r,e,t,i,n){const s=p3(r,e,t,i,n);return m3(s)}class g3 extends os{constructor(e,t,i,n,s){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=n||0,this.endKnot=s||this.knots.length-1;for(let a=0;a<i.length;++a){const o=i[a];this.controlPoints[a]=new bt(o.x,o.y,o.z,o.w)}}getPoint(e,t=new P){const i=t,n=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=h3(this.degree,this.knots,this.controlPoints,n);return s.w!==1&&s.divideScalar(s.w),i.set(s.x,s.y,s.z)}getTangent(e,t=new P){const i=t,n=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),s=f3(this.degree,this.knots,this.controlPoints,n,1);return i.copy(s[1]).normalize(),i}}let Jt,ar,_n;class A3 extends $i{constructor(e){super(e)}load(e,t,i,n){const s=this,a=s.path===""?Qs.extractUrlBase(e):s.path,o=new bi(this.manager);o.setPath(s.path),o.setResponseType("arraybuffer"),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(l){try{t(s.parse(l,a))}catch(c){n?n(c):console.error(c),s.manager.itemError(e)}},i,n)}parse(e,t){if(x3(e))Jt=new w3().parse(e);else{const s=YC(e);if(!E3(s))throw new Error("THREE.FBXLoader: Unknown format.");if(WC(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+WC(s));Jt=new b3().parse(s)}const i=new Ko(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),n=new v3(i,this.manager).parse(Jt);return Jt=null,ar=null,_n=null,n}}class v3{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){ar=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),i=this.parseMaterials(t),n=this.parseDeformers(),s=new y3().parse(n);return this.parseScene(n,s,i),_n}parseConnections(){const e=new Map;return"Connections"in Jt&&Jt.Connections.connections.forEach(function(t){const i=t[0],n=t[1],s=t[2];e.has(i)||e.set(i,{parents:[],children:[]});const a={ID:n,relationship:s};e.get(i).parents.push(a),e.has(n)||e.set(n,{parents:[],children:[]});const o={ID:i,relationship:s};e.get(n).children.push(o)}),e}parseImages(){const e={},t={};if("Video"in Jt.Objects){const i=Jt.Objects.Video;for(const n in i){const s=i[n],a=parseInt(n);if(e[a]=s.RelativeFilename||s.Filename,"Content"in s){const o=s.Content instanceof ArrayBuffer&&s.Content.byteLength>0,l=typeof s.Content=="string"&&s.Content!=="";if(o||l){const c=this.parseImage(i[n]);t[s.RelativeFilename||s.Filename]=c}}}}for(const i in e){const n=e[i];t[n]!==void 0?e[i]=t[n]:e[i]=e[i].split("\\").pop()}return e}parseImage(e){const t=e.Content,i=e.RelativeFilename||e.Filename,n=i.slice(i.lastIndexOf(".")+1).toLowerCase();let s;switch(n){case"bmp":s="image/bmp";break;case"jpg":case"jpeg":s="image/jpeg";break;case"png":s="image/png";break;case"tif":s="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",i),s="image/tga";break;default:console.warn('FBXLoader: Image type "'+n+'" is not supported.');return}if(typeof t=="string")return"data:"+s+";base64,"+t;{const a=new Uint8Array(t);return window.URL.createObjectURL(new Blob([a],{type:s}))}}parseTextures(e){const t=new Map;if("Texture"in Jt.Objects){const i=Jt.Objects.Texture;for(const n in i){const s=this.parseTexture(i[n],e);t.set(parseInt(n),s)}}return t}parseTexture(e,t){const i=this.loadTexture(e,t);i.ID=e.id,i.name=e.attrName;const n=e.WrapModeU,s=e.WrapModeV,a=n!==void 0?n.value:0,o=s!==void 0?s.value:0;if(i.wrapS=a===0?Ar:ai,i.wrapT=o===0?Ar:ai,"Scaling"in e){const l=e.Scaling.value;i.repeat.x=l[0],i.repeat.y=l[1]}if("Translation"in e){const l=e.Translation.value;i.offset.x=l[0],i.offset.y=l[1]}return i}loadTexture(e,t){let i;const n=this.textureLoader.path,s=ar.get(e.id).children;s!==void 0&&s.length>0&&t[s[0].ID]!==void 0&&(i=t[s[0].ID],(i.indexOf("blob:")===0||i.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let a;const o=e.FileName.slice(-3).toLowerCase();if(o==="tga"){const l=this.manager.getHandler(".tga");l===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),a=new Ti):(l.setPath(this.textureLoader.path),a=l.load(i))}else o==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),a=new Ti):a=this.textureLoader.load(i);return this.textureLoader.setPath(n),a}parseMaterials(e){const t=new Map;if("Material"in Jt.Objects){const i=Jt.Objects.Material;for(const n in i){const s=this.parseMaterial(i[n],e);s!==null&&t.set(parseInt(n),s)}}return t}parseMaterial(e,t){const i=e.id,n=e.attrName;let s=e.ShadingModel;if(typeof s=="object"&&(s=s.value),!ar.has(i))return null;const a=this.parseParameters(e,t,i);let o;switch(s.toLowerCase()){case"phong":o=new Vl;break;case"lambert":o=new Ev;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),o=new Vl;break}return o.setValues(a),o.name=n,o}parseParameters(e,t,i){const n={};e.BumpFactor&&(n.bumpScale=e.BumpFactor.value),e.Diffuse?n.color=new fe().fromArray(e.Diffuse.value).convertSRGBToLinear():e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(n.color=new fe().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(n.displacementScale=e.DisplacementFactor.value),e.Emissive?n.emissive=new fe().fromArray(e.Emissive.value).convertSRGBToLinear():e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(n.emissive=new fe().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(n.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(n.opacity=parseFloat(e.Opacity.value)),n.opacity<1&&(n.transparent=!0),e.ReflectionFactor&&(n.reflectivity=e.ReflectionFactor.value),e.Shininess&&(n.shininess=e.Shininess.value),e.Specular?n.specular=new fe().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&e.SpecularColor.type==="Color"&&(n.specular=new fe().fromArray(e.SpecularColor.value).convertSRGBToLinear());const s=this;return ar.get(i).children.forEach(function(a){const o=a.relationship;switch(o){case"Bump":n.bumpMap=s.getTexture(t,a.ID);break;case"Maya|TEX_ao_map":n.aoMap=s.getTexture(t,a.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":n.map=s.getTexture(t,a.ID),n.map!==void 0&&(n.map.colorSpace=it);break;case"DisplacementColor":n.displacementMap=s.getTexture(t,a.ID);break;case"EmissiveColor":n.emissiveMap=s.getTexture(t,a.ID),n.emissiveMap!==void 0&&(n.emissiveMap.colorSpace=it);break;case"NormalMap":case"Maya|TEX_normal_map":n.normalMap=s.getTexture(t,a.ID);break;case"ReflectionColor":n.envMap=s.getTexture(t,a.ID),n.envMap!==void 0&&(n.envMap.mapping=_s,n.envMap.colorSpace=it);break;case"SpecularColor":n.specularMap=s.getTexture(t,a.ID),n.specularMap!==void 0&&(n.specularMap.colorSpace=it);break;case"TransparentColor":case"TransparencyFactor":n.alphaMap=s.getTexture(t,a.ID),n.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",o);break}}),n}getTexture(e,t){return"LayeredTexture"in Jt.Objects&&t in Jt.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=ar.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in Jt.Objects){const i=Jt.Objects.Deformer;for(const n in i){const s=i[n],a=ar.get(parseInt(n));if(s.attrType==="Skin"){const o=this.parseSkeleton(a,i);o.ID=n,a.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),o.geometryID=a.parents[0].ID,e[n]=o}else if(s.attrType==="BlendShape"){const o={id:n};o.rawTargets=this.parseMorphTargets(a,i),o.id=n,a.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[n]=o}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const i=[];return e.children.forEach(function(n){const s=t[n.ID];if(s.attrType!=="Cluster")return;const a={ID:n.ID,indices:[],weights:[],transformLink:new et().fromArray(s.TransformLink.a)};"Indexes"in s&&(a.indices=s.Indexes.a,a.weights=s.Weights.a),i.push(a)}),{rawBones:i,bones:[]}}parseMorphTargets(e,t){const i=[];for(let n=0;n<e.children.length;n++){const s=e.children[n],a=t[s.ID],o={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if(a.attrType!=="BlendShapeChannel")return;o.geoID=ar.get(parseInt(s.ID)).children.filter(function(l){return l.relationship===void 0})[0].ID,i.push(o)}return i}parseScene(e,t,i){_n=new fn;const n=this.parseModels(e.skeletons,t,i),s=Jt.Objects.Model,a=this;n.forEach(function(l){const c=s[l.ID];a.setLookAtProperties(l,c),ar.get(l.ID).parents.forEach(function(h){const d=n.get(h.ID);d!==void 0&&d.add(l)}),l.parent===null&&_n.add(l)}),this.bindSkeleton(e.skeletons,t,n),this.createAmbientLight(),_n.traverse(function(l){if(l.userData.transformData){l.parent&&(l.userData.transformData.parentMatrix=l.parent.matrix,l.userData.transformData.parentMatrixWorld=l.parent.matrixWorld);const c=XC(l.userData.transformData);l.applyMatrix4(c),l.updateWorldMatrix()}});const o=new _3().parse();_n.children.length===1&&_n.children[0].isGroup&&(_n.children[0].animations=o,_n=_n.children[0]),_n.animations=o}parseModels(e,t,i){const n=new Map,s=Jt.Objects.Model;for(const a in s){const o=parseInt(a),l=s[a],c=ar.get(o);let h=this.buildSkeleton(c,e,o,l.attrName);if(!h){switch(l.attrType){case"Camera":h=this.createCamera(c);break;case"Light":h=this.createLight(c);break;case"Mesh":h=this.createMesh(c,t,i);break;case"NurbsCurve":h=this.createCurve(c,t);break;case"LimbNode":case"Root":h=new vh;break;case"Null":default:h=new fn;break}h.name=l.attrName?Ht.sanitizeNodeName(l.attrName):"",h.ID=o}this.getTransformData(h,l),n.set(o,h)}return n}buildSkeleton(e,t,i,n){let s=null;return e.parents.forEach(function(a){for(const o in t){const l=t[o];l.rawBones.forEach(function(c,h){if(c.ID===a.ID){const d=s;s=new vh,s.matrixWorld.copy(c.transformLink),s.name=n?Ht.sanitizeNodeName(n):"",s.ID=i,l.bones[h]=s,d!==null&&s.add(d)}})}}),s}createCamera(e){let t,i;if(e.children.forEach(function(n){const s=Jt.Objects.NodeAttribute[n.ID];s!==void 0&&(i=s)}),i===void 0)t=new It;else{let n=0;i.CameraProjectionType!==void 0&&i.CameraProjectionType.value===1&&(n=1);let s=1;i.NearPlane!==void 0&&(s=i.NearPlane.value/1e3);let a=1e3;i.FarPlane!==void 0&&(a=i.FarPlane.value/1e3);let o=window.innerWidth,l=window.innerHeight;i.AspectWidth!==void 0&&i.AspectHeight!==void 0&&(o=i.AspectWidth.value,l=i.AspectHeight.value);const c=o/l;let h=45;i.FieldOfView!==void 0&&(h=i.FieldOfView.value);const d=i.FocalLength?i.FocalLength.value:null;switch(n){case 0:t=new Qi(h,c,s,a),d!==null&&t.setFocalLength(d);break;case 1:t=new ua(-o/2,o/2,l/2,-l/2,s,a);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+n+"."),t=new It;break}}return t}createLight(e){let t,i;if(e.children.forEach(function(n){const s=Jt.Objects.NodeAttribute[n.ID];s!==void 0&&(i=s)}),i===void 0)t=new It;else{let n;i.LightType===void 0?n=0:n=i.LightType.value;let s=16777215;i.Color!==void 0&&(s=new fe().fromArray(i.Color.value).convertSRGBToLinear());let a=i.Intensity===void 0?1:i.Intensity.value/100;i.CastLightOnObject!==void 0&&i.CastLightOnObject.value===0&&(a=0);let o=0;i.FarAttenuationEnd!==void 0&&(i.EnableFarAttenuation!==void 0&&i.EnableFarAttenuation.value===0?o=0:o=i.FarAttenuationEnd.value);const l=1;switch(n){case 0:t=new Kl(s,a,o,l);break;case 1:t=new Ch(s,a);break;case 2:let c=Math.PI/3;i.InnerAngle!==void 0&&(c=Zt.degToRad(i.InnerAngle.value));let h=0;i.OuterAngle!==void 0&&(h=Zt.degToRad(i.OuterAngle.value),h=Math.max(h,1)),t=new Eh(s,a,o,c,h,l);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a PointLight."),t=new Kl(s,a);break}i.CastShadows!==void 0&&i.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,i){let n,s=null,a=null;const o=[];return e.children.forEach(function(l){t.has(l.ID)&&(s=t.get(l.ID)),i.has(l.ID)&&o.push(i.get(l.ID))}),o.length>1?a=o:o.length>0?a=o[0]:(a=new Vl({color:13421772}),o.push(a)),"color"in s.attributes&&o.forEach(function(l){l.vertexColors=!0}),s.FBX_Deformer?(n=new Nm(s,a),n.normalizeSkinWeights()):n=new Fe(s,a),n}createCurve(e,t){const i=e.children.reduce(function(s,a){return t.has(a.ID)&&(s=t.get(a.ID)),s},null),n=new Ji({color:3342591,linewidth:1});return new Tr(i,n)}getTransformData(e,t){const i={};"InheritType"in t&&(i.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?i.eulerOrder=qC(t.RotationOrder.value):i.eulerOrder="ZYX","Lcl_Translation"in t&&(i.translation=t.Lcl_Translation.value),"PreRotation"in t&&(i.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(i.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(i.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(i.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(i.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(i.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(i.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(i.rotationPivot=t.RotationPivot.value),e.userData.transformData=i}setLookAtProperties(e,t){"LookAtProperty"in t&&ar.get(e.ID).children.forEach(function(i){if(i.relationship==="LookAtProperty"){const n=Jt.Objects.Model[i.ID];if("Lcl_Translation"in n){const s=n.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(s),_n.add(e.target)):e.lookAt(new P().fromArray(s))}}})}bindSkeleton(e,t,i){const n=this.parsePoseNodes();for(const s in e){const a=e[s];ar.get(parseInt(a.ID)).parents.forEach(function(o){if(t.has(o.ID)){const l=o.ID;ar.get(l).parents.forEach(function(c){i.has(c.ID)&&i.get(c.ID).bind(new yh(a.bones),n[c.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in Jt.Objects){const t=Jt.Objects.Pose;for(const i in t)if(t[i].attrType==="BindPose"&&t[i].NbPoseNodes>0){const n=t[i].PoseNode;Array.isArray(n)?n.forEach(function(s){e[s.Node]=new et().fromArray(s.Matrix.a)}):e[n.Node]=new et().fromArray(n.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in Jt&&"AmbientColor"in Jt.GlobalSettings){const e=Jt.GlobalSettings.AmbientColor.value,t=e[0],i=e[1],n=e[2];if(t!==0||i!==0||n!==0){const s=new fe(t,i,n).convertSRGBToLinear();_n.add(new ff(s,1))}}}}class y3{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in Jt.Objects){const i=Jt.Objects.Geometry;for(const n in i){const s=ar.get(parseInt(n)),a=this.parseGeometry(s,i[n],e);t.set(parseInt(n),a)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,i){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,i);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,i){const n=i.skeletons,s=[],a=e.parents.map(function(d){return Jt.Objects.Model[d.ID]});if(a.length===0)return;const o=e.children.reduce(function(d,m){return n[m.ID]!==void 0&&(d=n[m.ID]),d},null);e.children.forEach(function(d){i.morphTargets[d.ID]!==void 0&&s.push(i.morphTargets[d.ID])});const l=a[0],c={};"RotationOrder"in l&&(c.eulerOrder=qC(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);const h=XC(c);return this.genGeometry(t,o,s,h)}genGeometry(e,t,i,n){const s=new ht;e.attrName&&(s.name=e.attrName);const a=this.parseGeoNode(e,t),o=this.genBuffers(a),l=new Ne(o.vertex,3);if(l.applyMatrix4(n),s.setAttribute("position",l),o.colors.length>0&&s.setAttribute("color",new Ne(o.colors,3)),t&&(s.setAttribute("skinIndex",new ih(o.weightsIndices,4)),s.setAttribute("skinWeight",new Ne(o.vertexWeights,4)),s.FBX_Deformer=t),o.normal.length>0){const c=new Bt().getNormalMatrix(n),h=new Ne(o.normal,3);h.applyNormalMatrix(c),s.setAttribute("normal",h)}if(o.uvs.forEach(function(c,h){const d=h===0?"uv":`uv${h}`;s.setAttribute(d,new Ne(o.uvs[h],2))}),a.material&&a.material.mappingType!=="AllSame"){let c=o.materialIndex[0],h=0;if(o.materialIndex.forEach(function(d,m){d!==c&&(s.addGroup(h,m-h,c),c=d,h=m)}),s.groups.length>0){const d=s.groups[s.groups.length-1],m=d.start+d.count;m!==o.materialIndex.length&&s.addGroup(m,o.materialIndex.length-m,c)}s.groups.length===0&&s.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(s,e,i,n),s}parseGeoNode(e,t){const i={};if(i.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],i.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(i.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(i.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(i.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){i.uv=[];let n=0;for(;e.LayerElementUV[n];)e.LayerElementUV[n].UV&&i.uv.push(this.parseUVs(e.LayerElementUV[n])),n++}return i.weightTable={},t!==null&&(i.skeleton=t,t.rawBones.forEach(function(n,s){n.indices.forEach(function(a,o){i.weightTable[a]===void 0&&(i.weightTable[a]=[]),i.weightTable[a].push({id:s,weight:n.weights[o]})})})),i}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let i=0,n=0,s=!1,a=[],o=[],l=[],c=[],h=[],d=[];const m=this;return e.vertexIndices.forEach(function(f,v){let w,b=!1;f<0&&(f=f^-1,b=!0);let y=[],E=[];if(a.push(f*3,f*3+1,f*3+2),e.color){const _=Dg(v,i,f,e.color);l.push(_[0],_[1],_[2])}if(e.skeleton){if(e.weightTable[f]!==void 0&&e.weightTable[f].forEach(function(_){E.push(_.weight),y.push(_.id)}),E.length>4){s||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),s=!0);const _=[0,0,0,0],C=[0,0,0,0];E.forEach(function(M,S){let R=M,U=y[S];C.forEach(function(T,B,Q){if(R>T){Q[B]=R,R=T;const Z=_[B];_[B]=U,U=Z}})}),y=_,E=C}for(;E.length<4;)E.push(0),y.push(0);for(let _=0;_<4;++_)h.push(E[_]),d.push(y[_])}if(e.normal){const _=Dg(v,i,f,e.normal);o.push(_[0],_[1],_[2])}e.material&&e.material.mappingType!=="AllSame"&&(w=Dg(v,i,f,e.material)[0],w<0&&(m.negativeMaterialIndices=!0,w=0)),e.uv&&e.uv.forEach(function(_,C){const M=Dg(v,i,f,_);c[C]===void 0&&(c[C]=[]),c[C].push(M[0]),c[C].push(M[1])}),n++,b&&(n>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),m.genFace(t,e,a,w,o,l,c,h,d,n),i++,n=0,a=[],o=[],l=[],c=[],h=[],d=[])}),t}genFace(e,t,i,n,s,a,o,l,c,h){for(let d=2;d<h;d++)e.vertex.push(t.vertexPositions[i[0]]),e.vertex.push(t.vertexPositions[i[1]]),e.vertex.push(t.vertexPositions[i[2]]),e.vertex.push(t.vertexPositions[i[(d-1)*3]]),e.vertex.push(t.vertexPositions[i[(d-1)*3+1]]),e.vertex.push(t.vertexPositions[i[(d-1)*3+2]]),e.vertex.push(t.vertexPositions[i[d*3]]),e.vertex.push(t.vertexPositions[i[d*3+1]]),e.vertex.push(t.vertexPositions[i[d*3+2]]),t.skeleton&&(e.vertexWeights.push(l[0]),e.vertexWeights.push(l[1]),e.vertexWeights.push(l[2]),e.vertexWeights.push(l[3]),e.vertexWeights.push(l[(d-1)*4]),e.vertexWeights.push(l[(d-1)*4+1]),e.vertexWeights.push(l[(d-1)*4+2]),e.vertexWeights.push(l[(d-1)*4+3]),e.vertexWeights.push(l[d*4]),e.vertexWeights.push(l[d*4+1]),e.vertexWeights.push(l[d*4+2]),e.vertexWeights.push(l[d*4+3]),e.weightsIndices.push(c[0]),e.weightsIndices.push(c[1]),e.weightsIndices.push(c[2]),e.weightsIndices.push(c[3]),e.weightsIndices.push(c[(d-1)*4]),e.weightsIndices.push(c[(d-1)*4+1]),e.weightsIndices.push(c[(d-1)*4+2]),e.weightsIndices.push(c[(d-1)*4+3]),e.weightsIndices.push(c[d*4]),e.weightsIndices.push(c[d*4+1]),e.weightsIndices.push(c[d*4+2]),e.weightsIndices.push(c[d*4+3])),t.color&&(e.colors.push(a[0]),e.colors.push(a[1]),e.colors.push(a[2]),e.colors.push(a[(d-1)*3]),e.colors.push(a[(d-1)*3+1]),e.colors.push(a[(d-1)*3+2]),e.colors.push(a[d*3]),e.colors.push(a[d*3+1]),e.colors.push(a[d*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(n),e.materialIndex.push(n),e.materialIndex.push(n)),t.normal&&(e.normal.push(s[0]),e.normal.push(s[1]),e.normal.push(s[2]),e.normal.push(s[(d-1)*3]),e.normal.push(s[(d-1)*3+1]),e.normal.push(s[(d-1)*3+2]),e.normal.push(s[d*3]),e.normal.push(s[d*3+1]),e.normal.push(s[d*3+2])),t.uv&&t.uv.forEach(function(m,f){e.uvs[f]===void 0&&(e.uvs[f]=[]),e.uvs[f].push(o[f][0]),e.uvs[f].push(o[f][1]),e.uvs[f].push(o[f][(d-1)*2]),e.uvs[f].push(o[f][(d-1)*2+1]),e.uvs[f].push(o[f][d*2]),e.uvs[f].push(o[f][d*2+1])})}addMorphTargets(e,t,i,n){if(i.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const s=this;i.forEach(function(a){a.rawTargets.forEach(function(o){const l=Jt.Objects.Geometry[o.geoID];l!==void 0&&s.genMorphGeometry(e,t,l,n,o.name)})})}genMorphGeometry(e,t,i,n,s){const a=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],o=i.Vertices!==void 0?i.Vertices.a:[],l=i.Indexes!==void 0?i.Indexes.a:[],c=e.attributes.position.count*3,h=new Float32Array(c);for(let v=0;v<l.length;v++){const w=l[v]*3;h[w]=o[v*3],h[w+1]=o[v*3+1],h[w+2]=o[v*3+2]}const d={vertexIndices:a,vertexPositions:h},m=this.genBuffers(d),f=new Ne(m.vertex,3);f.name=s||i.attrName,f.applyMatrix4(n),e.morphAttributes.position.push(f)}parseNormals(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.Normals.a;let s=[];return i==="IndexToDirect"&&("NormalIndex"in e?s=e.NormalIndex.a:"NormalsIndex"in e&&(s=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:s,mappingType:t,referenceType:i}}parseUVs(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.UV.a;let s=[];return i==="IndexToDirect"&&(s=e.UVIndex.a),{dataSize:2,buffer:n,indices:s,mappingType:t,referenceType:i}}parseVertexColors(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.Colors.a;let s=[];i==="IndexToDirect"&&(s=e.ColorIndex.a);for(let a=0,o=new fe;a<n.length;a+=4)o.fromArray(n,a).convertSRGBToLinear().toArray(n,a);return{dataSize:4,buffer:n,indices:s,mappingType:t,referenceType:i}}parseMaterialIndices(e){const t=e.MappingInformationType,i=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};const n=e.Materials.a,s=[];for(let a=0;a<n.length;++a)s.push(a);return{dataSize:1,buffer:n,indices:s,mappingType:t,referenceType:i}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new ht;const i=t-1,n=e.KnotVector.a,s=[],a=e.Points.a;for(let h=0,d=a.length;h<d;h+=4)s.push(new bt().fromArray(a,h));let o,l;if(e.Form==="Closed")s.push(s[0]);else if(e.Form==="Periodic"){o=i,l=n.length-1-o;for(let h=0;h<i;++h)s.push(s[h])}const c=new g3(i,n,s,o,l).getPoints(s.length*12);return new ht().setFromPoints(c)}}class _3{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const i in t){const n=t[i],s=this.addClip(n);e.push(s)}return e}parseClips(){if(Jt.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=Jt.Objects.AnimationCurveNode,t=new Map;for(const i in e){const n=e[i];if(n.attrName.match(/S|R|T|DeformPercent/)!==null){const s={id:n.id,attr:n.attrName,curves:{}};t.set(s.id,s)}}return t}parseAnimationCurves(e){const t=Jt.Objects.AnimationCurve;for(const i in t){const n={id:t[i].id,times:t[i].KeyTime.a.map(C3),values:t[i].KeyValueFloat.a},s=ar.get(n.id);if(s!==void 0){const a=s.parents[0].ID,o=s.parents[0].relationship;o.match(/X/)?e.get(a).curves.x=n:o.match(/Y/)?e.get(a).curves.y=n:o.match(/Z/)?e.get(a).curves.z=n:o.match(/DeformPercent/)&&e.has(a)&&(e.get(a).curves.morph=n)}}}parseAnimationLayers(e){const t=Jt.Objects.AnimationLayer,i=new Map;for(const n in t){const s=[],a=ar.get(parseInt(n));a!==void 0&&(a.children.forEach(function(o,l){if(e.has(o.ID)){const c=e.get(o.ID);if(c.curves.x!==void 0||c.curves.y!==void 0||c.curves.z!==void 0){if(s[l]===void 0){const h=ar.get(o.ID).parents.filter(function(d){return d.relationship!==void 0})[0].ID;if(h!==void 0){const d=Jt.Objects.Model[h.toString()];if(d===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",o);return}const m={modelName:d.attrName?Ht.sanitizeNodeName(d.attrName):"",ID:d.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};_n.traverse(function(f){f.ID===d.id&&(m.transform=f.matrix,f.userData.transformData&&(m.eulerOrder=f.userData.transformData.eulerOrder))}),m.transform||(m.transform=new et),"PreRotation"in d&&(m.preRotation=d.PreRotation.value),"PostRotation"in d&&(m.postRotation=d.PostRotation.value),s[l]=m}}s[l]&&(s[l][c.attr]=c)}else if(c.curves.morph!==void 0){if(s[l]===void 0){const h=ar.get(o.ID).parents.filter(function(b){return b.relationship!==void 0})[0].ID,d=ar.get(h).parents[0].ID,m=ar.get(d).parents[0].ID,f=ar.get(m).parents[0].ID,v=Jt.Objects.Model[f],w={modelName:v.attrName?Ht.sanitizeNodeName(v.attrName):"",morphName:Jt.Objects.Deformer[h].attrName};s[l]=w}s[l][c.attr]=c}}}),i.set(parseInt(n),s))}return i}parseAnimStacks(e){const t=Jt.Objects.AnimationStack,i={};for(const n in t){const s=ar.get(parseInt(n)).children;s.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const a=e.get(s[0].ID);i[n]={name:t[n].attrName,layer:a}}return i}addClip(e){let t=[];const i=this;return e.layer.forEach(function(n){t=t.concat(i.generateTracks(n))}),new Yl(e.name,-1,t)}generateTracks(e){const t=[];let i=new P,n=new Ct,s=new P;if(e.transform&&e.transform.decompose(i,n,s),i=i.toArray(),n=new Di().setFromQuaternion(n,e.eulerOrder).toArray(),s=s.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const a=this.generateVectorTrack(e.modelName,e.T.curves,i,"position");a!==void 0&&t.push(a)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const a=this.generateRotationTrack(e.modelName,e.R.curves,n,e.preRotation,e.postRotation,e.eulerOrder);a!==void 0&&t.push(a)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const a=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");a!==void 0&&t.push(a)}if(e.DeformPercent!==void 0){const a=this.generateMorphTrack(e);a!==void 0&&t.push(a)}return t}generateVectorTrack(e,t,i,n){const s=this.getTimesForAllAxes(t),a=this.getKeyframeTrackValues(s,t,i);return new ql(e+"."+n,s,a)}generateRotationTrack(e,t,i,n,s,a){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(Zt.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(Zt.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(Zt.degToRad));const o=this.getTimesForAllAxes(t),l=this.getKeyframeTrackValues(o,t,i);n!==void 0&&(n=n.map(Zt.degToRad),n.push(a),n=new Di().fromArray(n),n=new Ct().setFromEuler(n)),s!==void 0&&(s=s.map(Zt.degToRad),s.push(a),s=new Di().fromArray(s),s=new Ct().setFromEuler(s).invert());const c=new Ct,h=new Di,d=[];for(let m=0;m<l.length;m+=3)h.set(l[m],l[m+1],l[m+2],a),c.setFromEuler(h),n!==void 0&&c.premultiply(n),s!==void 0&&c.multiply(s),c.toArray(d,m/3*4);return new to(e+".quaternion",o,d)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,i=t.values.map(function(s){return s/100}),n=_n.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new Wl(e.modelName+".morphTargetInfluences["+n+"]",t.times,i)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(i,n){return i-n}),t.length>1){let i=1,n=t[0];for(let s=1;s<t.length;s++){const a=t[s];a!==n&&(t[i]=a,n=a,i++)}t=t.slice(0,i)}return t}getKeyframeTrackValues(e,t,i){const n=i,s=[];let a=-1,o=-1,l=-1;return e.forEach(function(c){if(t.x&&(a=t.x.times.indexOf(c)),t.y&&(o=t.y.times.indexOf(c)),t.z&&(l=t.z.times.indexOf(c)),a!==-1){const h=t.x.values[a];s.push(h),n[0]=h}else s.push(n[0]);if(o!==-1){const h=t.y.values[o];s.push(h),n[1]=h}else s.push(n[1]);if(l!==-1){const h=t.z.values[l];s.push(h),n[2]=h}else s.push(n[2])}),s}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const i=e.values[t-1],n=e.values[t]-i,s=Math.abs(n);if(s>=180){const a=s/180,o=n/a;let l=i+o;const c=e.times[t-1],h=(e.times[t]-c)/a;let d=c+h;const m=[],f=[];for(;d<e.times[t];)m.push(d),d+=h,f.push(l),l+=o;e.times=KC(e.times,t,m),e.values=KC(e.values,t,f)}}}}class b3{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new HC,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,i=e.split(/[\r\n]+/);return i.forEach(function(n,s){const a=n.match(/^[\s\t]*;/),o=n.match(/^[\s\t]*$/);if(a||o)return;const l=n.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),c=n.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),h=n.match("^\\t{"+(t.currentIndent-1)+"}}");l?t.parseNodeBegin(n,l):c?t.parseNodeProperty(n,c,i[++s]):h?t.popStack():n.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(n)}),this.allNodes}parseNodeBegin(e,t){const i=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map(function(l){return l.trim().replace(/^"/,"").replace(/"$/,"")}),s={name:i},a=this.parseNodeAttr(n),o=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(i,s):i in o?(i==="PoseNode"?o.PoseNode.push(s):o[i].id!==void 0&&(o[i]={},o[i][o[i].id]=o[i]),a.id!==""&&(o[i][a.id]=s)):typeof a.id=="number"?(o[i]={},o[i][a.id]=s):i!=="Properties70"&&(i==="PoseNode"?o[i]=[s]:o[i]=s),typeof a.id=="number"&&(s.id=a.id),a.name!==""&&(s.attrName=a.name),a.type!==""&&(s.attrType=a.type),this.pushStack(s)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let i="",n="";return e.length>1&&(i=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:i,type:n}}parseNodeProperty(e,t,i){let n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),s=t[2].replace(/^"/,"").replace(/"$/,"").trim();n==="Content"&&s===","&&(s=i.replace(/"/g,"").replace(/,$/,"").trim());const a=this.getCurrentNode();if(a.name==="Properties70"){this.parseNodeSpecialProperty(e,n,s);return}if(n==="C"){const o=s.split(",").slice(1),l=parseInt(o[0]),c=parseInt(o[1]);let h=s.split(",").slice(3);h=h.map(function(d){return d.trim().replace(/^"/,"")}),n="connections",s=[l,c],S3(s,h),a[n]===void 0&&(a[n]=[])}n==="Node"&&(a.id=s),n in a&&Array.isArray(a[n])?a[n].push(s):n!=="a"?a[n]=s:a.a=s,this.setCurrentProp(a,n),n==="a"&&s.slice(-1)!==","&&(a.a=n_(s))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=n_(t.a))}parseNodeSpecialProperty(e,t,i){const n=i.split('",').map(function(h){return h.trim().replace(/^\"/,"").replace(/\s/,"_")}),s=n[0],a=n[1],o=n[2],l=n[3];let c=n[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=n_(c);break}this.getPrevNode()[s]={type:a,type2:o,flag:l,value:c},this.setCurrentProp(this.getPrevNode(),s)}}class w3{parse(e){const t=new jC(e);t.skip(23);const i=t.getUint32();if(i<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);const n=new HC;for(;!this.endOfContent(t);){const s=this.parseNode(t,i);s!==null&&n.add(s.name,s)}return n}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const i={},n=t>=7500?e.getUint64():e.getUint32(),s=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const a=e.getUint8(),o=e.getString(a);if(n===0)return null;const l=[];for(let m=0;m<s;m++)l.push(this.parseProperty(e));const c=l.length>0?l[0]:"",h=l.length>1?l[1]:"",d=l.length>2?l[2]:"";for(i.singleProperty=s===1&&e.getOffset()===n;n>e.getOffset();){const m=this.parseNode(e,t);m!==null&&this.parseSubNode(o,i,m)}return i.propertyList=l,typeof c=="number"&&(i.id=c),h!==""&&(i.attrName=h),d!==""&&(i.attrType=d),o!==""&&(i.name=o),i}parseSubNode(e,t,i){if(i.singleProperty===!0){const n=i.propertyList[0];Array.isArray(n)?(t[i.name]=i,i.a=n):t[i.name]=n}else if(e==="Connections"&&i.name==="C"){const n=[];i.propertyList.forEach(function(s,a){a!==0&&n.push(s)}),t.connections===void 0&&(t.connections=[]),t.connections.push(n)}else if(i.name==="Properties70")Object.keys(i).forEach(function(n){t[n]=i[n]});else if(e==="Properties70"&&i.name==="P"){let n=i.propertyList[0],s=i.propertyList[1];const a=i.propertyList[2],o=i.propertyList[3];let l;n.indexOf("Lcl ")===0&&(n=n.replace("Lcl ","Lcl_")),s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),s==="Color"||s==="ColorRGB"||s==="Vector"||s==="Vector3D"||s.indexOf("Lcl_")===0?l=[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:l=i.propertyList[4],t[n]={type:s,type2:a,flag:o,value:l}}else t[i.name]===void 0?typeof i.id=="number"?(t[i.name]={},t[i.name][i.id]=i):t[i.name]=i:i.name==="PoseNode"?(Array.isArray(t[i.name])||(t[i.name]=[t[i.name]]),t[i.name].push(i)):t[i.name][i.id]===void 0&&(t[i.name][i.id]=i)}parseProperty(e){const t=e.getString(1);let i;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return i=e.getUint32(),e.getArrayBuffer(i);case"S":return i=e.getUint32(),e.getString(i);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const n=e.getUint32(),s=e.getUint32(),a=e.getUint32();if(s===0)switch(t){case"b":case"c":return e.getBooleanArray(n);case"d":return e.getFloat64Array(n);case"f":return e.getFloat32Array(n);case"i":return e.getInt32Array(n);case"l":return e.getInt64Array(n)}const o=co(new Uint8Array(e.getArrayBuffer(a))),l=new jC(o.buffer);switch(t){case"b":case"c":return l.getBooleanArray(n);case"d":return l.getFloat64Array(n);case"f":return l.getFloat32Array(n);case"i":return l.getInt32Array(n);case"l":return l.getInt64Array(n)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class jC{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let i=0;i<e;i++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let i=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const n=i.indexOf(0);return n>=0&&(i=new Uint8Array(this.dv.buffer,t,n)),this._textDecoder.decode(i)}}class HC{add(e,t){this[e]=t}}function x3(r){const e="Kaydara FBX Binary  \0";return r.byteLength>=e.length&&e===YC(r,0,e.length)}function E3(r){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function i(n){const s=r[n-1];return r=r.slice(t+n),t++,s}for(let n=0;n<e.length;++n)if(i(1)===e[n])return!1;return!0}function WC(r){const e=/FBXVersion: (\d+)/,t=r.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function C3(r){return r/46186158e3}const M3=[];function Dg(r,e,t,i){let n;switch(i.mappingType){case"ByPolygonVertex":n=r;break;case"ByPolygon":n=e;break;case"ByVertice":n=t;break;case"AllSame":n=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}i.referenceType==="IndexToDirect"&&(n=i.indices[n]);const s=n*i.dataSize,a=s+i.dataSize;return T3(M3,i.buffer,s,a)}const r_=new Di,iu=new P;function XC(r){const e=new et,t=new et,i=new et,n=new et,s=new et,a=new et,o=new et,l=new et,c=new et,h=new et,d=new et,m=new et,f=r.inheritType?r.inheritType:0;if(r.translation&&e.setPosition(iu.fromArray(r.translation)),r.preRotation){const B=r.preRotation.map(Zt.degToRad);B.push(r.eulerOrder||Di.DEFAULT_ORDER),t.makeRotationFromEuler(r_.fromArray(B))}if(r.rotation){const B=r.rotation.map(Zt.degToRad);B.push(r.eulerOrder||Di.DEFAULT_ORDER),i.makeRotationFromEuler(r_.fromArray(B))}if(r.postRotation){const B=r.postRotation.map(Zt.degToRad);B.push(r.eulerOrder||Di.DEFAULT_ORDER),n.makeRotationFromEuler(r_.fromArray(B)),n.invert()}r.scale&&s.scale(iu.fromArray(r.scale)),r.scalingOffset&&o.setPosition(iu.fromArray(r.scalingOffset)),r.scalingPivot&&a.setPosition(iu.fromArray(r.scalingPivot)),r.rotationOffset&&l.setPosition(iu.fromArray(r.rotationOffset)),r.rotationPivot&&c.setPosition(iu.fromArray(r.rotationPivot)),r.parentMatrixWorld&&(d.copy(r.parentMatrix),h.copy(r.parentMatrixWorld));const v=t.clone().multiply(i).multiply(n),w=new et;w.extractRotation(h);const b=new et;b.copyPosition(h);const y=b.clone().invert().multiply(h),E=w.clone().invert().multiply(y),_=s,C=new et;if(f===0)C.copy(w).multiply(v).multiply(E).multiply(_);else if(f===1)C.copy(w).multiply(E).multiply(v).multiply(_);else{const B=new et().scale(new P().setFromMatrixScale(d)).clone().invert(),Q=E.clone().multiply(B);C.copy(w).multiply(v).multiply(Q).multiply(_)}const M=c.clone().invert(),S=a.clone().invert();let R=e.clone().multiply(l).multiply(c).multiply(t).multiply(i).multiply(n).multiply(M).multiply(o).multiply(a).multiply(s).multiply(S);const U=new et().copyPosition(R),T=h.clone().multiply(U);return m.copyPosition(T),R=m.clone().multiply(C),R.premultiply(h.invert()),R}function qC(r){r=r||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return r===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[r]}function n_(r){return r.split(",").map(function(e){return parseFloat(e)})}function YC(r,e,t){return e===void 0&&(e=0),t===void 0&&(t=r.byteLength),new TextDecoder().decode(new Uint8Array(r,e,t))}function S3(r,e){for(let t=0,i=r.length,n=e.length;t<n;t++,i++)r[i]=e[t]}function T3(r,e,t,i){for(let n=t,s=0;n<i;n++,s++)r[s]=e[n];return r}function KC(r,e,t){return r.slice(0,e).concat(t).concat(r.slice(e))}class I3 extends Rv{constructor(e){super(e),this.type=di}parse(e){const t=Math.pow(2.7182818,2.2);function i(I,k){let L=0;for(let z=0;z<65536;++z)(z==0||I[z>>3]&1<<(z&7))&&(k[L++]=z);const j=L-1;for(;L<65536;)k[L++]=0;return j}function n(I){for(let k=0;k<16384;k++)I[k]={},I[k].len=0,I[k].lit=0,I[k].p=null}const s={l:0,c:0,lc:0};function a(I,k,L,j,z){for(;L<I;)k=k<<8|Y(j,z),L+=8;L-=I,s.l=k>>L&(1<<I)-1,s.c=k,s.lc=L}const o=new Array(59);function l(I){for(let L=0;L<=58;++L)o[L]=0;for(let L=0;L<65537;++L)o[I[L]]+=1;let k=0;for(let L=58;L>0;--L){const j=k+o[L]>>1;o[L]=k,k=j}for(let L=0;L<65537;++L){const j=I[L];j>0&&(I[L]=j|o[j]++<<6)}}function c(I,k,L,j,z,J){const ae=k;let Re=0,Le=0;for(;j<=z;j++){if(ae.value-k.value>L)return!1;a(6,Re,Le,I,ae);const Se=s.l;if(Re=s.c,Le=s.lc,J[j]=Se,Se==63){if(ae.value-k.value>L)throw new Error("Something wrong with hufUnpackEncTable");a(8,Re,Le,I,ae);let ke=s.l+6;if(Re=s.c,Le=s.lc,j+ke>z+1)throw new Error("Something wrong with hufUnpackEncTable");for(;ke--;)J[j++]=0;j--}else if(Se>=59){let ke=Se-59+2;if(j+ke>z+1)throw new Error("Something wrong with hufUnpackEncTable");for(;ke--;)J[j++]=0;j--}}l(J)}function h(I){return I&63}function d(I){return I>>6}function m(I,k,L,j){for(;k<=L;k++){const z=d(I[k]),J=h(I[k]);if(z>>J)throw new Error("Invalid table entry");if(J>14){const ae=j[z>>J-14];if(ae.len)throw new Error("Invalid table entry");if(ae.lit++,ae.p){const Re=ae.p;ae.p=new Array(ae.lit);for(let Le=0;Le<ae.lit-1;++Le)ae.p[Le]=Re[Le]}else ae.p=new Array(1);ae.p[ae.lit-1]=k}else if(J){let ae=0;for(let Re=1<<14-J;Re>0;Re--){const Le=j[(z<<14-J)+ae];if(Le.len||Le.p)throw new Error("Invalid table entry");Le.len=J,Le.lit=k,ae++}}}return!0}const f={c:0,lc:0};function v(I,k,L,j){I=I<<8|Y(L,j),k+=8,f.c=I,f.lc=k}const w={c:0,lc:0};function b(I,k,L,j,z,J,ae,Re,Le){if(I==k){j<8&&(v(L,j,z,J),L=f.c,j=f.lc),j-=8;let Se=L>>j;if(Se=new Uint8Array([Se])[0],Re.value+Se>Le)return!1;const ke=ae[Re.value-1];for(;Se-- >0;)ae[Re.value++]=ke}else if(Re.value<Le)ae[Re.value++]=I;else return!1;w.c=L,w.lc=j}function y(I){return I&65535}function E(I){const k=y(I);return k>32767?k-65536:k}const _={a:0,b:0};function C(I,k){const L=E(I),j=E(k),z=L+(j&1)+(j>>1),J=z,ae=z-j;_.a=J,_.b=ae}function M(I,k){const L=y(I),j=y(k),z=L-(j>>1)&65535,J=j+z-32768&65535;_.a=J,_.b=z}function S(I,k,L,j,z,J,ae){const Re=ae<16384,Le=L>z?z:L;let Se=1,ke,Ke;for(;Se<=Le;)Se<<=1;for(Se>>=1,ke=Se,Se>>=1;Se>=1;){Ke=0;const nt=Ke+J*(z-ke),pt=J*Se,jt=J*ke,gt=j*Se,wt=j*ke;let Xt,Gi,Ui,cn;for(;Ke<=nt;Ke+=jt){let Pi=Ke;const ui=Ke+j*(L-ke);for(;Pi<=ui;Pi+=wt){const mr=Pi+gt,N=Pi+pt,le=N+gt;Re?(C(I[Pi+k],I[N+k]),Xt=_.a,Ui=_.b,C(I[mr+k],I[le+k]),Gi=_.a,cn=_.b,C(Xt,Gi),I[Pi+k]=_.a,I[mr+k]=_.b,C(Ui,cn),I[N+k]=_.a,I[le+k]=_.b):(M(I[Pi+k],I[N+k]),Xt=_.a,Ui=_.b,M(I[mr+k],I[le+k]),Gi=_.a,cn=_.b,M(Xt,Gi),I[Pi+k]=_.a,I[mr+k]=_.b,M(Ui,cn),I[N+k]=_.a,I[le+k]=_.b)}if(L&Se){const mr=Pi+pt;Re?C(I[Pi+k],I[mr+k]):M(I[Pi+k],I[mr+k]),Xt=_.a,I[mr+k]=_.b,I[Pi+k]=Xt}}if(z&Se){let Pi=Ke;const ui=Ke+j*(L-ke);for(;Pi<=ui;Pi+=wt){const mr=Pi+gt;Re?C(I[Pi+k],I[mr+k]):M(I[Pi+k],I[mr+k]),Xt=_.a,I[mr+k]=_.b,I[Pi+k]=Xt}}ke=Se,Se>>=1}return Ke}function R(I,k,L,j,z,J,ae,Re,Le){let Se=0,ke=0;const Ke=ae,nt=Math.trunc(j.value+(z+7)/8);for(;j.value<nt;)for(v(Se,ke,L,j),Se=f.c,ke=f.lc;ke>=14;){const jt=Se>>ke-14&16383,gt=k[jt];if(gt.len)ke-=gt.len,b(gt.lit,J,Se,ke,L,j,Re,Le,Ke),Se=w.c,ke=w.lc;else{if(!gt.p)throw new Error("hufDecode issues");let wt;for(wt=0;wt<gt.lit;wt++){const Xt=h(I[gt.p[wt]]);for(;ke<Xt&&j.value<nt;)v(Se,ke,L,j),Se=f.c,ke=f.lc;if(ke>=Xt&&d(I[gt.p[wt]])==(Se>>ke-Xt&(1<<Xt)-1)){ke-=Xt,b(gt.p[wt],J,Se,ke,L,j,Re,Le,Ke),Se=w.c,ke=w.lc;break}}if(wt==gt.lit)throw new Error("hufDecode issues")}}const pt=8-z&7;for(Se>>=pt,ke-=pt;ke>0;){const jt=k[Se<<14-ke&16383];if(jt.len)ke-=jt.len,b(jt.lit,J,Se,ke,L,j,Re,Le,Ke),Se=w.c,ke=w.lc;else throw new Error("hufDecode issues")}return!0}function U(I,k,L,j,z,J){const ae={value:0},Re=L.value,Le=we(k,L),Se=we(k,L);L.value+=4;const ke=we(k,L);if(L.value+=4,Le<0||Le>=65537||Se<0||Se>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const Ke=new Array(65537),nt=new Array(16384);n(nt);const pt=j-(L.value-Re);if(c(I,L,pt,Le,Se,Ke),ke>8*(j-(L.value-Re)))throw new Error("Something wrong with hufUncompress");m(Ke,Le,Se,nt),R(Ke,nt,I,L,ke,Se,J,z,ae)}function T(I,k,L){for(let j=0;j<L;++j)k[j]=I[k[j]]}function B(I){for(let k=1;k<I.length;k++){const L=I[k-1]+I[k]-128;I[k]=L}}function Q(I,k){let L=0,j=Math.floor((I.length+1)/2),z=0;const J=I.length-1;for(;!(z>J||(k[z++]=I[L++],z>J));)k[z++]=I[j++]}function Z(I){let k=I.byteLength;const L=new Array;let j=0;const z=new DataView(I);for(;k>0;){const J=z.getInt8(j++);if(J<0){const ae=-J;k-=ae+1;for(let Re=0;Re<ae;Re++)L.push(z.getUint8(j++))}else{const ae=J;k-=2;const Re=z.getUint8(j++);for(let Le=0;Le<ae+1;Le++)L.push(Re)}}return L}function q(I,k,L,j,z,J){let ae=new DataView(J.buffer);const Re=L[I.idx[0]].width,Le=L[I.idx[0]].height,Se=3,ke=Math.floor(Re/8),Ke=Math.ceil(Re/8),nt=Math.ceil(Le/8),pt=Re-(Ke-1)*8,jt=Le-(nt-1)*8,gt={value:0},wt=new Array(Se),Xt=new Array(Se),Gi=new Array(Se),Ui=new Array(Se),cn=new Array(Se);for(let ui=0;ui<Se;++ui)cn[ui]=k[I.idx[ui]],wt[ui]=ui<1?0:wt[ui-1]+Ke*nt,Xt[ui]=new Float32Array(64),Gi[ui]=new Uint16Array(64),Ui[ui]=new Uint16Array(Ke*64);for(let ui=0;ui<nt;++ui){let mr=8;ui==nt-1&&(mr=jt);let N=8;for(let pe=0;pe<Ke;++pe){pe==Ke-1&&(N=pt);for(let ie=0;ie<Se;++ie)Gi[ie].fill(0),Gi[ie][0]=z[wt[ie]++],X(gt,j,Gi[ie]),te(Gi[ie],Xt[ie]),me(Xt[ie]);se(Xt);for(let ie=0;ie<Se;++ie)he(Xt[ie],Ui[ie],pe*64)}let le=0;for(let pe=0;pe<Se;++pe){const ie=L[I.idx[pe]].type;for(let xe=8*ui;xe<8*ui+mr;++xe){le=cn[pe][xe];for(let Je=0;Je<ke;++Je){const St=Je*64+(xe&7)*8;ae.setUint16(le+0*2*ie,Ui[pe][St+0],!0),ae.setUint16(le+1*2*ie,Ui[pe][St+1],!0),ae.setUint16(le+2*2*ie,Ui[pe][St+2],!0),ae.setUint16(le+3*2*ie,Ui[pe][St+3],!0),ae.setUint16(le+4*2*ie,Ui[pe][St+4],!0),ae.setUint16(le+5*2*ie,Ui[pe][St+5],!0),ae.setUint16(le+6*2*ie,Ui[pe][St+6],!0),ae.setUint16(le+7*2*ie,Ui[pe][St+7],!0),le+=8*2*ie}}if(ke!=Ke)for(let xe=8*ui;xe<8*ui+mr;++xe){const Je=cn[pe][xe]+8*ke*2*ie,St=ke*64+(xe&7)*8;for(let vt=0;vt<N;++vt)ae.setUint16(Je+vt*2*ie,Ui[pe][St+vt],!0)}}}const Pi=new Uint16Array(Re);ae=new DataView(J.buffer);for(let ui=0;ui<Se;++ui){L[I.idx[ui]].decoded=!0;const mr=L[I.idx[ui]].type;if(L[ui].type==2)for(let N=0;N<Le;++N){const le=cn[ui][N];for(let pe=0;pe<Re;++pe)Pi[pe]=ae.getUint16(le+pe*2*mr,!0);for(let pe=0;pe<Re;++pe)ae.setFloat32(le+pe*2*mr,Ee(Pi[pe]),!0)}}}function X(I,k,L){let j,z=1;for(;z<64;)j=k[I.value],j==65280?z=64:j>>8==255?z+=j&255:(L[z]=j,z++),I.value++}function te(I,k){k[0]=Ee(I[0]),k[1]=Ee(I[1]),k[2]=Ee(I[5]),k[3]=Ee(I[6]),k[4]=Ee(I[14]),k[5]=Ee(I[15]),k[6]=Ee(I[27]),k[7]=Ee(I[28]),k[8]=Ee(I[2]),k[9]=Ee(I[4]),k[10]=Ee(I[7]),k[11]=Ee(I[13]),k[12]=Ee(I[16]),k[13]=Ee(I[26]),k[14]=Ee(I[29]),k[15]=Ee(I[42]),k[16]=Ee(I[3]),k[17]=Ee(I[8]),k[18]=Ee(I[12]),k[19]=Ee(I[17]),k[20]=Ee(I[25]),k[21]=Ee(I[30]),k[22]=Ee(I[41]),k[23]=Ee(I[43]),k[24]=Ee(I[9]),k[25]=Ee(I[11]),k[26]=Ee(I[18]),k[27]=Ee(I[24]),k[28]=Ee(I[31]),k[29]=Ee(I[40]),k[30]=Ee(I[44]),k[31]=Ee(I[53]),k[32]=Ee(I[10]),k[33]=Ee(I[19]),k[34]=Ee(I[23]),k[35]=Ee(I[32]),k[36]=Ee(I[39]),k[37]=Ee(I[45]),k[38]=Ee(I[52]),k[39]=Ee(I[54]),k[40]=Ee(I[20]),k[41]=Ee(I[22]),k[42]=Ee(I[33]),k[43]=Ee(I[38]),k[44]=Ee(I[46]),k[45]=Ee(I[51]),k[46]=Ee(I[55]),k[47]=Ee(I[60]),k[48]=Ee(I[21]),k[49]=Ee(I[34]),k[50]=Ee(I[37]),k[51]=Ee(I[47]),k[52]=Ee(I[50]),k[53]=Ee(I[56]),k[54]=Ee(I[59]),k[55]=Ee(I[61]),k[56]=Ee(I[35]),k[57]=Ee(I[36]),k[58]=Ee(I[48]),k[59]=Ee(I[49]),k[60]=Ee(I[57]),k[61]=Ee(I[58]),k[62]=Ee(I[62]),k[63]=Ee(I[63])}function me(I){const k=.5*Math.cos(.7853975),L=.5*Math.cos(3.14159/16),j=.5*Math.cos(3.14159/8),z=.5*Math.cos(3*3.14159/16),J=.5*Math.cos(5*3.14159/16),ae=.5*Math.cos(3*3.14159/8),Re=.5*Math.cos(7*3.14159/16),Le=new Array(4),Se=new Array(4),ke=new Array(4),Ke=new Array(4);for(let nt=0;nt<8;++nt){const pt=nt*8;Le[0]=j*I[pt+2],Le[1]=ae*I[pt+2],Le[2]=j*I[pt+6],Le[3]=ae*I[pt+6],Se[0]=L*I[pt+1]+z*I[pt+3]+J*I[pt+5]+Re*I[pt+7],Se[1]=z*I[pt+1]-Re*I[pt+3]-L*I[pt+5]-J*I[pt+7],Se[2]=J*I[pt+1]-L*I[pt+3]+Re*I[pt+5]+z*I[pt+7],Se[3]=Re*I[pt+1]-J*I[pt+3]+z*I[pt+5]-L*I[pt+7],ke[0]=k*(I[pt+0]+I[pt+4]),ke[3]=k*(I[pt+0]-I[pt+4]),ke[1]=Le[0]+Le[3],ke[2]=Le[1]-Le[2],Ke[0]=ke[0]+ke[1],Ke[1]=ke[3]+ke[2],Ke[2]=ke[3]-ke[2],Ke[3]=ke[0]-ke[1],I[pt+0]=Ke[0]+Se[0],I[pt+1]=Ke[1]+Se[1],I[pt+2]=Ke[2]+Se[2],I[pt+3]=Ke[3]+Se[3],I[pt+4]=Ke[3]-Se[3],I[pt+5]=Ke[2]-Se[2],I[pt+6]=Ke[1]-Se[1],I[pt+7]=Ke[0]-Se[0]}for(let nt=0;nt<8;++nt)Le[0]=j*I[16+nt],Le[1]=ae*I[16+nt],Le[2]=j*I[48+nt],Le[3]=ae*I[48+nt],Se[0]=L*I[8+nt]+z*I[24+nt]+J*I[40+nt]+Re*I[56+nt],Se[1]=z*I[8+nt]-Re*I[24+nt]-L*I[40+nt]-J*I[56+nt],Se[2]=J*I[8+nt]-L*I[24+nt]+Re*I[40+nt]+z*I[56+nt],Se[3]=Re*I[8+nt]-J*I[24+nt]+z*I[40+nt]-L*I[56+nt],ke[0]=k*(I[nt]+I[32+nt]),ke[3]=k*(I[nt]-I[32+nt]),ke[1]=Le[0]+Le[3],ke[2]=Le[1]-Le[2],Ke[0]=ke[0]+ke[1],Ke[1]=ke[3]+ke[2],Ke[2]=ke[3]-ke[2],Ke[3]=ke[0]-ke[1],I[0+nt]=Ke[0]+Se[0],I[8+nt]=Ke[1]+Se[1],I[16+nt]=Ke[2]+Se[2],I[24+nt]=Ke[3]+Se[3],I[32+nt]=Ke[3]-Se[3],I[40+nt]=Ke[2]-Se[2],I[48+nt]=Ke[1]-Se[1],I[56+nt]=Ke[0]-Se[0]}function se(I){for(let k=0;k<64;++k){const L=I[0][k],j=I[1][k],z=I[2][k];I[0][k]=L+1.5747*z,I[1][k]=L-.1873*j-.4682*z,I[2][k]=L+1.8556*j}}function he(I,k,L){for(let j=0;j<64;++j)k[L+j]=Ur.toHalfFloat(_e(I[j]))}function _e(I){return I<=1?Math.sign(I)*Math.pow(Math.abs(I),2.2):Math.sign(I)*Math.pow(t,Math.abs(I)-1)}function ge(I){return new DataView(I.array.buffer,I.offset.value,I.size)}function Oe(I){const k=I.viewer.buffer.slice(I.offset.value,I.offset.value+I.size),L=new Uint8Array(Z(k)),j=new Uint8Array(L.length);return B(L),Q(L,j),new DataView(j.buffer)}function oe(I){const k=I.array.slice(I.offset.value,I.offset.value+I.size),L=co(k),j=new Uint8Array(L.length);return B(L),Q(L,j),new DataView(j.buffer)}function be(I){const k=I.viewer,L={value:I.offset.value},j=new Uint16Array(I.width*I.scanlineBlockSize*(I.channels*I.type)),z=new Uint8Array(8192);let J=0;const ae=new Array(I.channels);for(let jt=0;jt<I.channels;jt++)ae[jt]={},ae[jt].start=J,ae[jt].end=ae[jt].start,ae[jt].nx=I.width,ae[jt].ny=I.lines,ae[jt].size=I.type,J+=ae[jt].nx*ae[jt].ny*ae[jt].size;const Re=at(k,L),Le=at(k,L);if(Le>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(Re<=Le)for(let jt=0;jt<Le-Re+1;jt++)z[jt+Re]=je(k,L);const Se=new Uint16Array(65536),ke=i(z,Se),Ke=we(k,L);U(I.array,k,L,Ke,j,J);for(let jt=0;jt<I.channels;++jt){const gt=ae[jt];for(let wt=0;wt<ae[jt].size;++wt)S(j,gt.start+wt,gt.nx,gt.size,gt.ny,gt.nx*gt.size,ke)}T(Se,j,J);let nt=0;const pt=new Uint8Array(j.buffer.byteLength);for(let jt=0;jt<I.lines;jt++)for(let gt=0;gt<I.channels;gt++){const wt=ae[gt],Xt=wt.nx*wt.size,Gi=new Uint8Array(j.buffer,wt.end*2,Xt*2);pt.set(Gi,nt),nt+=Xt*2,wt.end+=Xt}return new DataView(pt.buffer)}function Me(I){const k=I.array.slice(I.offset.value,I.offset.value+I.size),L=co(k),j=I.lines*I.channels*I.width,z=I.type==1?new Uint16Array(j):new Uint32Array(j);let J=0,ae=0;const Re=new Array(4);for(let Le=0;Le<I.lines;Le++)for(let Se=0;Se<I.channels;Se++){let ke=0;switch(I.type){case 1:Re[0]=J,Re[1]=Re[0]+I.width,J=Re[1]+I.width;for(let Ke=0;Ke<I.width;++Ke){const nt=L[Re[0]++]<<8|L[Re[1]++];ke+=nt,z[ae]=ke,ae++}break;case 2:Re[0]=J,Re[1]=Re[0]+I.width,Re[2]=Re[1]+I.width,J=Re[2]+I.width;for(let Ke=0;Ke<I.width;++Ke){const nt=L[Re[0]++]<<24|L[Re[1]++]<<16|L[Re[2]++]<<8;ke+=nt,z[ae]=ke,ae++}break}}return new DataView(z.buffer)}function Ve(I){const k=I.viewer,L={value:I.offset.value},j=new Uint8Array(I.width*I.lines*(I.channels*I.type*2)),z={version:Pe(k,L),unknownUncompressedSize:Pe(k,L),unknownCompressedSize:Pe(k,L),acCompressedSize:Pe(k,L),dcCompressedSize:Pe(k,L),rleCompressedSize:Pe(k,L),rleUncompressedSize:Pe(k,L),rleRawSize:Pe(k,L),totalAcUncompressedCount:Pe(k,L),totalDcUncompressedCount:Pe(k,L),acCompression:Pe(k,L)};if(z.version<2)throw new Error("EXRLoader.parse: "+ft.compression+" version "+z.version+" is unsupported");const J=new Array;let ae=at(k,L)-2;for(;ae>0;){const gt=Ue(k.buffer,L),wt=je(k,L),Xt=wt>>2&3,Gi=(wt>>4)-1,Ui=new Int8Array([Gi])[0],cn=je(k,L);J.push({name:gt,index:Ui,type:cn,compression:Xt}),ae-=gt.length+3}const Re=ft.channels,Le=new Array(I.channels);for(let gt=0;gt<I.channels;++gt){const wt=Le[gt]={},Xt=Re[gt];wt.name=Xt.name,wt.compression=0,wt.decoded=!1,wt.type=Xt.pixelType,wt.pLinear=Xt.pLinear,wt.width=I.width,wt.height=I.lines}const Se={idx:new Array(3)};for(let gt=0;gt<I.channels;++gt){const wt=Le[gt];for(let Xt=0;Xt<J.length;++Xt){const Gi=J[Xt];wt.name==Gi.name&&(wt.compression=Gi.compression,Gi.index>=0&&(Se.idx[Gi.index]=gt),wt.offset=gt)}}let ke,Ke,nt;if(z.acCompressedSize>0)switch(z.acCompression){case 0:ke=new Uint16Array(z.totalAcUncompressedCount),U(I.array,k,L,z.acCompressedSize,ke,z.totalAcUncompressedCount);break;case 1:const gt=I.array.slice(L.value,L.value+z.totalAcUncompressedCount),wt=co(gt);ke=new Uint16Array(wt.buffer),L.value+=z.totalAcUncompressedCount;break}if(z.dcCompressedSize>0){const gt={array:I.array,offset:L,size:z.dcCompressedSize};Ke=new Uint16Array(oe(gt).buffer),L.value+=z.dcCompressedSize}if(z.rleRawSize>0){const gt=I.array.slice(L.value,L.value+z.rleCompressedSize),wt=co(gt);nt=Z(wt.buffer),L.value+=z.rleCompressedSize}let pt=0;const jt=new Array(Le.length);for(let gt=0;gt<jt.length;++gt)jt[gt]=new Array;for(let gt=0;gt<I.lines;++gt)for(let wt=0;wt<Le.length;++wt)jt[wt].push(pt),pt+=Le[wt].width*I.type*2;q(Se,jt,Le,ke,Ke,j);for(let gt=0;gt<Le.length;++gt){const wt=Le[gt];if(!wt.decoded)switch(wt.compression){case 2:let Xt=0,Gi=0;for(let Ui=0;Ui<I.lines;++Ui){let cn=jt[gt][Xt];for(let Pi=0;Pi<wt.width;++Pi){for(let ui=0;ui<2*wt.type;++ui)j[cn++]=nt[Gi+ui*wt.width*wt.height];Gi++}Xt++}break;case 1:default:throw new Error("EXRLoader.parse: unsupported channel compression")}}return new DataView(j.buffer)}function Ue(I,k){const L=new Uint8Array(I);let j=0;for(;L[k.value+j]!=0;)j+=1;const z=new TextDecoder().decode(L.slice(k.value,k.value+j));return k.value=k.value+j+1,z}function rt(I,k,L){const j=new TextDecoder().decode(new Uint8Array(I).slice(k.value,k.value+L));return k.value=k.value+L,j}function xt(I,k){const L=Dt(I,k),j=we(I,k);return[L,j]}function mt(I,k){const L=we(I,k),j=we(I,k);return[L,j]}function Dt(I,k){const L=I.getInt32(k.value,!0);return k.value=k.value+4,L}function we(I,k){const L=I.getUint32(k.value,!0);return k.value=k.value+4,L}function Y(I,k){const L=I[k.value];return k.value=k.value+1,L}function je(I,k){const L=I.getUint8(k.value);return k.value=k.value+1,L}const Pe=function(I,k){let L;return"getBigInt64"in DataView.prototype?L=Number(I.getBigInt64(k.value,!0)):L=I.getUint32(k.value+4,!0)+Number(I.getUint32(k.value,!0)<<32),k.value+=8,L};function Te(I,k){const L=I.getFloat32(k.value,!0);return k.value+=4,L}function Ye(I,k){return Ur.toHalfFloat(Te(I,k))}function Ee(I){const k=(I&31744)>>10,L=I&1023;return(I>>15?-1:1)*(k?k===31?L?NaN:1/0:Math.pow(2,k-15)*(1+L/1024):6103515625e-14*(L/1024))}function at(I,k){const L=I.getUint16(k.value,!0);return k.value+=2,L}function ot(I,k){return Ee(at(I,k))}function Pt(I,k,L,j){const z=L.value,J=[];for(;L.value<z+j-1;){const ae=Ue(k,L),Re=Dt(I,L),Le=je(I,L);L.value+=3;const Se=Dt(I,L),ke=Dt(I,L);J.push({name:ae,pixelType:Re,pLinear:Le,xSampling:Se,ySampling:ke})}return L.value+=1,J}function Li(I,k){const L=Te(I,k),j=Te(I,k),z=Te(I,k),J=Te(I,k),ae=Te(I,k),Re=Te(I,k),Le=Te(I,k),Se=Te(I,k);return{redX:L,redY:j,greenX:z,greenY:J,blueX:ae,blueY:Re,whiteX:Le,whiteY:Se}}function Wi(I,k){const L=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],j=je(I,k);return L[j]}function G(I,k){const L=we(I,k),j=we(I,k),z=we(I,k),J=we(I,k);return{xMin:L,yMin:j,xMax:z,yMax:J}}function F(I,k){const L=["INCREASING_Y"],j=je(I,k);return L[j]}function ye(I,k){const L=Te(I,k),j=Te(I,k);return[L,j]}function Ge(I,k){const L=Te(I,k),j=Te(I,k),z=Te(I,k);return[L,j,z]}function ze(I,k,L,j,z){if(j==="string"||j==="stringvector"||j==="iccProfile")return rt(k,L,z);if(j==="chlist")return Pt(I,k,L,z);if(j==="chromaticities")return Li(I,L);if(j==="compression")return Wi(I,L);if(j==="box2i")return G(I,L);if(j==="lineOrder")return F(I,L);if(j==="float")return Te(I,L);if(j==="v2f")return ye(I,L);if(j==="v3f")return Ge(I,L);if(j==="int")return Dt(I,L);if(j==="rational")return xt(I,L);if(j==="timecode")return mt(I,L);if(j==="preview")return L.value+=z,"skipped";L.value+=z}function V(I,k,L){const j={};if(I.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.");j.version=I.getUint8(4);const z=I.getUint8(5);j.spec={singleTile:!!(z&2),longName:!!(z&4),deepFormat:!!(z&8),multiPart:!!(z&16)},L.value=8;let J=!0;for(;J;){const ae=Ue(k,L);if(ae==0)J=!1;else{const Re=Ue(k,L),Le=we(I,L),Se=ze(I,k,L,Re,Le);Se===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${Re}'.`):j[ae]=Se}}if(z&-5)throw console.error("EXRHeader:",j),new Error("THREE.EXRLoader: provided file is currently unsupported.");return j}function Ce(I,k,L,j,z){const J={size:0,viewer:k,array:L,offset:j,width:I.dataWindow.xMax-I.dataWindow.xMin+1,height:I.dataWindow.yMax-I.dataWindow.yMin+1,channels:I.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:I.channels[0].pixelType,uncompress:null,getter:null,format:null,colorSpace:wi};switch(I.compression){case"NO_COMPRESSION":J.lines=1,J.uncompress=ge;break;case"RLE_COMPRESSION":J.lines=1,J.uncompress=Oe;break;case"ZIPS_COMPRESSION":J.lines=1,J.uncompress=oe;break;case"ZIP_COMPRESSION":J.lines=16,J.uncompress=oe;break;case"PIZ_COMPRESSION":J.lines=32,J.uncompress=be;break;case"PXR24_COMPRESSION":J.lines=16,J.uncompress=Me;break;case"DWAA_COMPRESSION":J.lines=32,J.uncompress=Ve;break;case"DWAB_COMPRESSION":J.lines=256,J.uncompress=Ve;break;default:throw new Error("EXRLoader.parse: "+I.compression+" is unsupported")}if(J.scanlineBlockSize=J.lines,J.type==1)switch(z){case qt:J.getter=ot,J.inputSize=2;break;case di:J.getter=at,J.inputSize=2;break}else if(J.type==2)switch(z){case qt:J.getter=Te,J.inputSize=4;break;case di:J.getter=Ye,J.inputSize=4}else throw new Error("EXRLoader.parse: unsupported pixelType "+J.type+" for "+I.compression+".");J.blockCount=(I.dataWindow.yMax+1)/J.scanlineBlockSize;for(let Re=0;Re<J.blockCount;Re++)Pe(k,j);J.outputChannels=J.channels==3?4:J.channels;const ae=J.width*J.height*J.outputChannels;switch(z){case qt:J.byteArray=new Float32Array(ae),J.channels<J.outputChannels&&J.byteArray.fill(1,0,ae);break;case di:J.byteArray=new Uint16Array(ae),J.channels<J.outputChannels&&J.byteArray.fill(15360,0,ae);break;default:console.error("THREE.EXRLoader: unsupported type: ",z);break}return J.bytesPerLine=J.width*J.inputSize*J.channels,J.outputChannels==4?(J.format=mi,J.colorSpace=wi):(J.format=Mo,J.colorSpace=Xi),J}const Be=new DataView(e),Ae=new Uint8Array(e),ut={value:0},ft=V(Be,e,ut),He=Ce(ft,Be,Ae,ut,this.type),ct={value:0},lt={R:0,G:1,B:2,A:3,Y:0};for(let I=0;I<He.height/He.scanlineBlockSize;I++){const k=we(Be,ut);He.size=we(Be,ut),He.lines=k+He.scanlineBlockSize>He.height?He.height-k:He.scanlineBlockSize;const L=He.size<He.lines*He.bytesPerLine?He.uncompress(He):ge(He);ut.value+=He.size;for(let j=0;j<He.scanlineBlockSize;j++){const z=j+I*He.scanlineBlockSize;if(z>=He.height)break;for(let J=0;J<He.channels;J++){const ae=lt[ft.channels[J].name];for(let Re=0;Re<He.width;Re++){ct.value=(j*(He.channels*He.width)+J*He.width+Re)*He.inputSize;const Le=(He.height-1-z)*(He.width*He.outputChannels)+Re*He.outputChannels+ae;He.byteArray[Le]=He.getter(L,ct)}}}}return{header:ft,width:He.width,height:He.height,data:He.byteArray,format:He.format,colorSpace:He.colorSpace,type:this.type}}setDataType(e){return this.type=e,this}load(e,t,i,n){function s(a,o){a.colorSpace=o.colorSpace,a.minFilter=Et,a.magFilter=Et,a.generateMipmaps=!1,a.flipY=!1,t&&t(a,o)}return super.load(e,s,i,n)}}function P3(r,e){const t=(r.version?r.version:"0.0.0").split(".").map(n=>parseInt(n));if(!(r.type==="ViewerApp"&&t[0]===0&&(t[1]<7||t[1]===7&&t[2].toString()[0]<"6")))return;const i=new Set;e.forEach(n=>n.traverse(s=>{s.material&&i.add(s.material)})),i.forEach(n=>{const s=n.map;if(!s)return;const a=s.repeat,o=s.offset,l=s.center,c=s.rotation;["alphaMap","aoMap","bumpMap","displacementMap","emissiveMap","lightMap","metalnessMap","normalMap","roughnessMap","transmissionMap"].forEach(h=>{const d=n[h];d&&(d.repeat.copy(a),d.offset.copy(o),d.center.copy(l),d.rotation=c,d.needsUpdate=!0)}),n.needsUpdate=!0})}const JC=class extends zi{constructor(e,{simpleCache:t=!1,storage:i}={}){super(),this.processState=new Map,this._sceneUpdated=this._sceneUpdated.bind(this),this.addAsset=this.addAsset.bind(this),this.addRaw=this.addRaw.bind(this),this.addImported=this.addImported.bind(this),this.importer=new SC(!!e.getPlugin("debug")),this.exporter=new zC,this.materials=new QC,this.viewer=e,this.viewer.scene.addEventListener("addSceneObject",this._sceneUpdated),this.viewer.scene.addEventListener("materialChanged",this._sceneUpdated),this.viewer.scene.addEventListener("beforeDeserialize",this._sceneUpdated),this._initCacheStorage(t,i??!0),this._setupObjectProcess(),this._setupProcessState(),this._addImporters(),this._addExporters()}get storage(){return this._storage}async addAsset(e,t){if(!this.importer||!this.viewer)return[];const i=await this.importer.import(e,t);return i?this.loadImported(i,t):(console.warn("Unable to import",e,i),[])}async loadImported(e,{autoSetEnvironment:t=!0,autoSetBackground:i=!1,...n}={}){var s,a,o;const l=Array.isArray(e)?e:[e];let c=Array.isArray(e)?[]:void 0;if((n==null?void 0:n.importConfig)!==!1){const h=l.find(d=>(d==null?void 0:d.assetType)==="config")||((s=l.find(d=>d&&!!d.importedViewerConfig))==null?void 0:s.importedViewerConfig);h&&P3(h,l.filter(d=>d==null?void 0:d.isObject3D))}for(const h of l){if(!h){Array.isArray(c)&&c.push(void 0);continue}let d=h;switch(h.assetType){case"material":this.materials.registerMaterial(h);break;case"texture":t&&((a=h.__rootPath)!=null&&a.endsWith(".hdr")||(o=h.__rootPath)!=null&&o.endsWith(".exr"))&&(this.viewer.scene.environment=h),i&&(this.viewer.scene.background=h);break;case"model":case"light":case"camera":d=await this.viewer.addSceneObject(h,n);break;case"config":(n==null?void 0:n.importConfig)!==!1&&await this.viewer.importConfig(h);break;default:h.type&&typeof h.type=="string"&&(Array.isArray(h.plugins)||h.type==="ThreeViewer"||this.viewer.getPlugin(h.type))&&await this.viewer.importConfig(h);break}this.dispatchEvent({type:"loadAsset",data:h}),Array.isArray(c)?c.push(d):c=d}return c||[]}async addProcessedAssets(e,t){return this.loadImported(e,t)}async addAssetSingle(e,t){var i;return e?(i=await this.addAsset(e,t))==null?void 0:i[0]:void 0}async addRaw(e,t={}){const i=await this.importer.processRaw(e,t);return this.loadImported(i,t)}async addRawSingle(e,t={}){var i;return(i=await this.addRaw(e,t))==null?void 0:i[0]}_sceneUpdated(e){var t;if(e.type==="addSceneObject"){const i=e.object;switch(i.assetType){case"material":this.materials.registerMaterial(i);break}}else if(e.type==="materialChanged"){const i=e.material,n=Array.isArray(i)?i:i?[i]:[];for(const s of n)this.materials.registerMaterial(s)}else if(e.type==="beforeDeserialize"){const i=e.data,n=e.meta;i.metadata||console.warn("Invalid data(no metadata)",i),e.material&&(((t=i.metadata)==null?void 0:t.type)!=="Material"&&console.warn("Invalid material data",i),Yp.DeserializeMaterialJSON(i,this.viewer,n,e.material).then(()=>{}))}else console.error("Unexpected")}dispose(){this.importer.dispose(),this.materials.dispose(),this.processState.clear(),this.viewer.scene.removeEventListener("addSceneObject",this._sceneUpdated),this.viewer.scene.removeEventListener("materialChanged",this._sceneUpdated),this.exporter.dispose()}_addImporters(){const e=this.viewer;if(!e)return;const t=[new Pr(Ko,["webp","png","jpeg","jpg","svg","ico","data:image","avif"],["image/webp","image/png","image/jpeg","image/svg+xml","image/gif","image/bmp","image/tiff","image/x-icon","image/avif"],!1),new Pr(Yp,["mat",...this.materials.templates.map(i=>i.typeSlug).filter(i=>i)],[],!1,i=>(i&&(i.viewer=this.viewer),i)),new Pr(class extends l3{constructor(i){super(i),this.setDataType(s0(e.renderManager.renderer))}},["hdr"],["image/vnd.radiance"],!1),new Pr(class extends I3{constructor(i){super(i),this.setDataType(s0(e.renderManager.renderer))}},["exr"],["image/x-exr"],!1),new Pr(A3,["fbx"],["model/fbx"],!0),new Pr(pC,["zip","glbz","gltfz"],["application/zip","model/gltf+zip","model/zip"],!0),new Pr(ME,["obj"],["model/obj"],!0),new Pr(vy,["mtl"],["model/mtl"],!1),new Pr(CC,["gltf","glb","data:model/gltf","data:model/glb"],["model/gltf","model/gltf+json","model/gltf-binary","model/glb"],!0,(i,n,s)=>i==null?void 0:i.setup(this.viewer,s.extensions)),new Pr(MC,["drc"],["model/mesh+draco","model/drc"],!0)];this.importer.addImporter(...t)}_addExporters(){const e=[{ext:["gltf","glb"],extensions:[],ctor:(t,i)=>{const n=new FC;return n.setup(this.viewer,i.extensions),n}}];this.exporter.addExporter(...e)}_initCacheStorage(e,t){var i,n;if(t===!0&&window!=null&&window.caches){(n=(i=window.caches).open)==null||n.call(i,"threepipe-assetmanager").then(s=>{this._initCacheStorage(e,s),this._storage=s});return}(e||t)&&(e&&(Bn.enabled=!0),t&&window.Cache&&typeof window.Cache=="function"&&t instanceof window.Cache&&Ax(t)),this._storage=typeof t=="boolean"?void 0:t}_setupObjectProcess(){this.importer.addEventListener("processRaw",e=>{var t;const i=e.data;!i||!i.isMaterial||!i.uuid||((t=this.materials)!=null&&t.findMaterial(i.uuid)&&(console.warn("imported material uuid already exists, creating new uuid"),i.uuid=hs(),i.userData.uuid&&(i.userData.uuid=i.uuid)),this.materials.registerMaterial(i))}),this.importer.addEventListener("processRawStart",e=>{var t;const i=e.data,n=e.options;if(i.isObject3D){const s=[],a=[];i.traverse(o=>{if(o.material){const l=Array.isArray(o.material)?o.material:[o.material],c=[];for(const h of l){const d=this.materials.convertToIMaterial(h,{createFromTemplate:n.replaceMaterials!==!1})||h;d.uuid=h.uuid,d.userData.uuid=h.uuid,c.push(d)}Array.isArray(o.material)?o.material=c:o.material=c[0]}o.isCamera&&s.push(o),o.isLight&&a.push(o)});for(const o of s)if(o.assetType!=="camera")if(!o.isPerspectiveCamera||!o.parent||n.replaceCameras===!1)Un.upgradeCamera.call(o);else{const l=o.iCamera??new Oh("",this.viewer.canvas);if(o===l)continue;o.parent.children.splice(o.parent.children.indexOf(o),1,l),l.parent=o.parent,l.copy(o),o.parent=null,l.uuid=o.uuid,l.userData.uuid=o.uuid,o.iCamera=l}for(const o of a)if(o.assetType!=="light")if(!o.parent||n.replaceLights===!1)_r.upgradeLight.call(o);else{const l=o.iLight??o.isDirectionalLight?new p.DirectionalLight2:o.isPointLight?new p.PointLight2:o.isSpotLight?new p.SpotLight2:o.isAmbientLight?new p.AmbientLight2:o.isHemisphereLight?new p.HemisphereLight2:o.isRectAreaLight?new p.RectAreaLight2:void 0;if(o===l||!l)continue;o.parent.children.splice(o.parent.children.indexOf(o),1,l),l.parent=o.parent,l.copy(o),o.parent=null,l.uuid=o.uuid,l.userData.uuid=o.uuid,o.iLight=l}Wt.upgradeObject3D.call(i)}else i.isMaterial?Qe.upgradeMaterial.call(i):i.isTexture&&(hy.call(i),((t=e==null?void 0:e.options)==null?void 0:t.generateMipmaps)!==void 0&&(i.generateMipmaps=e==null?void 0:e.options.generateMipmaps),!i.generateMipmaps&&!i.isRenderTargetTexture&&(i.minFilter=i.minFilter===Er?Et:i.minFilter,i.magFilter=i.magFilter===Er?Et:i.magFilter))})}setProcessState(e,t){t===void 0?this.processState.delete(e):this.processState.set(e,t),this.dispatchEvent({type:"processStateUpdate"})}_setupProcessState(){this.importer.addEventListener("importFile",e=>{this.setProcessState(e.path,e.state!=="done"?{state:e.state,progress:e.progress?e.progress*100:void 0}:void 0)}),this.importer.addEventListener("processRawStart",e=>{this.setProcessState(e.path,{state:"processing",progress:void 0})}),this.importer.addEventListener("processRaw",e=>{this.setProcessState(e.path,void 0)}),this.exporter.addEventListener("exportFile",e=>{this.setProcessState(e.obj.name,e.state!=="done"?{state:e.state,progress:e.progress?e.progress*100:void 0}:void 0)})}async addImported(e,t={}){return console.error("addImported is deprecated, use addRaw instead"),this.addRaw(e,t)}async addFromPath(e,t={}){return console.error("addFromPath is deprecated, use addAsset instead"),this.addAsset(e,t)}exportViewerConfig(e=!0){return this.viewer?(console.error("exportViewerConfig is deprecated, use viewer.toJSON instead"),this.viewer.toJSON(e,void 0)):{}}exportPluginPresets(e){var t;return console.error("exportPluginPresets is deprecated, use viewer.exportPluginsConfig instead"),(t=this.viewer)==null?void 0:t.exportPluginsConfig(e)}exportPluginPreset(e){var t;return console.error("exportPluginPreset is deprecated, use viewer.exportPluginConfig instead"),(t=this.viewer)==null?void 0:t.exportPluginConfig(e)}async importPluginPreset(e,t){var i;return console.error("importPluginPreset is deprecated, use viewer.importPluginConfig instead"),(i=this.viewer)==null?void 0:i.importPluginConfig(e,t)}async importViewerConfig(e){var t;return(t=this.viewer)==null?void 0:t.importConfig(e)}applyViewerConfig(e,t){var i;return console.error("applyViewerConfig is deprecated, use viewer.fromJSON instead"),(i=this.viewer)==null?void 0:i.fromJSON(e,t)}async importConfigResources(e,t){var i;if(!this.importer)throw"Importer not initialized yet.";return e.__isLoadedResources?e:(i=this.viewer)==null?void 0:i.loadConfigResources(e,t)}};JC.PluginType="AssetManager";let ZC=JC;var R3=Object.defineProperty,D3=Object.getOwnPropertyDescriptor,fl=(r,e,t,i)=>{for(var n=i>1?void 0:i?D3(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&R3(e,t,n),n};p.RenderManager=class extends bE{constructor({canvas:r,alpha:e=!0,renderScale:t=1,targetOptions:i}){super(),this._renderSize=new ne(512,512),this._renderScale=1,this._passes=[],this._pipeline=[],this._passesNeedsUpdate=!0,this._frameCount=0,this._lastTime=0,this._totalFrameCount=0,this.stableNoise=!1,this.frameWaitTime=0,this._dirty=!0,this.autoBuildPipeline=!0,this.defaultRenderToScreen=!0,this.onPostFrame=()=>{var s;for(const a of this._passes)a.enabled&&a.onPostFrame&&((s=a.onPostFrame)==null||s.call(a,this))},this._animationLoop=this._animationLoop.bind(this),this._renderSize=new ne(r.clientWidth,r.clientHeight),this._renderScale=t,this._renderer=this._initWebGLRenderer(r,e),this._context=this._renderer.getContext(),this._isWebGL2=this._renderer.capabilities.isWebGL2,this.resetShadows();const n=this.createTarget(i,!1);n.texture.name="EffectComposer.rt1",this._composer=new yE(this._renderer,n)}get renderScale(){return this._renderScale}set renderScale(r){r!==this._renderScale&&(this._renderScale=r,this.setSize(void 0,void 0,!0))}get renderer(){return this._renderer}rebuildPipeline(r=!0){this._passesNeedsUpdate=!0,r&&this._updated({change:"rebuild"})}_refreshPipeline(){if(!this.autoBuildPipeline)return this._pipeline;const r=this._passes;return this._pipeline=gE(r)}_animationLoop(r,e){const t=r-this._lastTime;this._lastTime=r,this.frameWaitTime-=t,!(this.frameWaitTime>0)&&(this.frameWaitTime=0,this.dispatchEvent({type:"animationLoop",deltaTime:t,time:r,renderer:this._renderer,xrFrame:e}))}_initWebGLRenderer(r,e){const t=new sp({canvas:r,antialias:!1,alpha:e,premultipliedAlpha:!1,preserveDrawingBuffer:!0,powerPreference:p.RenderManager.POWER_PREFERENCE});return t.useLegacyLights=!1,t.setAnimationLoop(this._animationLoop),t.onContextLost=i=>{this.dispatchEvent({type:"contextLost",event:i})},t.onContextRestore=()=>{this.dispatchEvent({type:"contextRestored"})},t.setSize(this._renderSize.width,this._renderSize.height,!1),t.setPixelRatio(this._renderScale),t.toneMapping=$n,t.toneMappingExposure=1,t.outputColorSpace=Xi,t.shadowMap.enabled=!0,t.shadowMap.type=_t,t.shadowMap.autoUpdate=!1,uE.call(t,this)}setSize(r,e,t=!1){!t&&(r?Math.abs(r-this._renderSize.width):0)+(e?Math.abs(e-this._renderSize.height):0)<.1||(r&&(this._renderSize.width=r),e&&(this._renderSize.height=e),this.webglRenderer.xr.enabled&&this.webglRenderer.xr.isPresenting||(this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._renderScale)),this._composer.setPixelRatio(this._renderScale,!1),this._composer.setSize(this._renderSize.width,this._renderSize.height),this.resizeTrackedTargets(),this.dispatchEvent({type:"resize"}),this._updated({change:"size",data:this._renderSize.toArray()}),this.reset())}render(r,e){this._passesNeedsUpdate&&(this._refreshPipeline(),this.refreshPasses());for(const t of this._passes)t.enabled&&t.beforeRender&&t.beforeRender(r,r.renderCamera,this);this._composer.renderToScreen=e??this.defaultRenderToScreen,this._composer.render(),this._composer.renderToScreen=!0,e&&(this._frameCount+=1,this._totalFrameCount+=1),this._dirty=!1}get needsRender(){return this._dirty=this._dirty||this._passes.findIndex(r=>sr(r.dirty))>=0,this._dirty}setDirty(r=!1){this._dirty=!0,r&&this.reset()}reset(){this._frameCount=0,this._dirty=!0}resetShadows(){this._renderer.shadowMap.needsUpdate=!0}refreshPasses(){if(!this._passesNeedsUpdate)return;this._passesNeedsUpdate=!1;const r=[];for(const e of this._pipeline){const t=this._passes.find(i=>i.passId===e);if(!t){console.warn("Unable to find pass: ",e);continue}r.push(t)}[...this._composer.passes].forEach(e=>this._composer.removePass(e)),r.forEach(e=>this._composer.addPass(e)),this._updated({change:"passRefresh"})}dispose(r=!0){super.dispose(r),this._renderer.dispose()}updateShaderProperties(r){return r.uniforms.currentFrameCount&&(r.uniforms.currentFrameCount.value=this.frameCount),this.stableNoise?r.uniforms.frameCount?r.uniforms.frameCount.value=this.frameCount:console.warn("RenderManager: no uniform: frameCount"):r.uniforms.frameCount?r.uniforms.frameCount.value=this._totalFrameCount:console.warn("RenderManager: no uniform: frameCount"),this}registerPass(r,e=!0){var t;if(e)for(const i of[...this._passes])r.passId===i.passId&&this.unregisterPass(i);this._passes.push(r),(t=r.onRegister)==null||t.call(r,this),this.rebuildPipeline(!1),this._updated({change:"registerPass",pass:r})}unregisterPass(r){var e;const t=this._passes.indexOf(r);t>=0&&((e=r.onUnregister)==null||e.call(r,this),this._passes.splice(t,1),this.rebuildPipeline(!1),this._updated({change:"unregisterPass",pass:r}))}get frameCount(){return this._frameCount}get totalFrameCount(){return this._totalFrameCount}resetTotalFrameCount(){this._totalFrameCount=0}set pipeline(r){this._pipeline=r,this.autoBuildPipeline&&console.warn("RenderManager: pipeline changed, but autoBuildPipeline is true. This will not have any effect."),this.rebuildPipeline()}get pipeline(){return this._pipeline}get composer(){return this._composer}get passes(){return this._passes}get isWebGL2(){return this._isWebGL2}get composerTarget(){return this._composer.renderTarget1}get composerTarget2(){return this._composer.renderTarget2}get renderSize(){return this._renderSize}get context(){return this._context}get webglRenderer(){return this._renderer}get useLegacyLights(){return this._renderer.useLegacyLights}set useLegacyLights(r){this._renderer.useLegacyLights=r,this._updated({change:"useLegacyLights",data:r}),this.resetShadows()}get clock(){return this._composer.clock}blit(r,{source:e,viewport:t,material:i,clear:n=!0,respectColorSpace:s=!1,blending:a=Qt,transparent:o=!0}={}){const l=s?this._composer.copyPass2:this._composer.copyPass,{renderToScreen:c,material:h,uniforms:d,clear:m}=l;i&&(l.material=i);const f=l.material.transparent,v=r?r.viewport.clone():this._renderer.getViewport(new bt),w=r?r.scissor.clone():this._renderer.getScissor(new bt),b=r?r.scissorTest:this._renderer.getScissorTest(),y=this._renderer.autoClear,E=this._renderer.getRenderTarget(),_=l.material.blending;t&&(r?(r.viewport.copy(t),r.scissor.copy(t),r.scissorTest=!0):(this._renderer.setViewport(t),this._renderer.setScissor(t),this._renderer.setScissorTest(!0))),this._renderer.autoClear=!1,l.material.blending=o?a:ii,l.uniforms=l.material.uniforms,l.renderToScreen=!1,l.clear=n,l.material.transparent=o,l.material.needsUpdate=!0,this._renderer.renderWithModes({sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!0,transmissionRender:!1},()=>{l.render(this._renderer,r||null,{texture:e},0,!1)}),l.renderToScreen=c,l.clear=m,l.material=h,l.uniforms=d,l.material.blending=_,l.material.transparent=f,this._renderer.autoClear=y,t&&(r?(r.viewport.copy(v),r.scissor.copy(w),r.scissorTest=b):(this._renderer.setViewport(v),this._renderer.setScissor(w),this._renderer.setScissorTest(b))),this._renderer.setRenderTarget(E)}clearColor({r,g:e,b:t,a:i,target:n,depth:s=!0,stencil:a=!0,viewport:o}){const l=this._renderer.getClearColor(new fe),c=this._renderer.getClearAlpha();this._renderer.setClearColor(new fe(r??l.r,e??l.g,t??l.b)),this._renderer.setClearAlpha(i??c);const h=this._renderer.getRenderTarget(),d=this._renderer.getActiveCubeFace(),m=this._renderer.getActiveMipmapLevel(),f=n?n.viewport.clone():this._renderer.getViewport(new bt),v=n?n.scissor.clone():this._renderer.getScissor(new bt),w=n?n.scissorTest:this._renderer.getScissorTest();o&&(n?(n.viewport.copy(o),n.scissor.copy(o),n.scissorTest=!0):(this._renderer.setViewport(o),this._renderer.setScissor(o),this._renderer.setScissorTest(!0))),this._renderer.setRenderTarget(n??null),this._renderer.clear(!0,s,a),o&&(n?(n.viewport.copy(f),n.scissor.copy(v),n.scissorTest=w):(this._renderer.setViewport(f),this._renderer.setScissor(v),this._renderer.setScissorTest(w))),this._renderer.setRenderTarget(h,d,m),this._renderer.setClearColor(l),this._renderer.setClearAlpha(c)}renderTargetToDataUrl(r,e="image/png",t=90,i=0){const n=document.createElement("canvas");n.width=r.width,n.height=r.height;const s=n.getContext("2d");if(!s)throw new Error("Unable to get 2d context");const a=Array.isArray(r.texture)?r.texture[i]:r.texture,o=s.createImageData(r.width,r.height,{colorSpace:["display-p3","srgb"].includes(a.colorSpace)?a.colorSpace:void 0});if(a.type===di||a.type===qt){const c=this.renderTargetToBuffer(r,i);a0({data:c,width:r.width,height:r.height},a.colorSpace,o)}else this._renderer.readRenderTargetPixels(r,0,0,r.width,r.height,o.data,void 0,i);s.putImageData(o,0,0);const l=(a.flipY?n:Zv(n)).toDataURL(e,t);return n.remove(),l}renderTargetToBuffer(r,e=0){const t=Array.isArray(r.texture)?r.texture[e]:r.texture,i=t.type===di?new Uint16Array(r.width*r.height*4):t.type===qt?new Float32Array(r.width*r.height*4):new Uint8Array(r.width*r.height*4);return this._renderer.readRenderTargetPixels(r,0,0,r.width,r.height,i,void 0,e),i}exportRenderTarget(r,e="auto",t=0){const i=["image/x-exr"],n=Array.isArray(r.texture)?r.texture[t]:r.texture;let s=n.type===di||n.type===qt;e==="auto"&&(e=s?"image/x-exr":"image/png"),i.includes(e)||(s=!1);let a;if(s)e!=="image/x-exr"&&(console.warn("RenderManager: mimeType ",e," is not supported for HDR. Using EXR instead"),e="image/x-exr"),a=new i_().parse(this._renderer,r,{textureIndex:t});else{const l=this.renderTargetToDataUrl(r,e==="auto"?void 0:e,90,t);a=Hv(l.split(",")[1]),e=l.split(";")[0].split(":")[1]}const o=new Blob([a],{type:e});return o.ext=e==="image/x-exr"?"exr":e.split("/")[1],o}_updated(r){this.dispatchEvent({...r,type:"update"})}_createTargetClass(r,e,t){const i=this._processNewTarget,n=this.disposeTarget.bind(this);return new class extends r{constructor(s,...a){super(...a),this.renderManager=s,this.assetType="renderTarget",this.name="RenderTarget",this.uuid=hs();const o=a[a.length-1],l=o==null?void 0:o.colorSpace;this._initTexture(l)}_initTexture(s){Array.isArray(this.texture)?this.texture.forEach(a=>{s!==void 0&&(a.colorSpace=s),a._target=this,a.toJSON=()=>(console.warn("Multiple render target texture.toJSON not supported yet."),{})}):(this.texture._target=this,this.texture.toJSON=()=>({isRenderTargetTexture:!0}))}setSize(s,a,o){return super.setSize(Math.floor(s),Math.floor(a),o),this}clone(s=!0){var a;if(this.isTemporary)throw"Cloning temporary render targets not supported";if(Array.isArray(this.texture))throw"Cloning multiple render targets not supported";const o=new this.constructor(this.renderManager);o.copy(this),o._initTexture((a=Array.isArray(this.texture)?this.texture[0]:this.texture)==null?void 0:a.colorSpace);const l=o.texture;return Array.isArray(l)?l.forEach(c=>c.isRenderTargetTexture=!0):l.isRenderTargetTexture=!0,i(o,this.sizeMultiplier||1,s)}copy(s){return super.copy(s),this}dispose(s=!1){s===!0?n(this,!0):super.dispose()}}(this,...e,t)}get displayCanvasScaling(){return console.error("displayCanvasScaling is deprecated, use renderScale instead"),this.renderScale}set displayCanvasScaling(r){console.error("displayCanvasScaling is deprecated, use renderScale instead"),this.renderScale=r}},p.RenderManager.POWER_PREFERENCE="high-performance",fl([lc("Render Size")],p.RenderManager.prototype,"_renderSize",2),fl([Rt("Render Scale",[.1,8],.05)],p.RenderManager.prototype,"renderScale",1),fl([ur(void 0,{label:"Passes"})],p.RenderManager.prototype,"_passes",2),fl([De(),$()],p.RenderManager.prototype,"stableNoise",2),fl([Ir(p.RenderManager.prototype.rebuildPipeline)],p.RenderManager.prototype,"autoBuildPipeline",2),fl([ci("Rebuild Pipeline",{sendArgs:!1})],p.RenderManager.prototype,"rebuildPipeline",1),fl([$()],p.RenderManager.prototype,"useLegacyLights",1),p.RenderManager=fl([Kv("RenderManager"),ti("Render Manager")],p.RenderManager);var B3=Object.defineProperty,L3=Object.getOwnPropertyDescriptor,$C=(r,e,t,i)=>{for(var n=i>1?void 0:i?L3(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&B3(e,t,n),n};p.ViewerRenderManager=class extends p.RenderManager{constructor({rgbm:r=!0,msaa:e=!1,depthBuffer:t=!1,...i}){super({...i,targetOptions:{samples:e?typeof e!="number"?4:e:0,colorSpace:r?_l:Xi,type:r?oi:di,depthBuffer:t,generateMipmaps:e?!0:void 0,minFilter:e?Al:void 0}}),this.rgbm=r,this.msaa=e&&this.isWebGL2,this.depthBuffer=t,this.zPrepass=i.zPrepass||!1;let n=!0;this._renderer.userData||(n=!1,this._renderer.userData={__isIWebGLRenderer:!0}),this._renderer.userData.renderTransmissionPass=!n,this.renderPass=new fy(this),this.screenPass=new p.ScreenPass(i.screenShader||""),this.registerPass(this.renderPass),this.registerPass(this.screenPass)}_gbufferUnpackExtensionChanged(r){this.dispatchEvent({type:"gbufferUnpackExtensionChanged",...r})}render(r,e){const t=this.screenPass.clipBackgroundForce;if(this.rgbm){const i=!r.background&&!r.backgroundColor;i!==t&&(this.screenPass.clipBackgroundForce=i)}super.render(r,e)}},$C([yi(p.ViewerRenderManager.prototype._gbufferUnpackExtensionChanged)],p.ViewerRenderManager.prototype,"gbufferUnpackExtension",2),p.ViewerRenderManager=$C([ti("Render Manager")],p.ViewerRenderManager);var U3=Object.defineProperty,O3=Object.getOwnPropertyDescriptor,bc=(r,e,t,i)=>{for(var n=i>1?void 0:i?O3(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&U3(e,t,n),n};p.DropzonePlugin=class extends ei{constructor(r){super(),this.enabled=!0,this._allowedExtensions=void 0,this.autoImport=!0,this.autoAdd=!0,this.importOptions={autoImportZipContents:!0,forceImporterReprocess:!1},this.addOptions={autoCenter:!0,importConfig:!0,autoScale:!0,autoScaleRadius:2,centerGeometries:!1,centerGeometriesKeepPosition:!0,license:"",clearSceneObjects:!1,disposeSceneObjects:!1,autoSetBackground:!1,autoSetEnvironment:!0},r&&(this._domElement=r.domElement,this.allowedExtensions=r.allowedExtensions,this.autoImport=r.autoImport??this.autoImport,this.autoAdd=r.autoAdd??this.autoAdd,this.importOptions={...this.importOptions,...r.importOptions},this.addOptions={...this.addOptions,...r.addOptions})}get allowedExtensions(){return this._allowedExtensions}set allowedExtensions(r){this._allowedExtensions=r,this._inputEl&&(this._inputEl.accept=r?r.map(e=>"."+e).join(", "):"")}promptForFile(){var r;this.isDisabled()||(this.allowedExtensions=this._allowedExtensions,(r=this._inputEl)==null||r.click())}onAdded(r){super.onAdded(r),this._inputEl=document.createElement("input"),this._inputEl.type="file",this._domElement||(this._domElement=r.canvas),this._dropzone=new lx(this._domElement,this._inputEl,{drop:this._onFileDrop.bind(this)}),this.allowedExtensions=this._allowedExtensions}onRemove(r){var e;super.onRemove(r),(e=this._dropzone)==null||e.destroy(),this._dropzone=void 0,this._inputEl=void 0}async _onFileDrop({files:r,nativeEvent:e}){var t;if(!r||this.isDisabled())return;const i=this._viewer;if(!i)return;if(this._allowedExtensions!==void 0)for(const o of r.keys())this._allowedExtensions.includes(((t=o.split(".").pop())==null?void 0:t.toLowerCase())??"")||r.delete(o);if(r.size<1)return;const n=i.assetManager;let s,a;if(this.autoImport&&(s=await n.importer.importFiles(r,{allowedExtensions:this.allowedExtensions,...this.importOptions}),this.autoAdd)){const o=[...(s==null?void 0:s.values())??[]].flat(2).filter(l=>!!l)??[];a=await n.loadImported(o,{...this.addOptions})}this.dispatchEvent({type:"drop",files:r,imported:s,assets:a,nativeEvent:e})}},p.DropzonePlugin.PluginType="Dropzone",bc([De(),$()],p.DropzonePlugin.prototype,"enabled",2),bc([$()],p.DropzonePlugin.prototype,"autoImport",2),bc([De(),$()],p.DropzonePlugin.prototype,"autoAdd",2),bc([ur(),$()],p.DropzonePlugin.prototype,"importOptions",2),bc([ur(),$()],p.DropzonePlugin.prototype,"addOptions",2),bc([ci("Select files")],p.DropzonePlugin.prototype,"promptForFile",1),p.DropzonePlugin=bc([ti("Dropzone")],p.DropzonePlugin);const k3=`
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping(vec3 color){color*=toneMappingExposure;return saturate(Uncharted2Helper(color)/Uncharted2Helper(vec3(1.0)));}vec3 CustomToneMapping(vec3 color){return Uncharted2ToneMapping(color);}`,F3=`int getToneMapBit(in int number){return(number/2)% 2;}vec3 TonemappingSaturation(vec3 rgb){const vec3 W=vec3(0.2125,0.7154,0.0721);vec3 intensity=vec3(dot(rgb,W));return mix(intensity,rgb,toneMappingSaturation);}vec3 TonemappingContrast(vec3 color){return(color-vec3(0.5))*toneMappingContrast+vec3(0.5);}vec4 ToneMapping(in vec4 color){vec4 outColor=color;
#if defined( TONE_MAPPING )
outColor.rgb=toneMapping(outColor.rgb);outColor.rgb=TonemappingContrast(outColor.rgb);outColor.rgb=TonemappingSaturation(outColor.rgb);
#endif
return outColor;}`,N3=`bool doTonemap=true;
#ifdef HAS_GBUFFER
#ifdef GBUFFER_HAS_FLAGS
doTonemap=getToneMapBit(getGBufferFlags(vUv).a)>0;
#endif
#if TONEMAP_BACKGROUND < 1
if(isBackground)doTonemap=false;
#endif
#endif
if(doTonemap)diffuseColor=ToneMapping(diffuseColor);`;var G3=Object.defineProperty,eM=(r,e,t,i)=>{for(var n=void 0,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=a(e,t,n)||n);return n&&G3(e,t,n),n};const Bg=class extends ei{constructor(){super(),this.enabled=!0,this._beforeRender=this._beforeRender.bind(this)}_beforeRender(r,e,t){return this._pass?(this._pass.enabled=!this.isDisabled(),this._pass.enabled):!1}onAdded(r){var e;super.onAdded(r),this._pass=this._createPass(),(e=this._pass.onDirty)==null||e.push(r.setDirty),this._pass.beforeRender=Xw(this._beforeRender,this._pass.beforeRender),r.renderManager.registerPass(this._pass)}onRemove(r){var e,t;this._pass&&r.renderManager.unregisterPass(this._pass),(t=(e=this._pass)==null?void 0:e.dispose)==null||t.call(e),this._pass=void 0,super.onRemove(r)}get pass(){return this._pass}toJSON(r){return super.toJSON(r)}fromJSON(r,e){return super.fromJSON(r,e)}setDirty(){var r,e,t;this._pass&&(this._pass.enabled=!this.isDisabled()),(r=this._viewer)==null||r.setDirty(),(t=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||t.call(e,!0,"postFrame",100)}};eM([$(),De("Enabled"),st(Bg.prototype.setDirty)],Bg.prototype,"enabled"),eM([$("pass")],Bg.prototype,"_pass");let wc=Bg;const tM=`#ifndef UNPACK_GBUFFER_SNIPPET
#define UNPACK_GBUFFER_SNIPPET
uniform sampler2D tNormalDepth;float unpack16(vec2 value){return value.x+value.y/255.0;}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.0-2.0;float f=dot(fenc,fenc);float g=sqrt(1.0-f/4.0);return vec3(fenc*g,1.0-f/2.0);}float unpackDepth(vec2 uncodedDepth){float x=unpack16(uncodedDepth.xy);return x*x;}
#define getDepth(uv) unpackDepth(texture2D(tNormalDepth, uv).xy)
void getDepthNormal(const in vec2 uv,out float depth,out vec3 normal){vec4 uncodedDepth=texture2D(tNormalDepth,uv);depth=unpackDepth(uncodedDepth.xy);normal=unpackNormal(uncodedDepth.zw);}vec3 getViewNormal(const in vec2 uv){return unpackNormal(texture2D(tNormalDepth,uv).zw);}
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
uniform sampler2D tGBufferFlags;
#endif
ivec4 getGBufferFlags(const in vec2 uv){
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
return ivec4(texture2D(tGBufferFlags,uv)*255.);
#else
return ivec4(1);
#endif
}
#if defined(GBUFFER_HAS_DEPTH_TEXTURE) && GBUFFER_HAS_DEPTH_TEXTURE == 1
uniform sampler2D tGBufferDepthTexture;float getDepthTexture(vec2 coord,float cameraNear,float cameraFar){float fragCoordZ=texture2D(tGBufferDepthTexture,coord).x;float viewZ=perspectiveDepthToViewZ(fragCoordZ,cameraNear,cameraFar);return viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);}
#endif
#endif
`,z3=`
#define DEPTH_NORMAL
#if IS_GLSL3 > 0
out vec3 vViewPosition;
#else
varying vec3 vViewPosition;
#endif
#ifdef USE_ALPHAMAP
#define USE_UV
#endif
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main(){
#include <uv_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;}`,Q3=`
#define DEPTH_NORMAL
#if IS_GLSL3 > 0
in vec3 vViewPosition;
#else
varying vec3 vViewPosition;
#endif
#ifdef USE_ALPHAMAP
#define USE_UV
#include <packing>
#endif
#if IS_GLSL3 > 0
#ifndef gl_FragColor
layout(location=0)out vec4 gDepthNormal;layout(location=1)out vec4 gFlags;
#endif
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
uniform vec2 cameraNearFar;uniform vec4 flags;vec2 pack16(float value){float f=clamp(value,0.0,1.0)*255.0;float digitLow=fract(f);float digitHigh=floor(f)/255.0;return vec2(digitHigh,digitLow);}vec2 packNormal(vec3 n){float p=sqrt(n.z*8.0+8.0);return vec2(n.xy/p+0.5);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.0,1.0);}void main(){
#glMarker mainStart
#include <clipping_planes_fragment>
vec4 diffuseColor=vec4(1.0);
#include <map_fragment>
#ifdef USE_ALPHAMAP
float alphaMapValue=
#ifdef ALPHA_I_RGBA_PACKING
1.-unpackRGBAToDepth(texture2D(alphaMap,vAlphaMapUv));
#else
texture2D(alphaMap,vAlphaMapUv).g;
#endif
#if defined(INVERSE_ALPHAMAP) && INVERSE_ALPHAMAP >= 1
diffuseColor.a*=1.0-alphaMapValue;
#else
diffuseColor.a*=alphaMapValue;
#endif
#endif
#include <alphatest_fragment>
#include <logdepthbuf_fragment>
#include <normal_fragment_begin>
#include <normal_fragment_maps>
#ifdef FORCED_LINEAR_DEPTH
float linearZ=float(FORCED_LINEAR_DEPTH);
#else
float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);
#endif
vec2 packedZ=pack16(pow(linearZ,0.5));vec2 packedNormal=packNormal(normal);
#if IS_GLSL3 > 0
#ifndef gl_FragColor
gDepthNormal=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);gFlags=flags;
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
}`;var V3=Object.defineProperty,j3=Object.getOwnPropertyDescriptor,Lg=(r,e,t,i)=>{for(var n=i>1?void 0:i?j3(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&V3(e,t,n),n};p.GBufferPlugin=class extends wc{constructor(r=oi,e=!0,t=!0,i=!0,n=!1,s=un){super(),this.renderFlagsBuffer=i,this.renderDepthTexture=n,this.depthTextureType=s,this.passId="gbuffer",this.textures=[],this.unpackExtension={shaderExtender:a=>{const o=["gbuffer_unpack","packing"].find(l=>a.fragmentShader.includes(`#include <${l}>`));a.fragmentShader=ri(a.fragmentShader,`#include <${o}>`,`
`+tM+`
`,{append:o==="packing"})},extraUniforms:{tNormalDepth:()=>({value:this.normalDepthTexture}),tGBufferFlags:()=>({value:this.flagsTexture}),tGBufferDepthTexture:()=>({value:this.depthTexture})},extraDefines:{HAS_NORMAL_DEPTH_BUFFER:()=>this.normalDepthTexture?1:void 0,GBUFFER_HAS_DEPTH_TEXTURE:()=>this.depthTexture?1:void 0,GBUFFER_HAS_FLAGS:()=>this.flagsTexture?1:void 0,HAS_GBUFFER:()=>this.isPrimaryGBuffer&&this.normalDepthTexture?1:void 0},priority:100,isCompatible:()=>!0},this._isPrimaryGBufferSet=!1,this.enabled=t,this.bufferType=r,this.isPrimaryGBuffer=e}get normalDepthTexture(){return this.textures[0]}get flagsTexture(){return this.textures[1]}get depthTexture(){var r;return(r=this.target)==null?void 0:r.depthTexture}_createTargetAndMaterial(r=!0){var e;if(!this._viewer)return;r&&this._disposeTarget();const t=((e=this._viewer)==null?void 0:e.renderManager.isWebGL2)&&this.renderFlagsBuffer;this.target||(this.target=this._viewer.renderManager.createTarget({depthBuffer:!0,samples:this._viewer.renderManager.zPrepass&&this.isPrimaryGBuffer&&this._viewer.renderManager.composerTarget.samples||0,type:this.bufferType,textureCount:t?2:1,depthTexture:this.renderDepthTexture,depthTextureType:this.depthTextureType,wrapS:ai,wrapT:ai}),Array.isArray(this.target.texture)?(this.target.texture[0].name="gbufferDepthNormal",this.target.texture[1].name="gbufferFlags",this.textures=this.target.texture):(this.target.texture.name="gbufferDepthNormal",this.textures.push(this.target.texture))),this.material||(this.material=new s_(t,{blending:Qt,transparent:!0})),this._pass&&(this._pass.target=this.target),this.isPrimaryGBuffer&&(this._viewer.renderManager.gbufferTarget=this.target,this._viewer.renderManager.gbufferUnpackExtension=this.unpackExtension,this._viewer.renderManager.screenPass.material.registerMaterialExtensions([this.unpackExtension]),this._isPrimaryGBufferSet=!0)}_disposeTarget(){this._viewer&&(this.target&&(this._viewer.renderManager.disposeTarget(this.target),this.target=void 0),this.textures=[],this._isPrimaryGBufferSet&&(this._viewer.renderManager.gbufferTarget=void 0,this._viewer.renderManager.gbufferUnpackExtension=void 0,this._isPrimaryGBufferSet=!1))}_createPass(){if(this._createTargetAndMaterial(!0),!this.target)throw new Error("GBufferPlugin: target not created");if(!this.material)throw new Error("GBufferPlugin: material not created");this.material.userData.isGBufferMaterial=!0;const r=new p.GBufferRenderPass(this.passId,this.target,this.material,new fe(1,1,1),1),e=r.preprocessMaterial;return r.preprocessMaterial=t=>e(t,t.userData.renderToDepth),r.before=["render"],r.after=[],r.required=["render"],r}_beforeRender(r,e,t){return!super._beforeRender(r,e,t)||!this.material?!1:(e.updateShaderProperties(this.material),!0)}registerGBufferUpdater(r,e){this.material&&this.material.flagUpdaters.set(r,e)}unregisterGBufferUpdater(r){this.material&&this.material.flagUpdaters.delete(r)}onRemove(r){var e;return this._disposeTarget(),(e=this.material)==null||e.dispose(),this.material=void 0,super.onRemove(r)}getDepthNormal(){return this.textures.length>0?this.textures[0]:void 0}getFlagsTexture(){return this.textures.length>1?this.textures[1]:void 0}getTarget(){return this.target}getUnpackSnippet(){return tM}updateShaderProperties(r){var e;if(r.uniforms.tNormalDepth?r.uniforms.tNormalDepth.value=this.normalDepthTexture??void 0:(e=this._viewer)==null||e.console.warn("BaseRenderer: no uniform: tNormalDepth"),r.uniforms.tGBufferFlags){r.uniforms.tGBufferFlags.value=this.flagsTexture??void 0;const t=r.uniforms.tGBufferFlags.value?1:0;t!==r.defines.GBUFFER_HAS_FLAGS&&(r.defines.GBUFFER_HAS_FLAGS=t,r.needsUpdate=!0)}return this}},p.GBufferPlugin.PluginType="GBuffer",Lg([_a()],p.GBufferPlugin.prototype,"normalDepthTexture",1),Lg([_a()],p.GBufferPlugin.prototype,"flagsTexture",1),Lg([_a()],p.GBufferPlugin.prototype,"depthTexture",1),p.GBufferPlugin=Lg([ti("G-Buffer Plugin")],p.GBufferPlugin);class s_ extends cy{constructor(e=!0,t){super({vertexShader:z3,fragmentShader:Q3,uniforms:Dn.merge([qe.common,qe.bumpmap,qe.normalmap,qe.displacementmap,{cameraNearFar:{value:new ne(.1,1e3)},flags:{value:new bt(255,255,255,255)}}]),defines:{IS_GLSL3:e?"1":"0"},glslVersion:e?ku:iA,...t}),this.flagUpdaters=new Map,this.normalMapType=pn,this.flatShading=!1,this.reset()}onBeforeRender(e,t,i,n,s){var a,o;super.onBeforeRender(e,t,i,n,s);let l=s.material;if(Array.isArray(l)&&(l=l[0]),!l)return;const c=d=>{const m=l[d];m&&(this.uniforms[d].value=m,this.uniforms[d+"Transform"]?e.materials.refreshTransformUniform(m,this.uniforms[d+"Transform"]):console.error("GBufferMaterial: "+d+"Transform is not defined in uniform"))};c("map"),l.side!==void 0&&(this.side=l.side??dt),c("alphaMap"),l.alphaTest!==void 0&&(this.alphaTest=l.alphaTest<1e-4?1e-4:l.alphaTest),c("bumpMap"),l.bumpScale!==void 0&&(this.uniforms.bumpScale.value=l.bumpScale),c("normalMap"),l.normalScale!==void 0&&this.uniforms.normalScale.value.copy(l.normalScale),l.normalMapType!==void 0&&(this.normalMapType=l.normalMapType),l.flatShading!==void 0&&(this.flatShading=l.flatShading),c("displacementMap"),l.displacementScale!==void 0&&(this.uniforms.displacementScale.value=l.displacementScale),l.displacementBias!==void 0&&(this.uniforms.displacementBias.value=l.displacementBias),l.wireframe!==void 0&&(this.wireframe=l.wireframe),l.wireframeLinewidth!==void 0&&(this.wireframeLinewidth=l.wireframeLinewidth),this.uniforms.flags.value.set(255,255,255,255);const h=((a=l.userData.gBufferData)==null?void 0:a.materialId)??l.userData.matId;this.uniforms.flags.value.z=h||0,this.flagUpdaters.forEach(d=>d(this.uniforms.flags.value,{material:l,renderer:e,scene:t,camera:i,geometry:n,object:s})),this.uniforms.flags.value.x/=255,this.uniforms.flags.value.y/=255,this.uniforms.flags.value.z/=255,this.uniforms.flags.value.w/=255,this.uniformsNeedUpdate=!0,al({ALPHAMAP_UV:this.uniforms.alphaMap.value?"uv":void 0,USE_DISPLACEMENTMAP:this.uniforms.displacementMap.value?1:void 0,DISPLACEMENTMAP_UV:this.uniforms.displacementMap.value?"uv":void 0,ALPHA_I_RGBA_PACKING:l.userData.ALPHA_I_RGBA_PACKING?1:void 0,FORCED_LINEAR_DEPTH:l.userData.forcedLinearDepth??void 0},l),(o=l.materialExtensions)!=null&&o.length&&this.registerMaterialExtensions(l.materialExtensions),this.needsUpdate=!0}onAfterRender(e,t,i,n,s){var a;super.onAfterRender(e,t,i,n,s);let o=s.material;Array.isArray(o)&&(o=o[0]),o&&((a=o.materialExtensions)!=null&&a.length&&this.unregisterMaterialExtensions(o.materialExtensions),this.reset())}reset(){this.uniforms.map.value=null,this.side=dt,this.uniforms.alphaMap.value=null,this.alphaTest=.001,this.uniforms.bumpMap.value=null,this.uniforms.bumpScale.value=1,this.uniforms.normalMap.value=null,this.uniforms.normalScale.value.set(1,1),this.normalMapType=pn,this.flatShading=!1,this.uniforms.displacementMap.value=null,this.uniforms.displacementScale.value=1,this.uniforms.displacementBias.value=0,this.uniforms.flags.value.set(255,255,255,255),this.wireframe=!1,this.wireframeLinewidth=1}}class H3 extends s_{constructor(e,t){super(e,t),console.warn("DepthNormalMaterial is deprecated, use GBufferMaterial instead")}}class pd extends ei{constructor(){super(),this.priority=-100,this._shaderPatch="",this.computeCacheKey=e=>this.isDisabled()?"0":"1",this._onPluginAdd=e=>{var t,i,n;((i=(t=e.plugin)==null?void 0:t.constructor)==null?void 0:i.PluginType)===p.GBufferPlugin.PluginType&&(e.plugin.registerGBufferUpdater(this.constructor.PluginType,this.updateGBufferFlags.bind(this)),(n=this._viewer)==null||n.removeEventListener("addPlugin",this._onPluginAdd))},this.setDirty=this.setDirty.bind(this)}set uniformsNeedUpdate(e){e&&this.setDirty()}shaderExtender(e,t,i){this.isDisabled()||(e.fragmentShader=ri(e.fragmentShader,"#glMarker",`
`+this._shaderPatch+`
`,{prepend:!0}))}getUiConfig(){return this.uiConfig}isCompatible(e){return!0}setDirty(){var e,t;(e=this.__setDirty)==null||e.call(this),(t=this._viewer)==null||t.renderManager.screenPass.setDirty()}fromJSON(e,t){return e.pass&&(e={...e},e.extension={...e.pass},delete e.extension.enabled,delete e.pass),e.extension&&(e={...e,...e.extension},delete e.extension),super.fromJSON(e,t)}onAdded(e){super.onAdded(e);const t=e.getPlugin(p.GBufferPlugin);t?t.registerGBufferUpdater(this.constructor.PluginType,this.updateGBufferFlags.bind(this)):e.addEventListener("addPlugin",this._onPluginAdd),e.renderManager.screenPass.material.registerMaterialExtensions([this])}onRemove(e){var t;e.removeEventListener("addPlugin",this._onPluginAdd),(t=e.getPlugin(p.GBufferPlugin))==null||t.unregisterGBufferUpdater(this.constructor.PluginType),e.renderManager.screenPass.material.unregisterMaterialExtensions([this]),super.onRemove(e)}updateGBufferFlags(e,t){}}var W3=Object.defineProperty,X3=Object.getOwnPropertyDescriptor,xc=(r,e,t,i)=>{for(var n=i>1?void 0:i?X3(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&W3(e,t,n),n};const q3=gu;p.TonemapPlugin=class extends pd{constructor(){super(...arguments),this.extraUniforms={toneMappingContrast:{value:1},toneMappingSaturation:{value:1}},this.extraDefines={TONEMAP_BACKGROUND:"1"},this.enabled=!0,this.toneMapping=bo,this.tonemapBackground=!0,this.exposure=1,this.priority=-100,this.parsFragmentSnippet=()=>this.isDisabled()?"":ro`
            uniform float toneMappingContrast;
            uniform float toneMappingSaturation;
            ${F3}
        `,this._shaderPatch=N3,this._rendererState={}}onObjectRender(r,e,t){if(this.isDisabled())return;const{toneMapping:i,toneMappingExposure:n}=t;this._rendererState.toneMapping=i,this._rendererState.toneMappingExposure=n,t.toneMapping=this.toneMapping,t.toneMappingExposure=this.exposure,e.toneMapped=!0,e.needsUpdate=!0}onAfterRender(r,e,t){t.toneMapping=this._rendererState.toneMapping,t.toneMappingExposure=this._rendererState.toneMappingExposure}fromJSON(r,e){return r.extension&&r.clipBackground!==void 0&&(this._viewer?this._viewer.renderManager.screenPass.clipBackground=r.clipBackground:console.warn("TonemapPlugin: no viewer attached, clipBackground ignored"),delete r.clipBackground),super.fromJSON(r,e)}updateGBufferFlags(r,e){var t,i;const n=(((t=e.material.userData.gBufferData)==null?void 0:t.tonemapEnabled)??((i=e.material)==null?void 0:i.userData.postTonemap))===!1?0:1;r.w=t0(r.w,1,n),super.updateGBufferFlags(r,e)}},p.TonemapPlugin.PluginType="Tonemap",Ft.tonemapping_pars_fragment=Ft.tonemapping_pars_fragment.replace("vec3 CustomToneMapping( vec3 color ) { return color; }",k3),xc([$(),De("Enabled")],p.TonemapPlugin.prototype,"enabled",2),xc([js("Mode",[["Linear",Rd],["Reinhard",Dd],["Cineon",Bd],["ACESFilmic",bo],["Uncharted2",q3]].map(r=>({label:r[0],value:r[1]}))),st(p.TonemapPlugin.prototype.setDirty),$()],p.TonemapPlugin.prototype,"toneMapping",2),xc([De("Tonemap Background",r=>({hidden:()=>{var e;return!((e=r._viewer)!=null&&e.renderManager.gbufferTarget)}})),Sp("TONEMAP_BACKGROUND",void 0,!0,p.TonemapPlugin.prototype.setDirty),$()],p.TonemapPlugin.prototype,"tonemapBackground",2),xc([st(p.TonemapPlugin.prototype.setDirty),Rt("Exposure",[0,2*Math.PI],.01),$()],p.TonemapPlugin.prototype,"exposure",2),xc([Rt("Saturation",[0,2],.01),tl({propKey:"toneMappingSaturation"}),$()],p.TonemapPlugin.prototype,"saturation",2),xc([Rt("Contrast",[0,2],.01),tl({propKey:"toneMappingContrast"}),$()],p.TonemapPlugin.prototype,"contrast",2),p.TonemapPlugin=xc([ti("Tonemapping")],p.TonemapPlugin);const Y3="0.0.33";var K3=Object.defineProperty,J3=Object.getOwnPropertyDescriptor,dd=(r,e,t,i)=>{for(var n=i>1?void 0:i?J3(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&K3(e,t,n),n};p.ThreeViewer=class extends zi{constructor({debug:r=!1,...e}){var t,i,n;super(),this.enabled=!0,this.renderEnabled=!0,this.plugins={},this.maxFramePerLoop=1,this.rendersPerFrame=1,this.type="ThreeViewer",this.resizeObserver=window!=null&&window.ResizeObserver?new window.ResizeObserver(o=>this.resize()):void 0,this._needsResize=!1,this._isRenderingFrame=!1,this._objectProcessor={processObject:o=>{o.material&&(Array.isArray(o.material)?this.assetManager.materials.registerMaterials(o.material):this.assetManager.materials.registerMaterial(o.material))}},this._needsReset=!0,this._lastCameraPosition=new P,this._lastCameraQuat=new Ct,this._lastCameraTarget=new P,this._tempVec=new P,this._tempQuat=new Ct,this.resize=()=>{this._needsResize=!0,this.setDirty()},this.loadConfigResources=async(o,l)=>{if(o.__isLoadedResources)return o;const c=h0(o,this);return await Bf.ImportMeta(c,l)},this._defaultConfig={assetType:"config",type:this.type,version:p.ThreeViewer.VERSION,metadata:{generator:"ThreePipe",version:1},plugins:[]},this._lastSize=new ne,this._onContextRestore=o=>{this.enabled=!0,this._canvas.width=this._lastSize.width,this._canvas.height=this._lastSize.height,this.resize(),this._scene.setDirty({refreshScene:!0,frameFade:!1})},this._onContextLost=o=>{this._lastSize.set(this._canvas.width,this._canvas.height),this._canvas.width=2,this._canvas.height=2,this.resize(),this.enabled=!1},this.debug=r,r&&(p.ThreeViewer.ViewerDebugging=!0),this._canvas=e.canvas||Rw();let s=e.container;if(s&&!e.canvas&&s.appendChild(this._canvas),s||(s=this._canvas.parentElement??void 0),!s)throw new Error("No container(or canvas).");this._container=s,this.setDirty=this.setDirty.bind(this),this._animationLoop=this._animationLoop.bind(this),this._setActiveCameraView=this._setActiveCameraView.bind(this),this.renderStats=new ax(this._container),r&&this.renderStats.show(),window.threeViewers||(window.threeViewers=[]),window.threeViewers.push(this);const a=new Oh(((t=e.camera)==null?void 0:t.controlsMode)??"orbit",this._canvas);a.name="Default Camera",(i=e.camera)!=null&&i.position?a.position.copy(e.camera.position):a.position.set(0,0,5),(n=e.camera)!=null&&n.target?a.target.copy(e.camera.target):a.target.set(0,0,0),a.setDirty(),a.userData.autoLookAtTarget=!0,this.addEventListener("postFrame",()=>{var o,l;const c=this._scene.mainCamera;if(c&&c.canUserInteract){const h=(o=this.getPlugin("ProgressivePlugin"))==null?void 0:o.postFrameConvergedRecordingDelta();if(h!==void 0&&h===0)return;(l=c.controls)==null||l.update()}}),this.addEventListener("preFrame",()=>{const o=this._scene.mainCamera;o.getWorldPosition(this._tempVec).sub(this._lastCameraPosition).lengthSq()+this._tempVec.subVectors(o.target,this._lastCameraTarget).lengthSq()+o.getWorldQuaternion(this._tempQuat).angleTo(this._lastCameraQuat)>1e-6&&o.setDirty()}),this._scene=new p.RootScene(a,this._objectProcessor),this._scene.setBackgroundColor("#ffffff"),this._scene.addEventListener("setView",this._setActiveCameraView),this._scene.addEventListener("activateMain",this._setActiveCameraView),this._scene.addEventListener("materialUpdate",o=>this.setDirty(this._scene,o)),this._scene.addEventListener("materialChanged",o=>this.setDirty(this._scene,o)),this._scene.addEventListener("objectUpdate",o=>this.setDirty(this._scene,o)),this._scene.addEventListener("textureUpdate",o=>this.setDirty(this._scene,o)),this._scene.addEventListener("sceneUpdate",o=>{this.setDirty(this._scene,o),o.geometryChanged!==!1&&this.renderManager.resetShadows()}),this._scene.addEventListener("mainCameraUpdate",()=>{this._scene.mainCamera.getWorldPosition(this._lastCameraPosition),this._lastCameraTarget.copy(this._scene.mainCamera.target),this._scene.mainCamera.getWorldQuaternion(this._lastCameraQuat)}),(e.isAntialiased!==void 0||e.useRgbm!==void 0||e.useGBufferDepth!==void 0)&&this.console.warn("isAntialiased, useRgbm and useGBufferDepth are deprecated, use msaa, rgbm and zPrepass instead."),this.renderManager=new p.ViewerRenderManager({canvas:this._canvas,msaa:e.msaa??e.isAntialiased??!1,rgbm:e.rgbm??e.useRgbm??!1,zPrepass:e.zPrepass??e.useGBufferDepth??!1,depthBuffer:!(e.zPrepass??e.useGBufferDepth??!1),screenShader:e.screenShader,renderScale:typeof e.renderScale=="string"?e.renderScale==="auto"?Math.min(2,window.devicePixelRatio):parseFloat(e.renderScale):e.renderScale}),this.renderManager.addEventListener("animationLoop",this._animationLoop),this.renderManager.addEventListener("resize",()=>this._scene.mainCamera.refreshAspect()),this.renderManager.addEventListener("update",o=>{var l,c;o.change==="registerPass"&&(l=o.pass)!=null&&l.materialExtension?this.assetManager.materials.registerMaterialExtension(o.pass.materialExtension):o.change==="unregisterPass"&&(c=o.pass)!=null&&c.materialExtension&&this.assetManager.materials.unregisterMaterialExtension(o.pass.materialExtension),this.setDirty(this.renderManager,o)}),this.assetManager=new ZC(this,e.assetManager),this.resizeObserver&&this.resizeObserver.observe(this._canvas),window&&window.addEventListener("resize",this.resize),this._canvas.addEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.addEventListener("webglcontextlost",this._onContextLost,!1),e.dropzone&&this.addPluginSync(new p.DropzonePlugin(typeof e.dropzone=="object"?e.dropzone:void 0)),e.tonemap!==!1&&this.addPluginSync(new p.TonemapPlugin);for(const o of e.plugins??[])this.addPluginSync(o);if(this.console.log("ThreePipe Viewer instance initialized, version: ",p.ThreeViewer.VERSION),e.load){const o=[e.load.src].flat().filter(l=>l).map(async l=>l&&this.load(l));e.load.environment&&o.push(this.setEnvironmentMap(e.load.environment)),e.load.background&&o.push(this.setBackgroundMap(e.load.background)),Promise.all(o).then(e.onLoad)}}get materialManager(){return this.assetManager.materials}get scene(){return this._scene}get container(){return this._canvas.parentElement!==this._container&&this.console.error("ThreeViewer: Canvas is not in the container, this might cause issues with some plugins."),this._container}get canvas(){return this._canvas}get console(){return p.ThreeViewer.Console}get dialog(){return p.ThreeViewer.Dialog}async load(r,e){if(r)return await this.assetManager.addAssetSingle(r,e)}async import(r,e){if(r)return await this.assetManager.importer.importSingle(r,e)}async setEnvironmentMap(r,{setBackground:e=!1,...t}={}){return this._scene.environment=r&&!r.isTexture?await this.assetManager.importer.importSingle(r,t)||null:r||null,e?this.setBackgroundMap(this._scene.environment):this._scene.environment}async setBackgroundMap(r,{setEnvironment:e=!1,...t}={}){return this._scene.background=r&&!r.isTexture?await this.assetManager.importer.importSingle(r,t)||null:r||null,e?this.setEnvironmentMap(this._scene.background):this._scene.background}async export(r,e){var t;return r||(r=this._scene.modelRoot),r.type===this.type?u0(r.exportConfig()):(t=r.constructor)!=null&&t.PluginType?u0(this.exportPluginConfig(r)):await this.assetManager.exporter.exportObject(r,e)}async exportScene(r,e=!0){const t=e?this.getPlugin("AssetExporterPlugin"):void 0;return t?t.exportScene(r):this.assetManager.exporter.exportObject(this._scene.modelRoot,r)}async getScreenshotBlob({mimeType:r="image/jpeg",quality:e=90}={}){const t=this.getPlugin("CanvasSnapshotPlugin");if(t)return t.getFile("snapshot."+r.split("/")[1],{mimeType:r,quality:e,waitForProgressive:!0});const i=async()=>new Promise(n=>{this._canvas.toBlob(s=>{n(s)},r,e)});return this.renderEnabled?await this.doOnce("postFrame",async()=>{this.renderEnabled=!1;const n=await i();return this.renderEnabled=!0,n}):i()}async getScreenshotDataUrl({mimeType:r="image/jpeg",quality:e=.9}={}){return this.renderEnabled?await this.doOnce("postFrame",()=>this._canvas.toDataURL(r,e)):this._canvas.toDataURL(r,e)}dispose(r=!0){var e;if(r)for(const t of[...Object.values(this.plugins)])this.removePlugin(t,!0);this._scene.dispose(r),this.renderManager.dispose(r),r&&(this._canvas.removeEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.removeEventListener("webglcontextlost",this._onContextLost,!1),(e=window.threeViewers)==null||e.splice(window.threeViewers.indexOf(this),1),this.resizeObserver&&this.resizeObserver.unobserve(this._canvas),window.removeEventListener("resize",this.resize)),this.dispatchEvent({type:"dispose",clear:r})}setDirty(r,e){this._needsReset=!0,r=r??this,this.dispatchEvent({...e??{},type:"update",source:r})}_animationLoop(r){var e,t;if(!(!this.enabled||!this.renderEnabled)){if(this._isRenderingFrame){this.console.warn("animation loop: frame skip");return}this._isRenderingFrame=!0,this.renderStats.begin();for(let i=0;i<this.maxFramePerLoop;i++){if(this._needsReset&&(this.renderManager.reset(),this._needsReset=!1),this._needsResize){const a=[this._canvas.clientWidth,this._canvas.clientHeight];if(r.xrFrame){const o=(t=(e=this.renderManager.webglRenderer.xr.getCamera())==null?void 0:e.cameras[0])==null?void 0:t.viewport;o?((o.x!==0||o.y!==0)&&this.console.warn("x and y must be 0?"),a[0]=o.width,a[1]=o.height,this.console.log("resize for xr",a)):this._needsResize=!1}this._needsResize&&(this.renderManager.setSize(...a),this._needsResize=!1)}this.dispatchEvent({...r,type:"preFrame",target:this});const n=Object.values(this.plugins).filter(a=>a.dirty);n.length>0&&this.setDirty(n),this._needsReset&&(this.renderManager.reset(),this._needsReset=!1);const s=this.renderManager.needsRender;if(s)for(let a=0;a<this.rendersPerFrame;a++){this.dispatchEvent({type:"preRender",target:this});try{const o=this._scene.mainCamera;this._scene.renderCamera=o,o.visible&&this.renderManager.render(this._scene,this.renderManager.defaultRenderToScreen)}catch(o){if(this.console.error(o),this.debug)throw o}this.dispatchEvent({type:"postRender",target:this})}if(this.dispatchEvent({type:"postFrame",target:this}),this.renderManager.onPostFrame(),!s)break}this.renderStats.end(),this._isRenderingFrame=!1}}getPlugin(r){return this.plugins[typeof r=="string"?r:r.PluginType]}async getOrAddPlugin(r,...e){return this.getPlugin(r)||this.addPlugin(r,...e)}getOrAddPluginSync(r,...e){return this.getPlugin(r)||this.addPluginSync(r,...e)}async addPlugin(r,...e){const t=this._resolvePluginOrClass(r,...e),i=t.constructor.PluginType;if(!t.constructor.PluginType)return this.console.error("PluginType is not defined for",t),t;for(const s of t.dependencies||[])await this.getOrAddPlugin(s);this.plugins[i]&&(this.console.error(`Plugin of type ${i} already exists, removing and disposing old plugin. This might break functionality, ensure only one plugin of a type is added`,this.plugins[i],t),await this.removePlugin(this.plugins[i])),this.plugins[i]=t;const n=t.constructor.OldPluginType;return n&&this.plugins[n]&&this.console.error("Plugin type mismatch"),n&&(this.plugins[n]=t),await t.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:t}),this.setDirty(t),t}addPluginSync(r,...e){const t=this._resolvePluginOrClass(r,...e),i=t.constructor.PluginType;if(!t.constructor.PluginType)return this.console.error("PluginType is not defined for",t),t;for(const s of t.dependencies||[])this.getOrAddPluginSync(s);this.plugins[i]&&(this.console.error(`Plugin of type ${i} already exists, removing and disposing old plugin. This might break functionality, ensure only one plugin of a type is added`,this.plugins[i],t),this.removePluginSync(this.plugins[i])),this.plugins[i]=t;const n=t.constructor.OldPluginType;return n&&this.plugins[n]&&this.console.error("Plugin type mismatch"),n&&(this.plugins[n]=t),t.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:t}),this.setDirty(t),t}async addPlugins(r){for(const e of r)await this.addPlugin(e)}addPluginsSync(r){for(const e of r)this.addPluginSync(e)}async removePlugin(r,e=!0){const t=r.constructor.PluginType;this.plugins[t]&&(await r.onRemove(this),this.dispatchEvent({type:"removePlugin",target:this,plugin:r}),delete this.plugins[t],e&&await r.dispose(),this.setDirty(r))}removePluginSync(r,e=!0){const t=r.constructor.PluginType;this.plugins[t]&&(r.onRemove(this),this.dispatchEvent({type:"removePlugin",target:this,plugin:r}),delete this.plugins[t],e&&r.dispose(),this.setDirty(r))}setSize(r){this._canvas.style.width=r!=null&&r.width?r.width+"px":"100%",this._canvas.style.height=r!=null&&r.height?r.height+"px":"100%",this.resize()}setRenderSize(r,e="contain",t=1,i){const n=i||this.container.getBoundingClientRect(),s=n.height,a=n.width,o=r.width,l=r.height,c=o/l,h=a/s,d=t;let m,f;switch(e){case"contain":h>c?(m=s*c,f=s):(m=a,f=a/c);break;case"cover":h>c?(m=a,f=a/c):(m=s*c,f=s);break;case"fill":m=a,f=s;break;case"scale-down":o<a&&l<s?(m=o,f=l):h>c?(m=s*c,f=s):(m=a,f=a/c);break;case"none":m=o,f=l;break;default:throw new Error(`Invalid mode: ${e}`)}this.setSize({width:m,height:f}),this.renderManager.renderScale=d*l/f}traverseSceneObjects(r){this._scene.modelRoot.traverse(r)}async addSceneObject(r,e){var t;if((t=r.userData)!=null&&t.rootSceneModelRoot){const i=r;return this._scene.loadModelRoot(i,e),i.importedViewerConfig&&(e==null?void 0:e.importConfig)!==!1&&await this.importConfig(i.importedViewerConfig),this._scene.modelRoot}return this._scene.addObject(r,e),r}serializePlugins(r,e){return e&&e.length===0?[]:Object.entries(this.plugins).map(t=>{var i,n;if(!(e&&!e.includes(t[1].constructor.PluginType)))return t[1].serializeWithViewer!==!1?(n=(i=t[1]).toJSON)==null?void 0:n.call(i,r):void 0}).filter(t=>!!t)}deserializePlugins(r,e){return r.forEach(t=>{var i;if(!t.type){this.console.warn("Invalid plugin to import ",t);return}const n=this.getPlugin(t.type);n&&((i=n.fromJSON)==null||i.call(n,t,e))}),this}exportPluginConfig(r){var e;if((r&&typeof r=="string"||r.PluginType)&&(r=this.getPlugin(r)),!r)return{};const t=nc(),i=(e=r.toJSON)==null?void 0:e.call(r,t);return i?(i.resources=Lf(t),i):{}}async importPluginConfig(r,e){const t=r.type;if(e=e||this.getPlugin(t),!e){this.console.warn(`No plugin found for type ${t} to import config`);return}if(!e.fromJSON){this.console.warn(`Plugin ${t} does not support importing presets`);return}const i=r.resources||{};r.resources&&delete r.resources;const n=await this.loadConfigResources(i);return await e.fromJSON(r,n),n&&(r.resources=n),e}exportPluginsConfig(r){const e=nc(),t=this.serializePlugins(e,r);return c0(e),{...this._defaultConfig,plugins:t,resources:Lf(e)}}exportConfig(r=!1,e){return this.toJSON(r,e)}async importConfig(r){if(r.type!==this.type&&r.type!=="ViewerApp"){if(this.getPlugin(r.type))return this.importPluginConfig(r);this.console.error(`Unknown config type ${r.type} to import`);return}const e=await this.loadConfigResources(r.resources||{});this.fromJSON(r,e)}toJSON(r=!0,e){const t=nc(),i=Object.assign({...this._defaultConfig,plugins:this.serializePlugins(t,e)},Kt.Serialize(this,t,!0));return r||c0(t),i.resources=Lf(t),i}fromJSON(r,e){var t,i,n,s,a;const o={...r};return o.backgroundIntensity!==void 0&&((t=o.scene)==null?void 0:t.backgroundIntensity)===void 0&&(this.console.warn("old file format, backgroundIntensity moved to RootScene"),this._scene.backgroundIntensity=o.backgroundIntensity,delete o.backgroundIntensity),o.useLegacyLights!==void 0&&((i=o.renderManager)==null?void 0:i.useLegacyLights)===void 0&&(this.console.warn("old file format, useLegacyLights moved to RenderManager"),this.renderManager.useLegacyLights=o.useLegacyLights,delete o.useLegacyLights),o.background!==void 0&&((n=o.scene)==null?void 0:n.background)===void 0&&(this.console.warn("old file format, background moved to RootScene"),o.background==="envMapBackground"?o.background="environment":typeof o.background=="number"?o.background=new fe().setHex(o.background,wi):typeof o.background=="string"?o.background=new fe().setStyle(o.background,wi):(s=o.background)!=null&&s.isColor&&(o.background=new fe(o.background)),(a=o.background)!=null&&a.isColor?(this._scene.backgroundColor=o.background,this._scene.background=null):o.background?(this._scene.backgroundColor=new fe("#ffffff"),o.scene||(o.scene={}),o.scene.background=o.background):(this._scene.backgroundColor=null,this._scene.background=null),delete o.background),!e&&o.resources&&o.resources.__isLoadedResources&&(e=o.resources,delete o.resources),e!=null&&e.__isLoadedResources?(Array.isArray(o.plugins)&&(this.deserializePlugins(o.plugins,e),delete o.plugins),Kt.Deserialize(o,this,e,!0),this):(this.console.error("meta in fromJSON is not available or is not loaded resources, call viewer.loadConfigResources first, or directly use viewer.importConfig"),null)}async doOnce(r,e){return new Promise(t=>{const i=async(...n)=>{this.removeEventListener(r,i),t(await(e==null?void 0:e(...n)))};this.addEventListener(r,i)})}dispatchEvent(r){super.dispatchEvent(r),super.dispatchEvent({...r,type:"*",eType:r.type})}async exportBlob(r,e){const t=this.getPlugin("FileTransferPlugin");if(e=e??r.name??"file",!t){Cp(r,e);return}await t.exportFile(r,e)}_setActiveCameraView(r={}){if(r.type==="setView"){if(!r.camera){this.console.warn("Cannot find camera",r);return}this._scene.mainCamera.setViewFromCamera(r.camera)}else r.type==="activateMain"&&(this._scene.mainCamera=r.camera||void 0)}_resolvePluginOrClass(r,...e){let t;if(r.prototype){const i=this.getPlugin(r);if(i)return this.console.error(`Plugin of type ${i.constructor.PluginType} already exists, no new plugin created`,i),i;t=new r(...e)}else t=r;return t}_renderEnabledChanged(){this.dispatchEvent({type:this.renderEnabled?"renderEnabled":"renderDisabled"})}async fitToView(r,e=1.5,t,i){var n;const s=this.getPlugin("CameraViews");if(!s){this.console.error("CameraViewPlugin (CameraViews) is required for fitToView to work");return}await(s==null?void 0:s.animateToFitObject(r,e,t,i,{min:(((n=this.scene.mainCamera.controls)==null?void 0:n.minDistance)??.5)+.5,max:1e3}))}get canvasTexture(){if(!this._canvas)throw new Error("Canvas not found");return this._canvasTexture||(this._canvasTexture=new jm(this._canvas),this._canvasTexture.flipY=!1,this._canvasTexture.needsUpdate=!0),this._canvasTexture}get renderer(){return this.console.error("renderer is deprecated, use renderManager instead"),this.renderManager}getManager(){return this.assetManager}getPluginByType(r){return this.plugins[r]}},p.ThreeViewer.VERSION=Y3,p.ThreeViewer.ConfigTypeSlug="vjson",p.ThreeViewer.Console={log:console.log.bind(console),warn:console.warn.bind(console),error:console.error.bind(console)},p.ThreeViewer.Dialog=nx,p.ThreeViewer.ViewerDebugging=!1,dd([st(p.ThreeViewer.prototype._renderEnabledChanged)],p.ThreeViewer.prototype,"renderEnabled",2),dd([ur(),$("renderManager")],p.ThreeViewer.prototype,"renderManager",2),dd([$()],p.ThreeViewer.prototype,"type",2),dd([ur(),$("scene")],p.ThreeViewer.prototype,"_scene",2),p.ThreeViewer=dd([Xr("Viewer")],p.ThreeViewer);const Z3="153",$3={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},ek={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},tk=0,ik=1,rk=2,nk=3,sk=0,ak=1,ok=2,lk=3,ck=0,hk=1,uk=2,pk=2,dk=0,mk=1,fk=2,gk=3,Ak=4,vk=5,yk=100,_k=101,bk=102,wk=103,xk=104,Ek=200,Ck=201,Mk=202,Sk=203,Tk=204,Ik=205,Pk=206,Rk=207,Dk=208,Bk=209,Lk=210,Uk=0,Ok=1,kk=2,Fk=3,Nk=4,Gk=5,zk=6,Qk=7,Vk=0,jk=1,Hk=2,Wk=0,Xk=1,qk=2,Yk=3,Kk=4,Jk=5,Zk=300,$k=301,eF=302,tF=303,iF=304,rF=306,nF=1e3,sF=1001,aF=1002,oF=1003,lF=1004,cF=1004,hF=1005,uF=1005,pF=1006,dF=1007,mF=1007,fF=1008,gF=1008,AF=1009,vF=1010,yF=1011,_F=1012,bF=1013,wF=1014,xF=1015,EF=1016,CF=1017,MF=1018,SF=1020,TF=1021,IF=1023,PF=1024,RF=1025,DF=1026,BF=1027,LF=1028,UF=1029,OF=1030,kF=1031,FF=1033,NF=33776,GF=33777,zF=33778,QF=33779,VF=35840,jF=35841,HF=35842,WF=35843,XF=36196,qF=37492,YF=37496,KF=37808,JF=37809,ZF=37810,$F=37811,eN=37812,tN=37813,iN=37814,rN=37815,nN=37816,sN=37817,aN=37818,oN=37819,lN=37820,cN=37821,hN=36492,uN=36283,pN=36284,dN=36285,mN=36286,fN=2200,gN=2201,AN=2202,vN=2300,yN=2301,_N=2302,bN=2400,wN=2401,xN=2402,EN=2500,CN=2501,MN=0,SN=1,TN=2,IN=3e3,PN=3001,RN=3200,DN=3201,BN=0,LN=1,UN="",ON="srgb",kN="srgb-linear",FN="display-p3",NN="rgbm-16",GN=0,zN=7680,QN=7681,VN=7682,jN=7683,HN=34055,WN=34056,XN=5386,qN=512,YN=513,KN=514,JN=515,ZN=516,$N=517,eG=518,tG=519,iG=512,rG=513,nG=514,sG=515,aG=516,oG=517,lG=518,cG=519,hG=35044,uG=35048,pG=35040,dG=35045,mG=35049,fG=35041,gG=35046,AG=35050,vG=35042,yG="100",_G="300 es",bG=1035,wG=2e3,xG=2001;class Ec{constructor(){this.toJSON=null}onAdded(e){e.assetManager.importer.addImporter(this._importer)}onRemove(e){e.assetManager.importer.removeImporter(this._importer)}dispose(){}}var EG=Object.defineProperty,CG=Object.getOwnPropertyDescriptor,fo=(r,e,t,i)=>{for(var n=i>1?void 0:i?CG(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&EG(e,t,n),n};p.BaseGroundPlugin=class extends ei{constructor(){super(),this._transformNeedRefresh=!0,this.visible=!0,this.size=8,this.yOffset=0,this.renderToDepth=!0,this.tonemapGround=!0,this.limitCameraAboveGround=!1,this.autoAdjustTransform=!0,this.enableRefreshTransform=!0,this._cameraLimitsSet=!1,this._cameraLastMaxPolarAngle=Math.PI,this._refreshMaterial=this._refreshMaterial.bind(this),this._refreshTransform=this._refreshTransform.bind(this),this._refreshCameraLimits=this._refreshCameraLimits.bind(this),this.refresh=this.refresh.bind(this),this._refresh2=this._refresh2.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this._preRender=this._preRender.bind(this),this._postFrame=this._postFrame.bind(this),this._geometry=Ln.upgradeGeometry.call(new as(1,1,1,1)),this._geometry.attributes.uv2=this._geometry.attributes.uv.clone(),this._geometry.attributes.uv2.needsUpdate=!0,this._mesh=this._createMesh(),this.refresh()}get enabled(){return this.visible}set enabled(r){this.visible=r}onAdded(r){super.onAdded(r),r.scene.addObject(this._mesh,{addToRoot:!0}),r.scene.addEventListener("sceneUpdate",this._onSceneUpdate),r.scene.addEventListener("addSceneObject",this._onSceneUpdate),r.addEventListener("preRender",this._preRender),r.addEventListener("postFrame",this._postFrame),this.refresh()}onRemove(r){var e;return(e=this._mesh)==null||e.dispose(!0),this._removeMaterial(),r.scene.removeEventListener("sceneUpdate",this._onSceneUpdate),r.scene.removeEventListener("addSceneObject",this._onSceneUpdate),r.removeEventListener("postFrame",this._postFrame),r.removeEventListener("preRender",this._preRender),super.onRemove(r)}_postFrame(){this._transformNeedRefresh&&this._refreshTransform(),this._viewer}_preRender(){this._viewer}dispose(){var r,e,t;this._removeMaterial(),this._geometry.dispose(),(r=this._material)==null||r.dispose(),(t=(e=this._mesh)==null?void 0:e.dispose)==null||t.call(e),super.dispose()}_removeMaterial(){this._material&&(this._material.userData.renderToDepth=this._material.userData.__renderToDepth,this._material.userData.__renderToDepth=void 0,this._material=void 0)}_onSceneUpdate(r){(r==null?void 0:r.geometryChanged)!==!1&&(r==null?void 0:r.updateGround)!==!1&&this.refreshTransform()}refreshTransform(){this.enableRefreshTransform&&(this._transformNeedRefresh=!0)}refresh(){this._viewer&&(this._refreshMaterial(),this.refreshTransform(),this._refreshCameraLimits())}_refresh2(){this.refresh()}_refreshCameraLimits(){var r;const e=(r=this._viewer)==null?void 0:r.scene.mainCamera.controls;if(e){if(e.maxPolarAngle===void 0){console.warn("refreshCameraLimits only available with orbit controls.");return}this.limitCameraAboveGround?(this._cameraLimitsSet||(this._cameraLastMaxPolarAngle=e.maxPolarAngle),e.maxPolarAngle=Math.PI/2,this._cameraLimitsSet=!0):this._cameraLimitsSet&&(e.maxPolarAngle=this._cameraLastMaxPolarAngle,this._cameraLimitsSet=!1)}}_refreshTransform(){var r;if(!this._mesh||!this._viewer)return;let e=!1;if(this.visible!==this._mesh.visible&&(this._mesh.visible=this.visible,e=!0),this.isDisabled()){e&&((r=this._viewer)==null||r.scene.setDirty());return}if(this.autoAdjustTransform){this._mesh.userData.bboxVisible=!1;const t=this._viewer.scene.getBounds(!0);this._mesh.userData.bboxVisible=!0;const i=t.getCenter(new P).sub(new P(0,t.getSize(new P).y/2+this.yOffset,0));e=e||i.clone().sub(this._mesh.position).length()>1e-4,e&&this._mesh.position.copy(i)}e=e||Math.abs(this._mesh.scale.x-this.size)>1e-4,e&&(this._mesh.scale.setScalar(this.size),this._mesh.setRotationFromEuler(new Di(-Math.PI/2,0,this._mesh.rotation.z)),this._mesh.matrixWorldNeedsUpdate=!0,this._mesh.setDirty()),this._transformNeedRefresh=!1}_createMesh(r){return r?r.geometry=this._geometry:r=new hE(this._geometry,new kh),r&&(r.userData.physicsMass=0,r.userData.userSelectable=!1,r.castShadow=!0,r.receiveShadow=!0,r.name="Ground Plane"),r}_createMaterial(r){return r||(r=new xa({name:"BaseGroundMaterial",color:16777215})),r.userData.runtimeMaterial=!0,r}_refreshMaterial(){var r;if(!this._viewer||this.isDisabled())return!1;const e=this._material??this._createMaterial(),t=e!==this._material;return t&&(this._removeMaterial(),this._material=e,(r=this._material)!=null&&r.uuid||console.warn("No material found for ground"),this._viewer.scene.setDirty(),this._mesh&&this._material&&(this._material.roughness=.2,this._material.metalness=.5,this._mesh.material=this._material)),this._material&&(this._material.userData.__renderToDepth===void 0&&(this._material.userData.__renderToDepth=this._material.userData.renderToDepth),this._material.userData.renderToDepth!==this.renderToDepth&&(this._material.userData.renderToDepth=this.renderToDepth),this._material.userData.gBufferData||(this._material.userData.gBufferData={}),this._material.userData.gBufferData.__tonemapEnabled===void 0&&(this._material.userData.gBufferData.__tonemapEnabled=this._material.userData.gBufferData.tonemapEnabled),this._material.userData.gBufferData.tonemapEnabled!==this.tonemapGround&&(this._material.userData.gBufferData.tonemapEnabled=this.tonemapGround)),this._viewer.setDirty(this),t}get material(){return this._material}get mesh(){return this._mesh}fromJSON(r,e){return r.options&&console.error("todo: support old webgi v0 file"),super.fromJSON(r,e)?(this.refresh(),this):null}},p.BaseGroundPlugin.PluginType="BaseGroundPlugin",fo([De("Visible"),st(p.BaseGroundPlugin.prototype.refreshTransform),$()],p.BaseGroundPlugin.prototype,"visible",2),fo([vn("Size"),Ir(p.BaseGroundPlugin.prototype._onSceneUpdate),$()],p.BaseGroundPlugin.prototype,"size",2),fo([vn("Height (yOffset)"),Ir(p.BaseGroundPlugin.prototype._onSceneUpdate),$()],p.BaseGroundPlugin.prototype,"yOffset",2),fo([De("Render to Depth"),st(p.BaseGroundPlugin.prototype._refresh2),$()],p.BaseGroundPlugin.prototype,"renderToDepth",2),fo([De("Tonemap Ground"),st(p.BaseGroundPlugin.prototype._refresh2),$()],p.BaseGroundPlugin.prototype,"tonemapGround",2),fo([De("Limit Camera Above Ground"),st(p.BaseGroundPlugin.prototype._refreshCameraLimits),$()],p.BaseGroundPlugin.prototype,"limitCameraAboveGround",2),fo([De("Auto Adjust Transform"),st(p.BaseGroundPlugin.prototype.refreshTransform),$()],p.BaseGroundPlugin.prototype,"autoAdjustTransform",2),fo([$("material"),ur()],p.BaseGroundPlugin.prototype,"_material",2),p.BaseGroundPlugin=fo([ti("Ground")],p.BaseGroundPlugin);class Ug extends ei{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._cameraChanged=e=>{var t,i,n,s;(i=(t=e.lastCamera)==null?void 0:t.removeControlsCtor)==null||i.call(t,this.controlsKey),(s=(n=e.camera)==null?void 0:n.setControlsCtor)==null||s.call(n,this.controlsKey,this._controlsCtor)}}onAdded(e){super.onAdded(e),this._cameraChanged({camera:e.scene.mainCamera}),e.scene.addEventListener("mainCameraChange",this._cameraChanged)}onRemove(e){this._cameraChanged({lastCamera:e.scene.mainCamera}),e.scene.removeEventListener("mainCameraChange",this._cameraChanged),super.onRemove(e)}}var MG=Object.defineProperty,SG=(r,e,t,i)=>{for(var n=void 0,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=a(e,t,n)||n);return n&&MG(e,t,n),n};const a_=class extends ei{constructor(r,e){super(),this.container=e,this.enabled=!0,this._mainDiv=$o({id:"assetManager"+r,addToBody:!1,innerHTML:""}),this._contentDiv=$o({id:"assetManager"+r+"Content",addToBody:!1,innerHTML:""}),this.enabled||(this._mainDiv.style.display="none"),this._mainDiv.appendChild(this._contentDiv),this._onProcessStateUpdate=this._onProcessStateUpdate.bind(this)}_onEnabledChange(){this.enabled||(this._mainDiv.style.display="none")}onAdded(r){super.onAdded(r),(this.container??r.container).appendChild(this._mainDiv),this._updateMainDiv(r.assetManager.processState),r.assetManager.addEventListener("processStateUpdate",this._onProcessStateUpdate)}_onProcessStateUpdate(){this._viewer&&this._updateMainDiv(this._viewer.assetManager.processState)}onRemove(r){return this._mainDiv.remove(),r.assetManager.removeEventListener("processStateUpdate",this._onProcessStateUpdate),super.onRemove(r)}};SG([De("Enabled"),st(a_.prototype._onEnabledChange),$()],a_.prototype,"enabled");let iM=a_;class rM extends Nh{constructor(e){super({vertexShader:yc.vertexShader,fragmentShader:ro`
                uniform vec4 weight;
                uniform vec4 weight2;
                varying vec2 vUv;
                void main() {
                    vec4 texel = clamp(weight * tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ) + weight2 * tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:e},weight:{value:new bt(1,1,1,1)},weight2:{value:new bt(1,1,1,1)}}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}}var TG=Object.defineProperty,IG=Object.getOwnPropertyDescriptor,md=(r,e,t,i)=>{for(var n=i>1?void 0:i?IG(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&TG(e,t,n),n};p.SSAAPlugin=class extends ei{constructor(r=1){super(),this.enabled=!0,this.rendersPerFrame=1,this.jitterRenderCamera=!0,this.jitterLightCameras=!0,this._hasSetOffsetRC=!1,this._hasSetOffsetLC=!1,this.trackedJitterCameras=new Set,this.dependencies=[p.ProgressivePlugin],this._addSceneObject=e=>{var t;(t=e.object)==null||t.traverse(i=>{i&&i.shadow&&i.shadow.camera&&i.shadow.mapSize&&this.trackedJitterCameras.add([i.shadow.camera,i.shadow.mapSize])})},this._preRender=()=>{const e=this._viewer;if(!e||!this.enabled||e.renderManager.frameCount<=1)return;this.rendersPerFrame=e.rendersPerFrame;const t=e.scene.renderCamera;this.jitterRenderCamera&&this._jitter(t,{width:e.renderManager.renderSize.x*e.renderManager.renderScale,height:e.renderManager.renderSize.y*e.renderManager.renderScale},e.renderManager.frameCount),this.jitterLightCameras&&this.trackedJitterCameras.forEach(i=>this._jitter(...i,e.renderManager.frameCount)),this._hasSetOffsetRC=this.jitterRenderCamera,this._hasSetOffsetLC=this.jitterLightCameras,e.renderManager.resetShadows()},this._postRender=()=>{const e=this._viewer;e&&(this._hasSetOffsetRC&&(this._clearJitter(e.scene.renderCamera),this._hasSetOffsetRC=!1),this._hasSetOffsetLC&&(this.trackedJitterCameras.forEach(([t])=>this._clearJitter(t)),this._hasSetOffsetLC=!1))},this.jitterOffsets=[{x:0,y:0},{x:-.5,y:0},{x:-.375,y:-.25},{x:-.1875,y:-.125},{x:-.125,y:-.375},{x:.0625,y:-.0625},{x:.125,y:-.3125},{x:.375,y:-.4375},{x:.3125,y:-.1875},{x:.25,y:.0625},{x:.4375,y:.25},{x:.1875,y:.3125},{x:0,y:.4375},{x:-.0625,y:.1875},{x:-.25,y:.375},{x:-.4375,y:.5},{x:-.3125,y:.125}],this.rendersPerFrame=r}onAdded(r){super.onAdded(r),r.addEventListener("preRender",this._preRender),r.addEventListener("postRender",this._postRender),r.scene.addEventListener("addSceneObject",this._addSceneObject)}onRemove(r){return r.removeEventListener("preRender",this._preRender),r.removeEventListener("postRender",this._postRender),r.scene.removeEventListener("addSceneObject",this._addSceneObject),super.onRemove(r)}setDirty(){var r,e;this._viewer&&(this._viewer.rendersPerFrame=this.rendersPerFrame,this._viewer.setDirty(),(e=(r=this.uiConfig)==null?void 0:r.uiRefresh)==null||e.call(r,!0,"postFrame"))}_jitter(r,e,t){var i;if(r.userData.disableJitter)return;if(r.userData.__jittered){(i=this._viewer)==null||i.console.warn("SSAAPlugin: Camera already jittered");return}const n={...this.jitterOffsets[t%this.jitterOffsets.length]};r.setViewOffset(e.width,e.height,n.x,n.y,e.width,e.height),r.userData.__jittered=!0}_clearJitter(r){r.userData.__jittered&&(r.clearViewOffset(),delete r.userData.__jittered)}},p.SSAAPlugin.PluginType="SSAAPlugin",md([$(),De("Enabled"),st(p.SSAAPlugin.prototype.setDirty)],p.SSAAPlugin.prototype,"enabled",2),md([$(),Rt("Renders/Frame",[1,32],1),st(p.SSAAPlugin.prototype.setDirty)],p.SSAAPlugin.prototype,"rendersPerFrame",2),md([$(),De("Render Camera"),st(p.SSAAPlugin.prototype.setDirty)],p.SSAAPlugin.prototype,"jitterRenderCamera",2),md([$(),De("Light Cameras"),st(p.SSAAPlugin.prototype.setDirty)],p.SSAAPlugin.prototype,"jitterLightCameras",2),p.SSAAPlugin=md([ti("SSAA Plugin")],p.SSAAPlugin);var PG=Object.defineProperty,RG=Object.getOwnPropertyDescriptor,o_=(r,e,t,i)=>{for(var n=i>1?void 0:i?RG(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&PG(e,t,n),n};p.ProgressivePlugin=class extends wc{constructor(r=32,e=oi,t=!0){super(),this.passId="progressive",this._targets=new Map,this.maxFrameCount=r,this.enabled=t,this.bufferType=e}get texture(){var r;return(r=this.target)==null?void 0:r.texture}get target(){return this._viewer?this._targets.get(this._viewer.scene.renderCamera.uuid):void 0}getTarget(r){return this._viewer?this._targets.get((r||this._viewer.scene.renderCamera).uuid):void 0}get textures(){return this._viewer?Array.from(this._targets.values()).map(r=>r.texture):[]}get mainTexture(){var r;return this._viewer?(r=this.getTarget(this._viewer.scene.mainCamera))==null?void 0:r.texture:void 0}_createTarget(r,e=!1){if(!this._viewer)return;if(r=r??this._viewer.scene.renderCamera,e&&this._disposeTarget(r),this._targets.has(r.uuid))return this._targets.get(r.uuid);const t=this._viewer.renderManager.composerTarget.clone(!0);return t.texture.name="progressiveLastBuffer_"+r.uuid,this._targets.set(r.uuid,t),t}_disposeTarget(r){if(this._viewer)if(!r)this._targets.forEach(e=>this._viewer.renderManager.disposeTarget(e)),this._targets.clear();else{const e=this._targets.get(r.uuid);e&&(this._viewer.renderManager.disposeTarget(e),this._targets.delete(r.uuid))}}_createPass(){const r=new nM(this.passId,()=>this.target??this._createTarget());return r.dirty=()=>{var e;return(((e=this._viewer)==null?void 0:e.renderManager.frameCount)||0)<this.maxFrameCount},r}onAdded(r){super.onAdded(r)}onRemove(r){return this._disposeTarget(),super.onRemove(r)}isConverged(r=!1){var e;return(((e=this._viewer)==null?void 0:e.renderManager.frameCount)||0)>=this.maxFrameCount-1+(r?1:0)}updateShaderProperties(r){var e;return r.uniforms.tLastFrame&&(r.uniforms.tLastFrame.value=((e=this.target)==null?void 0:e.texture)??void 0),this}postFrameConvergedRecordingDelta(r="CanvasRecorder"){return-1}get convergedPromise(){return new Promise(r=>{var e,t;if(this.isConverged())(e=this._viewer)==null||e.doOnce("postFrame",()=>r());else{const i=()=>{var n,s;this.isConverged(!0)&&((n=this._viewer)==null||n.removeEventListener("postRender",i),(s=this._viewer)==null||s.doOnce("postFrame",()=>r()))};(t=this._viewer)==null||t.addEventListener("postRender",i)}})}fromJSON(r,e){var t;if(r.jitter!==void 0){const i=(t=this._viewer)==null?void 0:t.getPlugin(p.SSAAPlugin);i?(r={...r},i.enabled=r.jitter,delete r.jitter):console.warn("Loading old webgi v0 file, add SSAAPlugin to get anti-aliasing")}return super.fromJSON(r,e)}},p.ProgressivePlugin.PluginType="ProgressivePlugin",p.ProgressivePlugin.OldPluginType="Progressive",o_([$(),Lt("Frame count")],p.ProgressivePlugin.prototype,"maxFrameCount",2),o_([_a("Last Texture")],p.ProgressivePlugin.prototype,"mainTexture",1),p.ProgressivePlugin=o_([ti("Progressive Plugin")],p.ProgressivePlugin);class nM extends rM{constructor(e,t){super(),this.passId=e,this.target=t,this.before=["screen"],this.after=["render"],this.required=["render"],this.dirty=()=>!1}render(e,t,i,n,s){if(!this.enabled)return;const a=sr(this.target);if(!a){console.warn("ProgressiveBlendPass: target not defined");return}if(e.renderManager.frameCount<1){this.needsSwap=!1,i!=null&&i.texture&&e.renderManager.blit(a,{source:i.texture,respectColorSpace:!1});return}this.needsSwap=!0,super.render(e,t,i,n,s),e.renderManager.blit(a,{source:t.texture,respectColorSpace:!1})}beforeRender(e,t,i){var n;if(!this.enabled)return;if(!this.target){console.error("ProgressiveBlendPass: render target undefined");return}let s=1/(Math.max(i.frameCount,0)+1);this.uniforms.weight.value.set(s,s,s,s),s=1-s,this.uniforms.weight2.value.set(s,s,s,s),this.uniforms.tDiffuse2.value=(n=sr(this.target))==null?void 0:n.texture,this.material.uniformsNeedUpdate=!0}}const DG=`#if defined(HAS_DEPTH_BUFFER)
#if DEPTH_PACKING == 3200
#define unpackDepth(rgba_depth) (1.0 - rgba_depth.r)
#elif DEPTH_PACKING == 3201
#define unpackDepth(rgba_depth) unpackRGBAToDepth(rgba_depth)
#endif
uniform sampler2D tDepthBuffer;
#define getDepth(uv) unpackDepth(texture2D(tDepthBuffer, uv))
#endif
`;var BG=Object.defineProperty,LG=Object.getOwnPropertyDescriptor,l_=(r,e,t,i)=>{for(var n=i>1?void 0:i?LG(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&BG(e,t,n),n};p.DepthBufferPlugin=class extends wc{constructor(r=oi,e=!1,t=!0,i=xs){super(),this.passId="depth",this.material=new UG({depthPacking:xs,blending:Qt,transparent:!0}),this.unpackExtension={shaderExtender:n=>{const s=["depth_buffer_unpack","gbuffer_unpack","packing"].find(a=>n.fragmentShader.includes(`#include <${a}>`));n.fragmentShader=ri(n.fragmentShader,`#include <${s}>`,`
`+DG+`
`,{append:s==="packing"})},extraUniforms:{tDepthBuffer:()=>{var n;return{value:(n=this.target)==null?void 0:n.texture}}},extraDefines:{DEPTH_PACKING:xs,HAS_DEPTH_BUFFER:()=>{var n;return(n=this.target)!=null&&n.texture?1:void 0},HAS_GBUFFER:()=>{var n;return this.isPrimaryGBuffer&&(n=this.target)!=null&&n.texture?1:void 0}},priority:100,isCompatible:()=>!0},this._isPrimaryGBufferSet=!1,this.enabled=t,this.depthPacking=i,this.bufferType=r,this.isPrimaryGBuffer=e}_depthPackingChanged(){var r,e;this.material.depthPacking=this.depthPacking,this.material.needsUpdate=!0,this.unpackExtension&&this.unpackExtension.extraDefines&&(this.unpackExtension.extraDefines.DEPTH_PACKING=this.depthPacking,(e=(r=this.unpackExtension).setDirty)==null||e.call(r)),this.setDirty()}_createTarget(r=!0){this._viewer&&(r&&this._disposeTarget(),this.target||(this.target=this._viewer.renderManager.createTarget({depthBuffer:!0,samples:this._viewer.renderManager.zPrepass&&this.isPrimaryGBuffer&&this._viewer.renderManager.composerTarget.samples||0,type:this.bufferType})),this.texture=this.target.texture,this.texture.name="depthBuffer",this._pass&&(this._pass.target=this.target),this.isPrimaryGBuffer&&(this._viewer.renderManager.gbufferTarget=this.target,this._viewer.renderManager.gbufferUnpackExtension=this.unpackExtension,this._viewer.renderManager.screenPass.material.registerMaterialExtensions([this.unpackExtension]),this._isPrimaryGBufferSet=!0))}_disposeTarget(){this._viewer&&(this.target&&(this._viewer.renderManager.disposeTarget(this.target),this.target=void 0),this.texture=void 0,this._isPrimaryGBufferSet&&(this._viewer.renderManager.gbufferTarget=void 0,this._viewer.renderManager.gbufferUnpackExtension=void 0,this._isPrimaryGBufferSet=!1))}_createPass(){if(this._createTarget(!0),!this.target)throw new Error("DepthBufferPlugin: target not created");this.material.userData.isGBufferMaterial=!0;const r=new p.GBufferRenderPass(this.passId,this.target,this.material,new fe(0,0,0),1),e=r.preprocessMaterial;return r.preprocessMaterial=t=>e(t,t.userData.renderToDepth),r.before=["render"],r.after=[],r.required=["render"],r}onRemove(r){return this._disposeTarget(),super.onRemove(r)}},p.DepthBufferPlugin.PluginType="DepthBufferPlugin",l_([_a("Depth Buffer")],p.DepthBufferPlugin.prototype,"texture",2),l_([st(p.DepthBufferPlugin.prototype._depthPackingChanged),js("Depth Packing",y0.DepthPackingStrategies.uiConfig)],p.DepthBufferPlugin.prototype,"depthPacking",2),p.DepthBufferPlugin=l_([ti("Depth Buffer Plugin")],p.DepthBufferPlugin);class UG extends np{constructor(e){super(e),this.reset()}onBeforeRender(e,t,i,n,s){super.onBeforeRender(e,t,i,n,s);let a=s.material;Array.isArray(a)&&(a=a[0]),a&&(a.map!==void 0&&(this.map=a.map),a.side!==void 0&&(this.side=a.side??Ie),a.alphaMap!==void 0&&(this.alphaMap=a.alphaMap),a.alphaTest!==void 0&&(this.alphaTest=a.alphaTest<1e-4?1e-4:a.alphaTest),a.displacementMap!==void 0&&(this.displacementMap=a.displacementMap),a.displacementScale!==void 0&&(this.displacementScale=a.displacementScale),a.displacementBias!==void 0&&(this.displacementBias=a.displacementBias),a.wireframe!==void 0&&(this.wireframe=a.wireframe),a.wireframeLinewidth!==void 0&&(this.wireframeLinewidth=a.wireframeLinewidth),this.needsUpdate=!0)}onAfterRender(e,t,i,n,s){super.onAfterRender(e,t,i,n,s),this.reset()}reset(){this.map=null,this.side=dt,this.alphaMap=null,this.alphaTest=.001,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1}}var OG=Object.defineProperty,kG=Object.getOwnPropertyDescriptor,sM=(r,e,t,i)=>{for(var n=i>1?void 0:i?kG(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&OG(e,t,n),n};p.NormalBufferPlugin=class extends wc{constructor(r=di,e=!0){super(),this.passId="normal",this.material=new FG({blending:Qt}),this.enabled=e,this.bufferType=r}_createTarget(r=!0){this._viewer&&(r&&this._disposeTarget(),this.target||(this.target=this._viewer.renderManager.createTarget({depthBuffer:!0,samples:0,type:this.bufferType,magFilter:Ai,minFilter:Ai,generateMipmaps:!1,colorSpace:wi})),this.texture=this.target.texture,this.texture.name="normalBuffer",this._pass&&(this._pass.target=this.target))}_disposeTarget(){this._viewer&&(this.target&&(this._viewer.renderManager.disposeTarget(this.target),this.target=void 0),this.texture=void 0)}_createPass(){if(this._createTarget(!0),!this.target)throw new Error("NormalBufferPlugin: target not created");this.material.userData.isGBufferMaterial=!0;const r=new p.GBufferRenderPass(this.passId,this.target,this.material,new fe(0,0,0),1),e=r.preprocessMaterial;return r.preprocessMaterial=t=>e(t,!0),r.before=["render"],r.after=[],r.required=["render"],r}onRemove(r){return this._disposeTarget(),super.onRemove(r)}},p.NormalBufferPlugin.PluginType="NormalBufferPlugin",sM([_a("Normal Buffer")],p.NormalBufferPlugin.prototype,"texture",2),p.NormalBufferPlugin=sM([ti("Normal Buffer Plugin")],p.NormalBufferPlugin);class FG extends xv{constructor(e){super(e),this.reset()}onBeforeRender(e,t,i,n,s){if(super.onBeforeRender(e,t,i,n,s),!s.material)return;const a=s.material;a.bumpMap!==void 0&&(this.bumpMap=a.bumpMap),a.bumpScale!==void 0&&(this.bumpScale=a.bumpScale),a.alphaTest!==void 0&&(this.alphaTest=a.alphaTest),a.normalMap!==void 0&&(this.normalMap=a.normalMap),a.normalMapType!==void 0&&(this.normalMapType=a.normalMapType),a.normalScale!==void 0&&this.normalScale.copy(a.normalScale),a.displacementMap!==void 0&&(this.displacementMap=a.displacementMap),a.displacementScale!==void 0&&(this.displacementScale=a.displacementScale),a.displacementBias!==void 0&&(this.displacementBias=a.displacementBias),a.flatShading!==void 0&&(this.flatShading=a.flatShading),a.side!==void 0&&(this.side=a.side),a.wireframe!==void 0&&(this.wireframe=a.wireframe),a.wireframeLinewidth!==void 0&&(this.wireframeLinewidth=a.wireframeLinewidth)}onAfterRender(e,t,i,n,s){super.onAfterRender(e,t,i,n,s),this.reset()}reset(){this.bumpMap=null,this.bumpScale=1,this.alphaTest=0,this.normalMap=null,this.normalMapType=pn,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.flatShading=!1,this.side=dt,this.wireframe=!1,this.wireframeLinewidth=1}}var NG=Object.defineProperty,GG=Object.getOwnPropertyDescriptor,Og=(r,e,t,i)=>{for(var n=i>1?void 0:i?GG(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&NG(e,t,n),n};p.FrameFadePlugin=class extends wc{constructor(r=!0){super(),this.passId="frameFade",this.dependencies=[p.ProgressivePlugin],this.fadeOnActiveCameraChange=!0,this.fadeOnMaterialUpdate=!0,this.fadeOnSceneUpdate=!0,this._pointerEnabled=!0,this.saveFrameTimeThreshold=500,this._fadeCam=async e=>e.frameFade!==!1&&this.fadeOnActiveCameraChange&&this.startTransition(e.fadeDuration||1e3),this._fadeMat=async e=>e.frameFade!==!1&&this.fadeOnMaterialUpdate&&this.startTransition(e.fadeDuration||200),this._fadeScene=async e=>e.frameFade!==!1&&this.fadeOnSceneUpdate&&this.startTransition(e.fadeDuration||500),this._fadeObjectUpdate=async e=>e.frameFade&&this.startTransition(e.fadeDuration||500),this._onPointerMove=e=>{var t;const i=(t=this._viewer)==null?void 0:t.canvas;if(!i){this._pointerEnabled=!1;return}if(!e.buttons||e.target!==i){this._pointerEnabled=!0;return}const n=i.getBoundingClientRect(),s=(e.clientX-n.left)/n.width,a=(e.clientY-n.top)/n.height;this._pointerEnabled=s<0||s>1||a<0||a>1},this.enabled=r,this.startTransition=this.startTransition.bind(this),this.stopTransition=this.stopTransition.bind(this),this._fadeCam=this._fadeCam.bind(this),this._fadeMat=this._fadeMat.bind(this),this.isDisabled=(e=>()=>!this._pointerEnabled||e())(this.isDisabled)}async startTransition(r){!this._viewer||!this._pass||this.isDisabled()||(this._target||(this._target=this._viewer.renderManager.getTempTarget({sizeMultiplier:1,minFilter:Et,magFilter:Et,colorSpace:this._viewer.renderManager.composerTarget.texture.colorSpace})),this._pass.fadeTimeState<this.saveFrameTimeThreshold&&(this._pass.toSaveFrame=!0),this._pass.fadeTimeState=Math.max(r,this._pass.fadeTimeState),this._pass.fadeTime=this._pass.fadeTimeState,this.setDirty(),await cs(r))}stopTransition(){this._pass&&(this._pass.fadeTimeState=0)}onAdded(r){super.onAdded(r),r.scene.addEventListener("mainCameraUpdate",this.stopTransition),r.scene.addEventListener("mainCameraChange",this._fadeCam),r.scene.addEventListener("materialUpdate",this._fadeMat),r.scene.addEventListener("sceneUpdate",this._fadeScene),r.scene.addEventListener("objectUpdate",this._fadeObjectUpdate),window.addEventListener("pointermove",this._onPointerMove)}onRemove(r){r.scene.removeEventListener("mainCameraUpdate",this.stopTransition),r.scene.removeEventListener("mainCameraChange",this._fadeCam),r.scene.removeEventListener("materialUpdate",this._fadeMat),r.scene.removeEventListener("sceneUpdate",this._fadeScene),r.scene.removeEventListener("objectUpdate",this._fadeObjectUpdate),window.removeEventListener("pointermove",this._onPointerMove),super.onRemove(r)}setDirty(){var r;this.isDisabled()||(r=this._viewer)==null||r.setDirty()}get dirty(){return!this.isDisabled()&&!!this._pass&&this._pass.fadeTimeState>0}set dirty(r){console.error("FrameFadePlugin.dirty is readonly")}_createPass(){return new aM(this.passId,this)}get canFrameFade(){return this._target&&this._pointerEnabled&&this.dirty&&this._pass&&this._pass.fadeTimeState>.001&&this._viewer&&this._viewer.scene.renderCamera===this._viewer.scene.mainCamera}get lastFrame(){var r,e;return(e=(r=this._viewer)==null?void 0:r.getPlugin(p.ProgressivePlugin))==null?void 0:e.texture}get target(){return this._target}_beforeRender(){return!super._beforeRender()||!this._pass?!1:(this.isDisabled()&&this.stopTransition(),this._pass.fadeTimeState<.001&&(this._pass.toSaveFrame=!1,this._target&&this._viewer&&(this._viewer.renderManager.releaseTempTarget(this._target),this._target=void 0)),!0)}},p.FrameFadePlugin.PluginType="FrameFadePlugin",Og([$(),De()],p.FrameFadePlugin.prototype,"fadeOnActiveCameraChange",2),Og([$(),De()],p.FrameFadePlugin.prototype,"fadeOnMaterialUpdate",2),Og([$(),De()],p.FrameFadePlugin.prototype,"fadeOnSceneUpdate",2),p.FrameFadePlugin=Og([ti("FrameFade Plugin")],p.FrameFadePlugin);class aM extends rM{constructor(e,t){super(),this.passId=e,this.plugin=t,this.before=["progressive","taa"],this.after=["render"],this.required=["render","progressive"],this.dirty=()=>!1,this.fadeTime=0,this.fadeTimeState=0,this.toSaveFrame=!1,this._lastTime=0}render(e,t,i,n,s){this.needsSwap=!1;const a=this.plugin.target;if(!this.plugin.canFrameFade||!a)return;const o=this.plugin.lastFrame;this.toSaveFrame&&o&&(e.renderManager.blit(a,{source:o,respectColorSpace:!1}),this._lastTime=0,this.toSaveFrame=!1),this.uniforms.tDiffuse2.value=a.texture;const l=this.fadeTimeState/this.fadeTime;this.uniforms.weight2.value.setScalar(l),this.uniforms.weight2.value.w=1,this.uniforms.weight.value.setScalar(1-l),this.uniforms.weight.value.w=1,super.render(e,t,i,n,s),this.needsSwap=!0;const c=nn();this._lastTime<10&&(this._lastTime=c-10);const h=c-this._lastTime;this._lastTime=c,this.fadeTimeState-=h}}const zG=`#include <randomHelpers>
#include <common>
#include <packing>
#define THREE_PACKING_INCLUDED
#include <cameraHelpers>
varying vec2 vUv;uniform sampler2D tLastThis;uniform float frameCount;uniform vec4 saoData;uniform vec3 saoBiasEpsilon;uniform vec2 screenSize;const float INV_NUM_SAMPLES=1.0/float(NUM_SAMPLES);int getSelectionBit(in int number){
#ifdef WebGL2Context
return(number/8)% 2;
#else
return int(mod(floor(float(number)/8.),2.));
#endif
}vec3 packFloatToRGB(const in float x){const vec3 code=vec3(1.0,255.0,65025.0);vec3 pack=vec3(code*x);pack.gb=fract(pack.gb);pack.rg-=pack.gb*(1.0/256.0);return pack;}vec3 getPositionFromOffset(const in vec2 uvOffset){
#if defined(HAS_DEPTH_BUFFER) || defined(HAS_NORMAL_DEPTH_BUFFER)
float d=getDepth(uvOffset);
#else
float d=0.5;
#endif
#if LINEAR_DEPTH == 0
float centerViewZ=viewZFromNDCZ(d);return screenToView3(uvOffset,centerViewZ);
#else
d=mix(-cameraNearFar.x,-cameraNearFar.y,d);return screenToView3(uvOffset,d);
#endif
}float getOcclusion(const in vec2 uv,const in int id,const in float randomAngle,const in float occlusionSphereRadius,const in vec3 centerPosition,const in vec3 centerNormal){float screenSpaceRadius=(float(id)+mod(randomAngle,1.)+0.5)*INV_NUM_SAMPLES;float angle=screenSpaceRadius*(float(NUM_SPIRAL_TURNS)*6.28318)+randomAngle;screenSpaceRadius=(screenSpaceRadius*occlusionSphereRadius);vec2 uvOffset=uv+floor(screenSpaceRadius*vec2(cos(angle),sin(angle)))/screenSize;
#if CHECK_GBUFFER_FLAG == 1
if(getSelectionBit(getGBufferFlags(uvOffset.xy).a)<1)return 0.0;
#endif
vec3 samplePosition=getPositionFromOffset(uvOffset);vec3 direction=samplePosition-centerPosition;float d2=dot(direction,direction);float ao=max((dot(centerNormal,direction)+centerPosition.z*saoBiasEpsilon.x)/(saoBiasEpsilon.z*d2+saoBiasEpsilon.y),0.0);return ao;}void main(){float centerDepth=0.5;vec3 centerNormal=vec3(0,1,0);
#ifdef HAS_NORMAL_DEPTH_BUFFER
getDepthNormal(vUv,centerDepth,centerNormal);
#else
#ifdef HAS_DEPTH_BUFFER
centerDepth=getDepth(vUv);
#endif
#endif
#if LINEAR_DEPTH == 0
float centerViewZ=viewZFromNDCZ(centerDepth);
#else
float centerViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,centerDepth);
#endif
vec3 centerPosition=screenToView3(vUv,centerViewZ);float occlusionSphereScreenRadius=200.*saoData.z/(-centerPosition.z);float randomAngle=6.2*random3(vec3(vUv,frameCount*0.1));float sum=0.0;sum+=getOcclusion(vUv,0,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#if NUM_SAMPLES > 1
sum+=getOcclusion(vUv,1,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 2
sum+=getOcclusion(vUv,2,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 3
sum+=getOcclusion(vUv,3,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 4
sum+=getOcclusion(vUv,4,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 5
sum+=getOcclusion(vUv,5,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 6
sum+=getOcclusion(vUv,6,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 7
sum+=getOcclusion(vUv,7,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 8
sum+=getOcclusion(vUv,8,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 9
sum+=getOcclusion(vUv,9,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 10
sum+=getOcclusion(vUv,10,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
float aoValue=sum*saoData.y*INV_NUM_SAMPLES;aoValue=1.-clamp(aoValue,0.,1.);
#if SSAO_PACKING == 1
gl_FragColor.gba=packFloatToRGB(centerDepth);gl_FragColor.r=aoValue;
#elif SSAO_PACKING == 2
gl_FragColor.rgb=vec3(aoValue);gl_FragColor.a=1.;
#elif SSAO_PACKING == 3
gl_FragColor.rgba=packDepthToRGBA(aoValue);
#elif SSAO_PACKING == 4
gl_FragColor.rgb=packFloatToRGB(aoValue);gl_FragColor.a=1.;
#endif
}`,QG=`
#ifndef USE_TRANSMISSION
#if defined(SSAO_ENABLED) && SSAO_ENABLED > 0
float ambientOcclusion=tSSAOMapTexelToLinear(texture2D(tSSAOMap,viewToScreen(vViewPosition.xyz).xy)).r;reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));reflectedLight.indirectSpecular*=computeSpecularOcclusion(dotNV,ambientOcclusion,material.roughness);
#endif
#else
#include <aomap_fragment>
#endif
#endif
`;var VG=Object.defineProperty,jG=Object.getOwnPropertyDescriptor,Ia=(r,e,t,i)=>{for(var n=i>1?void 0:i?jG(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&VG(e,t,n),n};p.SSAOPlugin=class extends wc{constructor(r=oi,e=1,t=!0){super(),this.passId="ssao",this.dependencies=[p.GBufferPlugin],this._gbufferUnpackExtension=void 0,this._gbufferUnpackExtensionChanged=()=>{if(!this._pass||!this._viewer)throw new Error("SSAOPlugin: pass/viewer not created yet");const i=this._viewer.renderManager.gbufferUnpackExtension;this._gbufferUnpackExtension!==i&&(this._gbufferUnpackExtension&&this._pass.material.unregisterMaterialExtensions([this._gbufferUnpackExtension]),this._gbufferUnpackExtension=i,this._gbufferUnpackExtension?this._pass.material.registerMaterialExtensions([this._gbufferUnpackExtension]):this._viewer.console.warn("SSAOPlugin: GBuffer unpack extension removed"))},this._onPluginAdd=i=>{var n,s,a;((s=(n=i.plugin)==null?void 0:n.constructor)==null?void 0:s.PluginType)===p.GBufferPlugin.PluginType&&(i.plugin.registerGBufferUpdater(this.constructor.PluginType,this.updateGBufferFlags.bind(this)),(a=this._viewer)==null||a.removeEventListener("addPlugin",this._onPluginAdd))},this.enabled=t,this.bufferType=r,this.sizeMultiplier=e}_createTarget(r=!0){this._viewer&&(r&&this._disposeTarget(),this.target||(this.target=this._viewer.renderManager.createTarget({depthBuffer:!1,type:this.bufferType,sizeMultiplier:this.sizeMultiplier})),this.texture=this.target.texture,this.texture.name="ssaoBuffer",this._pass&&(this._pass.target=this.target))}_disposeTarget(){this._viewer&&(this.target&&(this._viewer.renderManager.disposeTarget(this.target),this.target=void 0),this.texture=void 0)}_createPass(){if(!this._viewer)throw new Error("SSAOPlugin: viewer not set");if(!this._viewer.renderManager.gbufferTarget||!this._viewer.renderManager.gbufferUnpackExtension)throw new Error("SSAOPlugin: GBuffer target not created. GBufferPlugin or DepthBufferPlugin is required.");return this._createTarget(!0),new p.SSAOPluginPass(this.passId,this.target)}onAdded(r){super.onAdded(r);const e=r.getPlugin(p.GBufferPlugin);e?e.registerGBufferUpdater(this.constructor.PluginType,this.updateGBufferFlags.bind(this)):r.addEventListener("addPlugin",this._onPluginAdd),this._gbufferUnpackExtensionChanged(),r.renderManager.addEventListener("gbufferUnpackExtensionChanged",this._gbufferUnpackExtensionChanged)}onRemove(r){return r.removeEventListener("addPlugin",this._onPluginAdd),this._disposeTarget(),super.onRemove(r)}updateGBufferFlags(r,e){if(!e.material||!e.material.userData)return;const t=e.material.userData.ssaoCastDisabled||e.material.userData.pluginsDisabled,i=t?0:1;r.w=t0(r.w,3,i),t&&this._pass&&(this._pass.checkGBufferFlag=!0)}get aoTarget(){return console.warn("SSAOPlugin: aoTarget is deprecated, use target instead"),this.target}},p.SSAOPlugin.PluginType="SSAOPlugin",Ia([_a("SSAO Buffer")],p.SSAOPlugin.prototype,"texture",2),Ia([ur()],p.SSAOPlugin.prototype,"_pass",2),p.SSAOPlugin=Ia([ti("SSAO Plugin")],p.SSAOPlugin),p.SSAOPluginPass=class extends Nh{constructor(r,e){super({defines:{LINEAR_DEPTH:1,NUM_SAMPLES:11,NUM_SPIRAL_TURNS:3,SSAO_PACKING:1,PERSPECTIVE_CAMERA:1,CHECK_GBUFFER_FLAG:0},uniforms:{tLastThis:{value:null},screenSize:{value:new ne(0,0)},saoData:{value:new bt},frameCount:{value:0},cameraNearFar:{value:new ne(.1,1e3)},projection:{value:new et},saoBiasEpsilon:{value:new P(1,1,1)}},vertexShader:i0.defaultVertex,fragmentShader:zG},"tDiffuse"),this.passId=r,this.target=e,this.before=["render"],this.after=["gbuffer","depth"],this.required=["render"],this.intensity=.25,this.occlusionWorldRadius=1,this.bias=.001,this.falloff=1.3,this.numSamples=8,this.checkGBufferFlag=!1,this.materialExtension={extraUniforms:{tSSAOMap:()=>{var t;return{value:((t=sr(this.target))==null?void 0:t.texture)??null}}},shaderExtender:(t,i,n)=>{t.defines.SSAO_ENABLED&&(t.fragmentShader=ri(t.fragmentShader,"#include <aomap_fragment>",QG))},onObjectRender:(t,i,n)=>{var s,a;const o=this.enabled&&n.userData.screenSpaceRendering!==!1&&!((s=i.userData)!=null&&s.pluginsDisabled)&&!((a=i.userData)!=null&&a.ssaoDisabled)?1:0;i.defines.SSAO_ENABLED!==o&&(i.defines.SSAO_ENABLED=o,i.needsUpdate=!0)},parsFragmentSnippet:t=>{var i;return ro`
             uniform sampler2D tSSAOMap;
             ${g0("tSSAOMap",(i=sr(this.target))==null?void 0:i.texture,t.capabilities.isWebGL2)}
             #include <simpleCameraHelpers>
        `},computeCacheKey:()=>{var t,i;return this.enabled?"1":"0"+((i=(t=sr(this.target))==null?void 0:t.texture)==null?void 0:i.colorSpace)},uuid:p.SSAOPlugin.PluginType,...k1(this._getUiConfig.bind(this),p.SSAOPlugin.PluginType),isCompatible:t=>t.isPhysicalMaterial},this.needsSwap=!1,this.clear=!0}render(r,e,t,i,n){if(!this.enabled)return;const s=sr(this.target);if(!s){console.warn("SSAOPluginPass: target not defined");return}this._updateParameters(),r.renderManager.blit(e,{source:s.texture}),this.uniforms.tLastThis.value=e.texture,super.render(r,s,t,i,n)}_updateParameters(){const r=this.material.uniforms.saoData.value;r.y=this.intensity,r.z=this.occlusionWorldRadius;const e=this.material.uniforms.saoBiasEpsilon.value;e.x=this.bias,e.y=.001,e.z=this.falloff}beforeRender(r,e,t){this.enabled&&this.updateShaderProperties([e,t])}_getUiConfig(r){return{type:"folder",label:"SSAO",children:[{type:"checkbox",label:"Enabled",get value(){return!(r.userData.ssaoDisabled??!1)},set value(e){e!==!(r.userData.ssaoDisabled??!1)&&(r.userData.ssaoDisabled=!e,r.setDirty())},onChange:this.setDirty},{type:"checkbox",label:"Cast SSAO",get value(){return!(r.userData.ssaoCastDisabled??!1)},set value(e){e!==!(r.userData.ssaoCastDisabled??!1)&&(r.userData.ssaoCastDisabled=!e,r.setDirty())},onChange:this.setDirty}]}}},Ia([$(),Rt("Intensity",[0,4],.01),Ir(p.SSAOPluginPass.prototype.setDirty)],p.SSAOPluginPass.prototype,"intensity",2),Ia([$(),Rt("Occlusion World Radius",[.1,8],.01),Ir(p.SSAOPluginPass.prototype.setDirty)],p.SSAOPluginPass.prototype,"occlusionWorldRadius",2),Ia([$(),Rt("Bias",[1e-5,.01],1e-5),Ir(p.SSAOPluginPass.prototype.setDirty)],p.SSAOPluginPass.prototype,"bias",2),Ia([$(),Rt("Falloff",[.01,3],.01),Ir(p.SSAOPluginPass.prototype.setDirty)],p.SSAOPluginPass.prototype,"falloff",2),Ia([$(),Rt("Num Samples",[1,11],1),Uf("NUM_SAMPLES",void 0,void 0,p.SSAOPluginPass.prototype.setDirty)],p.SSAOPluginPass.prototype,"numSamples",2),Ia([Sp("CHECK_GBUFFER_FLAG")],p.SSAOPluginPass.prototype,"checkGBufferFlag",2),p.SSAOPluginPass=Ia([ti("SSAO Pass")],p.SSAOPluginPass);const HG='#RenderTargetPreviewPluginContainer{position:absolute;left:0;bottom:0;width:100%;z-index:1000;display:flex;flex-wrap:wrap;flex-direction:row;gap:5px;padding:5px;pointer-events:none;height:auto}.RenderTargetPreviewPluginTarget{position:relative;width:200px;height:200px}.RenderTargetPreviewPluginCollapsed{height:25px}.RenderTargetPreviewPluginTargetHeader{position:absolute;top:0;left:0;right:0;background:#00000080;color:#fff;padding:2px;font-size:16px;height:20px;font-family:monospace;text-align:center;pointer-events:auto;cursor:pointer}.RenderTargetPreviewPluginTargetHeader:after{content:"-";position:absolute;right:2px;width:20px;height:20px;line-height:16px}.RenderTargetPreviewPluginCollapsed .RenderTargetPreviewPluginTargetHeader:after{content:"+";line-height:20px}';var WG=Object.defineProperty,XG=Object.getOwnPropertyDescriptor,oM=(r,e,t,i)=>{for(var n=i>1?void 0:i?XG(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&WG(e,t,n),n};p.RenderTargetPreviewPlugin=class extends ei{constructor(r=!0){super(),this.enabled=!0,this.toJSON=null,this.mainDiv=$o({id:"RenderTargetPreviewPluginContainer",addToBody:!1}),this.targetBlocks=[],this._postRender=()=>{if(this._viewer)for(const e of this.targetBlocks){if(!e.visible)continue;const t=sr(e.target);if(!t)continue;const i=e.div.getBoundingClientRect();let n=t.texture;const s=this._viewer.canvas.getBoundingClientRect();i.x=i.x-s.x,i.y=s.height+s.y-i.y-i.height,Array.isArray(n)&&(this._viewer.console.warn("Multi target preview not supported yet, rendering just the first one"),n=n[0]);const a=this._viewer.renderManager.webglRenderer.outputColorSpace;e.originalColorSpace||(this._viewer.renderManager.webglRenderer.outputColorSpace=it),this._viewer.renderManager.blit(null,{source:n,clear:!e.transparent,respectColorSpace:!e.originalColorSpace,viewport:new bt(i.x,i.y,i.width,i.height),material:e.material}),this._viewer.renderManager.webglRenderer.outputColorSpace=a}},this.enabled=r}onAdded(r){super.onAdded(r),r.addEventListener("postRender",this._postRender),this.stylesheet=Mh(HG,r.container),this.refreshUi()}onRemove(r){var e;r.removeEventListener("postRender",this._postRender),(e=this.stylesheet)==null||e.remove(),this.stylesheet=void 0,this.refreshUi(),super.onRemove(r)}addTarget(r,e,t=!1,i=!1,n=!0,s){if(!r)return this;const a=document.createElement("div"),o={target:r,name:e,transparent:t,div:a,originalColorSpace:i,visible:n};s&&(o.material=s!=null&&s.isMaterial?s:new gy(s).material),a.classList.add("RenderTargetPreviewPluginTarget"),o.visible||a.classList.add("RenderTargetPreviewPluginCollapsed");const l=document.createElement("div");return l.classList.add("RenderTargetPreviewPluginTargetHeader"),l.innerText=e,l.onclick=()=>{var c;o.visible=!o.visible,o.visible?a.classList.remove("RenderTargetPreviewPluginCollapsed"):a.classList.add("RenderTargetPreviewPluginCollapsed"),(c=this._viewer)==null||c.setDirty()},l.oncontextmenu=c=>{c.preventDefault(),c.stopPropagation(),n0.Create({Download:()=>this.downloadTarget(r),Remove:()=>this.removeTarget(r)},c.clientX,c.clientY)},a.appendChild(l),this.mainDiv.appendChild(a),this.targetBlocks.push(o),this.refreshUi(),this}removeTarget(r){const e=this.targetBlocks.findIndex(t=>t.target===r);if(e>=0){const t=this.targetBlocks[e];this.targetBlocks.splice(e,1),t.div.remove()}return this.refreshUi(),this}downloadTarget(r){var e;if(!this._viewer)return this;const t=sr(r);if(!t)return this;const i=t.texture;if(Array.isArray(i))return this._viewer.dialog.alert("Multi target not supported yet"),this._viewer.console.warn("todo: support multi target export"),this;if(!((e=this._viewer)!=null&&e.canvas))return this;const n=this._viewer.renderManager.exportRenderTarget(t),s=URL.createObjectURL(n),a=document.createElement("a");return document.body.appendChild(a),a.style.display="none",a.href=s,a.download="renderTarget."+(n.ext||"png"),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s),this}refreshUi(){var r,e;if(this.mainDiv){if(!this._viewer){this.mainDiv.parentElement&&this.mainDiv.remove(),this.mainDiv.style.display="none",this.mainDiv.style.zIndex="1000";return}this.mainDiv.parentElement||(r=this._viewer.container)==null||r.appendChild(this.mainDiv),this.mainDiv.style.display=this.isDisabled()?"none":"flex",this.mainDiv.style.zIndex=parseInt(this._viewer.canvas.style.zIndex||"0")+1+"",(e=this._viewer)==null||e.setDirty()}}setDirty(){this.refreshUi()}dispose(){for(const r of this.targetBlocks)this.removeTarget(r.target);super.dispose()}},p.RenderTargetPreviewPlugin.PluginType="RenderTargetPreviewPlugin",oM([De("Enabled"),st(p.RenderTargetPreviewPlugin.prototype.refreshUi)],p.RenderTargetPreviewPlugin.prototype,"enabled",2),p.RenderTargetPreviewPlugin=oM([ti("Render Target Preview Plugin")],p.RenderTargetPreviewPlugin);const qG='#GeometryUVPreviewPluginContainer{position:absolute;left:0;bottom:0;width:100%;z-index:1000;display:flex;flex-wrap:wrap;flex-direction:row;gap:5px;padding:5px;pointer-events:none;height:auto}.GeometryUVPreviewPluginTarget{position:relative;width:200px;height:200px}.GeometryUVPreviewPluginCollapsed{height:25px}.GeometryUVPreviewPluginTargetHeader{position:absolute;top:0;left:0;right:0;background:#00000080;color:#fff;padding:2px;font-size:16px;height:20px;font-family:monospace;text-align:center;pointer-events:auto;cursor:pointer}.GeometryUVPreviewPluginTargetHeader:after{content:"-";position:absolute;right:2px;width:20px;height:20px;line-height:16px}.GeometryUVPreviewPluginCollapsed .GeometryUVPreviewPluginTargetHeader:after{content:"+";line-height:20px}';function YG(r,e=1024){const t="abc",i=new ne,n=new ne,s=[new ne,new ne,new ne],a=[],o=document.createElement("canvas"),l=e,c=e;o.width=l,o.height=c;const h=o.getContext("2d");h.lineWidth=1,h.strokeStyle="rgb( 63, 63, 63 )",h.textAlign="center",h.fillStyle="rgb( 255, 255, 255 )",h.fillRect(0,0,l,c);const d=r.index,m=r.attributes.uv;if(d)for(let v=0,w=d.count;v<w;v+=3)a[0]=d.getX(v),a[1]=d.getX(v+1),a[2]=d.getX(v+2),s[0].fromBufferAttribute(m,a[0]),s[1].fromBufferAttribute(m,a[1]),s[2].fromBufferAttribute(m,a[2]),f(a,s,v/3);else for(let v=0,w=m.count;v<w;v+=3)a[0]=v,a[1]=v+1,a[2]=v+2,s[0].fromBufferAttribute(m,a[0]),s[1].fromBufferAttribute(m,a[1]),s[2].fromBufferAttribute(m,a[2]),f(a,s,v/3);return o;function f(v,w,b){h.beginPath(),i.set(0,0);for(let y=0,E=w.length;y<E;y++){const _=w[y];i.x+=_.x,i.y+=_.y,y===0?h.moveTo(_.x*(l-2)+.5,(1-_.y)*(c-2)+.5):h.lineTo(_.x*(l-2)+.5,(1-_.y)*(c-2)+.5)}h.closePath(),h.stroke(),i.divideScalar(w.length),h.font="18px Arial",h.fillStyle="rgb( 63, 63, 63 )",h.fillText(b,i.x*l,(1-i.y)*c),i.x>.95&&h.fillText(b,i.x%1*l,(1-i.y)*c),h.font="12px Arial",h.fillStyle="rgb( 191, 191, 191 )";for(let y=0,E=w.length;y<E;y++){const _=w[y];n.addVectors(i,_).divideScalar(2);const C=v[y];h.fillText(t[y]+C,n.x*l,(1-n.y)*c),n.x>.95&&h.fillText(t[y]+C,n.x%1*l,(1-n.y)*c)}}}var KG=Object.defineProperty,JG=Object.getOwnPropertyDescriptor,lM=(r,e,t,i)=>{for(var n=i>1?void 0:i?JG(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&KG(e,t,n),n};p.GeometryUVPreviewPlugin=class extends ei{constructor(r=!0){super(),this.enabled=!0,this.toJSON=null,this.mainDiv=$o({id:"GeometryUVPreviewPluginContainer",addToBody:!1}),this.targetBlocks=[],this._postRender=()=>{var e;if(this._viewer)for(const t of this.targetBlocks){if(!t.visible)continue;const i=sr(t.target);(e=i==null?void 0:i.attributes)!=null&&e.uv&&(t.uvCanvas||(t.uvCanvas=YG(i,1024),t.uvCanvas.style.width="100%",t.uvCanvas.style.height="100%"),t.uvCanvas&&t.uvCanvas.parentElement!==t.div&&t.div.appendChild(t.uvCanvas))}},this.enabled=r}onAdded(r){super.onAdded(r),r.addEventListener("postRender",this._postRender),this.stylesheet=Mh(qG,r.container),this.refreshUi()}onRemove(r){var e;r.removeEventListener("postRender",this._postRender),(e=this.stylesheet)==null||e.remove(),this.stylesheet=void 0,this.refreshUi(),super.onRemove(r)}addGeometry(r,e,t=!0){if(!r)return this;const i=document.createElement("div"),n={target:r,name:e,div:i,visible:t};i.classList.add("GeometryUVPreviewPluginTarget"),n.visible||i.classList.add("GeometryUVPreviewPluginCollapsed");const s=document.createElement("div");return s.classList.add("GeometryUVPreviewPluginTargetHeader"),s.innerText=e,s.onclick=()=>{var a;n.visible=!n.visible,n.visible?i.classList.remove("GeometryUVPreviewPluginCollapsed"):i.classList.add("GeometryUVPreviewPluginCollapsed"),(a=this._viewer)==null||a.setDirty()},s.oncontextmenu=a=>{a.preventDefault(),a.stopPropagation(),n0.Create({Download:()=>this.downloadGeometryUV(n),Remove:()=>this.removeGeometry(r)},a.clientX,a.clientY)},i.appendChild(s),this.mainDiv.appendChild(i),this.targetBlocks.push(n),this.refreshUi(),this}removeGeometry(r){const e=this.targetBlocks.findIndex(t=>t.target===r);if(e>=0){const t=this.targetBlocks[e];this.targetBlocks.splice(e,1),t.div.remove()}return this.refreshUi(),this}downloadGeometryUV(r){if(!this._viewer)return this;if(!r.uvCanvas)return this;const e=r.uvCanvas.toDataURL("image/png"),t=document.createElement("a");return document.body.appendChild(t),t.style.display="none",t.href=e,t.download="renderTarget.png",t.click(),document.body.removeChild(t),URL.revokeObjectURL(e),this}refreshUi(){var r,e;if(this.mainDiv){if(!this._viewer){this.mainDiv.parentElement&&this.mainDiv.remove(),this.mainDiv.style.display="none",this.mainDiv.style.zIndex="1000";return}this.mainDiv.parentElement||(r=this._viewer.container)==null||r.appendChild(this.mainDiv),this.mainDiv.style.display=this.isDisabled()?"none":"flex",this.mainDiv.style.zIndex=parseInt(this._viewer.canvas.style.zIndex||"0")+1+"",(e=this._viewer)==null||e.setDirty()}}setDirty(){this.refreshUi()}dispose(){for(const r of this.targetBlocks)this.removeGeometry(r.target);super.dispose()}},p.GeometryUVPreviewPlugin.PluginType="GeometryUVPreviewPlugin",lM([De("Enabled"),st(p.GeometryUVPreviewPlugin.prototype.refreshUi)],p.GeometryUVPreviewPlugin.prototype,"enabled",2),p.GeometryUVPreviewPlugin=lM([ti("Render Target Preview Plugin")],p.GeometryUVPreviewPlugin);var ZG=Object.defineProperty,$G=(r,e,t,i)=>{for(var n=void 0,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=a(e,t,n)||n);return n&&ZG(e,t,n),n};const cM=class extends ei{constructor(){super(),this.enabled=!0,this.serializeWithViewer=!1,this.uiConfig={}}onAdded(e){super.onAdded(e),this.uiConfig=e.uiConfig}};cM.PluginType="ViewerUiConfigPlugin";let hM=cM;$G([$("viewer")],hM.prototype,"_viewer");var ez=Object.defineProperty,tz=(r,e,t,i)=>{for(var n=void 0,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=a(e,t,n)||n);return n&&ez(e,t,n),n};const uM=class extends ei{constructor(){super(),this.enabled=!0,this.serializeWithViewer=!1,this.uiConfig={}}onAdded(e){super.onAdded(e),this.uiConfig=e.scene.uiConfig,this._scene=e.scene}};uM.PluginType="SceneUiConfigPlugin";let pM=uM;tz([$("scene")],pM.prototype,"_scene");var iz=Object.defineProperty,rz=Object.getOwnPropertyDescriptor,kg=(r,e,t,i)=>{for(var n=i>1?void 0:i?rz(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&iz(e,t,n),n};p.FullScreenPlugin=class extends ei{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._lastSize=["100%","100%"],this._lastFsElement=null,this._fsChangeHandler=r=>{var e;if(this.isFullScreen())this.dispatchEvent({type:"enter"});else{const t=this._lastFsElement||((e=this._viewer)==null?void 0:e.canvas);t&&(t.style.width=this._lastSize[0],t.style.height=this._lastSize[1]),document.removeEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("fullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("MSFullscreenChange",this._fsChangeHandler,!1),this.dispatchEvent({type:"exit"})}},this.enter=this.enter.bind(this),this.exit=this.exit.bind(this)}async enter(r){var e;if(this.isFullScreen())return;const t=r||((e=this._viewer)==null?void 0:e.canvas);if(t){if(this._lastFsElement=t,document.addEventListener&&(document.addEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("fullscreenchange",this._fsChangeHandler,!1),document.addEventListener("MSFullscreenChange",this._fsChangeHandler,!1)),this._lastSize=[t.style.width,t.style.height],t.style.width="100%",t.style.height="100%",t.requestFullscreen)return t.requestFullscreen();if(t.mozRequestFullScreen)return t.mozRequestFullScreen();if(t.webkitRequestFullscreen)return t.webkitRequestFullscreen();if(t.msRequestFullscreen)return t.msRequestFullscreen()}}async exit(){if(document.exitFullscreen)return document.exitFullscreen();if(document.mozCancelFullScreen)return document.mozCancelFullScreen();if(document.webkitExitFullscreen)return document.webkitExitFullscreen();if(document.msExitFullscreen)return document.msExitFullscreen()}async toggle(r){return this.isFullScreen()?this.exit():this.enter(r)}isFullScreen(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement!==void 0}},p.FullScreenPlugin.PluginType="FullScreenPlugin",kg([ci("Enter FullScreen",{sendArgs:!1})],p.FullScreenPlugin.prototype,"enter",1),kg([ci("Exit FullScreen",{sendArgs:!1})],p.FullScreenPlugin.prototype,"exit",1),kg([ci("Toggle FullScreen",{sendArgs:!1})],p.FullScreenPlugin.prototype,"toggle",1),p.FullScreenPlugin=kg([ti("Full Screen")],p.FullScreenPlugin);const nz='#assetManagerLoadingScreen{z-index:50;position:absolute;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji";bottom:0;right:0;min-width:100%;min-height:100%;color:#333;font-size:1rem;gap:1rem;display:flex;align-content:center;justify-content:center;align-items:center;flex-direction:column;opacity:1;transition:opacity .5s ease-in-out,min-width .5s,min-height .5s,bottom .5s,right .5s;overflow:hidden;background:transparent;-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);background-blend-mode:luminosity;--b-opacity: .8;--b-background: #fff}#assetManagerLoadingScreen:before{content:"";position:absolute;top:0;left:0;width:100%;height:100%;z-index:-1;opacity:var(--b-opacity);background:var(--b-background)}#assetManagerLoadingScreenContent{padding-top:.5rem}.loadingScreenProcessState{font-weight:700}#assetManagerLoadingScreen.minimizedLoadingScreen{top:unset;left:unset;bottom:2rem;right:2rem;min-width:0;min-height:0;max-width:80vw;max-height:80vh;width:max-content;height:max-content;padding:1.5rem;border-radius:.5rem}.loadingScreenFilesElement{min-height:4rem;padding:1rem}.loadingScreenLogoElement{margin-bottom:.5rem;max-width:80%}.loadingScreenLogoElement img{min-height:3rem;max-height:5rem;max-width:100%;object-fit:contain}.loadingScreenLogoImage{width:max-content;height:max-content}.minimizedLoadingScreen .loadingScreenLoadingElement{display:none}.minimizedLoadingScreen .loadingScreenFilesElement{min-height:0}.minimizedLoadingScreen .loadingScreenLogoElement{min-height:0;display:none}.minimizedLoadingScreen #assetManagerLoadingScreenContent{display:none}',sz=".loader{width:48px;height:48px;border:5px solid #333;border-bottom-color:transparent;border-radius:50%;display:inline-block;box-sizing:border-box;animation:rotation 1s linear infinite}@keyframes rotation{0%{transform:rotate(0)}to{transform:rotate(360deg)}}";var az=Object.defineProperty,oz=Object.getOwnPropertyDescriptor,or=(r,e,t,i)=>{for(var n=i>1?void 0:i?oz(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&az(e,t,n),n};p.LoadingScreenPlugin=class extends iM{constructor(r){super("LoadingScreen",r),this.styles=nz,this.spinners=[{styles:sz,html:'<span class="loader"></span>'}],this.loader=0,this.loadingTextHeader="Loading Files",this.errorTextHeader="Error Loading Files",this.showFileNames=!0,this.showProcessStates=!0,this.showProgress=!0,this.hideOnOnlyErrors=!0,this.hideOnFilesLoad=!0,this.hideOnSceneObjectLoad=!1,this.minimizeOnSceneObjectLoad=!0,this.showOnFilesLoading=!0,this.showOnSceneEmpty=!0,this.hideDelay=500,this.backgroundOpacity=.5,this.backgroundBlur=24,this.background="#ffffff",this.textColor="#222222",this.logoImage="https://static.webgi.xyz/logo.svg",this._isPreviewing=!1,this._previewState=new Map([["file.glb",{state:"downloading",progress:50}],["environment.hdr",{state:"adding"}]]),this.loadingElement=$o({classList:["loadingScreenLoadingElement"],addToBody:!1}),this.filesElement=$o({classList:["loadingScreenFilesElement"],addToBody:!1}),this.logoElement=$o({classList:["loadingScreenLogoElement"],addToBody:!1}),this._isHidden=!1,this._temp=document.createElement("template"),this._sceneUpdate=e=>{if(!this._viewer||!e.hierarchyChanged)return;const t=this._viewer.scene.modelRoot.children;t.length===0&&this.showOnSceneEmpty&&this.show(),t.length>0?this.hideOnSceneObjectLoad?this.hideWithDelay():this.minimizeOnSceneObjectLoad&&this._viewer.scene.environment&&cs(this.hideDelay+300).then(()=>this.minimize()):this.minimizeOnSceneObjectLoad&&this.maximize()},this._mainDiv.prepend(this.loadingElement),this._mainDiv.prepend(this.logoElement),this._mainDiv.appendChild(this.filesElement)}refresh(){this._viewer&&this._updateMainDiv(this._isPreviewing?this._previewState:this._viewer.assetManager.processState,!1)}togglePreview(){this.maximize(),this._isPreviewing=!this._isPreviewing,this.refresh(),this._isPreviewing?this.show():this.hideWithDelay()}async hide(){this._isHidden=!0,this._mainDiv.style.opacity="0",await cs(502),this._isHidden&&(this._mainDiv.style.display="none",this._showMainDiv())}async hideWithDelay(){if(this._isHidden=!0,await cs(this.hideDelay),!!this._isHidden)return this.hide()}show(){this._isHidden&&(this._isHidden=!1,this._showMainDiv(),this._mainDiv.style.display="flex")}_showMainDiv(){this._mainDiv.style.opacity="1"}minimize(){this._mainDiv.classList.add("minimizedLoadingScreen"),this.showFileNames||(this.loadingElement.style.display="block")}maximize(){this._mainDiv.classList.remove("minimizedLoadingScreen"),this.loadingElement.style.display=""}_setHTML(r,e){this._temp.innerHTML=e,this._temp.innerHTML.trim()!==r.innerHTML.trim()&&(r.innerHTML=e)}_updateMainDiv(r,e=!0){if(!this._viewer||!this._contentDiv)return;if(!this.enabled){this._mainDiv.style.display="none";return}if(this.showFileNames){let i="";r.forEach((n,s)=>{i+=(this.showProcessStates?`<span class="loadingScreenProcessState">${n.state}</span>: `:"")+(s||"").split("/").pop()+(this.showProgress&&n.progress?" - "+(n.progress.toFixed(0)+"%"):"")+"<br>"}),this._setHTML(this.filesElement,i)}else this._setHTML(this.filesElement,"");const t=[...r.values()].filter(i=>i.state==="error");t.length>0&&t.length===r.size&&!this.hideOnOnlyErrors?this._setHTML(this._contentDiv,this.errorTextHeader):this._setHTML(this._contentDiv,this.loadingTextHeader),this._setHTML(this.loadingElement,this.spinners[this.loader].html),this._mainDiv.style.setProperty("--b-opacity",this.backgroundOpacity.toString()),this._mainDiv.style.setProperty("--b-background",this.background),this._mainDiv.style.backdropFilter=`blur(${this.backgroundBlur}px)`,this._mainDiv.style.color=this.textColor,this._setHTML(this.logoElement,this.logoImage?`<img class="loadingScreenLogoImage" src="${this.logoImage}"/>`:""),e&&(this.hideOnFilesLoad&&(r.size===0||t.length===r.size&&this.hideOnOnlyErrors)?this.hideDelay?this.hideWithDelay():this.hide():r.size>0&&this.showOnFilesLoading&&this.show())}onAdded(r){this.stylesheet=Mh(this.styles,r.container),this.stylesheetLoader=this.spinners.map(e=>Mh(e.styles,r.container)),r.scene.addEventListener("sceneUpdate",this._sceneUpdate),super.onAdded(r)}onRemove(r){var e,t;return r.scene.removeEventListener("sceneUpdate",this._sceneUpdate),(e=this.stylesheet)==null||e.remove(),this.stylesheet=void 0,(t=this.stylesheetLoader)==null||t.forEach(i=>i.remove()),this.stylesheetLoader=void 0,super.onRemove(r)}},p.LoadingScreenPlugin.PluginType="LoadingScreenPlugin",or([js("Loader",["Spinner 1"].map((r,e)=>({value:e,label:r}))),$()],p.LoadingScreenPlugin.prototype,"loader",2),or([Lt("Loading text header"),st(p.LoadingScreenPlugin.prototype.refresh),$()],p.LoadingScreenPlugin.prototype,"loadingTextHeader",2),or([Lt("Error text header"),$()],p.LoadingScreenPlugin.prototype,"errorTextHeader",2),or([De("Show file names"),st(p.LoadingScreenPlugin.prototype.refresh),$()],p.LoadingScreenPlugin.prototype,"showFileNames",2),or([De("Show process states"),st(p.LoadingScreenPlugin.prototype.refresh),$()],p.LoadingScreenPlugin.prototype,"showProcessStates",2),or([De("Show progress"),st(p.LoadingScreenPlugin.prototype.refresh),$()],p.LoadingScreenPlugin.prototype,"showProgress",2),or([De("Hide on only errors"),$()],p.LoadingScreenPlugin.prototype,"hideOnOnlyErrors",2),or([De("Hide on files load"),$()],p.LoadingScreenPlugin.prototype,"hideOnFilesLoad",2),or([De("Hide on scene object load"),$()],p.LoadingScreenPlugin.prototype,"hideOnSceneObjectLoad",2),or([De("Minimize on scene object load"),$()],p.LoadingScreenPlugin.prototype,"minimizeOnSceneObjectLoad",2),or([De("Show when files start loading"),$()],p.LoadingScreenPlugin.prototype,"showOnFilesLoading",2),or([De("Show when scene empty"),$()],p.LoadingScreenPlugin.prototype,"showOnSceneEmpty",2),or([Lt("Hide delay (ms)"),$()],p.LoadingScreenPlugin.prototype,"hideDelay",2),or([Rt("Background Opacity",[0,1]),st(p.LoadingScreenPlugin.prototype.refresh),$()],p.LoadingScreenPlugin.prototype,"backgroundOpacity",2),or([Rt("Background Blur",[0,100]),st(p.LoadingScreenPlugin.prototype.refresh),$()],p.LoadingScreenPlugin.prototype,"backgroundBlur",2),or([Lt("Background Color"),st(p.LoadingScreenPlugin.prototype.refresh),$()],p.LoadingScreenPlugin.prototype,"background",2),or([Lt("Text Color"),st(p.LoadingScreenPlugin.prototype.refresh),$()],p.LoadingScreenPlugin.prototype,"textColor",2),or([Lt("Logo Image"),st(p.LoadingScreenPlugin.prototype.refresh),$()],p.LoadingScreenPlugin.prototype,"logoImage",2),or([ci("Toggle preview")],p.LoadingScreenPlugin.prototype,"togglePreview",1),or([ci("Minimize")],p.LoadingScreenPlugin.prototype,"minimize",1),or([ci("Maximize")],p.LoadingScreenPlugin.prototype,"maximize",1),p.LoadingScreenPlugin=or([ti("Loading Screen")],p.LoadingScreenPlugin);var lz=Object.defineProperty,cz=Object.getOwnPropertyDescriptor,Nr=(r,e,t,i)=>{for(var n=i>1?void 0:i?cz(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&lz(e,t,n),n};p.InteractionPromptPlugin=class extends ei{constructor(r=!0){super(),this.animationRunning=!1,this.animationDuration=2e3,this.animationDistance=80,this.animationPauseDuration=6e3,this.rotationDistance=.3,this.yOffset=0,this.autoStart=!0,this.autoStartDelay=3e4,this.autoStop=!0,this.autoStartOnObjectLoad=!0,this.autoStartOnObjectLoadDelay=3e3,this.currentTime=0,this.lastActionTime=1/0,this.pointerIcon=`<svg xmlns="http://www.w3.org/2000/svg" style="transform: translate(-50%, -25%);" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="36">
    <defs>
        <path id="A" d="M.001.232h24.997V36H.001z"></path>
    </defs>
    <g transform="translate(-11 -4)" fill="none" fill-rule="evenodd">
        <path fill-opacity="0" fill="#fff" d="M0 0h44v44H0z"></path>
        <g transform="translate(11 3)">
            <path d="M8.733 11.165c.04-1.108.766-2.027 1.743-2.307a2.54 2.54 0 0 1 .628-.089c.16 0 .314.017.463.044 1.088.2 1.9 1.092 1.9 2.16v8.88h1.26c2.943-1.39 5-4.45 5-8.025a9.01 9.01 0 0 0-1.9-5.56l-.43-.5c-.765-.838-1.683-1.522-2.712-2-1.057-.49-2.226-.77-3.46-.77s-2.4.278-3.46.77c-1.03.478-1.947 1.162-2.71 2l-.43.5a9.01 9.01 0 0 0-1.9 5.56 9.04 9.04 0 0 0 .094 1.305c.03.21.088.41.13.617l.136.624c.083.286.196.56.305.832l.124.333a8.78 8.78 0 0 0 .509.953l.065.122a8.69 8.69 0 0 0 3.521 3.191l1.11.537v-9.178z" fill-opacity=".5" fill="#e4e4e4"></path>
            <path d="M22.94 26.218l-2.76 7.74c-.172.485-.676.8-1.253.8H12.24c-1.606 0-3.092-.68-3.98-1.82-1.592-2.048-3.647-3.822-6.11-5.27-.095-.055-.15-.137-.152-.23-.004-.1.046-.196.193-.297.56-.393 1.234-.6 1.926-.6a3.43 3.43 0 0 1 .691.069l4.922.994V10.972c0-.663.615-1.203 1.37-1.203s1.373.54 1.373 1.203v9.882h2.953c.273 0 .533.073.757.21l6.257 3.874c.027.017.045.042.07.06.41.296.586.77.426 1.22M4.1 16.614c-.024-.04-.042-.083-.065-.122a8.69 8.69 0 0 1-.509-.953c-.048-.107-.08-.223-.124-.333l-.305-.832c-.058-.202-.09-.416-.136-.624l-.13-.617a9.03 9.03 0 0 1-.094-1.305c0-2.107.714-4.04 1.9-5.56l.43-.5c.764-.84 1.682-1.523 2.71-2 1.058-.49 2.226-.77 3.46-.77s2.402.28 3.46.77c1.03.477 1.947 1.16 2.712 2l.428.5a9 9 0 0 1 1.901 5.559c0 3.577-2.056 6.636-5 8.026h-1.26v-8.882c0-1.067-.822-1.96-1.9-2.16-.15-.028-.304-.044-.463-.044-.22 0-.427.037-.628.09-.977.28-1.703 1.198-1.743 2.306v9.178l-1.11-.537C6.18 19.098 4.96 18 4.1 16.614M22.97 24.09l-6.256-3.874c-.102-.063-.218-.098-.33-.144 2.683-1.8 4.354-4.855 4.354-8.243 0-.486-.037-.964-.104-1.43a9.97 9.97 0 0 0-1.57-4.128l-.295-.408-.066-.092a10.05 10.05 0 0 0-.949-1.078c-.342-.334-.708-.643-1.094-.922-1.155-.834-2.492-1.412-3.94-1.65l-.732-.088-.748-.03a9.29 9.29 0 0 0-1.482.119c-1.447.238-2.786.816-3.94 1.65a9.33 9.33 0 0 0-.813.686 9.59 9.59 0 0 0-.845.877l-.385.437-.36.5-.288.468-.418.778-.04.09c-.593 1.28-.93 2.71-.93 4.222 0 3.832 2.182 7.342 5.56 8.938l1.437.68v4.946L5 25.64a4.44 4.44 0 0 0-.888-.086c-.017 0-.034.003-.05.003-.252.004-.503.033-.75.08a5.08 5.08 0 0 0-.237.056c-.193.046-.382.107-.568.18-.075.03-.15.057-.225.1-.25.114-.494.244-.723.405a1.31 1.31 0 0 0-.566 1.122 1.28 1.28 0 0 0 .645 1.051C4 29.925 5.96 31.614 7.473 33.563a5.06 5.06 0 0 0 .434.491c1.086 1.082 2.656 1.713 4.326 1.715h6.697c.748-.001 1.43-.333 1.858-.872.142-.18.256-.38.336-.602l2.757-7.74c.094-.26.13-.53.112-.794s-.088-.52-.203-.76a2.19 2.19 0 0 0-.821-.91" fill-opacity=".6" fill="#000"></path>
            <path d="M22.444 24.94l-6.257-3.874a1.45 1.45 0 0 0-.757-.211h-2.953v-9.88c0-.663-.616-1.203-1.373-1.203s-1.37.54-1.37 1.203v16.643l-4.922-.994a3.44 3.44 0 0 0-.692-.069 3.35 3.35 0 0 0-1.925.598c-.147.102-.198.198-.194.298.004.094.058.176.153.23 2.462 1.448 4.517 3.22 6.11 5.27.887 1.14 2.373 1.82 3.98 1.82h6.686c.577 0 1.08-.326 1.253-.8l2.76-7.74c.16-.448-.017-.923-.426-1.22-.025-.02-.043-.043-.07-.06z" fill="#fff"></path>
            <g transform="translate(0 .769)">
                <mask id="B" fill="#fff">
                    <use xlink:href="#A"></use>
                </mask>
                <path d="M23.993 24.992a1.96 1.96 0 0 1-.111.794l-2.758 7.74c-.08.22-.194.423-.336.602-.427.54-1.11.87-1.857.872h-6.698c-1.67-.002-3.24-.633-4.326-1.715-.154-.154-.3-.318-.434-.49C5.96 30.846 4 29.157 1.646 27.773c-.385-.225-.626-.618-.645-1.05a1.31 1.31 0 0 1 .566-1.122 4.56 4.56 0 0 1 .723-.405l.225-.1a4.3 4.3 0 0 1 .568-.18l.237-.056c.248-.046.5-.075.75-.08.018 0 .034-.003.05-.003.303-.001.597.027.89.086l3.722.752V20.68l-1.436-.68c-3.377-1.596-5.56-5.106-5.56-8.938 0-1.51.336-2.94.93-4.222.015-.03.025-.06.04-.09.127-.267.268-.525.418-.778.093-.16.186-.316.288-.468.063-.095.133-.186.2-.277L3.773 5c.118-.155.26-.29.385-.437.266-.3.544-.604.845-.877a9.33 9.33 0 0 1 .813-.686C6.97 2.167 8.31 1.59 9.757 1.35a9.27 9.27 0 0 1 1.481-.119 8.82 8.82 0 0 1 .748.031c.247.02.49.05.733.088 1.448.238 2.786.816 3.94 1.65.387.28.752.588 1.094.922a9.94 9.94 0 0 1 .949 1.078l.066.092c.102.133.203.268.295.408a9.97 9.97 0 0 1 1.571 4.128c.066.467.103.945.103 1.43 0 3.388-1.67 6.453-4.353 8.243.11.046.227.08.33.144l6.256 3.874c.37.23.645.55.82.9.115.24.185.498.203.76m.697-1.195c-.265-.55-.677-1.007-1.194-1.326l-5.323-3.297c2.255-2.037 3.564-4.97 3.564-8.114 0-2.19-.637-4.304-1.84-6.114-.126-.188-.26-.37-.4-.552-.645-.848-1.402-1.6-2.252-2.204C15.472.91 13.393.232 11.238.232A10.21 10.21 0 0 0 5.23 2.19c-.848.614-1.606 1.356-2.253 2.205-.136.18-.272.363-.398.55C1.374 6.756.737 8.87.737 11.06c0 4.218 2.407 8.08 6.133 9.842l.863.41v3.092l-2.525-.51c-.356-.07-.717-.106-1.076-.106a5.45 5.45 0 0 0-3.14.996c-.653.46-1.022 1.202-.99 1.983a2.28 2.28 0 0 0 1.138 1.872c2.24 1.318 4.106 2.923 5.543 4.772 1.26 1.62 3.333 2.59 5.55 2.592h6.698c1.42-.001 2.68-.86 3.134-2.138l2.76-7.74c.272-.757.224-1.584-.134-2.325" fill-opacity=".05" fill="#000" mask="url(#B)"></path>
            </g>
        </g>
    </g>
</svg>`,this._mainCameraUpdate=e=>{this.isDisabled()||(e.change==="deserialize"?(this.stopAnimation(),this.startAnimation()):this.lastActionTime=nn())},this._addSceneObject=()=>{this.autoStartOnObjectLoad&&(this.lastActionTime=nn()-this.autoStartDelay+this.autoStartOnObjectLoadDelay)},this.onlyOnOrbitControls=!0,this._orbitWarning=!1,this.startAnimation=()=>{var e;if(!(!this._viewer||!this.cursorEl||this.isDisabled())){if(((e=this._viewer.scene.mainCamera.controls)==null?void 0:e.type)!=="OrbitControls"&&this.onlyOnOrbitControls){this._orbitWarning||console.warn("InteractionPromptPlugin requires OrbitControls, to run anyway, set onlyOnOrbitControls to false"),this._orbitWarning=!0;return}this._viewer.scene.modelRoot.children.length!==0&&(this.currentSphericalPosition=new ic().setFromVector3(new P().subVectors(this._viewer.scene.mainCamera.position,this._viewer.scene.mainCamera.target)),this.cursorEl.style.opacity="1",this.currentTime=0,this.animationRunning=!0,this._viewer.scene.mainCamera.setInteractions(!1,p.InteractionPromptPlugin.PluginType))}},this.stopAnimation=()=>{!this._viewer||!this.cursorEl||(this.animationRunning=!1,this.cursorEl.style.opacity="0",this._viewer.scene.mainCamera.setInteractions(!0,p.InteractionPromptPlugin.PluginType))},this._pointerDown=()=>{this.isDisabled()||(this.autoStop&&this.stopAnimation(),this.lastActionTime=nn())},this._x=0,this._preFrame=async e=>{if(!this._viewer||!this.cursorEl||(this.isDisabled()&&this.animationRunning&&this.stopAnimation(),this.isDisabled())||(!this.animationRunning&&this.autoStart&&this.lastActionTime+this.autoStartDelay<nn()&&this.startAnimation(),!this.animationRunning))return;if(this.currentTime<=this.animationDuration){this.cursorEl.style.opacity="1";const s=this.currentTime/this.animationDuration;this._x=Math.sin(Math.PI*2*s),(s<.25||s>.75)&&(this._x*=this._x*Math.sign(this._x))}else this.cursorEl.style.opacity="0",this._x=0;if(this.currentTime<=this.animationDuration+50){const s=this.currentSphericalPosition.clone();s.theta+=this._x*this.rotationDistance,this._viewer.scene.mainCamera.position.setFromSpherical(s).add(this._viewer.scene.mainCamera.target),this._viewer.scene.mainCamera.setDirty()}const t=this._viewer.container.getBoundingClientRect(),i=t.width/2+-this._x*Math.min(this.animationDistance,t.width/4),n=t.height/2+this.yOffset*t.height/2;this.cursorEl.style.transform=`translate(${Math.floor(i)}px, ${Math.floor(n)}px)`,this.currentTime+=e.deltaTime,this.currentTime>this.animationDuration+this.animationPauseDuration&&(this.currentTime=0)},this.enabled=r}onAdded(r){super.onAdded(r);{An(r.plugins,"InteractionPointerPlugin")&&delete r.plugins.InteractionPointerPlugin;const e=this;Object.defineProperty(r.plugins,"InteractionPointerPlugin",{get(){return console.warn("InteractionPromptPlugin: PluginType renamed from InteractionPointerPlugin to InteractionPromptPlugin. Please update your code/vjson."),e},configurable:!0})}this.lastActionTime=1/0,r.addEventListener("preFrame",this._preFrame),r.container.addEventListener("pointerdown",this._pointerDown,!0),r.container.addEventListener("wheel",this._pointerDown,!0),r.scene.addEventListener("addSceneObject",this._addSceneObject),r.scene.addEventListener("mainCameraUpdate",this._mainCameraUpdate),this._initializeCursor()}onRemove(r){return this.stopAnimation(),r.removeEventListener("preFrame",this._preFrame),r.container.removeEventListener("pointerdown",this._pointerDown,!0),r.container.removeEventListener("wheel",this._pointerDown,!0),r.scene.removeEventListener("addSceneObject",this._addSceneObject),r.scene.removeEventListener("mainCameraUpdate",this._mainCameraUpdate),this.cursorEl&&this.cursorEl.remove(),super.onRemove(r)}_pointerIconChanged(){this.cursorEl&&(this.cursorEl.innerHTML=this.pointerIcon)}_initializeCursor(){this.cursorEl=document.createElement("div"),this.cursorEl.style.position="absolute",this.cursorEl.style.top="0",this.cursorEl.style.left="0",this.cursorEl.style.width="10px",this.cursorEl.style.height="10px",this.cursorEl.style.opacity="0",this._pointerIconChanged(),this._viewer.container.appendChild(this.cursorEl)}},p.InteractionPromptPlugin.PluginType="InteractionPromptPlugin",Nr([$(),De()],p.InteractionPromptPlugin.prototype,"enabled",2),Nr([$(),Lt()],p.InteractionPromptPlugin.prototype,"animationDuration",2),Nr([$(),Lt()],p.InteractionPromptPlugin.prototype,"animationDistance",2),Nr([$(),Lt()],p.InteractionPromptPlugin.prototype,"animationPauseDuration",2),Nr([$(),Lt()],p.InteractionPromptPlugin.prototype,"rotationDistance",2),Nr([$(),Lt()],p.InteractionPromptPlugin.prototype,"yOffset",2),Nr([$(),De()],p.InteractionPromptPlugin.prototype,"autoStart",2),Nr([$(),Lt()],p.InteractionPromptPlugin.prototype,"autoStartDelay",2),Nr([$(),De()],p.InteractionPromptPlugin.prototype,"autoStop",2),Nr([$(),De()],p.InteractionPromptPlugin.prototype,"autoStartOnObjectLoad",2),Nr([$(),De()],p.InteractionPromptPlugin.prototype,"autoStartOnObjectLoadDelay",2),Nr([lc()],p.InteractionPromptPlugin.prototype,"currentTime",2),Nr([lc()],p.InteractionPromptPlugin.prototype,"lastActionTime",2),Nr([st(p.InteractionPromptPlugin.prototype._pointerIconChanged)],p.InteractionPromptPlugin.prototype,"pointerIcon",2),Nr([$()],p.InteractionPromptPlugin.prototype,"onlyOnOrbitControls",2),Nr([ci()],p.InteractionPromptPlugin.prototype,"startAnimation",2),Nr([ci()],p.InteractionPromptPlugin.prototype,"stopAnimation",2),p.InteractionPromptPlugin=Nr([ti("Interaction Prompt")],p.InteractionPromptPlugin);var hz=Object.defineProperty,c_=(r,e,t,i)=>{for(var n=void 0,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=a(e,t,n)||n);return n&&hz(e,t,n),n};const ru=(re=class extends ei{constructor(r=$1,e=!0,t=!1){super(),this.enabled=!0,this.autoFocusHover=!1,this.widgetEnabled=!0,this._mainCameraChange=()=>{!this._picker||!this._viewer||(this._picker.camera=this._viewer.scene.mainCamera)},this._onSceneUpdate=i=>{if(!i.hierarchyChanged)return;const n=this.getSelectedObject();let s=!1;n==null||n.traverseAncestors(a=>{var o;a===((o=this._viewer)==null?void 0:o.scene)&&(s=!0)}),s||this.setSelectedObject(void 0)},this._onObjectSelectEvent=i=>{i.source!==re.PluginType&&(i.object===void 0&&i.value===void 0?console.error("e.object or e.value must be set for picking, can be null to unselect"):this.setSelectedObject(i.object||i.value,this.autoFocus||i.focusCamera))},this._selectedObjectChanged=i=>{var n,s;if(!this._viewer)return;this.dispatchEvent(i);const a=((n=this._picker)==null?void 0:n.selectedObject)||void 0,o=this._viewer.getPlugin(p.FrameFadePlugin);if(o&&(a?o.disable(this):o.enable(this)),this._viewer.scene.autoNearFarEnabled=!a,this._pickUi){const c=a==null?void 0:a.uiConfig,h=this.uiConfig;h.children=[...this._uiConfigChildren],c&&h.children.push(c),(s=h.uiRefresh)==null||s.call(h)}const l=this._widget;l&&this.widgetEnabled&&(a?l.attach(a):l.detach()),this._viewer.setDirty(),this.autoFocus&&this.focusObject(a)},this._hoverObjectChanged=i=>{var n,s;this.dispatchEvent(i);const a=((n=this._picker)==null?void 0:n.hoverObject)||void 0,o=this._hoverWidget;o&&this.widgetEnabled&&(a?o.attach(a):o.detach()),(s=this._viewer)==null||s.setDirty(),this.autoFocusHover&&this.focusObject(a)},this._onObjectHit=i=>{if(this._viewer){if(this.isDisabled()){i.intersects.selectedObject=null;return}this.dispatchEvent(i)}},this._uiConfigChildren=[{label:"Enabled",type:"checkbox",property:[this,"enabled"]},{label:"Hover Enabled",type:"checkbox",property:[this,"hoverEnabled"],onChange:()=>{var i,n;return(n=(i=this.uiConfig).uiRefresh)==null?void 0:n.call(i,!0)}},{label:"Auto Focus",type:"checkbox",property:[this,"autoFocus"],onChange:()=>{const i=this.getSelectedObject();this.autoFocus&&i&&this.setSelectedObject(i,!0)}},{label:"Auto Focus on Hover",type:"checkbox",hidden:()=>!this.hoverEnabled,property:[this,"autoFocusHover"]},{label:"Widget Enabled",type:"checkbox",property:[this,"widgetEnabled"]}],this.uiConfig={type:"panel",label:"Picker",expanded:!0,children:[...this._uiConfigChildren]},r&&(this._widget=new r,this._hoverWidget=new r,this._hoverWidget.lineMaterial&&(this._hoverWidget.lineMaterial.linewidth/=2,this._hoverWidget.lineMaterial.color.set("#aa2222"))),this._pickUi=e,this.autoFocus=t,this.dispatchEvent=this.dispatchEvent.bind(this)}get picker(){return this._picker}get hoverEnabled(){var r;return((r=this._picker)==null?void 0:r.hoverEnabled)??!1}set hoverEnabled(r){var e,t;this._picker&&(this._picker.hoverEnabled=r,this.uiConfig&&((t=(e=this.uiConfig).uiRefresh)==null||t.call(e)))}_widgetEnabledChange(){var r,e,t,i,n;this.widgetEnabled&&(r=this._picker)!=null&&r.selectedObject?(e=this._widget)==null||e.attach(this._picker.selectedObject):(t=this._widget)==null||t.detach(),(n=(i=this.uiConfig)==null?void 0:i.uiRefresh)==null||n.call(i,!0)}setDirty(){this._viewer&&(this.isDisabled()&&this.setSelectedObject(void 0),this._viewer.setDirty())}getSelectedObject(){var r;if(!this.isDisabled())return((r=this._picker)==null?void 0:r.selectedObject)||void 0}setSelectedObject(r,e=!1){const t=this.isDisabled();if(t&&!r||!this._picker)return;const i=this.autoFocus;this.autoFocus=!1,this._picker.selectedObject=r||null,this.autoFocus=i,!t&&r&&(i||e)&&this.focusObject(r)}onAdded(r){super.onAdded(r),this.setDirty(),this._picker=new xx(r.scene.modelRoot,r.canvas,r.scene.mainCamera,e=>{if(!e.material)return!1;let t=e,i=!1;for(;t;){if(!t.visible||((t.assetType==="model"||t.assetType==="light")&&(i=!0),t.assetType==="widget")||t.userData.userSelectable===!1||t.userData.bboxVisible===!1)return!1;t=t.parent}return i}),this._widget&&r.scene.addObject(this._widget,{addToRoot:!0}),this._hoverWidget&&r.scene.addObject(this._hoverWidget,{addToRoot:!0}),this._picker.addEventListener("selectedObjectChanged",this._selectedObjectChanged),this._picker.addEventListener("hoverObjectChanged",this._hoverObjectChanged),this._picker.addEventListener("hitObject",this._onObjectHit),r.scene.addEventListener("select",this._onObjectSelectEvent),r.scene.addEventListener("sceneUpdate",this._onSceneUpdate),r.scene.addEventListener("mainCameraChange",this._mainCameraChange)}onRemove(r){var e,t;r.scene.removeEventListener("select",this._onObjectSelectEvent),r.scene.removeEventListener("sceneUpdate",this._onSceneUpdate),r.scene.removeEventListener("mainCameraChange",this._mainCameraChange),(e=this._widget)==null||e.removeFromParent(),(t=this._hoverWidget)==null||t.removeFromParent(),this._picker&&(this._picker.removeEventListener("selectedObjectChanged",this._selectedObjectChanged),this._picker.removeEventListener("hoverObjectChanged",this._hoverObjectChanged),this._picker.removeEventListener("hitObject",this._onObjectHit),this._picker.dispose(),this._picker=void 0),super.onRemove(r)}dispose(){var r,e;super.dispose(),(r=this._widget)==null||r.dispose(),(e=this._hoverWidget)==null||e.dispose()}async focusObject(r){var e;(e=this._viewer)==null||e.fitToView(r,1.25,1e3,"easeOut")}get widget(){return this._widget}},re.PluginType="Picking",re.OldPluginType="PickingPlugin",re);c_([$(),st(ru.prototype.setDirty)],ru.prototype,"enabled"),c_([$()],ru.prototype,"autoFocus"),c_([st(ru.prototype._widgetEnabledChange)],ru.prototype,"widgetEnabled");let fd=ru;var uz=Object.defineProperty,pz=Object.getOwnPropertyDescriptor,Fg=(r,e,t,i)=>{for(var n=i>1?void 0:i?pz(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&uz(e,t,n),n};p.TransformControlsPlugin=class extends ei{constructor(r=!0){super(),this.enabled=!0,this._pickingWidgetDisabled=!1,this.toJSON=void 0,this.dependencies=[fd],this._isInteracting=!1,this._viewerListeners={postFrame:()=>{!this.transformControls||this._viewer}},this._mainCameraChange=()=>{!this.transformControls||!this._viewer||(this.transformControls.camera=this._viewer.scene.mainCamera)},ll.ObjectConstructors.MeshBasicMaterial=kh,ll.ObjectConstructors.LineBasicMaterial=Xp,this.enabled=r}setDirty(){if(!this._viewer)return;const r=this._viewer.getPlugin(fd),e=!this.isDisabled();e&&r.widgetEnabled?(r.widgetEnabled=!1,this._pickingWidgetDisabled=!0):!e&&this._pickingWidgetDisabled&&(r.widgetEnabled=!0,this._pickingWidgetDisabled=!1),this.transformControls&&(e&&r.getSelectedObject()?this.transformControls.attach(r.getSelectedObject()):this.transformControls.detach()),this._viewer.setDirty()}onAdded(r){super.onAdded(r),this.setDirty(),this.transformControls=new p.TransformControls2(r.scene.mainCamera,r.canvas),this._mainCameraChange=this._mainCameraChange.bind(this),r.scene.addEventListener("mainCameraChange",this._mainCameraChange),this.transformControls.addEventListener("dragging-changed",e=>{if(!(this!=null&&this._viewer))return;const t=this._viewer.scene.mainCamera.controls;typeof(t==null?void 0:t.stopDamping)=="function"&&t!=null&&t.enabled&&t.stopDamping(),this._viewer.scene.mainCamera.setInteractions(!e.value,p.TransformControlsPlugin.PluginType)}),this.transformControls.addEventListener("axis-changed",e=>{if(!(this!=null&&this._viewer))return;this._isInteracting=!!e.value;const t=this._viewer.scene.mainCamera.controls;typeof(t==null?void 0:t.stopDamping)=="function"&&t!=null&&t.enabled&&t.stopDamping(),this._viewer.setDirty()}),r.scene.addObject(this.transformControls,{addToRoot:!0}),r.getPlugin(fd).addEventListener("selectedObjectChanged",e=>{if(this.transformControls){if(this.isDisabled()){this.transformControls.object&&this.transformControls.detach();return}e.object?this.transformControls.attach(e.object):this.transformControls.detach()}})}onRemove(r){r.scene.removeEventListener("mainCameraChange",this._mainCameraChange),this.transformControls&&(this.transformControls.detach(),r.scene.remove(this.transformControls),this.transformControls.dispose()),this.transformControls=void 0,super.onRemove(r)}centerAllMeshes(){var r;(r=this._viewer)==null||r.scene.centerAllGeometries(!0)}},p.TransformControlsPlugin.PluginType="TransformControlsPlugin",Fg([De(),st(p.TransformControlsPlugin.prototype.setDirty)],p.TransformControlsPlugin.prototype,"enabled",2),Fg([ur(void 0,{expanded:!0})],p.TransformControlsPlugin.prototype,"transformControls",2),Fg([ci("Center All Meshes")],p.TransformControlsPlugin.prototype,"centerAllMeshes",1),p.TransformControlsPlugin=Fg([Xr("Transform Controls")],p.TransformControlsPlugin);var dz=Object.defineProperty,mz=Object.getOwnPropertyDescriptor,dM=(r,e,t,i)=>{for(var n=i>1?void 0:i?mz(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&dz(e,t,n),n};p.EditorViewWidgetPlugin=class extends ei{constructor(r="top-left",e=128){super(),this.placement=r,this.size=e,this.enabled=!0,this._needsRender=!1,this._viewerListeners={postRender:t=>{!this._viewer||!this.widget||this.isDisabled()||(this._needsRender=!0)},postFrame:t=>{!this._viewer||!this.widget||this.isDisabled()||!this._needsRender||(this.widget.update(),this.widget.render(),this.widget.animating&&this._viewer.scene.mainCamera.setDirty(),this._needsRender=!1)}}}setDirty(){!this._viewer||!this.widget||(this.widget.domContainer.style.display=this.isDisabled()?"none":"block")}onAdded(r){super.onAdded(r),this.widget=new T0(r.scene.mainCamera,r.canvas,this.placement,this.size),this.widget.target=r.scene.mainCamera.target,this.widget.addEventListener("animating-changed",e=>{const t=e.detail.value;r.scene.mainCamera.setInteractions(!t,p.EditorViewWidgetPlugin.PluginType)}),this.widget.addEventListener("update",()=>this._needsRender=!0),r.scene.addEventListener("mainCameraChange",this._mainCameraChange),r.scene.addEventListener("mainCameraUpdate",this._mainCameraUpdate)}onRemove(r){var e;(e=this.widget)==null||e.dispose(),this.widget=void 0,r.scene.removeEventListener("mainCameraChange",this._mainCameraChange),r.scene.removeEventListener("mainCameraUpdate",this._mainCameraUpdate),super.onRemove(r)}_mainCameraChange(){!this._viewer||!this.widget||(this.widget.camera=this._viewer.scene.mainCamera)}_mainCameraUpdate(){!this._viewer||!this.widget||(this.widget.target=this._viewer.scene.mainCamera.target)}setOrientation(r){this.widget&&this.widget.setOrientation(r)}},p.EditorViewWidgetPlugin.PluginType="EditorViewWidgetPlugin",dM([De(),st(p.EditorViewWidgetPlugin.prototype.setDirty)],p.EditorViewWidgetPlugin.prototype,"enabled",2),p.EditorViewWidgetPlugin=dM([ti("Editor View Widget")],p.EditorViewWidgetPlugin);const mM=class extends Ug{constructor(){super(...arguments),this.controlsKey="deviceOrientation",this._controlsCtor=(e,t)=>new p.DeviceOrientationControls2(e)}};mM.PluginType="DeviceOrientationControlsPlugin";let fz=mM;const fM=class extends Ug{constructor(){super(...arguments),this.controlsKey="pointerLock",this._controlsCtor=(e,t)=>new p.PointerLockControls2(e,t!=null&&t.ownerDocument?t:(t||document).documentElement)}};fM.PluginType="PointerLockControlsPlugin";let gz=fM;const gM=class extends Ug{constructor(){super(...arguments),this.controlsKey="threeFirstPerson",this._controlsCtor=(e,t)=>new p.FirstPersonControls2(e,t||document.documentElement)}};gM.PluginType="ThreeFirstPersonControlsPlugin";let Az=gM;var vz=Object.defineProperty,yz=Object.getOwnPropertyDescriptor,gd=(r,e,t,i)=>{for(var n=i>1?void 0:i?yz(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&vz(e,t,n),n};p.Rhino3dmLoadPlugin=class extends Ec{constructor(){super(...arguments),this._importer=new Pr(eu,["3dm"],["model/vnd.3dm","model/3dm"],!0),this.importMaterials=!0,this.forceLayerMaterials=!1,this.replaceWithInstancedMesh=!1,this.hideLineMesh=!1}_refresh(){eu.ImportMaterials=this.importMaterials,eu.ForceLayerMaterials=this.forceLayerMaterials,eu.ReplaceWithInstancedMesh=this.replaceWithInstancedMesh,eu.HideLineMesh=this.hideLineMesh}onAdded(r){if(!window.WebAssembly)throw new Error("Rhino3dmLoadPlugin requires WebAssembly support");super.onAdded(r),this._refresh()}},p.Rhino3dmLoadPlugin.PluginType="Rhino3dmLoadPlugin",gd([st(p.Rhino3dmLoadPlugin.prototype._refresh),De()],p.Rhino3dmLoadPlugin.prototype,"importMaterials",2),gd([st(p.Rhino3dmLoadPlugin.prototype._refresh),De()],p.Rhino3dmLoadPlugin.prototype,"forceLayerMaterials",2),gd([st(p.Rhino3dmLoadPlugin.prototype._refresh),De()],p.Rhino3dmLoadPlugin.prototype,"replaceWithInstancedMesh",2),gd([st(p.Rhino3dmLoadPlugin.prototype._refresh),De()],p.Rhino3dmLoadPlugin.prototype,"hideLineMesh",2),p.Rhino3dmLoadPlugin=gd([ti("Rhino 3dm Loader")],p.Rhino3dmLoadPlugin);class _z{parse(e){const t={},i=e.split(`
`),n=i.length;let s=0,a=null,o=t;const l=[t];function c(){const h=i[s];if(h.includes("=")){const d=h.split("="),m=d[0].trim(),f=d[1].trim();if(f.endsWith("{")){const v={};l.push(v),o[m]=v,o=v}else o[m]=f}else if(h.endsWith("{")){const d=o[a]||{};l.push(d),o[a]=d,o=d}else if(h.endsWith("}")){if(l.pop(),l.length===0)return;o=l[l.length-1]}else if(h.endsWith("(")){const d={};l.push(d),a=h.split("(")[0].trim()||a,o[a]=d,o=d}else h.endsWith(")")?(l.pop(),o=l[l.length-1]):a=h.trim();s++,s<n&&c()}return c(),t}}class bz extends $i{constructor(e){super(e)}load(e,t,i,n){const s=this,a=new bi(s.manager);a.setPath(s.path),a.setResponseType("arraybuffer"),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(o){try{t(s.parse(o))}catch(l){n?n(l):console.error(l),s.manager.itemError(e)}},i,n)}parse(e){const t=new _z;function i(S){const R={};new bi().setResponseType("arraybuffer");for(const U in S){if(U.endsWith("png")){const T=new Blob([S[U]],{type:{type:"image/png"}});R[U]=URL.createObjectURL(T)}if(U.endsWith("usd")){const T=rd(S[U]);R[U]=t.parse(T)}}return R}function n(S){for(const R in S)if(R.endsWith("usda"))return S[R]}const s=Ny(new Uint8Array(e)),a=i(s),o=n(s);if(o===void 0)return console.warn("THREE.USDZLoader: No usda file found."),new fn;const l=rd(o),c=t.parse(l);function h(S){if(S){if("prepend references"in S){const R=S["prepend references"].split("@"),U=R[1].replace(/^.\//,""),T=R[2].replace(/^<\//,"").replace(/>$/,"");return d(a[U],T)}return d(S)}}function d(S,R){if(R!==void 0){const U=`def "${R}"`;if(U in S)return S[U]}for(const U in S){const T=S[U];if(U.startsWith("def Mesh"))return"point3f[] points"in S&&(T["point3f[] points"]=S["point3f[] points"]),"float2[] primvars:st"in S&&(T["float2[] primvars:st"]=S["float2[] primvars:st"]),"int[] primvars:st:indices"in S&&(T["int[] primvars:st:indices"]=S["int[] primvars:st:indices"]),T;if(typeof T=="object"){const B=d(T);if(B)return B}}}function m(S){if(!S)return;let R=new ht;if("int[] faceVertexIndices"in S){const U=JSON.parse(S["int[] faceVertexIndices"]);R.setIndex(new At(new Uint16Array(U),1))}if("point3f[] points"in S){const U=JSON.parse(S["point3f[] points"].replace(/[()]*/g,"")),T=new At(new Float32Array(U),3);R.setAttribute("position",T)}if("normal3f[] normals"in S){const U=JSON.parse(S["normal3f[] normals"].replace(/[()]*/g,"")),T=new At(new Float32Array(U),3);R.setAttribute("normal",T)}else R.computeVertexNormals();if("float2[] primvars:st"in S&&(S["texCoord2f[] primvars:st"]=S["float2[] primvars:st"]),"texCoord2f[] primvars:st"in S){const U=JSON.parse(S["texCoord2f[] primvars:st"].replace(/[()]*/g,"")),T=new At(new Float32Array(U),2);if("int[] primvars:st:indices"in S){R=R.toNonIndexed();const B=JSON.parse(S["int[] primvars:st:indices"]);R.setAttribute("uv",f(T,B))}else R.setAttribute("uv",T)}return R}function f(S,R){const U=S.array,T=S.itemSize,B=new U.constructor(R.length*T);let Q=0,Z=0;for(let q=0,X=R.length;q<X;q++){Q=R[q]*T;for(let te=0;te<T;te++)B[Z++]=U[Q++]}return new At(B,T)}function v(S){if(S){if("rel material:binding"in S){const R=S["rel material:binding"].replace(/^<\//,"").replace(/>$/,"").split("/");return w(c,` "${R[1]}"`)}return w(S)}}function w(S,R=""){for(const U in S){const T=S[U];if(U.startsWith("def Material"+R))return T;if(typeof T=="object"){const B=w(T,R);if(B)return B}}}function b(S){const R=new fa;if(S!==void 0){if('def Shader "PreviewSurface"'in S){const U=S['def Shader "PreviewSurface"'];if("color3f inputs:diffuseColor.connect"in U){const T=U["color3f inputs:diffuseColor.connect"],B=y(c,/(\w+).output/.exec(T)[1]);R.map=E(B),R.map.colorSpace=it}else if("color3f inputs:diffuseColor"in U){const T=U["color3f inputs:diffuseColor"].replace(/[()]*/g,"");R.color.fromArray(JSON.parse("["+T+"]"))}if("normal3f inputs:normal.connect"in U){const T=U["normal3f inputs:normal.connect"],B=y(c,/(\w+).output/.exec(T)[1]);R.normalMap=E(B)}"float inputs:roughness"in U&&(R.roughness=parseFloat(U["float inputs:roughness"])),"float inputs:metallic"in U&&(R.metalness=parseFloat(U["float inputs:metallic"]))}if('def Shader "diffuseColor_texture"'in S){const U=S['def Shader "diffuseColor_texture"'];R.map=E(U),R.map.colorSpace=it}if('def Shader "normal_texture"'in S){const U=S['def Shader "normal_texture"'];R.normalMap=E(U)}}return R}function y(S,R){for(const U in S){const T=S[U];if(U.startsWith(`def Shader "${R}"`))return T;if(typeof T=="object"){const B=y(T,R);if(B)return B}}}function E(S){if("asset inputs:file"in S){const R=S["asset inputs:file"].replace(/@*/g,""),U=new Ko().load(a[R]),T={'"clamp"':ai,'"mirror"':bs,'"repeat"':Ar};return"token inputs:wrapS"in S&&(U.wrapS=T[S["token inputs:wrapS"]]),"token inputs:wrapT"in S&&(U.wrapT=T[S["token inputs:wrapT"]]),U}return null}function _(S){const R=m(h(S)),U=b(v(S)),T=R?new Fe(R,U):new It;if("matrix4d xformOp:transform"in S){const B=JSON.parse("["+S["matrix4d xformOp:transform"].replace(/[()]*/g,"")+"]");T.matrix.fromArray(B),T.matrix.decompose(T.position,T.quaternion,T.scale)}return T}function C(S,R){for(const U in S)if(U.startsWith("def Scope"))C(S[U],R);else if(U.startsWith("def Xform")){const T=_(S[U]);/def Xform "(\w+)"/.test(U)&&(T.name=/def Xform "(\w+)"/.exec(U)[1]),R.add(T),C(S[U],T)}}const M=new fn;return C(c,M),M}}const AM=class extends Ec{constructor(){super(...arguments),this._importer=new Pr(class extends bz{constructor(){super(...arguments),this.currentUrl=""}async loadAsync(e,t){this.currentUrl=e;const i=await super.loadAsync(e,t);return this.currentUrl="",i}parse(e){if(this.currentUrl.endsWith(".usda")&&typeof e!="string"){const t=this.currentUrl.split("/").pop();if(t){const i={};i[t]=new Uint8Array(e),e=hC(i).buffer}}return super.parse(e)}},["usdz","usda"],["model/vnd.usd+zip","model/vnd.usdz+zip","model/vnd.usda"],!1)}};AM.PluginType="USDZLoadPlugin";let wz=AM;const kn=new fe;class xz extends $i{constructor(e){super(e),this.propertyNameMapping={},this.customPropertyMapping={}}load(e,t,i,n){const s=this,a=new bi(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(o){try{t(s.parse(o))}catch(l){n?n(l):console.error(l),s.manager.itemError(e)}},i,n)}setPropertyNameMapping(e){this.propertyNameMapping=e}setCustomPropertyNameMapping(e){this.customPropertyMapping=e}parse(e){function t(b){const y=/^ply([\s\S]*)end_header(\r\n|\r|\n)/;let E="",_=0;const C=y.exec(b);C!==null&&(E=C[1],_=new Blob([C[0]]).size);const M={comments:[],elements:[],headerLength:_,objInfo:""},S=E.split(/\r\n|\r|\n/);let R;function U(T,B){const Q={type:T[0]};return Q.type==="list"?(Q.name=T[3],Q.countType=T[1],Q.itemType=T[2]):Q.name=T[1],Q.name in B&&(Q.name=B[Q.name]),Q}for(let T=0;T<S.length;T++){let B=S[T];if(B=B.trim(),B==="")continue;const Q=B.split(/\s+/),Z=Q.shift();switch(B=Q.join(" "),Z){case"format":M.format=Q[0],M.version=Q[1];break;case"comment":M.comments.push(B);break;case"element":R!==void 0&&M.elements.push(R),R={},R.name=Q[0],R.count=parseInt(Q[1]),R.properties=[];break;case"property":R.properties.push(U(Q,w.propertyNameMapping));break;case"obj_info":M.objInfo=B;break;default:console.log("unhandled",Z,Q)}}return R!==void 0&&M.elements.push(R),M}function i(b,y){switch(y){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(b);case"float":case"double":case"float32":case"float64":return parseFloat(b)}}function n(b,y){const E={};for(let _=0;_<b.length;_++){if(y.empty())return null;if(b[_].type==="list"){const C=[],M=i(y.next(),b[_].countType);for(let S=0;S<M;S++){if(y.empty())return null;C.push(i(y.next(),b[_].itemType))}E[b[_].name]=C}else E[b[_].name]=i(y.next(),b[_].type)}return E}function s(){const b={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[],faceVertexColors:[]};for(const y of Object.keys(w.customPropertyMapping))b[y]=[];return b}function a(b){const y=b.map(_=>_.name);function E(_){for(let C=0,M=_.length;C<M;C++){const S=_[C];if(y.includes(S))return S}return null}return{attrX:E(["x","px","posx"])||"x",attrY:E(["y","py","posy"])||"y",attrZ:E(["z","pz","posz"])||"z",attrNX:E(["nx","normalx"]),attrNY:E(["ny","normaly"]),attrNZ:E(["nz","normalz"]),attrS:E(["s","u","texture_u","tx"]),attrT:E(["t","v","texture_v","ty"]),attrR:E(["red","diffuse_red","r","diffuse_r"]),attrG:E(["green","diffuse_green","g","diffuse_g"]),attrB:E(["blue","diffuse_blue","b","diffuse_b"])}}function o(b,y){const E=s(),_=/end_header\s+(\S[\s\S]*\S|\S)\s*$/;let C,M;(M=_.exec(b))!==null?C=M[1].split(/\s+/):C=[];const S=new Ez(C);e:for(let R=0;R<y.elements.length;R++){const U=y.elements[R],T=a(U.properties);for(let B=0;B<U.count;B++){const Q=n(U.properties,S);if(!Q)break e;c(E,U.name,Q,T)}}return l(E)}function l(b){let y=new ht;b.indices.length>0&&y.setIndex(b.indices),y.setAttribute("position",new Ne(b.vertices,3)),b.normals.length>0&&y.setAttribute("normal",new Ne(b.normals,3)),b.uvs.length>0&&y.setAttribute("uv",new Ne(b.uvs,2)),(b.faceVertexUvs.length>0||b.faceVertexColors.length>0)&&(y=y.toNonIndexed(),b.faceVertexUvs.length>0&&y.setAttribute("uv",new Ne(b.faceVertexUvs,2)),b.faceVertexColors.length>0&&y.setAttribute("color",new Ne(b.faceVertexColors,3)));for(const E of Object.keys(w.customPropertyMapping))b[E].length>0&&y.setAttribute(E,new Ne(b[E],w.customPropertyMapping[E].length));return y.computeBoundingSphere(),y}function c(b,y,E,_){if(y==="vertex"){b.vertices.push(E[_.attrX],E[_.attrY],E[_.attrZ]),_.attrNX!==null&&_.attrNY!==null&&_.attrNZ!==null&&b.normals.push(E[_.attrNX],E[_.attrNY],E[_.attrNZ]),_.attrS!==null&&_.attrT!==null&&b.uvs.push(E[_.attrS],E[_.attrT]),_.attrR!==null&&_.attrG!==null&&_.attrB!==null&&(kn.setRGB(E[_.attrR]/255,E[_.attrG]/255,E[_.attrB]/255).convertSRGBToLinear(),b.colors.push(kn.r,kn.g,kn.b));for(const C of Object.keys(w.customPropertyMapping))for(const M of w.customPropertyMapping[C])b[C].push(E[M])}else if(y==="face"){const C=E.vertex_indices||E.vertex_index,M=E.texcoord;C.length===3?(b.indices.push(C[0],C[1],C[2]),M&&M.length===6&&(b.faceVertexUvs.push(M[0],M[1]),b.faceVertexUvs.push(M[2],M[3]),b.faceVertexUvs.push(M[4],M[5]))):C.length===4&&(b.indices.push(C[0],C[1],C[3]),b.indices.push(C[1],C[2],C[3])),_.attrR!==null&&_.attrG!==null&&_.attrB!==null&&(kn.setRGB(E[_.attrR]/255,E[_.attrG]/255,E[_.attrB]/255).convertSRGBToLinear(),b.faceVertexColors.push(kn.r,kn.g,kn.b),b.faceVertexColors.push(kn.r,kn.g,kn.b),b.faceVertexColors.push(kn.r,kn.g,kn.b))}}function h(b,y){const E={};let _=0;for(let C=0;C<y.length;C++){const M=y[C],S=M.valueReader;if(M.type==="list"){const R=[],U=M.countReader.read(b+_);_+=M.countReader.size;for(let T=0;T<U;T++)R.push(S.read(b+_)),_+=S.size;E[M.name]=R}else E[M.name]=S.read(b+_),_+=S.size}return[E,_]}function d(b,y,E){function _(C,M,S){switch(M){case"int8":case"char":return{read:R=>C.getInt8(R),size:1};case"uint8":case"uchar":return{read:R=>C.getUint8(R),size:1};case"int16":case"short":return{read:R=>C.getInt16(R,S),size:2};case"uint16":case"ushort":return{read:R=>C.getUint16(R,S),size:2};case"int32":case"int":return{read:R=>C.getInt32(R,S),size:4};case"uint32":case"uint":return{read:R=>C.getUint32(R,S),size:4};case"float32":case"float":return{read:R=>C.getFloat32(R,S),size:4};case"float64":case"double":return{read:R=>C.getFloat64(R,S),size:8}}}for(let C=0,M=b.length;C<M;C++){const S=b[C];S.type==="list"?(S.countReader=_(y,S.countType,E),S.valueReader=_(y,S.itemType,E)):S.valueReader=_(y,S.type,E)}}function m(b,y){const E=s(),_=y.format==="binary_little_endian",C=new DataView(b,y.headerLength);let M,S=0;for(let R=0;R<y.elements.length;R++){const U=y.elements[R],T=U.properties,B=a(T);d(T,C,_);for(let Q=0;Q<U.count;Q++){M=h(S,T),S+=M[1];const Z=M[0];c(E,U.name,Z,B)}}return l(E)}function f(b){let y=0,E=!0,_="";const C=[];do{const M=String.fromCharCode(b[y++]);M!==`
`&&M!=="\r"?_+=M:(_==="end_header"&&(E=!1),_!==""&&(C.push(_),_=""))}while(E&&y<b.length);return C.join("\r")+"\r"}let v;const w=this;if(e instanceof ArrayBuffer){const b=new Uint8Array(e),y=f(b),E=t(y);if(E.format==="ascii"){const _=new TextDecoder().decode(b);v=o(_,E)}else v=m(e,E)}else v=o(e,t(e));return v}}class Ez{constructor(e){this.arr=e,this.i=0}empty(){return this.i>=this.arr.length}next(){return this.arr[this.i++]}}const vM=class extends Ec{constructor(){super(...arguments),this._importer=new Pr(class extends xz{transform(e,t){var i;return(i=e.attributes)!=null&&i.normal||e.computeVertexNormals(),e?new Fe(e,new xa({color:new fe(1,1,1),vertexColors:e.hasAttribute("color")})):void 0}},["ply"],["text/plain+ply"],!1)}};vM.PluginType="PLYLoadPlugin";let Cz=vM;class Mz extends $i{constructor(e){super(e)}load(e,t,i,n){const s=this,a=new bi(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(o){try{t(s.parse(o))}catch(l){n?n(l):console.error(l),s.manager.itemError(e)}},i,n)}parse(e){function t(c){const h=new DataView(c),d=32/8*3+32/8*3*3+16/8,m=h.getUint32(80,!0);if(80+32/8+m*d===h.byteLength)return!0;const f=[115,111,108,105,100];for(let v=0;v<5;v++)if(i(f,h,v))return!1;return!0}function i(c,h,d){for(let m=0,f=c.length;m<f;m++)if(c[m]!==h.getUint8(d+m))return!1;return!0}function n(c){const h=new DataView(c),d=h.getUint32(80,!0);let m,f,v,w=!1,b,y,E,_,C;for(let Q=0;Q<70;Q++)h.getUint32(Q,!1)==1129270351&&h.getUint8(Q+4)==82&&h.getUint8(Q+5)==61&&(w=!0,b=new Float32Array(d*3*3),y=h.getUint8(Q+6)/255,E=h.getUint8(Q+7)/255,_=h.getUint8(Q+8)/255,C=h.getUint8(Q+9)/255);const M=84,S=12*4+2,R=new ht,U=new Float32Array(d*3*3),T=new Float32Array(d*3*3),B=new fe;for(let Q=0;Q<d;Q++){const Z=M+Q*S,q=h.getFloat32(Z,!0),X=h.getFloat32(Z+4,!0),te=h.getFloat32(Z+8,!0);if(w){const me=h.getUint16(Z+48,!0);me&32768?(m=y,f=E,v=_):(m=(me&31)/31,f=(me>>5&31)/31,v=(me>>10&31)/31)}for(let me=1;me<=3;me++){const se=Z+me*12,he=Q*3*3+(me-1)*3;U[he]=h.getFloat32(se,!0),U[he+1]=h.getFloat32(se+4,!0),U[he+2]=h.getFloat32(se+8,!0),T[he]=q,T[he+1]=X,T[he+2]=te,w&&(B.set(m,f,v).convertSRGBToLinear(),b[he]=B.r,b[he+1]=B.g,b[he+2]=B.b)}}return R.setAttribute("position",new At(U,3)),R.setAttribute("normal",new At(T,3)),w&&(R.setAttribute("color",new At(b,3)),R.hasColors=!0,R.alpha=C),R}function s(c){const h=new ht,d=/solid([\s\S]*?)endsolid/g,m=/facet([\s\S]*?)endfacet/g;let f=0;const v=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,w=new RegExp("vertex"+v+v+v,"g"),b=new RegExp("normal"+v+v+v,"g"),y=[],E=[],_=new P;let C,M=0,S=0,R=0;for(;(C=d.exec(c))!==null;){S=R;const U=C[0];for(;(C=m.exec(U))!==null;){let Q=0,Z=0;const q=C[0];for(;(C=b.exec(q))!==null;)_.x=parseFloat(C[1]),_.y=parseFloat(C[2]),_.z=parseFloat(C[3]),Z++;for(;(C=w.exec(q))!==null;)y.push(parseFloat(C[1]),parseFloat(C[2]),parseFloat(C[3])),E.push(_.x,_.y,_.z),Q++,R++;Z!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+f),Q!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+f),f++}const T=S,B=R-S;h.addGroup(T,B,M),M++}return h.setAttribute("position",new Ne(y,3)),h.setAttribute("normal",new Ne(E,3)),h}function a(c){return typeof c!="string"?new TextDecoder().decode(c):c}function o(c){if(typeof c=="string"){const h=new Uint8Array(c.length);for(let d=0;d<c.length;d++)h[d]=c.charCodeAt(d)&255;return h.buffer||h}else return c}const l=o(e);return t(l)?n(l):s(a(e))}}const yM=class extends Ec{constructor(){super(...arguments),this._importer=new Pr(class extends Mz{transform(e,t){var i;return(i=e.attributes)!=null&&i.normal||e.computeVertexNormals(),e?new Fe(e,new xa({color:new fe(1,1,1),vertexColors:e.hasAttribute("color")})):void 0}},["stl"],["model/stl","model/x.stl-binary","model/x.stl-ascii"],!1)}};yM.PluginType="STLLoadPlugin";let Sz=yM;class Tz extends rw{constructor(e){super(e)}parse(e,t){const i=new Rz(e,1);return{mipmaps:i.mipmaps(t),width:i.pixelWidth,height:i.pixelHeight,format:i.glInternalFormat,isCubemap:i.numberOfFaces===6,mipmapCount:i.numberOfMipmapLevels}}}const Iz=12+13*4,Pz=0;class Rz{constructor(e,t){this.arrayBuffer=e;const i=new Uint8Array(this.arrayBuffer,0,12);if(i[0]!==171||i[1]!==75||i[2]!==84||i[3]!==88||i[4]!==32||i[5]!==49||i[6]!==49||i[7]!==187||i[8]!==13||i[9]!==10||i[10]!==26||i[11]!==10){console.error("texture missing KTX identifier");return}const n=Uint32Array.BYTES_PER_ELEMENT,s=new DataView(this.arrayBuffer,12,13*n),a=s.getUint32(0,!0)===67305985;if(this.glType=s.getUint32(1*n,a),this.glTypeSize=s.getUint32(2*n,a),this.glFormat=s.getUint32(3*n,a),this.glInternalFormat=s.getUint32(4*n,a),this.glBaseInternalFormat=s.getUint32(5*n,a),this.pixelWidth=s.getUint32(6*n,a),this.pixelHeight=s.getUint32(7*n,a),this.pixelDepth=s.getUint32(8*n,a),this.numberOfArrayElements=s.getUint32(9*n,a),this.numberOfFaces=s.getUint32(10*n,a),this.numberOfMipmapLevels=s.getUint32(11*n,a),this.bytesOfKeyValueData=s.getUint32(12*n,a),this.glType!==0){console.warn("only compressed formats currently supported");return}else this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels);if(this.pixelHeight===0||this.pixelDepth!==0){console.warn("only 2D textures currently supported");return}if(this.numberOfArrayElements!==0){console.warn("texture arrays not currently supported");return}if(this.numberOfFaces!==t){console.warn("number of faces expected"+t+", but found "+this.numberOfFaces);return}this.loadType=Pz}mipmaps(e){const t=[];let i=Iz+this.bytesOfKeyValueData,n=this.pixelWidth,s=this.pixelHeight;const a=e?this.numberOfMipmapLevels:1;for(let o=0;o<a;o++){const l=new Int32Array(this.arrayBuffer,i,1)[0];i+=4;for(let c=0;c<this.numberOfFaces;c++){const h=new Uint8Array(this.arrayBuffer,i,l);t.push({data:h,width:n,height:s}),i+=l,i+=3-(l+3)%4}n=Math.max(1,n*.5),s=Math.max(1,s*.5)}return t}}const _M=class extends Ec{constructor(){super(...arguments),this._importer=new Pr(Tz,["ktx"],["image/ktx"],!1)}};_M.PluginType="KTXLoadPlugin";let Dz=_M;class Bz{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const i=this.workersResolve[e];if(i&&i(t),this.queue.length){const{resolve:n,msg:s,transfer:a}=this.queue.shift();this.workersResolve[e]=n,this.workers[e].postMessage(s,a)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(i=>{const n=this._getIdleWorker();n!==-1?(this._initWorker(n),this.workerStatus|=1<<n,this.workersResolve[n]=i,this.workers[n].postMessage(e,t)):this.queue.push({resolve:i,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const Lz=0,Uz=2,Oz=1,kz=2,Fz=0,bM=9,h_=15,wM=16,u_=22,xM=37,p_=43,EM=76,CM=83,MM=97,SM=100,TM=103,IM=109;class Nz{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Ad{constructor(e,t,i,n){this._dataView=new DataView(e.buffer,e.byteOffset+t,i),this._littleEndian=n,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const i=this._offset;let n=0;for(;this._dataView.getUint8(this._offset)!==t&&n<e;)n++,this._offset++;return n<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,n)}}const bn=[171,75,84,88,32,50,48,187,13,10,26,10];function PM(r){return typeof TextDecoder<"u"?new TextDecoder().decode(r):Buffer.from(r).toString("utf8")}function Gz(r){const e=new Uint8Array(r.buffer,r.byteOffset,bn.length);if(e[0]!==bn[0]||e[1]!==bn[1]||e[2]!==bn[2]||e[3]!==bn[3]||e[4]!==bn[4]||e[5]!==bn[5]||e[6]!==bn[6]||e[7]!==bn[7]||e[8]!==bn[8]||e[9]!==bn[9]||e[10]!==bn[10]||e[11]!==bn[11])throw new Error("Missing KTX 2.0 identifier.");const t=new Nz,i=17*Uint32Array.BYTES_PER_ELEMENT,n=new Ad(r,bn.length,i,!0);t.vkFormat=n._nextUint32(),t.typeSize=n._nextUint32(),t.pixelWidth=n._nextUint32(),t.pixelHeight=n._nextUint32(),t.pixelDepth=n._nextUint32(),t.layerCount=n._nextUint32(),t.faceCount=n._nextUint32();const s=n._nextUint32();t.supercompressionScheme=n._nextUint32();const a=n._nextUint32(),o=n._nextUint32(),l=n._nextUint32(),c=n._nextUint32(),h=n._nextUint64(),d=n._nextUint64(),m=new Ad(r,bn.length+i,3*s*8,!0);for(let se=0;se<s;se++)t.levels.push({levelData:new Uint8Array(r.buffer,r.byteOffset+m._nextUint64(),m._nextUint64()),uncompressedByteLength:m._nextUint64()});const f=new Ad(r,a,o,!0),v={vendorId:f._skip(4)._nextUint16(),descriptorType:f._nextUint16(),versionNumber:f._nextUint16(),descriptorBlockSize:f._nextUint16(),colorModel:f._nextUint8(),colorPrimaries:f._nextUint8(),transferFunction:f._nextUint8(),flags:f._nextUint8(),texelBlockDimension:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],bytesPlane:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],samples:[]},w=(v.descriptorBlockSize/4-6)/4;for(let se=0;se<w;se++){const he={bitOffset:f._nextUint16(),bitLength:f._nextUint8(),channelType:f._nextUint8(),samplePosition:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&he.channelType?(he.sampleLower=f._nextInt32(),he.sampleUpper=f._nextInt32()):(he.sampleLower=f._nextUint32(),he.sampleUpper=f._nextUint32()),v.samples[se]=he}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(v);const b=new Ad(r,l,c,!0);for(;b._offset<c;){const se=b._nextUint32(),he=b._scan(se),_e=PM(he),ge=b._scan(se-he.byteLength);t.keyValue[_e]=_e.match(/^ktx/i)?PM(ge):ge,b._offset%4&&b._skip(4-b._offset%4)}if(d<=0)return t;const y=new Ad(r,h,d,!0),E=y._nextUint16(),_=y._nextUint16(),C=y._nextUint32(),M=y._nextUint32(),S=y._nextUint32(),R=y._nextUint32(),U=[];for(let se=0;se<s;se++)U.push({imageFlags:y._nextUint32(),rgbSliceByteOffset:y._nextUint32(),rgbSliceByteLength:y._nextUint32(),alphaSliceByteOffset:y._nextUint32(),alphaSliceByteLength:y._nextUint32()});const T=h+y._offset,B=T+C,Q=B+M,Z=Q+S,q=new Uint8Array(r.buffer,r.byteOffset+T,C),X=new Uint8Array(r.buffer,r.byteOffset+B,M),te=new Uint8Array(r.buffer,r.byteOffset+Q,S),me=new Uint8Array(r.buffer,r.byteOffset+Z,R);return t.globalData={endpointCount:E,selectorCount:_,imageDescs:U,endpointsData:q,selectorsData:X,tablesData:te,extendedData:me},t}let d_,go,m_;const f_={env:{emscripten_notify_memory_growth:function(r){m_=new Uint8Array(go.exports.memory.buffer)}}};class zz{init(){return d_||(d_=typeof fetch<"u"?fetch("data:application/wasm;base64,"+RM).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,f_)).then(this._init):WebAssembly.instantiate(Buffer.from(RM,"base64"),f_).then(this._init),d_)}_init(e){go=e.instance,f_.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!go)throw new Error("ZSTDDecoder: Await .init() before decoding.");const i=e.byteLength,n=go.exports.malloc(i);m_.set(e,n),t=t||Number(go.exports.ZSTD_findDecompressedSize(n,i));const s=go.exports.malloc(t),a=go.exports.ZSTD_decompress(s,t,n,i),o=m_.slice(s,s+a);return go.exports.free(n),go.exports.free(s),o}}const RM="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",g_=new WeakMap;let A_=0,v_;class Pa extends $i{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Bz,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),etc1Supported:!1,etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:!1,pvrtcSupported:!1}:(this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1)),this}init(){if(!this.transcoderPending){const e=new bi(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),i=new bi(this.manager);i.setPath(this.transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const n=i.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,n]).then(([s,a])=>{const o=Pa.BasisWorker,l=["/* constants */","let _EngineFormat = "+JSON.stringify(Pa.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Pa.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Pa.BasisFormat),"/* basis_transcoder.js */",s,"/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([l])),this.transcoderBinary=a,this.workerPool.setWorkerCreator(()=>{const c=new Worker(this.workerSourceURL),h=this.transcoderBinary.slice(0);return c.postMessage({type:"init",config:this.workerConfig,transcoderBinary:h},[h]),c})}),A_>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),A_++}return this.transcoderPending}load(e,t,i,n){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const s=new bi(this.manager);s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials),s.load(e,a=>{if(g_.has(a))return g_.get(a).promise.then(t).catch(n);this.createTexture(a).then(o=>t?t(o):null).catch(n)},i,n)}_createTextureFrom(e,t){const{faces:i,width:n,height:s,format:a,type:o,error:l,dfdTransferFn:c,dfdFlags:h}=e;if(o==="error")return Promise.reject(l);let d;if(t.faceCount===6)d=new qo,d.image=i,d.format=a,d.type=oi;else{const m=i[0].mipmaps;d=t.layerCount>1?new Db(m,n,s,t.layerCount,a,oi):new qo(m,n,s,a,oi)}return d.minFilter=i[0].mipmaps.length===1?Et:Er,d.magFilter=Et,d.generateMipmaps=!1,d.needsUpdate=!0,d.colorSpace=c===kz?it:Xi,d.premultiplyAlpha=!!(h&Oz),d}async createTexture(e,t={}){const i=Gz(new Uint8Array(e));if(i.vkFormat!==Fz){const a=[],o=[];for(let c=0;c<i.levels.length;c++)o.push(Vz(i,c).then(function(h){a[c]=h}));await Promise.all(o);const l=a[0];return l.mipmaps=a.map(c=>({data:c.source.data,width:c.source.data.width,height:c.source.data.height,depth:c.source.data.depth})),l}const n=t,s=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:n},[e])).then(a=>this._createTextureFrom(a.data,i));return g_.set(e,{promise:s}),s}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),A_--,this}}Pa.BasisFormat={ETC1S:0,UASTC_4x4:1},Pa.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},Pa.EngineFormat={RGBAFormat:mi,RGBA_ASTC_4x4_Format:Oa,RGBA_BPTC_Format:Lc,RGBA_ETC2_EAC_Format:xu,RGBA_PVRTC_4BPPV1_Format:Dc,RGBA_S3TC_DXT5_Format:So,RGB_ETC1_Format:Gd,RGB_ETC2_Format:Bc,RGB_PVRTC_4BPPV1_Format:bu,RGB_S3TC_DXT1_Format:ia},Pa.BasisWorker=`function () {

	let config;
	let transcoderPending;
	let BasisModule;

	const EngineFormat = _EngineFormat; // eslint-disable-line no-undef
	const TranscoderFormat = _TranscoderFormat; // eslint-disable-line no-undef
	const BasisFormat = _BasisFormat; // eslint-disable-line no-undef

	self.addEventListener( 'message', function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':
				config = message.config;
				init( message.transcoderBinary );
				break;

			case 'transcode':
				transcoderPending.then( () => {

					try {

						const { faces, buffers, width, height, hasAlpha, format, dfdTransferFn, dfdFlags } = transcode( message.buffer );

						self.postMessage( { type: 'transcode', id: message.id, faces, width, height, hasAlpha, format, dfdTransferFn, dfdFlags }, buffers );

					} catch ( error ) {

						console.error( error );

						self.postMessage( { type: 'error', id: message.id, error: error.message } );

					}

				} );
				break;

		}

	} );

	function init( wasmBinary ) {

		transcoderPending = new Promise( ( resolve ) => {

			BasisModule = { wasmBinary, onRuntimeInitialized: resolve };
			BASIS( BasisModule ); // eslint-disable-line no-undef

		} ).then( () => {

			BasisModule.initializeBasis();

			if ( BasisModule.KTX2File === undefined ) {

				console.warn( 'THREE.KTX2Loader: Please update Basis Universal transcoder.' );

			}

		} );

	}

	function transcode( buffer ) {

		const ktx2File = new BasisModule.KTX2File( new Uint8Array( buffer ) );

		function cleanup() {

			ktx2File.close();
			ktx2File.delete();

		}

		if ( ! ktx2File.isValid() ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader:	Invalid or unsupported .ktx2 file' );

		}

		const basisFormat = ktx2File.isUASTC() ? BasisFormat.UASTC_4x4 : BasisFormat.ETC1S;
		const width = ktx2File.getWidth();
		const height = ktx2File.getHeight();
		const layerCount = ktx2File.getLayers() || 1;
		const levelCount = ktx2File.getLevels();
		const faceCount = ktx2File.getFaces();
		const hasAlpha = ktx2File.getHasAlpha();
		const dfdTransferFn = ktx2File.getDFDTransferFunc();
		const dfdFlags = ktx2File.getDFDFlags();

		const { transcoderFormat, engineFormat } = getTranscoderFormat( basisFormat, width, height, hasAlpha );

		if ( ! width || ! height || ! levelCount ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader:	Invalid texture' );

		}

		if ( ! ktx2File.startTranscoding() ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader: .startTranscoding failed' );

		}

		const faces = [];
		const buffers = [];

		for ( let face = 0; face < faceCount; face ++ ) {

			const mipmaps = [];

			for ( let mip = 0; mip < levelCount; mip ++ ) {

				const layerMips = [];

				let mipWidth, mipHeight;

				for ( let layer = 0; layer < layerCount; layer ++ ) {

					const levelInfo = ktx2File.getImageLevelInfo( mip, layer, face );

					if ( face === 0 && mip === 0 && layer === 0 && ( levelInfo.origWidth % 4 !== 0 || levelInfo.origHeight % 4 !== 0 ) ) {

						console.warn( 'THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions.' );

					}

					if ( levelCount > 1 ) {

						mipWidth = levelInfo.origWidth;
						mipHeight = levelInfo.origHeight;

					} else {

						// Handles non-multiple-of-four dimensions in textures without mipmaps. Textures with
						// mipmaps must use multiple-of-four dimensions, for some texture formats and APIs.
						// See mrdoob/three.js#25908.
						mipWidth = levelInfo.width;
						mipHeight = levelInfo.height;

					}

					const dst = new Uint8Array( ktx2File.getImageTranscodedSizeInBytes( mip, layer, 0, transcoderFormat ) );
					const status = ktx2File.transcodeImage( dst, mip, layer, face, transcoderFormat, 0, - 1, - 1 );

					if ( ! status ) {

						cleanup();
						throw new Error( 'THREE.KTX2Loader: .transcodeImage failed.' );

					}

					layerMips.push( dst );

				}

				const mipData = concat( layerMips );

				mipmaps.push( { data: mipData, width: mipWidth, height: mipHeight } );
				buffers.push( mipData.buffer );

			}

			faces.push( { mipmaps, width, height, format: engineFormat } );

		}

		cleanup();

		return { faces, buffers, width, height, hasAlpha, format: engineFormat, dfdTransferFn, dfdFlags };

	}

	//

	// Optimal choice of a transcoder target format depends on the Basis format (ETC1S or UASTC),
	// device capabilities, and texture dimensions. The list below ranks the formats separately
	// for ETC1S and UASTC.
	//
	// In some cases, transcoding UASTC to RGBA32 might be preferred for higher quality (at
	// significant memory cost) compared to ETC1/2, BC1/3, and PVRTC. The transcoder currently
	// chooses RGBA32 only as a last resort and does not expose that option to the caller.
	const FORMAT_OPTIONS = [
		{
			if: 'astcSupported',
			basisFormat: [ BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ASTC_4x4, TranscoderFormat.ASTC_4x4 ],
			engineFormat: [ EngineFormat.RGBA_ASTC_4x4_Format, EngineFormat.RGBA_ASTC_4x4_Format ],
			priorityETC1S: Infinity,
			priorityUASTC: 1,
			needsPowerOfTwo: false,
		},
		{
			if: 'bptcSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.BC7_M5, TranscoderFormat.BC7_M5 ],
			engineFormat: [ EngineFormat.RGBA_BPTC_Format, EngineFormat.RGBA_BPTC_Format ],
			priorityETC1S: 3,
			priorityUASTC: 2,
			needsPowerOfTwo: false,
		},
		{
			if: 'dxtSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.BC1, TranscoderFormat.BC3 ],
			engineFormat: [ EngineFormat.RGB_S3TC_DXT1_Format, EngineFormat.RGBA_S3TC_DXT5_Format ],
			priorityETC1S: 4,
			priorityUASTC: 5,
			needsPowerOfTwo: false,
		},
		{
			if: 'etc2Supported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ETC1, TranscoderFormat.ETC2 ],
			engineFormat: [ EngineFormat.RGB_ETC2_Format, EngineFormat.RGBA_ETC2_EAC_Format ],
			priorityETC1S: 1,
			priorityUASTC: 3,
			needsPowerOfTwo: false,
		},
		{
			if: 'etc1Supported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ETC1 ],
			engineFormat: [ EngineFormat.RGB_ETC1_Format ],
			priorityETC1S: 2,
			priorityUASTC: 4,
			needsPowerOfTwo: false,
		},
		{
			if: 'pvrtcSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.PVRTC1_4_RGB, TranscoderFormat.PVRTC1_4_RGBA ],
			engineFormat: [ EngineFormat.RGB_PVRTC_4BPPV1_Format, EngineFormat.RGBA_PVRTC_4BPPV1_Format ],
			priorityETC1S: 5,
			priorityUASTC: 6,
			needsPowerOfTwo: true,
		},
	];

	const ETC1S_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {

		return a.priorityETC1S - b.priorityETC1S;

	} );
	const UASTC_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {

		return a.priorityUASTC - b.priorityUASTC;

	} );

	function getTranscoderFormat( basisFormat, width, height, hasAlpha ) {

		let transcoderFormat;
		let engineFormat;

		const options = basisFormat === BasisFormat.ETC1S ? ETC1S_OPTIONS : UASTC_OPTIONS;

		for ( let i = 0; i < options.length; i ++ ) {

			const opt = options[ i ];

			if ( ! config[ opt.if ] ) continue;
			if ( ! opt.basisFormat.includes( basisFormat ) ) continue;
			if ( hasAlpha && opt.transcoderFormat.length < 2 ) continue;
			if ( opt.needsPowerOfTwo && ! ( isPowerOfTwo( width ) && isPowerOfTwo( height ) ) ) continue;

			transcoderFormat = opt.transcoderFormat[ hasAlpha ? 1 : 0 ];
			engineFormat = opt.engineFormat[ hasAlpha ? 1 : 0 ];

			return { transcoderFormat, engineFormat };

		}

		console.warn( 'THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32.' );

		transcoderFormat = TranscoderFormat.RGBA32;
		engineFormat = EngineFormat.RGBAFormat;

		return { transcoderFormat, engineFormat };

	}

	function isPowerOfTwo( value ) {

		if ( value <= 2 ) return true;

		return ( value & ( value - 1 ) ) === 0 && value !== 0;

	}

	/** Concatenates N byte arrays. */
	function concat( arrays ) {

		if ( arrays.length === 1 ) return arrays[ 0 ];

		let totalByteLength = 0;

		for ( let i = 0; i < arrays.length; i ++ ) {

			const array = arrays[ i ];
			totalByteLength += array.byteLength;

		}

		const result = new Uint8Array( totalByteLength );

		let byteOffset = 0;

		for ( let i = 0; i < arrays.length; i ++ ) {

			const array = arrays[ i ];
			result.set( array, byteOffset );

			byteOffset += array.byteLength;

		}

		return result;

	}

}`;const DM={[IM]:mi,[MM]:mi,[xM]:mi,[p_]:mi,[TM]:La,[CM]:La,[wM]:La,[u_]:La,[SM]:Mo,[EM]:Mo,[h_]:Mo,[bM]:Mo},y_={[IM]:qt,[MM]:di,[xM]:oi,[p_]:oi,[TM]:qt,[CM]:di,[wM]:oi,[u_]:oi,[SM]:qt,[EM]:di,[h_]:oi,[bM]:oi},Qz={[p_]:it,[u_]:it,[h_]:it};async function Vz(r,e=0){const{vkFormat:t}=r,i=Math.max(1,r.pixelWidth>>e),n=Math.max(1,r.pixelHeight>>e),s=Math.max(1,r.pixelDepth>>e);if(DM[t]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const a=r.levels[e];let o,l;if(r.supercompressionScheme===Lz)o=a.levelData;else if(r.supercompressionScheme===Uz)v_||(v_=new Promise(async h=>{const d=new zz;await d.init(),h(d)})),o=(await v_).decode(a.levelData,a.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");y_[t]===qt?l=new Float32Array(o.buffer,o.byteOffset,o.byteLength/Float32Array.BYTES_PER_ELEMENT):y_[t]===di?l=new Uint16Array(o.buffer,o.byteOffset,o.byteLength/Uint16Array.BYTES_PER_ELEMENT):l=o;const c=s===0?new pa(l,i,n):new Wc(l,i,n,s);return c.type=y_[t],c.format=DM[t],c.colorSpace=Qz[t]||Xi,c.needsUpdate=!0,Promise.resolve(c)}const __=class yS extends Ec{constructor(){super(...arguments),this._importer=new Pr(BM,["ktx2"],["image/ktx2"],!1)}onAdded(e){var t,i;this._importer.onCtor=n=>n.setTranscoderPath(yS.TRANSCODER_LIBRARY_PATH).detectSupport(e.renderManager.renderer),super.onAdded(e),(i=(t=e.assetManager.exporter.getExporter("gltf","glb"))==null?void 0:t.extensions)==null||i.push(LM)}onRemove(e){var t,i;super.onRemove(e);const n=e.assetManager.exporter.getExporter("gltf","glb"),s=(t=n==null?void 0:n.extensions)==null?void 0:t.indexOf(LM);s!==void 0&&s!==-1&&((i=n==null?void 0:n.extensions)==null||i.splice(s,1))}};__.PluginType="KTX2LoadPlugin",__.TRANSCODER_LIBRARY_PATH="https://cdn.jsdelivr.net/gh/BinomialLLC/basis_universal@1.16.4/webgl/transcoder/build/";let jz=__;class BM extends Pa{_initTexture(e){hy.call(e),e.userData.mimeType="image/ktx2",e.toJSON=i=>ux(e,i,e.name,"image/ktx2");const t=e.clone;return e.clone=()=>{const i=t.call(e);return i.source!==e.source&&(i.source._sourceImgBuffer=e.source._sourceImgBuffer),this._initTexture(i)},e}async createTexture(e,t){const i=new Uint8Array(e.slice(0)),n=await super.createTexture(e,t);return n.source._sourceImgBuffer=i,this._initTexture(n),n}}const b_="KHR_texture_basisu",LM=r=>({writeTexture:(e,t)=>{if(e.userData.mimeType!=="image/ktx2")return;if(t.source!==void 0&&t.source!==null){console.warn("ktx2 export: source already set");return}const i=e.source._sourceImgBuffer||e.__sourceBuffer;if(!i){console.warn("ktx2 export: no source buffer for ktx2");return}t.extensions=t.extensions||{};const n={},s=new Blob([i],{type:"image/ktx2"});n.source=r.processImageBlob(s,e),t.extensions[b_]=n,r.extensionsUsed[b_]=!0}}),w_=class _S extends jv{constructor(e=!0,t=document.head){super(),this.rootNode=t,this.enabled=!0,this.toJSON=void 0,this._initializing=void 0,e&&this.initialize()}get initialized(){return!!window.MeshoptDecoder}async initialize(){if(this.initialized)return;if(this._initializing)return await this._initializing;const e=document.createElement("script");e.type="module";const t=Math.random().toString(36).substring(7);return e.innerHTML=`
import { MeshoptDecoder } from '${_S.DECODER_URL}';
window.MeshoptDecoder = MeshoptDecoder; // setting it before ready as GLTFLoader supports it.
MeshoptDecoder.ready.then(() => {
window.dispatchEvent(new CustomEvent('${t}'))
});
`,this._initializing=new Promise(i=>{window.addEventListener(t,()=>i(),{once:!0}),this.rootNode.appendChild(e),this._script=e}),await this._initializing}dispose(){this._script&&(this._script.remove(),delete window.MeshoptDecoder),this._script=void 0}onAdded(){}onRemove(){}};w_.PluginType="GLTFMeshOptDecodePlugin",w_.DECODER_URL="https://unpkg.com/meshoptimizer@0.20.0/meshopt_decoder.module.js";let Hz=w_;var Wz=Object.defineProperty,Xz=(r,e,t,i)=>{for(var n=void 0,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=a(e,t,n)||n);return n&&Wz(e,t,n),n};const UM=class extends ei{constructor(){super(),this.enabled=!0,this.exportOptions={name:"scene",viewerConfig:!0,encodeUint16Rgbe:!1,convertMeshToIndexed:!1,embedUrlImagePreviews:!1,embedUrlImages:!1,encrypt:!1,encryptKey:""},this.uiConfig={type:"folder",label:"Asset Export",children:[{type:"input",property:[this.exportOptions,"name"]},{type:"folder",label:"GLB Export",children:[{type:"checkbox",label:"Viewer Config (All Settings)",property:[this.exportOptions,"viewerConfig"],onChange:()=>{var e,t;return(t=(e=this.uiConfig).uiRefresh)==null?void 0:t.call(e,!0)}},{type:"checkbox",label:"Embed Image Previews",property:[this.exportOptions,"embedUrlImagePreviews"]},{type:"checkbox",label:"Encrypt",property:[this.exportOptions,"encrypt"],onChange:()=>{var e,t;return(t=(e=this.uiConfig).uiRefresh)==null?void 0:t.call(e,!0)}},{type:"checkbox",label:"Encrypt Password",hidden:()=>!this.exportOptions.encrypt,property:[this.exportOptions,"encryptKey"]},{type:"checkbox",label:"Compress hdr env maps",hidden:()=>!this.exportOptions.viewerConfig,property:[this.exportOptions,"encodeUint16Rgbe"]},{type:"button",label:"Export GLB",property:[this,"downloadSceneGlb"]}]},{type:"button",label:"Export Viewer Config",value:async()=>{var e,t;const i=new Blob([JSON.stringify((e=this._viewer)==null?void 0:e.exportConfig(!1),null,2)],{type:"application/json"});i&&await((t=this._viewer)==null?void 0:t.exportBlob(i,this.exportOptions.name+"."+p.ThreeViewer.ConfigTypeSlug))}},{type:"button",label:"Export Selected",hidden:()=>{var e;return!((e=this._viewer)!=null&&e.getPlugin("PickingPlugin"))},value:async()=>this.exportSelected(this.exportOptions,!0)}]},this.exportScene=this.exportScene.bind(this)}onAdded(e){super.onAdded(e)}onRemove(e){return super.onRemove(e)}async exportScene(e){var t,i,n;return(n=(t=this._viewer)==null?void 0:t.assetManager.exporter)==null?void 0:n.exportObject((i=this._viewer)==null?void 0:i.scene.modelRoot,e||{...this.exportOptions})}async downloadSceneGlb(){var e;const t=await this.exportScene(this.exportOptions);t&&await((e=this._viewer)==null?void 0:e.exportBlob(t,this.exportOptions.name+"."+t.ext))}async exportSelected(e,t=!0){var i,n,s;const a=(n=(i=this._viewer)==null?void 0:i.getPlugin("PickingPlugin"))==null?void 0:n.getSelectedObject();if(!a){alert("Nothing selected");return}const o=await this._viewer.assetManager.exporter.exportObject(a,e??this.exportOptions);return o&&t&&await((s=this._viewer)==null?void 0:s.exportBlob(o,"object."+o.ext)),o}};UM.PluginType="AssetExporterPlugin";let OM=UM;Xz([$()],OM.prototype,"exportOptions");var qz=Object.defineProperty,Yz=Object.getOwnPropertyDescriptor,nu=(r,e,t,i)=>{for(var n=i>1?void 0:i?Yz(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&qz(e,t,n),n};p.CanvasSnapshotPlugin=class extends ei{constructor(){super(),this.enabled=!0,this.filename="snapshot.png",this.defaultOptions={waitForProgressive:!0,displayPixelRatio:window.devicePixelRatio,scale:1,timeout:0,quality:.9},this.downloadSnapshot=this.downloadSnapshot.bind(this)}async getFile(r,e={waitForProgressive:!0}){return e.getDataUrl=!1,await this._getFile(r||this.filename,e)}async getDataUrl(r={}){return r.getDataUrl=!0,await this._getFile("",r)??""}async _getFile(r,e={}){var t;const i=this._viewer,n=(t=this._viewer)==null?void 0:t.canvas;if(!i||!n)return;const s=i.renderManager.renderScale;e.displayPixelRatio!==void 0&&e.displayPixelRatio!==s&&(i.renderManager.renderScale=e.displayPixelRatio),e.timeout&&await cs(e.timeout);const a=i.getPlugin(p.ProgressivePlugin);e.waitForProgressive!==!1&&a?await new Promise(c=>{const h=()=>{a.isConverged(!0)&&(i.removeEventListener("postFrame",h),c())};i.addEventListener("postFrame",h)}):await i.doOnce("postFrame"),e.displayPixelRatio=1;const o=e.rect;o&&i.renderManager.renderScale!==1&&(e.rect={...o,x:o.x*i.renderManager.renderScale,y:o.y*i.renderManager.renderScale,width:o.width*i.renderManager.renderScale,height:o.height*i.renderManager.renderScale});const l=await S1.GetFile(n,r,e);return e.rect=o,e.displayPixelRatio=i.renderManager.renderScale,i.renderManager.renderScale=s,l}async downloadSnapshot(r,e={waitForProgressive:!0}){if(!this._viewer)return;!e.mimeType&&!r&&(this.filename=this.filename.split(".").slice(0,-1).join(".")+".png");const t=await this.getFile(r,{...this.defaultOptions,...e});t&&await this._viewer.exportBlob(t,t.name)}async _downloadPng(){return this.filename=this.filename.split(".").slice(0,-1).join(".")+".png",this.downloadSnapshot(void 0,{mimeType:"image/png"})}async _downloadJpeg(){return this.filename=this.filename.split(".").slice(0,-1).join(".")+".jpeg",this.downloadSnapshot(void 0,{mimeType:"image/jpeg"})}async _downloadWebp(){return this.filename=this.filename.split(".").slice(0,-1).join(".")+".webp",this.downloadSnapshot(void 0,{mimeType:"image/webp"})}},p.CanvasSnapshotPlugin.PluginType="CanvasSnapshotPlugin",nu([Lt("Filename"),$()],p.CanvasSnapshotPlugin.prototype,"filename",2),nu([ur(),$()],p.CanvasSnapshotPlugin.prototype,"defaultOptions",2),nu([ci("Download .png")],p.CanvasSnapshotPlugin.prototype,"_downloadPng",1),nu([ci("Download .jpeg")],p.CanvasSnapshotPlugin.prototype,"_downloadJpeg",1),nu([ci("Download .webp")],p.CanvasSnapshotPlugin.prototype,"_downloadWebp",1),p.CanvasSnapshotPlugin=nu([ti("Canvas Snapshot (Image Export)")],p.CanvasSnapshotPlugin);const kM=class extends p.CanvasSnapshotPlugin{constructor(){super(),console.warn("CanvasSnipperPlugin is deprecated, use CanvasSnapshotPlugin")}};kM.PluginType="CanvasSnipper";let Kz=kM;const FM=class extends ei{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.defaultActions={exportFile:async(e,t,i)=>{Cp(e,t)}},this.actions={...this.defaultActions},this._updateProcessState=this._updateProcessState.bind(this)}async exportFile(e,t){t=t||e.name||"file_export",this.dispatchEvent({type:"transferFile",path:t,state:"exporting",progress:0}),await this.actions.exportFile(e,t,({state:i,progress:n})=>{this.dispatchEvent({type:"transferFile",path:t,state:i??"exporting",progress:n})}),this.dispatchEvent({type:"transferFile",path:t,state:"done"})}onAdded(e){super.onAdded(e),this.addEventListener("transferFile",this._updateProcessState)}onRemove(e){this.removeEventListener("transferFile",this._updateProcessState),super.onRemove(e)}_updateProcessState(e){this._viewer&&this._viewer.assetManager.setProcessState(e.path,e.state!=="done"?{state:e.state,progress:e.progress?e.progress*100:void 0}:void 0)}};FM.PluginType="FileTransferPlugin";let Jz=FM;const Zz="vec4 Vignette(in vec4 color){vec2 uv=vUv*(1.0-vUv);float vig=uv.x*uv.y*16.0;vig=pow(vig,power);return vec4(mix(color.rgb,vec3(bgcolor),1.-vig),color.a);}";var $z=Object.defineProperty,eQ=Object.getOwnPropertyDescriptor,Ng=(r,e,t,i)=>{for(var n=i>1?void 0:i?eQ(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&$z(e,t,n),n};p.VignettePlugin=class extends pd{constructor(r=!0){super(),this.extraUniforms={power:{value:1},bgcolor:{value:new fe}},this.power=.5,this.color=new fe(0),this.priority=-50,this.parsFragmentSnippet=()=>this.isDisabled()?"":ro`
            uniform float power;
            uniform vec3 bgcolor;
            ${Zz}
        `,this._shaderPatch="diffuseColor = Vignette(diffuseColor);",this.enabled=r}get bgcolor(){return console.warn("VignettePlugin.bgcolor is deprecated, use VignettePlugin.color instead"),this.color}set bgcolor(r){console.warn("VignettePlugin.bgcolor is deprecated, use VignettePlugin.color instead"),this.color=r}},p.VignettePlugin.PluginType="Vignette",Ng([st(p.VignettePlugin.prototype.setDirty),De("Enable"),$()],p.VignettePlugin.prototype,"enabled",2),Ng([Rt("Power",[.1,4],.01),tl({propKey:"power"}),$()],p.VignettePlugin.prototype,"power",2),Ng([Hs("Color",r=>({onChange:()=>r==null?void 0:r.setDirty()})),tl({propKey:"bgcolor"}),$("bgcolor")],p.VignettePlugin.prototype,"color",2),p.VignettePlugin=Ng([ti("Vignette")],p.VignettePlugin);const tQ="vec4 ChromaticAberration(in vec4 color){vec2 distFromCenter=vUv-0.5;vec2 aberrated=aberrationIntensity*pow(distFromCenter,vec2(2.0));vec4 outColor=vec4(tDiffuseTexelToLinear(texture2D(tDiffuse,vUv+aberrated)).r,color.g,tDiffuseTexelToLinear(texture2D(tDiffuse,vUv-aberrated)).b,color.a);return outColor;}";var iQ=Object.defineProperty,rQ=Object.getOwnPropertyDescriptor,x_=(r,e,t,i)=>{for(var n=i>1?void 0:i?rQ(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&iQ(e,t,n),n};p.ChromaticAberrationPlugin=class extends pd{constructor(r=!0){super(),this.extraUniforms={aberrationIntensity:{value:1}},this.intensity=.5,this.priority=-50,this.parsFragmentSnippet=()=>this.isDisabled()?"":ro`
            uniform float aberrationIntensity;
            ${tQ}
        `,this._shaderPatch="diffuseColor = ChromaticAberration(diffuseColor);",this.enabled=r}get aberrationIntensity(){return console.warn("ChromaticAberrationPlugin.aberrationIntensity is deprecated, use ChromaticAberrationPlugin.intensity instead"),this.intensity}set aberrationIntensity(r){console.warn("ChromaticAberrationPlugin.aberrationIntensity is deprecated, use ChromaticAberrationPlugin.intensity instead"),this.intensity=r}},p.ChromaticAberrationPlugin.PluginType="ChromaticAberration",x_([st(p.ChromaticAberrationPlugin.prototype.setDirty),De("Enable"),$()],p.ChromaticAberrationPlugin.prototype,"enabled",2),x_([Rt("Intensity",[0,.3],.001),tl({propKey:"aberrationIntensity"}),$("aberrationIntensity")],p.ChromaticAberrationPlugin.prototype,"intensity",2),p.ChromaticAberrationPlugin=x_([ti("ChromaticAberration")],p.ChromaticAberrationPlugin);const nQ="vec4 FilmicGrain(in vec4 color){float x=(vUv.x+4.0)*(vUv.y+4.0)*(10.0);vec4 grain=vec4(mod((mod(x,13.0)+1.0)*(mod(x,123.0)+1.0),0.01)-0.005)*grainIntensity;return vec4(grainMultiply ?(color.rgb*vec3(1.-grain)):(color.rgb+vec3(grain)),color.a);}";var sQ=Object.defineProperty,aQ=Object.getOwnPropertyDescriptor,Gg=(r,e,t,i)=>{for(var n=i>1?void 0:i?aQ(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&sQ(e,t,n),n};p.FilmicGrainPlugin=class extends pd{constructor(r=!0){super(),this.extraUniforms={grainIntensity:{value:1},grainMultiply:{value:!1}},this.intensity=10,this.multiply=!1,this.priority=-50,this.parsFragmentSnippet=()=>this.isDisabled()?"":ro`
            uniform float grainIntensity;
            uniform bool grainMultiply;
            ${nQ}
        `,this._shaderPatch="diffuseColor = FilmicGrain(diffuseColor);",this.enabled=r}get grainIntensity(){return console.warn("FilmicGrainPlugin.grainIntensity is deprecated, use FilmicGrainPlugin.intensity instead"),this.intensity}set grainIntensity(r){console.warn("FilmicGrainPlugin.grainIntensity is deprecated, use FilmicGrainPlugin.intensity instead"),this.intensity=r}},p.FilmicGrainPlugin.PluginType="FilmicGrain",Gg([st(p.FilmicGrainPlugin.prototype.setDirty),De("Enable"),$()],p.FilmicGrainPlugin.prototype,"enabled",2),Gg([Rt("Intensity",[0,20],.01),tl({propKey:"grainIntensity"}),$("grainIntensity")],p.FilmicGrainPlugin.prototype,"intensity",2),Gg([De("Multiply"),tl({propKey:"grainMultiply"}),$("grainMultiply")],p.FilmicGrainPlugin.prototype,"multiply",2),p.FilmicGrainPlugin=Gg([ti("FilmicGrain")],p.FilmicGrainPlugin);var oQ=Object.defineProperty,lQ=Object.getOwnPropertyDescriptor,lr=(r,e,t,i)=>{for(var n=i>1?void 0:i?lQ(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&oQ(e,t,n),n};p.GLTFAnimationPlugin=class extends ei{constructor(){super(),this.enabled=!0,this.animations=[],this.autoIncrementTime=!0,this.loopAnimations=!0,this.loopRepetitions=1/0,this.timeScale=1,this.animationSpeed=1,this.animateOnScroll=!1,this.scrollAnimationDamping=.1,this.animateOnPageScroll=!1,this.pageScrollAnimationDamping=.1,this.animateOnDrag=!1,this.dragAxis="y",this.dragAnimationDamping=.3,this.autoplayOnLoad=!1,this.syncMaxDuration=!1,this._animationState="none",this._lastAnimationTime=0,this._animationTime=0,this._animationDuration=0,this._scrollAnimationState=0,this._pageScrollAnimationState=0,this._dragAnimationState=0,this._pointerDragHelper=new Pw,this._lastFrameTime=0,this._fadeDisabled=!1,this._lastAnimId="",this._objectAdded=r=>{const e=r.object;if(!this._viewer)return;let t=!1;e.traverse(i=>{if(!this._viewer)return;const n=i.animations;if(n.length<1)return;const s=Math.max(...n.map(l=>l.duration));(e.userData.gltfAnim_SyncMaxDuration??this.syncMaxDuration)&&(n.forEach(l=>l.duration=s),e.userData.gltfAnim_SyncMaxDuration=!0);const a=new vw(this._viewer.scene.modelRoot),o=n.map(l=>a.clipAction(l).setLoop(this.loopAnimations?Du:Ru,this.loopRepetitions));o.forEach(l=>l.clampWhenFinished=!0),this.animations.push({mixer:a,clips:n,actions:o,duration:s}),t=!0}),t&&(this._onPropertyChange(!this.autoplayOnLoad),this.autoplayOnLoad&&this.playAnimation())},this.pageScrollHeight=()=>Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)-window.innerHeight,this.playClips=this.playClips.bind(this),this.playClip=this.playClip.bind(this),this.playAnimation=this.playAnimation.bind(this),this.playPauseAnimation=this.playPauseAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.stopAnimation=this.stopAnimation.bind(this),this.resetAnimation=this.resetAnimation.bind(this),this._onPropertyChange=this._onPropertyChange.bind(this),this._postFrame=this._postFrame.bind(this),this._wheel=this._wheel.bind(this),this._scroll=this._scroll.bind(this),this._pointerDragHelper.addEventListener("drag",this._drag.bind(this))}get animationState(){return this._animationState}get animationTime(){return this._animationTime}get animationDuration(){return this._animationDuration}playPauseAnimation(){this._animationState==="playing"?this.pauseAnimation():this.playAnimation()}setTime(r){this._animationTime=Math.max(0,Math.min(r,this._animationDuration))}onAdded(r){super.onAdded(r),r.scene.addEventListener("addSceneObject",this._objectAdded),r.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),window.addEventListener("scroll",this._scroll),this._pointerDragHelper.element=r.canvas}onRemove(r){for(;this.animations.length;)this.animations.pop();return r.scene.removeEventListener("addSceneObject",this._objectAdded),r.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),window.removeEventListener("scroll",this._scroll),this._pointerDragHelper.element=void 0,super.onRemove(r)}onStateChange(){var r,e;(e=(r=this.uiConfig)==null?void 0:r.uiRefresh)==null||e.call(r,!0,"postFrame")}async playClip(r,e=!1){return this.playClips([r],e)}async playClips(r,e=!1){const t=[];return this.animations.forEach(({actions:i})=>{i.forEach(n=>{r.includes(n.getClip().name)&&t.push(n)})}),this.playAnimation(e,t)}async playAnimation(r=!1,e){var t;if(this.isDisabled())return;let i=!1;this._animationState==="playing"&&(this.stopAnimation(!1),i=!0);let n=0;const s=!e;e||(e=[],this.animations.forEach(({actions:o})=>{e.push(...o)})),i?this.resetAnimation():this.animationState!=="paused"&&(e.forEach(o=>{o.reset()}),this._animationTime=0);const a=hs();this._lastAnimId=a;for(const o of e)o.setLoop(this.loopAnimations?Du:Ru,this.loopRepetitions),o.play(),n=Math.max(n,o.getClip().duration/Math.abs(o.timeScale));if(this._animationState="playing",(t=this._viewer)==null||t.setDirty(),s){if(!isFinite(this._animationDuration))return;await new Promise(o=>{const l=()=>{this.removeEventListener("checkpointEnd",l),o()};this.addEventListener("checkpointEnd",l)})}else{const o=this.loopAnimations?this.loopRepetitions:1;if(n*=o,!isFinite(n))return;await new Promise(l=>{const c=h=>{h.time>=n&&(this.removeEventListener("animationStep",c),l())};this.addEventListener("animationStep",c)})}a===this._lastAnimId&&this.stopAnimation(r)}pauseAnimation(){var r;if(this._animationState!=="playing"){console.warn("pauseAnimation called when animation was not playing.");return}this._animationState="paused",(r=this._viewer)==null||r.setDirty()}resumeAnimation(){var r;if(this._animationState!=="paused"){console.warn("resumeAnimation called when animation was not paused.");return}this._animationState="playing",(r=this._viewer)==null||r.setDirty()}stopAnimation(r=!1){var e,t;this._animationState="stopped",r?this.resetAnimation():(e=this._viewer)==null||e.setDirty(),this._lastAnimId="",this._viewer&&this._fadeDisabled&&((t=this._viewer.getPlugin("FrameFade"))==null||t.enable(this),this._fadeDisabled=!1)}resetAnimation(){var r;if(this._animationState!=="stopped"&&this._animationState!=="none"){this.stopAnimation(!0);return}this.animations.forEach(({mixer:e})=>{e.stopAllAction(),e.setTime(0)}),this._animationTime=0,(r=this._viewer)==null||r.setDirty()}_postFrame(){var r,e;if(!this._viewer)return;const t=this.animateOnScroll,i=this.animateOnPageScroll,n=this.animateOnDrag;if(this.isDisabled()||this.animations.length<1||this._animationState!=="playing"&&!t&&!n&&!i){this._lastFrameTime=0,this._fadeDisabled&&((r=this._viewer.getPlugin("FrameFade"))==null||r.enable(this),this._fadeDisabled=!1);return}if(this._animationTime<1e-4&&this.dispatchEvent({type:"checkpointBegin"}),this.autoIncrementTime){const o=nn()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=o-1/30);let l=o-this._lastFrameTime;if(l*=this.animationSpeed,this._lastFrameTime=o,i?l*=this._pageScrollAnimationState:t&&n?l*=rx(this._scrollAnimationState,this._dragAnimationState):t?l*=this._scrollAnimationState:n&&(l*=this._dragAnimationState),Math.abs(l)<1e-4)return;const c=(e=this._viewer.getPlugin("Progressive"))==null?void 0:e.postFrameConvergedRecordingDelta();if(c&&c>0&&(l=c),c===0)return;const h=Math.abs(this.timeScale);this._animationTime+=l*(h>0?h:1)}const s=this._animationTime-this._lastAnimationTime;this._lastAnimationTime=this._animationTime;const a=this.timeScale<0?(isFinite(this._animationDuration)?this._animationDuration:0)-this._animationTime:this._animationTime;if(this.animations.map(o=>{o.mixer.setTime(a)}),!(Math.abs(s)<1e-5)){if(this._pageScrollAnimationState=this.pageScrollTime-this._animationTime,Math.abs(this._pageScrollAnimationState)<.001?this._pageScrollAnimationState=0:this._pageScrollAnimationState*=1-this.pageScrollAnimationDamping,Math.abs(this._scrollAnimationState)<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,Math.abs(this._dragAnimationState)<.001?this._dragAnimationState=0:this._dragAnimationState*=1-this.dragAnimationDamping,this.dispatchEvent({type:"animationStep",delta:s,time:a}),this._viewer.renderManager.resetShadows(),this._viewer.setDirty(),!this._fadeDisabled){const o=this._viewer.getPlugin("FrameFade");o&&(o.disable(p.GLTFAnimationPlugin.PluginType),this._fadeDisabled=!0)}this._animationTime>=this._animationDuration&&this.dispatchEvent({type:"checkpointEnd"})}}_onPropertyChange(r=!0){this._animationDuration=Math.max(...this.animations.map(({duration:e})=>e))*(this.loopAnimations?this.loopRepetitions:1),this._animationState==="playing"&&r&&this.playAnimation()}get pageScrollTime(){const r=this.pageScrollHeight();return window.scrollY/r*(this.animationDuration-.05)}_scroll(){this.isDisabled()||(this._pageScrollAnimationState=this.pageScrollTime-this.animationTime)}_wheel({deltaY:r}){this.isDisabled()||Math.abs(r)>.001&&(this._scrollAnimationState=-1*Math.sign(r))}_drag(r){this.isDisabled()||!this._viewer||(this._dragAnimationState=this.dragAxis==="x"?r.delta.x*this._viewer.canvas.width/4:r.delta.y*this._viewer.canvas.height/4)}},p.GLTFAnimationPlugin.PluginType="GLTFAnimation",lr([$()],p.GLTFAnimationPlugin.prototype,"autoIncrementTime",2),lr([Ir(p.GLTFAnimationPlugin.prototype._onPropertyChange),De("Loop"),$()],p.GLTFAnimationPlugin.prototype,"loopAnimations",2),lr([Ir(p.GLTFAnimationPlugin.prototype._onPropertyChange),$()],p.GLTFAnimationPlugin.prototype,"loopRepetitions",2),lr([Rt("Timescale",[-2,2],.01),$()],p.GLTFAnimationPlugin.prototype,"timeScale",2),lr([Rt("Speed",[.1,4],.1),$()],p.GLTFAnimationPlugin.prototype,"animationSpeed",2),lr([De(),$()],p.GLTFAnimationPlugin.prototype,"animateOnScroll",2),lr([Rt("Scroll Damping",[0,1]),$()],p.GLTFAnimationPlugin.prototype,"scrollAnimationDamping",2),lr([De(),$()],p.GLTFAnimationPlugin.prototype,"animateOnPageScroll",2),lr([Rt("Page Scroll Damping",[0,1]),$()],p.GLTFAnimationPlugin.prototype,"pageScrollAnimationDamping",2),lr([De(),$()],p.GLTFAnimationPlugin.prototype,"animateOnDrag",2),lr([js("Drag Axis",[{label:"x"},{label:"y"}]),$()],p.GLTFAnimationPlugin.prototype,"dragAxis",2),lr([Rt("Drag Damping",[0,1]),$()],p.GLTFAnimationPlugin.prototype,"dragAnimationDamping",2),lr([De(),$()],p.GLTFAnimationPlugin.prototype,"autoplayOnLoad",2),lr([De("syncMaxDuration(dev)"),$()],p.GLTFAnimationPlugin.prototype,"syncMaxDuration",2),lr([lc()],p.GLTFAnimationPlugin.prototype,"animationState",1),lr([lc()],p.GLTFAnimationPlugin.prototype,"animationTime",1),lr([lc()],p.GLTFAnimationPlugin.prototype,"animationDuration",1),lr([ci("Play/Pause",r=>({label:()=>r.animationState==="playing"?"Pause":"Play"}))],p.GLTFAnimationPlugin.prototype,"playPauseAnimation",1),lr([st(p.GLTFAnimationPlugin.prototype.onStateChange)],p.GLTFAnimationPlugin.prototype,"_animationState",2),lr([ci("Stop",{sendArgs:!1})],p.GLTFAnimationPlugin.prototype,"stopAnimation",1),lr([ci("Reset",{sendArgs:!1})],p.GLTFAnimationPlugin.prototype,"resetAnimation",1),p.GLTFAnimationPlugin=lr([ti("GLTF Animations")],p.GLTFAnimationPlugin);const NM=class extends ei{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.fromJSON=void 0,this._lastFrameTime=0,this._updaters=[],this.dependencies=[],this._fadeDisabled=!1,this.disableFrameFade=!0,this._postFrame=()=>{var t,i;if(!this._viewer)return;if(this.isDisabled()||Object.keys(this.animations).length<1){this._lastFrameTime=0,this._fadeDisabled&&((t=this._viewer.getPlugin("FrameFade"))==null||t.enable(this),this._fadeDisabled=!1);return}const n=nn()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=n-1/60);let s=n-this._lastFrameTime;this._lastFrameTime=n;const a=(i=this._viewer.getPlugin("Progressive"))==null?void 0:i.postFrameConvergedRecordingDelta();if(a&&a>0&&(s=a),a!==0&&(s*=1e3,!(s<=.001)&&(this._updaters.forEach(o=>{let l=s;o.time+l<0&&(l=-o.time),o.time+=l,Math.abs(l)>.001&&o.u(l)}),!this._fadeDisabled&&this.disableFrameFade))){const o=this._viewer.getPlugin("FrameFade");o&&(o.disable(this),this._fadeDisabled=!0)}},this.defaultDriver=t=>({start:()=>this._updaters.push({u:t,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(i=>i.u===t),1)}),this.animations={},this.enabled=e,this._postFrame=this._postFrame.bind(this)}onAdded(e){super.onAdded(e),e.addEventListener("postFrame",this._postFrame)}onRemove(e){e.removeEventListener("postFrame",this._postFrame),super.onRemove(e)}animateTarget(e,t,i){return this.animate({...i,target:e,key:t})}animate(e){let t;const i={...e};if(i.target!==void 0){if(i.key===void 0)throw new Error("key must be defined");i.key in i.target||(console.warn("key not present in target, creating",i.key,i.target),i.target[i.key]=i.from||0);const a=H0(i.target,i.key),o=i.target[i.key];i.lastOnUpdate=i.onUpdate,i.onUpdate=l=>{a(l),i.lastOnUpdate&&i.lastOnUpdate(l)},t={target:i.target,key:i.key},i.from===void 0&&(i.from=o),delete i.target,delete i.key}const n=hs(),s={id:n,options:i,stop:()=>{var a,o,l;(a=this.animations[n])!=null&&a._stop?(l=(o=this.animations[n])==null?void 0:o._stop)==null||l.call(o):console.warn("Animation not started")},promise:void 0,targetRef:t};return this.animations[n]=s,s.promise=new Promise((a,o)=>{const l=()=>{try{i.onEnd&&i.onEnd()}catch(d){return o(d),!1}return!0},c={driver:this.defaultDriver,...i,onComplete:()=>{try{i.onComplete&&i.onComplete()}catch(d){if(!l())return;o(d);return}l()&&a()},onStop:()=>{try{i.onStop&&i.onStop()}catch(d){if(!l())return;o(d);return}a()}},h=j0(c);this.animations[n]._stop=h.stop,this.animations[n].options=c}).then(()=>(delete this.animations[n],n)),this.animations[n]}async animateAsync(e,t){const i=this.animate(e);return t&&t.push(i),i.promise}async animateTargetAsync(e,t,i,n){const s=this.animate({...i,target:e,key:t});return n&&n.push(s),s.promise}animateCamera(e,t,i=!0,n){const s=i?w1(e,t):x1(e,t);return this.animate({ease:Kf.linear,duration:1e3,...s,...n})}async animateCameraAsync(e,t,i=!0,n,s){const a=this.animateCamera(e,t,i,n);return s&&s.push(a),a.promise}};NM.PluginType="PopmotionPlugin";let vd=NM;const GM=class Ks extends ei{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.dependencies=[vd],this._addSceneObject=e=>{const t=e.object;t!=null&&t.traverse&&t.traverse(i=>{var n,s,a;i.userData[Ks.PluginType]||(i.userData[Ks.PluginType]={transforms:[]}),(n=i.userData[Ks.PluginType].transforms)==null||n.forEach((l,c)=>{l.name===void 0&&(l.name="Transform "+c)});const o={type:"folder",label:"Transform Animation",children:[{type:"button",label:"Add Current Transform",value:()=>{var l;this.addTransform(i),(l=o==null?void 0:o.uiRefresh)==null||l.call(o)}},()=>{var l;return(l=i.userData[Ks.PluginType])==null?void 0:l.transforms.map((c,h)=>({type:"folder",label:c.name||`Transform ${h}`,children:[{type:"input",label:"Name",property:[c,"name"]},{type:"vec3",label:"Position",property:[c,"position"]},{type:"vec3",label:"Quaternion",property:[c,"quaternion"]},{type:"vec3",label:"Scale",property:[c,"scale"]},{type:"button",label:"Set",value:()=>{this.setTransform(i,c)}},{type:"button",label:"Animate",value:()=>{this.animateTransform(i,c)}}]}))}]};(a=(s=i.uiConfig)==null?void 0:s.children)==null||a.push(o)})}}onAdded(e){super.onAdded(e),e.scene.addEventListener("addSceneObject",this._addSceneObject)}onRemove(e){return e.scene.removeEventListener("addSceneObject",this._addSceneObject),super.onRemove(e)}addTransform(e,t){e.userData[Ks.PluginType]||(e.userData[Ks.PluginType]={transforms:[]});const i={name:t||"Transform "+(e.userData[Ks.PluginType].transforms.length+1),position:e.position.clone(),quaternion:e.quaternion.clone(),scale:e.scale.clone()};return e.userData[Ks.PluginType].transforms.push(i),i}setTransform(e,t){var i,n,s;const a=this.getSavedTransform(t,e);a&&(e.position.copy(a.position),e.quaternion.copy(a.quaternion),e.scale.copy(a.scale),(i=e.setDirty)==null||i.call(e),(s=(n=e.uiConfig)==null?void 0:n.uiRefresh)==null||s.call(n))}getSavedTransform(e,t){var i,n;return typeof e=="number"?(i=t.userData[Ks.PluginType])==null?void 0:i.transforms[e]:typeof e=="string"?(n=t.userData[Ks.PluginType])==null?void 0:n.transforms.find(s=>s.name===e):e}animateTransform(e,t,i=2e3){var n,s;const a=(n=this._viewer)==null?void 0:n.getPlugin(vd);a||(s=this._viewer)==null||s.console.error("PopmotionPlugin required for animation");const o=this.getSavedTransform(t,e);if(!o)return;const l=new P,c=new Ct,h=new P,d=e.position.clone(),m=e.quaternion.clone(),f=e.scale.clone(),v=o.position,w=o.quaternion,b=o.scale;return a==null?void 0:a.animate({from:0,to:1,duration:i,onUpdate:y=>{var E,_;l.lerpVectors(d,v,y),c.slerpQuaternions(m,w,y),h.lerpVectors(f,b,y),e.position.copy(l),e.quaternion.copy(c),e.scale.copy(h),(E=this._viewer)==null||E.setDirty(),(_=this._viewer)==null||_.renderManager.resetShadows()},onStop:()=>{var y,E,_;e.position.copy(o.position),e.quaternion.copy(o.quaternion),e.scale.copy(o.scale),(y=e.setDirty)==null||y.call(e),(_=(E=e.uiConfig)==null?void 0:E.uiRefresh)==null||_.call(E)}})}};GM.PluginType="TransformAnimationPlugin";let cQ=GM;var hQ=Object.defineProperty,uQ=Object.getOwnPropertyDescriptor,Jn=(r,e,t,i)=>{for(var n=i>1?void 0:i?uQ(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&hQ(e,t,n),n};const wn=(ue=class extends ei{constructor(r={}){super(),this.enabled=!0,this._cameraViews=[],this.viewLooping=!1,this.viewPauseTime=200,this.animEase="easeInOutSine",this.animDuration=1e3,this.interpolateMode="spherical",this.rotationOffset=.25,this._animating=!1,this.dependencies=[vd],this._viewSetView=({view:e,camera:t})=>{var i;if(!e){(i=this._viewer)==null||i.console.warn("Invalid view",e);return}this.setView(e,t)},this._viewUpdateView=({view:e,camera:t})=>{var i;if(!e){(i=this._viewer)==null||i.console.warn("Invalid view",e);return}const n=e.name;this.getView(t,e.isWorldSpace??!0,e),e.name=n},this._viewDeleteView=({view:e})=>{var t;if(!e){(t=this._viewer)==null||t.console.warn("Invalid view",e);return}this.deleteView(e)},this._viewAnimateView=async({view:e,camera:t,duration:i,easing:n,throwOnStop:s})=>{var a;if(!e){(a=this._viewer)==null||a.console.warn("Invalid view",e);return}return this.animateToView(e,i||this.animDuration,n||this.animEase,t,s)},this.focusNext=(e=!0)=>{if(this._animating||this._cameraViews.length<2)return;let t=this._cameraViews.findIndex(i=>i===this._currentView);t<0&&(t=-1),t=t+1,e?t=t%this._cameraViews.length:t=Math.min(t,this._cameraViews.length-1),this.animateToView(t)},this.focusPrevious=(e=!0)=>{if(this._animating||this._cameraViews.length<2||!this._currentView)return;let t=this._cameraViews.findIndex(i=>i===this._currentView);t<0&&(t=0),t=t-1,e?t=(t+this._cameraViews.length)%this._cameraViews.length:t=Math.max(t,0),this.animateToView(t)},this._popAnimations=[],this.uiConfig={type:"folder",label:"Camera Views",children:[()=>[...this._cameraViews.map(e=>e.uiConfig)],...Ih(this)||[]]},this._viewQueue=[],this._animationLooping=!1,this._infiniteLooping=!0,this.addCurrentView=this.addCurrentView.bind(this),this.resetToFirstView=this.resetToFirstView.bind(this),this.animateAllViews=this.animateAllViews.bind(this),this.animDuration=r.duration??this.animDuration,this.animEase=r.ease??this.animEase,this.interpolateMode=r.interpolateMode??this.interpolateMode}get cameraViews(){return this._cameraViews}get camViews(){return this._cameraViews}get animating(){return this._animating}onAdded(r){super.onAdded(r),r.addEventListener("preFrame",e=>{})}onRemove(r){return super.onRemove(r)}async resetToFirstView(r=100){this.isDisabled()||(this._currentView=void 0,await this.animateToView(0,r),await cs(2))}async addCurrentView(){var r;if(this.isDisabled())return;const e=(r=this._viewer)==null?void 0:r.scene.mainCamera;if(!e)return;const t=this.getView(e);return this.addView(t),t.name="View "+this._cameraViews.length,t}addView(r){var e,t;this._cameraViews.includes(r)||this._cameraViews.push(r),r.addEventListener("setView",this._viewSetView),r.addEventListener("updateView",this._viewUpdateView),r.addEventListener("deleteView",this._viewDeleteView),r.addEventListener("animateView",this._viewAnimateView),(t=(e=this.uiConfig).uiRefresh)==null||t.call(e),this.dispatchEvent({type:"viewAdd",view:r})}deleteView(r){var e,t;const i=this._cameraViews.indexOf(r);i>=0&&this._cameraViews.splice(i,1),r.removeEventListener("setView",this._viewSetView),r.removeEventListener("updateView",this._viewUpdateView),r.removeEventListener("deleteView",this._viewDeleteView),r.removeEventListener("animateView",this._viewAnimateView),(t=(e=this.uiConfig).uiRefresh)==null||t.call(e),this.dispatchEvent({type:"viewDelete",view:r})}getView(r,e=!0,t){var i;return r=r||((i=this._viewer)==null?void 0:i.scene.mainCamera),r?r.getView(e,t):t??new p.CameraView}setView(r,e){var t;e=e||((t=this._viewer)==null?void 0:t.scene.mainCamera),e&&e.setView(r)}async animateToView(r,e,t,i,n=!1){var s,a,o,l,c,h;if(i=i||((s=this._viewer)==null?void 0:s.scene.mainCamera),!i)return;if(this._animating){this._popAnimations.forEach(w=>(w==null?void 0:w.stop)&&w.stop()),this._popAnimations=[];let v=0;for(;this._animating&&(await cs(100),!(v++>20)););if(this._animating){console.warn("Unable to stop all animations, maybe because of viewLooping?");return}}const d=typeof r=="number"?this._cameraViews[r]:typeof r=="string"?this._cameraViews.find(v=>v.name===r):r;if(!d){(a=this._viewer)==null||a.console.warn("Invalid view",r);return}this._currentView=d,this._animating=!0,(o=this._viewer)==null||o.scene.mainCamera.setInteractions(!1,ue.PluginType),this.dispatchEvent({type:"startViewChange",view:d});const m=(l=this._viewer)==null?void 0:l.getPlugin(vd);if(!m)throw new Error("PopmotionPlugin not found");e===void 0&&(e=this.animDuration);const f=typeof t=="function"?t:Kf[t||this.animEase];this._popAnimations=[],await m.animateCameraAsync(i,d,this.interpolateMode==="spherical",{ease:f,duration:e},this._popAnimations).catch(v=>{if(n)throw v}),(c=this._viewer)==null||c.scene.mainCamera.setInteractions(!0,ue.PluginType),this._animating=!1,(h=this._viewer)==null||h.setDirty(),this.dispatchEvent({type:"viewChange",view:d}),await cs(10)}async animateAllViews(){if(!this.isDisabled()&&!(this.viewLooping||this._cameraViews.length<2)){for(;this._viewQueue.length>0;)this._viewQueue.pop();this._viewQueue.push(...this._cameraViews),this._viewQueue.push(this._viewQueue.shift()),this._infiniteLooping=!1,await this._animationLoop(),this._infiniteLooping=!0}}async stopAllAnimations(){for(this.viewLooping=!1,this._popAnimations.forEach(r=>{var e;return(e=r==null?void 0:r.stop)==null?void 0:e.call(r)}),this._popAnimations=[];this._animating||this._animationLooping;)await cs(100)}fromJSON(r,e){var t,i;return this._cameraViews.forEach(n=>this.deleteView(n)),super.fromJSON(r,e)?(this._cameraViews.forEach(n=>this.addView(n)),(i=(t=this.uiConfig).uiRefresh)==null||i.call(t),this):null}async animateToObject(r,e=4,t,i,n={min:.5,max:5}){if(!this._viewer)return;const s=new Vs().expandByObject(r||this._viewer.scene.modelRoot,!1,!0),a=s.getCenter(new P),o=s.getSize(new P).length()/2;await this.animateToTarget(Math.min(n.max,Math.max(n.min,o*e)),a,t,i)}async animateToFitObject(r,e=1.5,t=1e3,i,n={min:.5,max:50}){if(!this._viewer)return;const s=new Vs().expandByObject(r||this._viewer.scene.modelRoot,!1,!0),a=s.getCenter(new P),o=s.getSize(new P),l=this._viewer.scene.mainCamera;let c=1;if(l.isPerspectiveCamera){const h=l.fov*(Math.PI/180),d=2*Math.atan(Math.tan(h/2)*l.aspect),m=o.z/2+Math.abs(o.x/2/Math.tan(d/2)),f=o.z/2+Math.abs(o.y/2/Math.tan(h/2));c=Math.max(m,f)}await this.animateToTarget(Math.min(n.max,Math.max(n.min,c*e)),a,t,i)}async animateToTarget(r,e,t,i){const n=this.getView();n.target.copy(e);const s=new P().subVectors(n.target,n.position).normalize();n.position.copy(s.multiplyScalar(-r).add(n.target)),await this.animateToView(n,t,i)}get animationLooping(){return this._animationLooping}async _animationLoop(){if(!this._animationLooping){for(this._animationLooping=!0;(this.viewLooping||!this._infiniteLooping)&&!(this.isDisabled()||this._cameraViews.length<1);){if(this._viewQueue.length===0)if(this._infiniteLooping)this._viewQueue.push(...this._cameraViews);else break;await this.animateToView(this._viewQueue.shift()),await cs(2+this.viewPauseTime)}this._animationLooping=!1}}getCurrentCameraView(r,e=!0){return this.getView(r,e)}setCurrentCameraView(r){return this.setView(r)}async focusView(r){return this.animateToView(r)}},ue.PluginType="CameraViews",ue);Jn([$("cameraViews")],wn.prototype,"_cameraViews",2),Jn([st(wn.prototype._animationLoop),$(),De("Loop All Views")],wn.prototype,"viewLooping",2),Jn([$(),Lt("View Pause Time")],wn.prototype,"viewPauseTime",2),Jn([$(),js("Ease",Object.keys(Kf).map(r=>({label:r})))],wn.prototype,"animEase",2),Jn([$(),Rt("Duration",[10,1e4],10)],wn.prototype,"animDuration",2),Jn([$(),js("Interpolation",["spherical","linear"].map(r=>({label:r})))],wn.prototype,"interpolateMode",2),Jn([$()],wn.prototype,"rotationOffset",2),Jn([ci("Reset To First View",{sendArgs:!1})],wn.prototype,"resetToFirstView",1),Jn([ci("Add Current View")],wn.prototype,"addCurrentView",1),Jn([ci("Focus Next",{sendArgs:!1})],wn.prototype,"focusNext",2),Jn([ci("Focus Previous",{sendArgs:!1})],wn.prototype,"focusPrevious",2),Jn([ci("Animate All Views")],wn.prototype,"animateAllViews",1),Jn([ci("Stop All Animations")],wn.prototype,"stopAllAnimations",1);let pQ=wn;var dQ=Object.defineProperty,mQ=Object.getOwnPropertyDescriptor,zM=(r,e,t,i)=>{for(var n=i>1?void 0:i?mQ(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&dQ(e,t,n),n};p.ClearcoatTintPlugin=class extends ei{constructor(){super(),this.enabled=!0,this._uniforms={ccTintColor:{value:new fe},ccThickness:{value:0},ccIor:{value:0}},this.materialExtension={parsFragmentSnippet:(r,e)=>{var t;return this.isDisabled()||!((t=e==null?void 0:e.userData._clearcoatTint)!=null&&t.enableTint)||!(e.clearcoat>0)?"":ro`
uniform vec3 ccTintColor;
uniform float ccThickness;
uniform float ccIor;
vec3 clearcoatTint(const in float dotNV, const in float dotNL, const in float clearcoat) {
    vec3 tint = ( ccThickness > 0. ? 1. - ccTintColor : ccTintColor); // Set thickness < 0 for glow.
    tint = exp(tint * -(ccThickness * ((dotNL + dotNV) / max(dotNL * dotNV, 1e-3)))); // beer's law
    return mix(vec3(1.0), tint, clearcoat);
}
        `},shaderExtender:(r,e)=>{var t;this.isDisabled()||!((t=e==null?void 0:e.userData._clearcoatTint)!=null&&t.enableTint)||!(e.clearcoat>0)||(r.fragmentShader=ri(r.fragmentShader,"float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );","float dotNVcc = saturate( dot( geometry.clearcoatNormal, -refract(geometry.viewDir, geometry.clearcoatNormal, 1./ccIor) ) );"),r.fragmentShader=ri(r.fragmentShader,"outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;",`outgoingLight *= clearcoatTint(dotNVcc, dotNVcc, material.clearcoat);
`,{prepend:!0}),r.defines.USE_UV="")},onObjectRender:(r,e)=>{const t=e.userData._clearcoatTint;t!=null&&t.enableTint&&(this._uniforms.ccTintColor.value.set(t.tintColor),this._uniforms.ccThickness.value=t.thickness,this._uniforms.ccIor.value=t.ior,al({CLEARCOAT_TINT_ENABLED:+!this.isDisabled()},e))},extraUniforms:{},computeCacheKey:r=>{var e;return(this.isDisabled()?"0":"1")+((e=r.userData._clearcoatTint)!=null&&e.enableTint?"1":"0")+(r.clearcoat>0?"1":"0")},isCompatible:r=>r.isPhysicalMaterial,getUiConfig:r=>{const e=this._viewer;r.userData._clearcoatTint===void 0&&(r.userData._clearcoatTint={});const t=r.userData._clearcoatTint,i={type:"folder",label:"Clearcoat Tint",onChange:n=>{n.config&&this.setDirty()},children:[{type:"checkbox",label:"Enabled",get value(){return t.enableTint||!1},set value(n){var s;n!==t.enableTint&&(n?p.ClearcoatTintPlugin.AddClearcoatTint(r)||e.dialog.alert("Cannot add clearcoat tint."):(t.enableTint=!1,r.setDirty&&r.setDirty()),(s=i.uiRefresh)==null||s.call(i,!0,"postFrame"))}},{type:"color",label:"Tint color",hidden:()=>!t.enableTint,property:[t,"tintColor"]},{type:"input",label:"Thickness",hidden:()=>!t.enableTint,property:[t,"thickness"]},{type:"slider",bounds:[.8,2.5],label:"IOR",hidden:()=>!t.enableTint,property:[t,"ior"]}]};return i}},this.setDirty=()=>{var r,e,t;(e=(r=this.materialExtension).setDirty)==null||e.call(r),(t=this._viewer)==null||t.setDirty()},this._loaderCreate=this._loaderCreate.bind(this),Object.assign(this.materialExtension.extraUniforms,this._uniforms)}static AddClearcoatTint(r,e){const t=r==null?void 0:r.userData;if(!t)return null;t._clearcoatTint||(t._clearcoatTint={});const i=t._clearcoatTint;return i.enableTint=!0,i.tintColor===void 0&&(i.tintColor="#ffffff"),i.thickness===void 0&&(i.thickness=.1),i.ior===void 0&&(i.ior=1.5),e&&Object.assign(i,e),r.setDirty&&r.setDirty(),i}_loaderCreate({loader:r}){r.isGLTFLoader2&&r.register(e=>new fQ(e))}onAdded(r){var e,t;super.onAdded(r),r.assetManager.materials.registerMaterialExtension(this.materialExtension),r.assetManager.importer.addEventListener("loaderCreate",this._loaderCreate),(t=(e=r.assetManager.exporter.getExporter("gltf","glb"))==null?void 0:e.extensions)==null||t.push(QM)}onRemove(r){var e,t,i,n;(e=r.assetManager.materials)==null||e.unregisterMaterialExtension(this.materialExtension),(t=r.assetManager.importer)==null||t.removeEventListener("loaderCreate",this._loaderCreate);const s=r.assetManager.exporter.getExporter("gltf","glb");if(s){const a=(i=s.extensions)==null?void 0:i.indexOf(QM);a!==void 0&&a>=0&&((n=s.extensions)==null||n.splice(a,1))}return super.onRemove(r)}},p.ClearcoatTintPlugin.PluginType="ClearcoatTintPlugin",p.ClearcoatTintPlugin.CLEARCOAT_TINT_GLTF_EXTENSION="WEBGI_materials_clearcoat_tint",zM([De("Enabled",r=>({onChange:r.setDirty})),$()],p.ClearcoatTintPlugin.prototype,"enabled",2),p.ClearcoatTintPlugin=zM([ti("Clearcoat Tint (MatExt)")],p.ClearcoatTintPlugin);class fQ{constructor(e){this.parser=e,this.name=p.ClearcoatTintPlugin.CLEARCOAT_TINT_GLTF_EXTENSION}async extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return;const n=i.extensions[this.name];t.userData||(t.userData={}),p.ClearcoatTintPlugin.AddClearcoatTint(t),Kt.Deserialize(n,t.userData._clearcoatTint)}}const QM=r=>({writeMaterial:(e,t)=>{var i;if(!e.isMeshStandardMaterial||!((i=e.userData._clearcoatTint)!=null&&i.enableTint))return;t.extensions=t.extensions||{};const n=Kt.Serialize(e.userData._clearcoatTint);t.extensions[p.ClearcoatTintPlugin.CLEARCOAT_TINT_GLTF_EXTENSION]=n,r.extensionsUsed[p.ClearcoatTintPlugin.CLEARCOAT_TINT_GLTF_EXTENSION]=!0}}),gQ=`#include <randomHelpers>
#include <voronoiNoise>
uniform vec2 noiseBumpParams;uniform float noiseBumpScale;uniform float noiseBumpFlakeScale;uniform float noiseFlakeClamp;uniform float noiseFlakeRadius;uniform bool useColorFlakes;uniform vec4 flakeParams;uniform vec3 flakeFallOffParams;vec3 perturbNormalArb_nb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}`,AQ=`vec3 outColor,outColor1,outColor2,outColor3,outColor4,outColor5;float distFac=length(vViewPosition.xyz);/*float e=floor(log2(0.3*distFac+3.0)/0.3785116);float level_z=0.1*pow(1.3,e)-0.2;*/float level=1.;vec2 uvMod=noiseBumpFlakeScale*noiseBumpParams.xy*vUv*level;float voronoiDist=clamp(voronoi_f1_2d(uvMod,1.,noiseFlakeClamp,noiseFlakeRadius,outColor),0.0,1.0);vec3 oldNormal=normal;normal=perturbNormalArb_nb(-vViewPosition,normal,(2.*outColor.xy-1.)*noiseBumpScale,faceDirection);float oldRoughnessFactor=roughnessFactor;float oldMetalnessFactor=metalnessFactor;roughnessFactor=mix(roughnessFactor,flakeParams.x,1.-voronoiDist);metalnessFactor=mix(metalnessFactor,flakeParams.y,1.-voronoiDist);
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
vec3 sparkleRadiance=getIBLRadiance(normalize(vViewPosition),normal,roughnessFactor);float sparkleIntensity=length(sparkleRadiance);float sparkleIntensityMultiplier=sparkleIntensity>1.3 ? flakeParams.z : 1.;vec3 oldDiffuseColor=diffuseColor.rgb;vec2 cellPosition_=floor(uvMod);vec3 colorRGB=useColorFlakes ? hash3(cellPosition_): vec3(1.);float fallOff_=mix(1.,1./(1.+flakeFallOffParams.y*distFac+flakeFallOffParams.z*distFac*distFac),flakeFallOffParams.x);diffuseColor.rgb*=mix(vec3(1.),sparkleIntensityMultiplier*colorRGB*fallOff_,vec3(1.-voronoiDist));if(sparkleIntensity<flakeParams.w){float mixFactor=1.;roughnessFactor=mix(roughnessFactor,oldRoughnessFactor,mixFactor);metalnessFactor=mix(metalnessFactor,oldMetalnessFactor,mixFactor);normal=normalize(mix(normal,oldNormal,mixFactor));diffuseColor.rgb=mix(diffuseColor.rgb,oldDiffuseColor,mixFactor);}
#endif
`;var vQ=Object.defineProperty,yQ=Object.getOwnPropertyDescriptor,VM=(r,e,t,i)=>{for(var n=i>1?void 0:i?yQ(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&vQ(e,t,n),n};p.NoiseBumpMaterialPlugin=class extends ei{constructor(){super(),this.enabled=!0,this._uniforms={noiseBumpParams:{value:new ne},noiseBumpScale:{value:.05},noiseBumpFlakeScale:{value:1e3},noiseFlakeClamp:{value:1},noiseFlakeRadius:{value:.5},flakeParams:{value:new bt(0,1,3,0)},flakeFallOffParams:{value:new P(0,1,0)},useColorFlakes:{value:!1}},this.materialExtension={parsFragmentSnippet:(r,e)=>{var t;return this.isDisabled()||!((t=e==null?void 0:e.userData._noiseBumpMat)!=null&&t.hasBump)?"":gQ},shaderExtender:(r,e)=>{var t;this.isDisabled()||!((t=e==null?void 0:e.userData._noiseBumpMat)!=null&&t.hasBump)||(r.fragmentShader=ri(r.fragmentShader,"#glMarker beforeAccumulation",AQ,{prepend:!0}),r.defines.USE_UV="",r.extensionDerivatives=!0)},onObjectRender:(r,e)=>{const t=e.userData._noiseBumpMat;t!=null&&t.hasBump&&(Array.isArray(t.bumpNoiseParams)?this._uniforms.noiseBumpParams.value.fromArray(t.bumpNoiseParams):this._uniforms.noiseBumpParams.value.copy(t.bumpNoiseParams),this._uniforms.noiseBumpScale.value=t.bumpScale,this._uniforms.noiseBumpFlakeScale.value=t.flakeScale,this._uniforms.noiseFlakeClamp.value=t.flakeClamp,this._uniforms.noiseFlakeRadius.value=t.flakeRadius,Array.isArray(t.flakeParams)?this._uniforms.flakeParams.value.fromArray(t.flakeParams):this._uniforms.flakeParams.value.copy(t.flakeParams),Array.isArray(t.flakeFallOffParams)?this._uniforms.flakeFallOffParams.value.fromArray(t.flakeFallOffParams):this._uniforms.flakeFallOffParams.value.copy(t.flakeFallOffParams),this._uniforms.useColorFlakes.value=t.useColorFlakes,al({NOISE_BUMP_MATERIAL_ENABLED:+!this.isDisabled()},e))},extraUniforms:{},computeCacheKey:r=>{var e;return(this.isDisabled()?"0":"1")+((e=r.userData._noiseBumpMat)!=null&&e.hasBump?"1":"0")},isCompatible:r=>r.isPhysicalMaterial,getUiConfig:r=>{const e=this._viewer;r.userData._noiseBumpMat===void 0&&(r.userData._noiseBumpMat={});const t=r.userData._noiseBumpMat,i={type:"folder",label:"SparkleBump (NoiseBump)",onChange:n=>{n.config&&this.setDirty()},children:[{type:"checkbox",label:"Enabled",get value(){return t.hasBump||!1},set value(n){var s;n!==t.hasBump&&(n?p.NoiseBumpMaterialPlugin.AddNoiseBumpMaterial(r)||e.dialog.alert("Cannot add NoiseBumpMaterial."):(t.hasBump=!1,r.setDirty&&r.setDirty()),(s=i.uiRefresh)==null||s.call(i,!0,"postFrame"))}},{type:"vec4",label:"Bump Noise Params",bounds:[0,1],hidden:()=>!t.hasBump,property:[t,"bumpNoiseParams"]},{type:"slider",label:"Bump Scale",bounds:[0,.001],stepSize:1e-5,hidden:()=>!t.hasBump,property:[t,"bumpScale"]},{type:"slider",label:"Flake Scale",bounds:[100,1e4],stepSize:1e-4,hidden:()=>!t.hasBump,property:[t,"flakeScale"]},{type:"slider",label:"Flake Clamp",bounds:[0,1],stepSize:1,hidden:()=>!t.hasBump,property:[t,"flakeClamp"]},{type:"slider",label:"Flake Radius",bounds:[.01,1],stepSize:.001,hidden:()=>!t.hasBump,property:[t,"flakeRadius"]},{type:"slider",label:"Flake Roughness",bounds:[0,1],stepSize:.01,hidden:()=>!t.hasBump,property:[t.flakeParams,"x"]},{type:"slider",label:"Flake Metalness",bounds:[0,1],stepSize:.01,hidden:()=>!t.hasBump,property:[t.flakeParams,"y"]},{type:"slider",label:"Flake Strength",bounds:[0,100],stepSize:.001,hidden:()=>!t.hasBump,property:[t.flakeParams,"z"]},{type:"slider",label:"Flake Threshold",bounds:[.1,10],stepSize:.001,hidden:()=>!t.hasBump,property:[t.flakeParams,"w"]},{type:"slider",label:"Falloff",stepSize:1,bounds:[0,1],hidden:()=>!t.hasBump,property:[t.flakeFallOffParams,"x"]},{type:"slider",label:"Linear falloff factor",bounds:[0,10],stepSize:.001,hidden:()=>!t.hasBump,property:[t.flakeFallOffParams,"y"]},{type:"slider",label:"Quadratic falloff factor",bounds:[0,10],stepSize:.001,hidden:()=>!t.hasBump,property:[t.flakeFallOffParams,"z"]},{type:"checkbox",label:"Colored Flakes",hidden:()=>!t.hasBump,property:[t,"useColorFlakes"]}]};return i}},this.setDirty=()=>{var r,e,t;(e=(r=this.materialExtension).setDirty)==null||e.call(r),(t=this._viewer)==null||t.setDirty()},this._loaderCreate=this._loaderCreate.bind(this),Object.assign(this.materialExtension.extraUniforms,this._uniforms)}static AddNoiseBumpMaterial(r,e){const t=r==null?void 0:r.userData;if(!t)return!1;t._noiseBumpMat||(t._noiseBumpMat={});const i=t._noiseBumpMat;return i.hasBump=!0,i.bumpNoiseParams===void 0&&(i.bumpNoiseParams=new ne(.5,.5)),i.bumpScale===void 0&&(i.bumpScale=.05),i.flakeScale===void 0&&(i.flakeScale=.05),i.flakeClamp===void 0&&(i.flakeClamp=1),i.flakeRadius===void 0&&(i.flakeRadius=.3),i.useColorFlakes===void 0&&(i.useColorFlakes=!1),i.flakeParams===void 0&&(i.flakeParams=new bt(0,1,3,0)),i.flakeFallOffParams===void 0&&(i.flakeFallOffParams=new P(0,1,0)),e&&Object.assign(i,e),r.setDirty&&r.setDirty(),!0}_loaderCreate({loader:r}){r.isGLTFLoader2&&r.register(e=>new _Q(e))}onAdded(r){var e,t;super.onAdded(r),r.assetManager.materials.registerMaterialExtension(this.materialExtension),r.assetManager.importer.addEventListener("loaderCreate",this._loaderCreate),(t=(e=r.assetManager.exporter.getExporter("gltf","glb"))==null?void 0:e.extensions)==null||t.push(jM)}onRemove(r){var e,t,i,n;(e=r.assetManager.materials)==null||e.unregisterMaterialExtension(this.materialExtension),(t=r.assetManager.importer)==null||t.removeEventListener("loaderCreate",this._loaderCreate);const s=r.assetManager.exporter.getExporter("gltf","glb");if(s){const a=(i=s.extensions)==null?void 0:i.indexOf(jM);a!==void 0&&a>=0&&((n=s.extensions)==null||n.splice(a,1))}return super.onRemove(r)}},p.NoiseBumpMaterialPlugin.PluginType="NoiseBumpMaterialPlugin",p.NoiseBumpMaterialPlugin.NOISE_BUMP_MATERIAL_GLTF_EXTENSION="WEBGI_materials_noise_bump",VM([De("Enabled",r=>({onChange:r.setDirty})),$()],p.NoiseBumpMaterialPlugin.prototype,"enabled",2),p.NoiseBumpMaterialPlugin=VM([ti("Noise/Sparkle Bump (MatExt)")],p.NoiseBumpMaterialPlugin);class _Q{constructor(e){this.parser=e,this.name=p.NoiseBumpMaterialPlugin.NOISE_BUMP_MATERIAL_GLTF_EXTENSION}async extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return;const n=i.extensions[this.name];t.userData||(t.userData={}),p.NoiseBumpMaterialPlugin.AddNoiseBumpMaterial(t),Kt.Deserialize(n,t.userData._noiseBumpMat)}}const jM=r=>({writeMaterial:(e,t)=>{var i;if(!e.isMeshStandardMaterial||!((i=e.userData._noiseBumpMat)!=null&&i.hasBump))return;t.extensions=t.extensions||{};const n=Kt.Serialize(e.userData._noiseBumpMat);t.extensions[p.NoiseBumpMaterialPlugin.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=n,r.extensionsUsed[p.NoiseBumpMaterialPlugin.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=!0}}),bQ=`#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
#if CUSTOM_BUMP_MAP_BICUBIC > 0
vec4 cubic_cb(float v){vec4 n=vec4(1.0,2.0,3.0,4.0)-v;vec4 s=n*n*n;float x=s.x;float y=s.y-4.0*s.x;float z=s.z-4.0*s.y+6.0*s.x;float w=6.0-x-y-z;return vec4(x,y,z,w)*(1.0/6.0);}vec4 textureBicubic_cb(sampler2D sampler,vec2 texCoords){vec2 texSize=vec2(textureSize(sampler,0));vec2 invTexSize=1.0/texSize;texCoords=texCoords*texSize-0.5;vec2 fxy=fract(texCoords);texCoords-=fxy;vec4 xcubic=cubic_cb(fxy.x);vec4 ycubic=cubic_cb(fxy.y);vec4 c=texCoords.xxyy+vec2(-0.5,+1.5).xyxy;vec4 s=vec4(xcubic.xz+xcubic.yw,ycubic.xz+ycubic.yw);vec4 offset=c+vec4(xcubic.yw,ycubic.yw)/s;offset*=invTexSize.xxyy;vec4 sample0=texture(sampler,offset.xz);vec4 sample1=texture(sampler,offset.yz);vec4 sample2=texture(sampler,offset.xw);vec4 sample3=texture(sampler,offset.yw);float sx=s.x/(s.x+s.y);float sy=s.z/(s.z+s.w);return mix(mix(sample3,sample2,sx),mix(sample1,sample0,sx),sy);}
#endif
varying vec2 vCustomBumpUv;uniform sampler2D customBumpMap;uniform float customBumpScale;vec2 dHdxy_fwd_cb(){vec2 dSTdx=dFdx(vCustomBumpUv);vec2 dSTdy=dFdy(vCustomBumpUv);
#if CUSTOM_BUMP_MAP_BICUBIC > 0
float Hll=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#else
float Hll=customBumpScale*texture2D(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#endif
return vec2(dBx,dBy);}
#ifndef USE_BUMPMAP
vec3 perturbNormalArb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
#endif
#endif
`;var wQ=Object.defineProperty,xQ=Object.getOwnPropertyDescriptor,E_=(r,e,t,i)=>{for(var n=i>1?void 0:i?xQ(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&wQ(e,t,n),n};p.CustomBumpMapPlugin=class extends ei{constructor(){super(),this.enabled=!0,this.bicubicFiltering=!0,this._defines={CUSTOM_BUMP_MAP_DEBUG:!1,CUSTOM_BUMP_MAP_BICUBIC:!0},this._uniforms={customBumpUvTransform:{value:new Bt},customBumpScale:{value:.001},customBumpMap:{value:null}},this.materialExtension={parsFragmentSnippet:(r,e)=>this.isDisabled()||!(e!=null&&e.userData._hasCustomBump)?"":bQ,shaderExtender:(r,e)=>{this.isDisabled()||!(e!=null&&e.userData._hasCustomBump)||!e.userData._customBumpMap||(r.fragmentShader=ri(r.fragmentShader,"#glMarker beforeAccumulation",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
    normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd_cb(), faceDirection );
#endif
                `,{prepend:!0}),r.vertexShader=ri(r.vertexShader,"#include <uv_pars_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
    varying vec2 vCustomBumpUv;
    uniform mat3 customBumpUvTransform;
#endif
                `,{prepend:!0}),r.vertexShader=ri(r.vertexShader,"#include <uv_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
    vCustomBumpUv = ( customBumpUvTransform * vec3( uv, 1 ) ).xy;
#endif
                `,{prepend:!0}),r.defines.USE_UV="")},onObjectRender:(r,e)=>{var t;const i=e.userData;if(!(i!=null&&i._hasCustomBump)||!r.isMesh||!r.geometry)return;const n=(t=i._customBumpMap)!=null&&t.isTexture?i._customBumpMap:null;this._uniforms.customBumpMap.value=n,this._uniforms.customBumpScale.value=n?i._customBumpScale??0:0,n&&(n.updateMatrix(),this._uniforms.customBumpUvTransform.value.copy(n.matrix)),al({...this._defines,CUSTOM_BUMP_MAP_ENABLED:+this.enabled},e)},extraUniforms:{},computeCacheKey:r=>{var e,t;return(this.enabled?"1":"0")+(r.userData._hasCustomBump?"1":"0")+((t=(e=r.userData)==null?void 0:e._customBumpMap)==null?void 0:t.uuid)},isCompatible:r=>r.isPhysicalMaterial,getUiConfig:r=>{const e=this._viewer,t=this.enableCustomBump.bind(this),i=r.userData,n={type:"folder",label:"CustomBumpMap",onChange:s=>{s.config&&this.setDirty()},children:[{type:"checkbox",label:"Enabled",get value(){return i._hasCustomBump||!1},set value(s){var a;s!==i._hasCustomBump&&(s?t(r)||e.dialog.alert("Cannot add CustomBumpMap."):(i._hasCustomBump=!1,r.setDirty&&r.setDirty()),(a=n.uiRefresh)==null||a.call(n,!0,"postFrame"))}},{type:"slider",label:"Bump Scale",bounds:[-1,1],hidden:()=>!i._hasCustomBump,property:[i,"_customBumpScale"],onChange:this.setDirty},{type:"image",label:"Bump Map",hidden:()=>!i._hasCustomBump,property:[i,"_customBumpMap"],onChange:()=>{r.setDirty()}},Hi(i,"_customBumpMap")]};return n}},this.setDirty=()=>{var r,e,t;(e=(r=this.materialExtension).setDirty)==null||e.call(r),(t=this._viewer)==null||t.setDirty()},this._loaderCreate=this._loaderCreate.bind(this),Object.assign(this.materialExtension.extraUniforms,this._uniforms)}enableCustomBump(r,e,t){const i=r==null?void 0:r.userData;if(!i)return!1;if(i._hasCustomBump===void 0){const n=r.appliedMeshes;let s=!0;if(n)for(const{geometry:a}of n)a&&(!a.attributes.position||!a.attributes.normal||!a.attributes.uv)&&(s=!1);if(!s)return!1}return i._hasCustomBump=!0,i._customBumpScale=t??i._customBumpScale??.001,i._customBumpMap=e??i._customBumpMap??null,r.setDirty&&r.setDirty(),!0}_loaderCreate({loader:r}){r.isGLTFLoader2&&r.register(e=>new EQ(e))}onAdded(r){var e,t;super.onAdded(r),r.assetManager.materials.registerMaterialExtension(this.materialExtension),r.assetManager.importer.addEventListener("loaderCreate",this._loaderCreate),(t=(e=r.assetManager.exporter.getExporter("gltf","glb"))==null?void 0:e.extensions)==null||t.push(HM)}onRemove(r){var e,t,i,n;(e=r.assetManager.materials)==null||e.unregisterMaterialExtension(this.materialExtension),(t=r.assetManager.importer)==null||t.removeEventListener("loaderCreate",this._loaderCreate);const s=r.assetManager.exporter.getExporter("gltf","glb");if(s){const a=(i=s.extensions)==null?void 0:i.indexOf(HM);a!==void 0&&a>=0&&((n=s.extensions)==null||n.splice(a,1))}return super.onRemove(r)}},p.CustomBumpMapPlugin.PluginType="CustomBumpMapPlugin",p.CustomBumpMapPlugin.CUSTOM_BUMP_MAP_GLTF_EXTENSION="WEBGI_materials_custom_bump_map",E_([De("Enabled",r=>({onChange:r.setDirty})),$()],p.CustomBumpMapPlugin.prototype,"enabled",2),E_([De("Bicubic",r=>({onChange:r.setDirty})),Uf("CUSTOM_BUMP_MAP_BICUBIC",void 0,!0,p.CustomBumpMapPlugin.prototype.setDirty),$()],p.CustomBumpMapPlugin.prototype,"bicubicFiltering",2),p.CustomBumpMapPlugin=E_([ti("Custom BumpMap (MatExt)")],p.CustomBumpMapPlugin);class EQ{constructor(e){this.parser=e,this.name=p.CustomBumpMapPlugin.CUSTOM_BUMP_MAP_GLTF_EXTENSION}async extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return;const s=n.extensions[this.name];t.userData||(t.userData={}),t.userData._hasCustomBump=!0,t.userData._customBumpScale=s.customBumpScale??0;const a=[],o=s.customBumpMap;return o&&a.push(i.assignTexture(t.userData,"_customBumpMap",o).then(l=>{l.colorSpace=it})),Promise.all(a)}}const HM=r=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._hasCustomBump||(e.userData._customBumpScale||0)<.001)return;t.extensions=t.extensions||{};const i={};if(i.customBumpScale=e.userData._customBumpScale||1,e.userData._customBumpMap){const n={index:r.processTexture(e.userData._customBumpMap)};r.applyTextureTransform(n,e.userData._customBumpMap),i.customBumpMap=n}t.extensions[p.CustomBumpMapPlugin.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=i,r.extensionsUsed[p.CustomBumpMapPlugin.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=!0}}),CQ=`
#ifdef USE_BUMPMAP
mat3 mat3_inverse(mat3 A){mat3 M_t=mat3(vec3(A[0][0],A[1][0],A[2][0]),vec3(A[0][1],A[1][1],A[2][1]),vec3(A[0][2],A[1][2],A[2][2]));float det=dot(cross(M_t[0],M_t[1]),M_t[2]);mat3 adjugate=mat3(cross(M_t[1],M_t[2]),cross(M_t[2],M_t[0]),cross(M_t[0],M_t[1]));return adjugate/det;}float CalculateHeight(in vec2 texCoords){float height=texture2D(bumpMap,texCoords).x;return clamp(height,0.0,1.0);}const vec2 bumpMapSize=vec2(512,512);vec3 CalculateNormal(in vec2 texCoords){
#if defined( TANGENTSPACE_NORMALMAP ) && 0
vec3 mapN=texture2D(normalMap,texCoords).xyz;mapN.xy*=normalScale;return normalize(mapN);
#else
vec2 texOffs=1.0/bumpMapSize;
#if PARALLAX_NORMAL_MAP_QUALITY > 0
float hx[9];hx[0]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.0,-1.0)).r;hx[1]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.0,-1.0)).r;hx[2]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.0,-1.0)).r;hx[3]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.0,0.0)).r;hx[4]=texture2D(bumpMap,texCoords.st).r;hx[5]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.0,0.0)).r;hx[6]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.0,1.0)).r;hx[7]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.0,1.0)).r;hx[8]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.0,1.0)).r;vec2 deltaH=vec2(hx[0]-hx[2]+2.0*(hx[3]-hx[5])+hx[6]-hx[8],hx[0]-hx[6]+2.0*(hx[1]-hx[7])+hx[2]-hx[8]);
#else
float h_xa=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.0,0.0)).r;float h_xb=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.0,0.0)).r;float h_ya=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.0,-1.0)).r;float h_yb=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.0,1.0)).r;vec2 deltaH=vec2(h_xa-h_xb,h_ya-h_yb);
#endif
return normalize(vec3(deltaH/texOffs,1.0));
#endif
}vec3 ReliefParallax(in float frontFace,in vec3 texDir3D,in vec2 texCoord){float surf_sign=frontFace;float back_face=step(0.0,-surf_sign);vec2 texStep=surf_sign*texDir3D.xy/abs(texDir3D.z);vec2 texC=texCoord.st+surf_sign*texStep+back_face*texStep.xy;float mapHeight=1.0;float bumpHeightStep=1.0/float(PARALLAX_MAP_STEPS);float bestBumpHeight=mapHeight+bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_STEPS;i++){if(mapHeight<bestBumpHeight){bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);}}
#pragma unroll_loop_end
bestBumpHeight+=bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_B_STEPS;i++){bumpHeightStep*=0.5;bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);bestBumpHeight+=(bestBumpHeight<mapHeight)? bumpHeightStep : 0.0;}
#pragma unroll_loop_end
bestBumpHeight-=bumpHeightStep*clamp((bestBumpHeight-mapHeight)/bumpHeightStep,0.0,1.0);mapHeight=bestBumpHeight;texC-=mapHeight*texStep;return vec3(texC.xy,mapHeight);}vec3 reliefParallaxPerturbNormal(in float faceDirection,inout vec3 normal){if(abs(bumpScale)<0.001)return vec3(vBumpMapUv,0.);float parallaxHeight;vec2 texCoords=vBumpMapUv;float face_sign=sign(dot(normal,vViewPosition));vec3 N=normalize(normal);vec3 dp1=dFdx(-vViewPosition);vec3 dp2=dFdy(-vViewPosition);vec2 duv1=dFdx(vBumpMapUv);vec2 duv2=dFdy(vBumpMapUv);vec3 dp2perp=cross(dp2,N);vec3 dp1perp=cross(N,dp1);vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(T,T),dot(B,B)));mat3 tbnMat=mat3(T*invmax,B*invmax,N*bumpScale);vec3 tangentPos=normalize(mat3_inverse(tbnMat)*-vViewPosition);vec3 parallaxUv=ReliefParallax(face_sign,tangentPos,vBumpMapUv);tbnMat[2]=face_sign*N/bumpScale;normal=normalize(tbnMat*CalculateNormal(parallaxUv.xy).xyz);
#ifdef FLIP_SIDED
normal=-normal;
#endif
return parallaxUv;}
#endif
`;var MQ=Object.defineProperty,SQ=Object.getOwnPropertyDescriptor,su=(r,e,t,i)=>{for(var n=i>1?void 0:i?SQ(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&MQ(e,t,n),n};p.ParallaxMappingPlugin=class extends ei{constructor(r=!0){super(),this.enabled=!0,this.stepCount=12,this.binaryStepCount=3,this.debugNormals=!1,this.debugHitHeight=!1,this._defines={PARALLAX_NORMAL_MAP_QUALITY:0},this._bumpMapExtension={shaderExtender:(e,t,i)=>{if(!(!t.bumpMap||this.isDisabled())){e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_begin>",""),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",""),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",`#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <map_fragment>`);for(const n of["map_fragment","alphamap_fragment","roughnessmap_fragment","metalnessmap_fragment","emissivemap_fragment","transmission_fragment"])e.fragmentShader=ri(e.fragmentShader,`#include <${n}>`,Ft[n].replace(/\bv\w+Uv\b/g,"parallaxUv.xy",{replaceAll:!0}));(this.debugNormals||this.debugHitHeight)&&(e.fragmentShader=ri(e.fragmentShader,"texture2D( map, parallaxUv.xy )",this.debugNormals?"vec4(normal, 1.); normal = geometryNormal":"vec4(parallaxUv.z,0., 0., 1.)")),e.fragmentShader=ri(e.fragmentShader,"#include <normal_fragment_maps>",ri(ri(Ft.normal_fragment_maps,"#elif defined( USE_NORMALMAP_TANGENTSPACE )","#elif defined( USE_NORMALMAP_TANGENTSPACE ) && !defined( USE_BUMPMAP )"),"normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );","vec3 parallaxUv = reliefParallaxPerturbNormal(faceDirection, normal);"))}},parsFragmentSnippet:()=>this.isDisabled()?"":(CQ+`
`).replaceAll("PARALLAX_MAP_STEPS",this.stepCount.toString()).replaceAll("PARALLAX_MAP_B_STEPS",this.binaryStepCount.toString()),isCompatible:e=>e.isPhysicalMaterial,computeCacheKey:e=>{var t;return""+!this.isDisabled()+((t=e.bumpMap)==null?void 0:t.uuid)+this.debugNormals+this.debugHitHeight+this.stepCount.toString()+this.binaryStepCount.toString()},onObjectRender:(e,t,i)=>{this.isDisabled()||al({...this._defines},t)}},this.enabled=r,this._updateExtension=this._updateExtension.bind(this)}_updateExtension(){var r,e,t;(e=(r=this._bumpMapExtension)==null?void 0:r.setDirty)==null||e.call(r),(t=this._viewer)==null||t.setDirty()}onAdded(r){return r.materialManager.registerMaterialExtension(this._bumpMapExtension),super.onAdded(r)}onRemove(r){return r.materialManager.unregisterMaterialExtension(this._bumpMapExtension),super.onRemove(r)}},p.ParallaxMappingPlugin.PluginType="ReliefParallaxMapping",su([st(p.ParallaxMappingPlugin.prototype._updateExtension),$(),De("Enabled")],p.ParallaxMappingPlugin.prototype,"enabled",2),su([Rt("Step count",[1,32],1),st(p.ParallaxMappingPlugin.prototype._updateExtension),$()],p.ParallaxMappingPlugin.prototype,"stepCount",2),su([Rt("Binary search steps",[1,8],1),st(p.ParallaxMappingPlugin.prototype._updateExtension),$()],p.ParallaxMappingPlugin.prototype,"binaryStepCount",2),su([st(p.ParallaxMappingPlugin.prototype._updateExtension),De("Debug Normals")],p.ParallaxMappingPlugin.prototype,"debugNormals",2),su([st(p.ParallaxMappingPlugin.prototype._updateExtension),De("Debug Hit Height")],p.ParallaxMappingPlugin.prototype,"debugHitHeight",2),p.ParallaxMappingPlugin=su([ti("Parallax Bump Mapping (MatExt)")],p.ParallaxMappingPlugin);const TQ=`#include <simpleCameraHelpers>
uniform vec4 fragClippingPosition;uniform vec4 fragClippingParams;uniform float fragClippingCamAspect;
#if FRAG_CLIPPING_MODE == FragmentClippingMode.Circle
float fragClippingCircle(){vec2 pos=viewToScreen(vViewPosition.xyz).xy;float radius=fragClippingParams.x;vec2 center=fragClippingPosition.xy;pos.y/=fragClippingCamAspect;center.y/=fragClippingCamAspect;return length(pos-center)-radius;}
#elif FRAG_CLIPPING_MODE == FragmentClippingMode.Ellipse
float fragClippingEllipse(){vec2 pos=viewToScreen(vViewPosition.xyz).xy;vec2 radius=fragClippingParams.xy;vec2 center=fragClippingPosition.xy;pos.y/=fragClippingCamAspect;center.y/=fragClippingCamAspect;return length((pos-center)/radius)-1.0;}
#elif FRAG_CLIPPING_MODE == FragmentClippingMode.Rectangle
float fragClippingRectangle(){vec2 pos=viewToScreen(vViewPosition.xyz).xy;vec2 radius=fragClippingParams.xy;vec2 center=fragClippingPosition.xy;pos.y/=fragClippingCamAspect;center.y/=fragClippingCamAspect;vec2 d=abs(pos-center)-radius;return min(max(d.x,d.y),0.0)+length(max(d,0.0));}
#elif FRAG_CLIPPING_MODE == FragmentClippingMode.Plane
float fragClippingPlane(){vec3 pos=vViewPosition.xyz;vec3 normal=fragClippingParams.xyz;float d=dot(pos,normal)-fragClippingParams.w;return d;}
#elif FRAG_CLIPPING_MODE == FragmentClippingMode.Sphere
float fragClippingSphere(){vec3 pos=vViewPosition.xyz;vec3 center=fragClippingPosition.xyz;float radius=fragClippingParams.x;pos.y/=fragClippingCamAspect;center.y/=fragClippingCamAspect;return length(pos-center)-radius;}
#endif
`,IQ=`float fragClippingDist=0.0;
#if FRAG_CLIPPING_MODE == FragmentClippingMode.Circle
fragClippingDist=fragClippingCircle();
#elif FRAG_CLIPPING_MODE == FragmentClippingMode.Ellipse
fragClippingDist=fragClippingEllipse();
#elif FRAG_CLIPPING_MODE == FragmentClippingMode.Rectangle
fragClippingDist=fragClippingRectangle();
#elif FRAG_CLIPPING_MODE == FragmentClippingMode.Plane
fragClippingDist=fragClippingPlane();
#elif FRAG_CLIPPING_MODE == FragmentClippingMode.Sphere
fragClippingDist=fragClippingSphere();
#endif
#if FRAG_CLIPPING_DEBUG
gl_FragColor=vec4(max(fragClippingDist,0.0),0.0,0.0,1.0);
#include <encodings_fragment>
return;
#endif
#if FRAG_CLIPPING_INVERSE == 1
if(fragClippingDist>0.0)discard;
#else
if(fragClippingDist<0.0)discard;
#endif
`;var PQ=Object.defineProperty,RQ=Object.getOwnPropertyDescriptor,WM=(r,e,t,i)=>{for(var n=i>1?void 0:i?RQ(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&PQ(e,t,n),n};p.FragmentClippingExtensionPlugin=class extends ei{constructor(){super(),this.enabled=!0,this._defines={FRAG_CLIPPING_DEBUG:0},this._uniforms={fragClippingPosition:{value:new bt},fragClippingParams:{value:new bt},fragClippingCamAspect:{value:1}},this._plane=new ks,this._viewNormalMatrix=new Bt,this._v4=new bt,this.materialExtension={parsFragmentSnippet:(r,e)=>{var t;return!this.enabled||!((t=e==null?void 0:e.userData._fragmentClippingExt)!=null&&t.clipEnabled)?"":Object.entries(yd).map(i=>["FragmentClippingMode."+i[0],""+i[1]]).reduce((i,n)=>i.replace(n[0],n[1]),TQ)},shaderExtender:(r,e)=>{var t;!this.enabled||!((t=e==null?void 0:e.userData._fragmentClippingExt)!=null&&t.clipEnabled)||(r.fragmentShader=ri(r.fragmentShader,"#glMarker mainStart",Object.entries(yd).map(i=>["FragmentClippingMode."+i[0],""+i[1]]).reduce((i,n)=>i.replace(n[0],n[1]),`
`+IQ),{append:!0}))},onObjectRender:(r,e)=>{var t,i,n;let s=e.userData._fragmentClippingExt;if(e.userData.isGBufferMaterial&&r&&r.material&&!Array.isArray(r.material)&&(s=(t=r.material)==null?void 0:t.userData._fragmentClippingExt),!!(s!=null&&s.clipEnabled)){if(Array.isArray(s.clipPosition)?this._uniforms.fragClippingPosition.value.fromArray(s.clipPosition):this._uniforms.fragClippingPosition.value.copy(s.clipPosition),s.clipMode===3&&s.clipParams){const a=Array.isArray(s.clipParams)?this._v4.fromArray(s.clipParams):this._v4.copy(s.clipParams),o=this._viewer.scene.mainCamera.matrixWorldInverse;this._plane.normal.set(a.x,a.y,a.z),this._plane.constant=a.w,this._viewNormalMatrix.getNormalMatrix(o),this._plane.applyMatrix4(o,this._viewNormalMatrix),this._uniforms.fragClippingParams.value.set(this._plane.normal.x,this._plane.normal.y,this._plane.normal.z,this._plane.constant)}else Array.isArray(s.clipPosition)?this._uniforms.fragClippingParams.value.fromArray(s.clipParams):this._uniforms.fragClippingParams.value.copy(s.clipParams);(i=this._viewer)!=null&&i.scene.mainCamera.isPerspectiveCamera?this._uniforms.fragClippingCamAspect.value=(n=this._viewer)==null?void 0:n.scene.mainCamera.aspect:this._uniforms.fragClippingCamAspect.value=1,al({...this._defines,FRAG_CLIPPING_MODE:+(s.clipMode??0),FRAG_CLIPPING_INVERSE:+(s.clipInvert??!1)},e)}},extraUniforms:{},computeCacheKey:r=>{var e;return(this.enabled?"1":"0")+((e=r.userData._fragmentClippingExt)!=null&&e.clipEnabled?"1":"0")},isCompatible:r=>r.isPhysicalMaterial||r.userData.isGBufferMaterial,getUiConfig:r=>{const e=this._viewer;r.userData._fragmentClippingExt===void 0&&(r.userData._fragmentClippingExt={});const t=r.userData._fragmentClippingExt,i={type:"folder",label:"Fragment Clipping",onChange:n=>{n.config&&this.setDirty()},children:[{type:"checkbox",label:"Enabled",get value(){return t.clipEnabled||!1},set value(n){var s;n!==t.clipEnabled&&(n?p.FragmentClippingExtensionPlugin.AddFragmentClipping(r)||e.dialog.alert("Cannot add FragmentClippingExtension."):(t.clipEnabled=!1,r.setDirty&&r.setDirty()),(s=i.uiRefresh)==null||s.call(i,!0,"postFrame"))}},{type:"dropdown",label:"Mode",children:Object.entries(yd).map(n=>({label:n[0],value:n[1]})),hidden:()=>!t.clipEnabled,property:[t,"clipMode"]},{type:"vec4",label:"Position",bounds:[-1,1],hidden:()=>!t.clipEnabled,property:[t,"clipPosition"]},{type:"vec4",label:"Params",bounds:[0,1],hidden:()=>!t.clipEnabled,property:[t,"clipParams"]},{type:"toggle",label:"Invert",hidden:()=>!t.clipEnabled,property:[t,"clipInvert"]}]};return i}},this.setDirty=()=>{var r,e,t;(e=(r=this.materialExtension).setDirty)==null||e.call(r),(t=this._viewer)==null||t.setDirty()},this._loaderCreate=this._loaderCreate.bind(this),Object.assign(this.materialExtension.extraUniforms,this._uniforms)}static AddFragmentClipping(r,e){const t=r==null?void 0:r.userData;if(!t)return!1;t._fragmentClippingExt||(t._fragmentClippingExt={});const i=t._fragmentClippingExt;return i.clipEnabled=!0,i.clipPosition===void 0&&(i.clipPosition=[0,0,0,0]),i.clipParams===void 0&&(i.clipParams=[0,0,0,0]),i.clipMode===void 0!==void 0&&(i.clipMode=0),i.clipInvert===void 0!==void 0&&(i.clipInvert=!1),e&&Object.assign(i,e),r.setDirty&&r.setDirty(),!0}_loaderCreate({loader:r}){r.isGLTFLoader2&&r.register(e=>new DQ(e))}onAdded(r){var e,t;super.onAdded(r),r.assetManager.materials.registerMaterialExtension(this.materialExtension),r.assetManager.importer.addEventListener("loaderCreate",this._loaderCreate),(t=(e=r.assetManager.exporter.getExporter("gltf","glb"))==null?void 0:e.extensions)==null||t.push(XM)}onRemove(r){var e,t,i,n;(e=r.assetManager.materials)==null||e.unregisterMaterialExtension(this.materialExtension),(t=r.assetManager.importer)==null||t.removeEventListener("loaderCreate",this._loaderCreate);const s=r.assetManager.exporter.getExporter("gltf","glb");if(s){const a=(i=s.extensions)==null?void 0:i.indexOf(XM);a!==void 0&&a>=0&&((n=s.extensions)==null||n.splice(a,1))}return super.onRemove(r)}},p.FragmentClippingExtensionPlugin.PluginType="FragmentClippingExtensionPlugin1",p.FragmentClippingExtensionPlugin.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION="WEBGI_materials_fragment_clipping_extension",WM([De("Enabled",r=>({onChange:r.setDirty})),$()],p.FragmentClippingExtensionPlugin.prototype,"enabled",2),p.FragmentClippingExtensionPlugin=WM([ti("Fragment Clipping (MatExt)")],p.FragmentClippingExtensionPlugin);var yd=(r=>(r[r.Circle=0]="Circle",r[r.Ellipse=1]="Ellipse",r[r.Rectangle=2]="Rectangle",r[r.Plane=3]="Plane",r[r.Sphere=4]="Sphere",r))(yd||{});class DQ{constructor(e){this.parser=e,this.name=p.FragmentClippingExtensionPlugin.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION}async extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return;const n=i.extensions[this.name];t.userData||(t.userData={}),p.FragmentClippingExtensionPlugin.AddFragmentClipping(t),Kt.Deserialize(n,t.userData._fragmentClippingExt)}}const XM=r=>({writeMaterial:(e,t)=>{var i;if(!e.isMeshStandardMaterial||!((i=e.userData._fragmentClippingExt)!=null&&i.clipEnabled))return;t.extensions=t.extensions||{};const n=Kt.Serialize(e.userData._fragmentClippingExt);t.extensions[p.FragmentClippingExtensionPlugin.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION]=n,r.extensionsUsed[p.FragmentClippingExtensionPlugin.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION]=!0}});var BQ=Object.defineProperty,LQ=Object.getOwnPropertyDescriptor,qM=(r,e,t,i)=>{for(var n=i>1?void 0:i?LQ(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&BQ(e,t,n),n};p.VirtualCamerasPlugin=class extends ei{constructor(r=!0){super(),this.enabled=!0,this.toJSON=void 0,this.cameras=[],this._viewerListeners={preRender:()=>{if(this.isDisabled()||!this._viewer)return;const e=this._viewer;for(const t of this.cameras){if(!t.enabled)continue;const i=t.camera;try{this.dispatchEvent({type:"preRenderCamera",camera:t}),e.scene.renderCamera=i,e.renderManager.render(e.scene,!1);const n=e.renderManager.composer.readBuffer.texture;this.dispatchEvent({type:"preBlitCamera",camera:t,readBuffer:n}),e.renderManager.blit(t.target,{source:n}),this.dispatchEvent({type:"postRenderCamera",camera:t})}catch(n){if(e.console.error(n),t.enabled=!1,e.debug)throw n}}}},this.enabled=r}addCamera(r){if(!this._viewer)throw"Plugin not added to viewer";const e=this._viewer.renderManager.composerTarget.clone(!0);e.name=r.name+"_virtualCamTarget";const t={camera:r,target:e,enabled:!0};return this.cameras.push(t),t}},p.VirtualCamerasPlugin.PluginType="VirtualCamerasPlugin",qM([De()],p.VirtualCamerasPlugin.prototype,"enabled",2),p.VirtualCamerasPlugin=qM([ti("Virtual Cameras")],p.VirtualCamerasPlugin);var UQ=Object.defineProperty,OQ=(r,e,t,i)=>{for(var n=void 0,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=a(e,t,n)||n);return n&&UQ(e,t,n),n};const YM=class extends ei{constructor(){super(),this.enabled=!0,this._uiNeedRefresh=!1,this.applyOnLoad=!0,this.variations=[],this._selectedMaterial=()=>{var e,t;return((t=(e=this._picking)==null?void 0:e.getSelectedObject())==null?void 0:t.material)||void 0},this.uiConfig={label:"Material Configurator",type:"folder",children:[()=>{var e;return[{type:"input",label:"uuid",property:[this._selectedMaterial(),"uuid"],hidden:()=>!this._selectedMaterial(),disabled:!0},{type:"input",label:"mapping",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"uuid"],onChange:async()=>this.refreshUi()},{type:"input",label:"title",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"title"],onChange:async()=>this.refreshUi()},{type:"dropdown",label:"Preview Type",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"preview"],onChange:async()=>this.refreshUi(),children:["generate:sphere","generate:cube","color","map","emissive",...Object.keys(xa.MaterialProperties).filter(t=>t.endsWith("Map"))].map(t=>({label:t,value:t}))},...((e=this.getSelectedVariation())==null?void 0:e.materials.map(t=>t.uiConfig?Object.assign(t.uiConfig,{expanded:!1}):{}))||[],{type:"button",label:"Clear variations",hidden:()=>!this._selectedMaterial(),value:async()=>{const t=this.getSelectedVariation();t&&await this._viewer.dialog.confirm("Material configurator: Remove all variations for this material?")&&(t.materials=[]),this.refreshUi()}},{type:"button",label:"Remove completely",hidden:()=>!this._selectedMaterial(),value:async()=>{const t=this.getSelectedVariation();t&&await this._viewer.dialog.confirm("Material configurator: Remove this variation?")&&this.removeVariation(t)}},{type:"button",label:"Add Variation",hidden:()=>!this._selectedMaterial(),value:async()=>{var t;const i=this._selectedMaterial();i&&(!i.name&&!await((t=this._viewer)==null?void 0:t.dialog.confirm("Material configurator: Material has no name. Use uuid instead?"))||this.addVariation(i))}},{type:"button",label:"Refresh Ui",value:()=>this.refreshUi()},{type:"button",label:"Apply All",value:()=>{this.variations.forEach(t=>this.applyVariation(t,t.materials[0].uuid))}}]}]},this.addEventListener("deserialize",this.refreshUi),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._refreshUiConfig=this._refreshUiConfig.bind(this)}onAdded(e){var t;super.onAdded(e),this._picking=e.getPlugin("Picking"),this._previewGenerator=new Mx,(t=this._picking)==null||t.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi)}reapplyAll(){this.variations.forEach(e=>this.applyVariation(e,e.materials[e.selectedIndex??0].uuid))}fromJSON(e,t){return this.variations=[],super.fromJSON(e,t)?(e.applyOnLoad===void 0&&(this.applyOnLoad=!1),this.applyOnLoad&&this.reapplyAll(),this):null}onRemove(e){var t,i;return(t=this._previewGenerator)==null||t.dispose(),this._previewGenerator=void 0,(i=this._picking)==null||i.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}findVariation(e){return e?this.variations.find(t=>t.uuid===e):void 0}getSelectedVariation(){var e,t;return this.findVariation((e=this._selectedMaterial())==null?void 0:e.uuid)||this.findVariation((t=this._selectedMaterial())==null?void 0:t.name)}applyVariation(e,t){var i;const n=(i=this._viewer)==null?void 0:i.materialManager;if(!n)return!1;const s=typeof t=="string"?e.materials.find(a=>a.uuid===t):e.materials[t];return s?(e.selectedIndex=e.materials.indexOf(s),n.applyMaterial(s,e.uuid)):!1}getPreview(e,t,i=!0){if(!this._viewer)return"";const n=e;if(!n)return"";let s="";if(t.startsWith("generate:"))s=this._previewGenerator.generate(n,this._viewer.renderManager.renderer,this._viewer.scene.environment,t.split(":")[1]);else{const a=n[t]||"#ff00ff";s=a.image?Zw(a.image,100):"",s.length||(s=tx(a.isColor?a.getHexString():a))}return i&&this._viewer.setDirty(),s}refreshUi(){!this.enabled||!this._viewer||(this._uiNeedRefresh=!0)}_refreshUiConfig(){var e,t;this.enabled&&((t=(e=this.uiConfig).uiRefresh)==null||t.call(e))}async _refreshUi(){return!this.enabled||!this._viewer||!this._uiNeedRefresh?!1:(this._uiNeedRefresh=!1,this._refreshUiConfig(),!0)}removeVariationForMaterial(e){let t=this.findVariation(e.uuid);!t&&e.name.length>0&&(t=this.findVariation(e.name)),t&&this.removeVariation(t)}removeVariation(e){e&&(this.variations.splice(this.variations.indexOf(e),1),this.refreshUi())}addVariation(e){var t;const i=(t=e==null?void 0:e.clone)==null?void 0:t.call(e);if(e&&i){let n=this.findVariation(e.uuid);!n&&e.name.length>0&&(n=this.findVariation(e.name)),n||(n=this.createVariation(e)),n.materials.push(i),this.refreshUi()}}createVariation(e){return this.variations.push({uuid:e.name.length>0?e.name:e.uuid,title:e.name.length>0?e.name:"No Name",preview:"generate:sphere",materials:[]}),this.variations[this.variations.length-1]}};YM.PluginType="MaterialConfiguratorPlugin";let KM=YM;OQ([$()],KM.prototype,"variations");var kQ=Object.defineProperty,FQ=(r,e,t,i)=>{for(var n=void 0,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=a(e,t,n)||n);return n&&kQ(e,t,n),n};const JM=class extends ei{constructor(){super(),this.enabled=!0,this._uiNeedRefresh=!1,this.applyOnLoad=!0,this.variations=[],this._selectedSwitchNode=()=>{var e;const t=(e=this._picking)==null?void 0:e.getSelectedObject();if(!t)return;const i=this.variations.map(s=>s.name);let n;return t.traverseAncestors(s=>{n||s.name&&i.includes(s.name)&&(n=s)}),n},this.uiConfig={label:"Switch Node Plugin",type:"folder",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"]},()=>[{type:"folder",label:"All nodes",expanded:!0,children:[this.variations.map(e=>({type:"input",label:e.title,property:[e,"name"],onChange:()=>this.refreshUi()}))]},{type:"button",label:"Add Node",value:()=>{this.addNode({name:"switch_node",selected:"",title:"Switch Node",camView:"front",camDistance:1})}},{type:"button",label:"Refresh UI",value:()=>this.refreshUi()},{type:"input",label:"Selected node title",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"title"]:[]},onChange:()=>this.refreshUi()},{type:"slider",bounds:[.01,2],stepSize:.01,label:"Cam Distance",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"camDistance"]:[]}},{type:"dropdown",label:"Cam View",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"camView"]:[]},onChange:()=>this.refreshUi(),children:["top","bottom","front","back","left","right"].map(e=>({label:e,value:e}))}]]},this._postFrame=this._postFrame.bind(this),this.refreshUiConfig=this.refreshUiConfig.bind(this),this.addEventListener("deserialize",async()=>{this.refreshUi()})}onAdded(e){var t;super.onAdded(e),this._picking=e.getPlugin("Picking"),(t=this._picking)==null||t.addEventListener("selectedObjectChanged",this.refreshUiConfig),e.addEventListener("postFrame",this._postFrame)}onRemove(e){var t;this._picking=e.getPlugin("Picking"),(t=this._picking)==null||t.removeEventListener("selectedObjectChanged",this.refreshUiConfig),e.removeEventListener("postFrame",this._postFrame),super.onRemove(e)}_postFrame(){this._uiNeedRefresh&&this._refreshUi()}selectNode(e,t,i=!0){var n,s;const a=(n=this._viewer)==null?void 0:n.scene.getObjectByName(e.name);if(!a||a.children.length<1)return;const o=typeof t=="number"?a.children[t]:a.children.find(c=>c.name===t||c.uuid===t);if(!o)return(s=this._viewer)==null||s.console.warn("SwitchNodePlugin: child not found",t),!1;e.selected=o.name||o.uuid;let l=!1;for(const c of a.children){const h=c.visible;c.visible=(c.name||c.uuid)===e.selected,l=l||h!==c.visible}return l&&i&&this._viewer.scene.setDirty({refreshScene:!0,frameFade:!0}),l}reapplyAll(){this.variations.forEach(e=>this.selectNode(e,e.selected||0,!1)),this._viewer.scene.setDirty({refreshScene:!0,frameFade:!0})}fromJSON(e,t){return this.variations=[],super.fromJSON(e,t)?(e.applyOnLoad===void 0&&(this.applyOnLoad=!0),this.applyOnLoad&&this.reapplyAll(),this):null}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}_refreshUi(){return!this.enabled||!this._viewer?!1:(this._uiNeedRefresh=!1,this.refreshUiConfig(),!0)}refreshUiConfig(){var e,t;this.enabled&&((t=(e=this.uiConfig).uiRefresh)==null||t.call(e))}getPreview(e,t,i=!0){var n;if(!this._viewer||!e)return"";const s=e.camView,a=new P((s.includes("right")?1:0)-(s.includes("left")?1:0),(s.includes("top")?1:0)-(s.includes("bottom")?1:0),(s.includes("front")?1:0)-(s.includes("back")?1:0));e.camDistance||(e.camDistance=1);const o=w0(this._viewer.renderManager.renderer,t,(n=this._viewer)==null?void 0:n.scene,7,a.multiplyScalar(e.camDistance*2));return i&&this._viewer.setDirty(),o}addNode(e,t=!0){this.variations.push(e),t&&this.refreshUi()}};JM.PluginType="SwitchNodePlugin";let ZM=JM;FQ([$()],ZM.prototype,"variations");const NQ=`
#ifdef HDRi_GROUND_PROJ
float intersectPlane1(const in vec3 r0,const in vec3 rd,const in vec3 n,const in vec3 p0){float t=dot(p0-r0,n)/(dot(n,rd)+1e-6);return t<0. ? 1000. : t;}float intersectSphere1(in vec3 ro,in vec3 rd,in vec3 sph,in float rad){vec3 oc=ro-sph;float b=dot(oc,rd);float c=dot(oc,oc)-rad*rad;float t=b*b-c;return t<0.0 ? t :-b+sqrt(t);}
#define PI_HALF 1.5707963267948966
uniform float worldRadius;uniform float tripodHeight;uniform vec3 originPosition;vec3 hdriProject(){vec3 p=normalize(vWorldDirection);vec3 camPos=cameraPosition;camPos.y-=tripodHeight;float t=intersectSphere1(camPos,p,originPosition,worldRadius);if(t>0.0){float t2=intersectPlane1(camPos,p,vec3(0,-1,0),originPosition+vec3(0.0,-tripodHeight,0.0));p=(camPos+min(t,t2)*p)/worldRadius;/*if(t2<t&&tripodHeight<0.001){float phi=atan(p.z,p.x);float p1=0.4;float l=length(p.xz);p1=(1.-p1*l)/(1.-p1);float theta=sin(l*PI_HALF)*PI_HALF;p.x=sin(theta)*cos(phi)*p1;p.y=-cos(theta);p.z=sin(theta)*sin(phi)*p1;}*/}else p=vec3(0.0,1.0,0.0);return p;}
#endif
`;var GQ=Object.defineProperty,zQ=Object.getOwnPropertyDescriptor,au=(r,e,t,i)=>{for(var n=i>1?void 0:i?zQ(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&GQ(e,t,n),n};p.HDRiGroundPlugin=class extends ei{constructor(r=!1,e=!0){super(),this.enabled=!1,this.worldRadius=100,this.tripodHeight=10,this.originPosition=new P(0,0,0),this.promptOnBackgroundMismatch=!0,this.setDirty=this.setDirty.bind(this),this.enabled=r,this.promptOnBackgroundMismatch=e,this.addEventListener("deserialize",this.setDirty)}setDirty(){var r;if(!this._viewer)return;const e=this._viewer.scene.background;this.enabled&&e!==this._viewer.scene.environment&&e!=="environment"&&(e&&e.isDataTexture?e.mapping=_s:!this.promptOnBackgroundMismatch||this._viewer.dialog.confirmSync("Background must be same as environment, do you want to change it?")?this._viewer.scene.background="environment":this.enabled=!1);const t=(r=this._viewer.renderManager.renderer.background.getBoxMesh2())==null?void 0:r.material,i=(t==null?void 0:t.uniforms)??Vi.backgroundCube.uniforms;i.tripodHeight||(i.tripodHeight={value:1}),i.worldRadius||(i.worldRadius={value:1}),i.originPosition||(i.originPosition={value:new P}),i.tripodHeight.value=this.tripodHeight,i.worldRadius.value=this.worldRadius,i.originPosition.value.copy(this.originPosition),t&&(this.isDisabled()&&t.defines.HDRi_GROUND_PROJ?delete t.defines.HDRi_GROUND_PROJ:this.isDisabled()||(t.defines.HDRi_GROUND_PROJ="1"),t.needsUpdate=!0),this._viewer.setDirty()}onAdded(r){var e,t;super.onAdded(r),(t=(e=this._viewer)==null?void 0:e.renderManager.webglRenderer)!=null&&t.background.getBoxMesh()&&r.console.error("HDRi Ground Plugin must be added before setting any cube or env map"),Vi.backgroundCube.fragmentShader.includes("#ifdef HDRi_GROUND_PROJ")||(Vi.backgroundCube.fragmentShader=ri(Vi.backgroundCube.fragmentShader,"void main() {",NQ,{prepend:!0}),Vi.backgroundCube.fragmentShader=ri(Vi.backgroundCube.fragmentShader,"vec3 vReflect = vWorldDirection;",`
vec3 vReflect = 
#ifdef HDRi_GROUND_PROJ
hdriProject()
#else
vWorldDirection
#endif
;
`)),r.scene.addEventListener("environmentChanged",this.setDirty)}},p.HDRiGroundPlugin.PluginType="HDRiGroundPlugin",au([$(),st(p.HDRiGroundPlugin.prototype.setDirty),De("Enabled")],p.HDRiGroundPlugin.prototype,"enabled",2),au([$(),st(p.HDRiGroundPlugin.prototype.setDirty),Rt("World Radius",[1,1e3],.01)],p.HDRiGroundPlugin.prototype,"worldRadius",2),au([$(),st(p.HDRiGroundPlugin.prototype.setDirty),Rt("Tripod height",[0,50],.01)],p.HDRiGroundPlugin.prototype,"tripodHeight",2),au([$(),st(p.HDRiGroundPlugin.prototype.setDirty),an("Origin Position",void 0,.001,r=>({onChange:r.setDirty}))],p.HDRiGroundPlugin.prototype,"originPosition",2),au([$(),st(p.HDRiGroundPlugin.prototype.setDirty)],p.HDRiGroundPlugin.prototype,"promptOnBackgroundMismatch",2),p.HDRiGroundPlugin=au([Xr("HDRi Ground")],p.HDRiGroundPlugin);var QQ=Object.defineProperty,VQ=(r,e,t,i)=>{for(var n=void 0,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=a(e,t,n)||n);return n&&QQ(e,t,n),n};const C_=(de=class extends ei{constructor(r=!0){super(),this.enabled=!0,this.helpers=[tE,aE,nE,ag],this.toJSON=null,this._widgetRoot=new It,this._addSceneObject=e=>{this._createWidgets(e.object)},this.widgets=[],this._widgetDisposed=e=>this._unregisterWidget(e.target),this.uiConfig={type:"folder",label:"Widgets",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"]},{type:"button",label:"Refresh",value:()=>this.refresh()}]},this.enabled=r}setDirty(){var r,e;(r=this.widgets)==null||r.forEach(t=>t.visible=!this.isDisabled()),(e=this._viewer)==null||e.setDirty()}onAdded(r){super.onAdded(r),r.scene.addEventListener("addSceneObject",this._addSceneObject),r.scene.addObject(this._widgetRoot)}onRemove(r){r.scene.removeEventListener("addSceneObject",this._addSceneObject),this.widgets.forEach(e=>e.dispose&&e.dispose()),this.widgets=[],this._widgetRoot.removeFromParent(),this._widgetRoot.clear(),super.onRemove(r)}refresh(){var r;this._createWidgets((r=this._viewer)==null?void 0:r.scene.modelRoot)}_registerWidget(r){this.widgets.push(r),r.addEventListener("dispose",this._widgetDisposed)}_unregisterWidget(r){r.removeEventListener("dispose",this._widgetDisposed);const e=this.widgets.indexOf(r);e>=0&&this.widgets.splice(e,1)}_createWidgets(r){r==null||r.traverse(e=>{const t=this.widgets.find(i=>i.object===e);if(t){t.update&&t.update();return}this.helpers.filter(i=>i.Check(e)).forEach(i=>{const n=i.Create(e);n.visible=!this.isDisabled(),this._widgetRoot.add(n),this._registerWidget(n)})})}},de.PluginType="Object3DWidgetsPlugin",de);VQ([st(C_.prototype.setDirty)],C_.prototype,"enabled");let jQ=C_;var HQ=Object.defineProperty,WQ=Object.getOwnPropertyDescriptor,M_=(r,e,t,i)=>{for(var n=i>1?void 0:i?WQ(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&HQ(e,t,n),n};p.Object3DGeneratorPlugin=class extends ei{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this._selectedType="",this.generators={"camera-perspective":(r={})=>{var e;const t=new Oh(r.controlsMode??"",(e=this._viewer)==null?void 0:e.canvas,r.autoAspect,r.fov,r.aspect);return r.position?t.position.copy(r.position):t.position.set(0,0,5),r.target?t.target.copy(r.target):t.target.set(0,0,0),t.autoLookAtTarget=r.autoLookAtTarget??!0,t.setDirty(),t.name=r.name??"Perspective Camera",t},"light-directional":(r={})=>{const e=new p.DirectionalLight2(r.color??16711680,r.intensity??3);return r.position?e.position.copy(r.position):e.position.set(5,5,5),e.lookAt(r.target??new P(0,0,0)),e.name="Directional Light",e},"light-ambient":(r={})=>{const e=new p.AmbientLight2(r.color??16777215,r.intensity??1);return e.name="Ambient Light",e},"light-point":(r={})=>{const e=new p.PointLight2(r.color??16711680,r.intensity??3);return r.position?e.position.copy(r.position):e.position.set(5,5,5),e.name="Point Light",e},"light-spot":(r={})=>{const e=new p.SpotLight2(r.color??16711680,r.intensity??3);return r.position?e.position.copy(r.position):e.position.set(5,5,5),e.lookAt(r.target??new P(0,0,0)),e.name="Spot Light",e},"light-hemisphere":(r={})=>{const e=new p.HemisphereLight2(r.color??11184895,5592131,r.intensity??1);return e.name="Hemisphere Light",e},"light-rect-area":(r={})=>{const e=new p.RectAreaLight2(r.color??255,r.intensity??3,2,2);return r.position?e.position.copy(r.position):e.position.set(5,5,5),e.lookAt(r.target??new P(0,0,0)),e.name="Rect Area Light",e}},this._selectedType=Object.keys(this.generators)[0]}generate(r,e,t=!0){var i,n;if(!this._viewer)throw new Error("No viewer");const s=(n=(i=this.generators)[r??this._selectedType])==null?void 0:n.call(i,e);return t&&s&&this._viewer.scene.addObject(s),s}},p.Object3DGeneratorPlugin.PluginType="Object3DGeneratorPlugin",M_([js("Type",void 0,r=>({children:[()=>Object.keys(r.generators).map(e=>({label:e}))]}))],p.Object3DGeneratorPlugin.prototype,"_selectedType",2),M_([ci("Generate",{sendArgs:!1})],p.Object3DGeneratorPlugin.prototype,"generate",1),p.Object3DGeneratorPlugin=M_([Xr("Generate Scene Objects")],p.Object3DGeneratorPlugin);var XQ=Object.defineProperty,qQ=Object.getOwnPropertyDescriptor,_d=(r,e,t,i)=>{for(var n=i>1?void 0:i?qQ(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&XQ(e,t,n),n};p.ContactShadowGroundPlugin=class extends p.BaseGroundPlugin{constructor(){super(),this.contactShadows=!0,this.shadowScale=1,this.shadowHeight=5,this.blurAmount=1,this.shadowCamera=new ua(-1,1,1,-1,.001,this.shadowHeight),this._refreshShadowCameraFrustum=this._refreshShadowCameraFrustum.bind(this),this.refresh=this.refresh.bind(this)}onAdded(r){const e=r.renderManager.createTarget({type:oi,format:mi,colorSpace:Xi,size:{width:512,height:512},generateMipmaps:!1,depthBuffer:!0,minFilter:Et,magFilter:Et});e.texture.name="groundContactDepthTexture";const t=new np({depthPacking:xs,transparent:!1,blending:Qt});t.onBeforeCompile=i=>{i.uniforms.opacity.value=1,i.fragmentShader=ri(i.fragmentShader,"gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), 1.0 );")},this._depthPass=new p.GBufferRenderPass("contactShadowGround",e,t,new fe(0,0,0),0),this._blurHelper=new Cx(r),super.onAdded(r)}onRemove(r){var e,t,i,n;const s=(e=this._depthPass)==null?void 0:e.target;return s&&((t=this._viewer)==null||t.renderManager.disposeTarget(s)),(i=this._depthPass)==null||i.dispose(),this._depthPass=void 0,(n=this._blurHelper)==null||n.dispose(),this._blurHelper=void 0,super.onRemove(r)}_postFrame(){super._postFrame(),this._viewer}_preRender(){if(super._preRender(),!this._viewer||!this._depthPass||!this._blurHelper)return;this._depthPass.scene=this._viewer.scene,this._depthPass.camera=this.shadowCamera,this._depthPass.render(this._viewer.renderManager.renderer,null);const r=this._viewer.renderManager.getTempTarget({type:oi,format:mi,colorSpace:Xi,size:{width:1024,height:1024},generateMipmaps:!1,depthBuffer:!1,minFilter:Et,magFilter:Et});this._blurHelper.blur(this._depthPass.target.texture,this._depthPass.target,r,this.blurAmount/256),this._blurHelper.blur(this._depthPass.target.texture,this._depthPass.target,r,.4*this.blurAmount/256),this._viewer.renderManager.releaseTempTarget(r)}_refreshTransform(){super._refreshTransform(),this._mesh&&this._viewer&&(this.shadowCamera.position.copy(this._mesh.getWorldPosition(new P)),this.shadowCamera.setRotationFromEuler(new Di(Math.PI/2,0,0)),this.shadowCamera.updateMatrixWorld(),this._refreshShadowCameraFrustum(),this._mesh.scale.y=-this.size)}_refreshShadowCameraFrustum(){this.shadowCamera&&(this.shadowCamera.left=-this.size/(2*this.shadowScale),this.shadowCamera.right=this.size/(2*this.shadowScale),this.shadowCamera.top=this.size/(2*this.shadowScale),this.shadowCamera.bottom=-this.size/(2*this.shadowScale),this.shadowCamera.far=this.shadowHeight,this.shadowCamera.updateProjectionMatrix(),this._setDirty())}_setDirty(){var r;(r=this._viewer)==null||r.setDirty()}_removeMaterial(){this._material&&super._removeMaterial()}refresh(){this._viewer&&super.refresh()}_refreshMaterial(){var r;if(!this._viewer)return!1;const e=super._refreshMaterial();return this._material&&(this._material.alphaMap=((r=this._depthPass)==null?void 0:r.target.texture)||null,e&&(this._material.roughness=1,this._material.metalness=0,this._material.color.set(1118481),this._material.transparent=!0,this._material.userData.ssreflDisabled=!0,this._material.userData.ssreflNonPhysical=!1)),e}},p.ContactShadowGroundPlugin.PluginType="ContactShadowGroundPlugin",_d([De("Contact Shadows"),st(p.ContactShadowGroundPlugin.prototype.refresh),$()],p.ContactShadowGroundPlugin.prototype,"contactShadows",2),_d([Rt("Shadow Scale",[0,2]),$(),st(p.ContactShadowGroundPlugin.prototype._refreshShadowCameraFrustum)],p.ContactShadowGroundPlugin.prototype,"shadowScale",2),_d([Rt("Shadow Height",[0,20]),$(),st(p.ContactShadowGroundPlugin.prototype._refreshShadowCameraFrustum)],p.ContactShadowGroundPlugin.prototype,"shadowHeight",2),_d([Rt("Blur Amount",[0,10]),$(),st(p.ContactShadowGroundPlugin.prototype._setDirty)],p.ContactShadowGroundPlugin.prototype,"blurAmount",2),p.ContactShadowGroundPlugin=_d([Xr("Contact Shadow Ground")],p.ContactShadowGroundPlugin);var YQ=Object.defineProperty,KQ=Object.getOwnPropertyDescriptor,S_=(r,e,t,i)=>{for(var n=i>1?void 0:i?KQ(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&YQ(e,t,n),n};const $M=class extends ei{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.simplifyFactor=.5}get initialized(){return!0}async initialize(){}onAdded(e){super.onAdded(e),this._pickingPlugin=e.getPlugin(fd)}simplifyGeometries(e,t){var i;if(!e){const s=(i=this._pickingPlugin)==null?void 0:i.getSelectedObject(),a=[];if(s==null||s.traverse(o=>{o.geometry&&!a.includes(o.geometry)&&a.push(o.geometry)}),e=a,!e||!e.length)return}Array.isArray(e)||(e=[e]);const n=[];for(const s of e)n.push(this.simplifyGeometry(s,t));return n}simplifyGeometry(e,{factor:t,count:i,replace:n=!0,disposeOnReplace:s=!1}={}){var a,o,l;if(!e){const y=(a=this._pickingPlugin)==null?void 0:a.getSelectedObject();if(e=y==null?void 0:y.geometry,!e)return}if(!e.attributes.position)return(o=this._viewer)==null||o.console.error("SimplifyModifierPlugin: Geometry does not have position attribute",e),e;t=t||this.simplifyFactor,i=i||e.attributes.position.count*t,e.boundingBox||e.computeBoundingBox();const c=this._simplify(e,i);c.computeBoundingBox(),c.computeBoundingSphere(),c.computeVertexNormals();const h=c.boundingBox,d=h.getSize(new P);if(!isFinite(d.x)||!isFinite(d.y)||!isFinite(d.z))return(l=this._viewer)==null||l.console.error("SimplifyModifierPlugin: Unable to simplify",e,c,d),e;const m=e.boundingBox,f=m.getSize(new P),v=d.clone().sub(f),w=v.clone().divide(f);if(w.lengthSq()>.001&&console.warn("Simplify",e,c,h,m,d,f,v,w),!n)return c;const b=e.appliedMeshes;if(!b)return console.error("No meshes found for geometry, cannot replace",e),c;for(const y of b)y.geometry=c;return s&&e.dispose(!0),c}async simplifyAll(e,t){var i;if(!e&&this._viewer&&(e=this._viewer.scene.modelRoot),!e){console.error("SimplifyModifierPlugin: No root found");return}if(!this.initialized&&(await this.initialize(),!this.initialized)){(i=this._viewer)==null||i.console.error("SimplifyModifierPlugin cannot be initialized");return}const n=[];if(e.traverse(s=>{s.geometry&&!n.includes(s.geometry)&&n.push(s.geometry)}),!n.length){console.error("SimplifyModifierPlugin: No geometries found");return}return this.simplifyGeometries(n,t)}async simplifySelected(){var e;if(!this._viewer)return;if(!this.initialized&&(await this.initialize(),!this.initialized)){await this._viewer.dialog.alert("SimplifyModifierPlugin cannot be initialized");return}const t=(e=this._pickingPlugin)==null?void 0:e.getSelectedObject();if(!t){await this._viewer.dialog.alert("Nothing Selected");return}let i=!1;t.geometry?t.children.length===0&&(i=!0):i=!0,i||await this._viewer.dialog.confirm("Simplify all in hierarchy?")&&(i=!0),i?this.simplifyGeometries():this.simplifyGeometry(t.geometry)}};$M.PluginType="SimplifyModifierPlugin";let bd=$M;S_([Rt("Simplify Factor",[0,1])],bd.prototype,"simplifyFactor",2),S_([ci("Simplify All",{sendArgs:!1})],bd.prototype,"simplifyAll",1),S_([ci("Simplify Selected")],bd.prototype,"simplifySelected",1);var JQ=Object.defineProperty,ZQ=Object.getOwnPropertyDescriptor,T_=(r,e,t,i)=>{for(var n=i>1?void 0:i?ZQ(e,t):e,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=(i?a(e,t,n):a(n))||n);return i&&n&&JQ(e,t,n),n};p.MeshOptSimplifyModifierPlugin=class extends bd{constructor(r=!0,e=document.head){super(),this.rootNode=e,this._initializing=void 0,this.errorThreshold=.5,this.lockBorder=!1,r&&this.initialize()}get initialized(){return!!window.MeshoptSimplifier}onAdded(r){super.onAdded(r)}async initialize(){if(this.initialized)return;if(this._initializing)return await this._initializing;const r=document.createElement("script");r.type="module";const e=Math.random().toString(36).substring(7);return r.innerHTML=`
import { MeshoptSimplifier } from '${p.MeshOptSimplifyModifierPlugin.SIMPLIFIER_URL}';
MeshoptSimplifier.ready.then(() => {
window.MeshoptSimplifier = MeshoptSimplifier;
window.dispatchEvent(new CustomEvent('${e}'))
});
`,this._initializing=new Promise(t=>{window.addEventListener(e,()=>t(),{once:!0}),this.rootNode.appendChild(r),this._script=r}),await this._initializing}dispose(){this._script&&(this._script.remove(),delete window.MeshoptSimplifier),this._script=void 0}_simplify(r,e){if(!this.initialized)throw new Error("MeshOptSimplifyModifierPlugin not initialized");r.index?r=r.clone():r=v0(r);const t=r.index.array,i=r.attributes.position.array,n=e/r.attributes.position.count,s=3*Math.floor(n*t.length/3),[a,o]=window.MeshoptSimplifier.simplify(t,i,3,s,this.errorThreshold,this.lockBorder?["LockBorder"]:[]);return console.log("srcCount",t.length/3,"destCount",a.length/3),o&&console.error("Simplify error",o),r.setIndex(new At(new Uint32Array(a),1)),Ln.upgradeGeometry.call(r.toNonIndexed())}},p.MeshOptSimplifyModifierPlugin.PluginType="MeshOptSimplifyModifierPlugin",p.MeshOptSimplifyModifierPlugin.SIMPLIFIER_URL="https://unpkg.com/meshoptimizer@0.20.0/meshopt_simplifier.module.js",T_([vn()],p.MeshOptSimplifyModifierPlugin.prototype,"errorThreshold",2),T_([De()],p.MeshOptSimplifyModifierPlugin.prototype,"lockBorder",2),p.MeshOptSimplifyModifierPlugin=T_([ti("Simplify Modifier (meshopt)")],p.MeshOptSimplifyModifierPlugin);const $Q=r=>{const e=[],t=new Set;for(const i of r){let n=i,s=0;for(;t.has(n);)n=i+"."+ ++s;t.add(n),e.push(n)}return e},e5=(r,e)=>{const t={};for(const i of r.mappings)for(const n of i.variants)t[e[n]]={material:null,gltfMaterialIndex:i.material};return t},t5=r=>r.material!==void 0&&r.userData&&r.userData._variantMaterials,wd="KHR_materials_variants";class i5{constructor(e){this.parser=e,this.name=wd}async afterRoot(e){const t=this.parser,i=t.json;if(!i.extensions||!i.extensions[this.name])return;const n=i.extensions[this.name].variants||[],s=$Q(n.map(o=>o.name));for(const o of e.scenes)o.traverse(l=>{const c=t.associations.get(l);if(!c||c.meshes===void 0||c.primitives===void 0)return;const h=i.meshes[c.meshes].primitives[c.primitives].extensions;!h||!h[this.name]||(l.userData._variantMaterials=e5(h[this.name],s))});const a=async o=>{const l=o.material,c=o.userData._variantMaterials,h=[];for(const d in c){const m=c[d];if(m.material)continue;const f=m.gltfMaterialIndex;h.push(t.getDependency("material",f).then(v=>{o.material=v,t.assignFinalMaterial(o),c[d].material=o.material}))}return Promise.all(h).then(()=>{o.material=l})};await Promise.all(e.scenes.map(async o=>{const l=[];return o.traverse(c=>t5(c)&&l.push(a(c))),o.userData.__importData||(o.userData.__importData={}),o.userData.__importData[wd]={names:s},Promise.all(l)}))}}const eS=r=>r.material!==void 0&&r.userData&&r.userData._variantMaterials&&!!Object.values(r.userData._variantMaterials).filter(e=>zg(e==null?void 0:e.material)),zg=r=>r&&r.isMaterial&&!Array.isArray(r);class r5{constructor(e){this.writer=e,this.name=wd,this.variantNames=[]}beforeParse(e){const t=new Set;for(const i of e)i.traverse(n=>{if(!eS(n))return;const s=n.userData._variantMaterials;for(const a in s){const o=s[a];zg(o.material)&&t.add(a)}});t.forEach(i=>this.variantNames.push(i))}writeMesh(e,t){if(!eS(e))return;const i=e.userData,n=i._variantMaterials,s={};for(const l in n){const c=n[l].material;if(!zg(c))continue;const h=this.variantNames.indexOf(l),d=this.writer.processMaterial(c);s[d]||(s[d]={material:d,variants:[]}),s[d].variants.push(h)}const a=Object.values(s).map(l=>l.variants.sort((c,h)=>c-h)&&l).sort((l,c)=>l.material-c.material);if(a.length===0)return;const o=zg(i._originalMaterial)?this.writer.processMaterial(i._originalMaterial)??-1:-1;for(const l of t.primitives)o>=0&&(l.material=o),l.extensions=l.extensions||{},l.extensions[this.name]={mappings:a}}afterParse(e){if(this.variantNames.length===0)return;const t=this.writer.json;t.extensions=t.extensions||{};const i=this.variantNames.map(n=>({name:n}));t.extensions[this.name]={variants:i},this.writer.extensionsUsed[this.name]=!0}}function tS(r){return new r5(r)}var n5=Object.defineProperty,iS=(r,e,t,i)=>{for(var n=void 0,s=r.length-1,a;s>=0;s--)(a=r[s])&&(n=a(e,t,n)||n);return n&&n5(e,t,n),n};const Qg=(ve=class extends ei{constructor(){super(),this.enabled=!0,this.variants={},this.selectedVariant="",this.applyFirstVariantOnLoad=!0,this._objectAdded=r=>{var e,t;const i=r.object;i!=null&&i.isObject3D&&this._viewer&&(i.traverse(n=>{var s,a,o;if(n.userData._variantMaterials)for(const h of Object.values(n.userData._variantMaterials))h!=null&&h.material&&(h.material=((s=this._viewer)==null?void 0:s.materialManager.convertToIMaterial(h.material,{}))||h.material);const l=(o=(a=n.userData)==null?void 0:a.__importData)==null?void 0:o[wd];if(!l)return;const c=l.names||[];for(const h of c)this.variants[h]||(this.variants[h]=[]),this.variants[h].push(n);delete n.userData.__importData[wd]}),!this.selectedVariant&&this.applyFirstVariantOnLoad&&(this.selectedVariant=Object.keys(this.variants)[0]||""),(t=(e=this.uiConfig).uiRefresh)==null||t.call(e))},this.uiConfig={type:"folder",label:"KHR Material Variants",children:[()=>({children:[null,...Object.keys(this.variants)].map(r=>r?{label:r}:{label:"none",value:""}),type:"dropdown",label:"Variant",property:[this,"selectedVariant"]})]},this._loaderCreate=this._loaderCreate.bind(this)}onAdded(r){var e,t;super.onAdded(r),r.scene.addEventListener("addSceneObject",this._objectAdded),r.assetManager.importer.addEventListener("loaderCreate",this._loaderCreate),(t=(e=r.assetManager.exporter.getExporter("gltf","glb"))==null?void 0:e.extensions)==null||t.push(tS)}_loaderCreate({loader:r}){r.isGLTFLoader2&&r.register(e=>new i5(e))}onRemove(r){var e;r.scene.removeEventListener("addSceneObject",this._objectAdded),r.assetManager.importer.removeEventListener("loaderCreate",this._loaderCreate);const t=((e=r.assetManager.exporter.getExporter("gltf","glb"))==null?void 0:e.extensions)||[],i=t.indexOf(tS);return i!==-1&&t.splice(i,1),this.variants={},super.onRemove(r)}_variantChanged(){this.applyVariant(this.selectedVariant||"",!0)}applyVariant(r,e=!1,t,i=!0){if(!e&&!t&&this.selectedVariant===r||!r)return;t||(this.selectedVariant=r);const n=t?Array.isArray(t)?t:[t]:r?this.variants[r]||[]:Object.values(this.variants).flat();for(const s of n){const a=new Set,o=l=>{var c;if(!l.userData._variantMaterials||a.has(l))return;const h=r?(c=l.userData._variantMaterials[r])==null?void 0:c.material:l.userData._originalMaterial;h&&(l.userData._originalMaterial||(l.userData._originalMaterial=l.material),l.material=h),a.add(l)};i?s.traverse(o):o(s)}}},ve.PluginType="GLTFKHRMaterialVariantsPlugin",ve);iS([st(Qg.prototype._variantChanged),$()],Qg.prototype,"selectedVariant"),iS([$()],Qg.prototype,"applyFirstVariantOnLoad");let s5=Qg;function a5(){window.dispatchEvent(new Event("threepipe-test-finished")),document.body.classList.add("_testFinish")}function o5(){window.dispatchEvent(new Event("threepipe-test-started"))}function l5(r){return Wt.autoCenter.call(r)}function c5(r,e,t,i){return Wt.autoScale.call(r,e,t,i)}p.AAssetManagerProcessStatePlugin=iM,p.ACESFilmicToneMapping=Kk,p.ACameraControlsPlugin=Ug,p.ACameraHelperWidget=Z1,p.AHelperWidget=ay,p.ALightHelperWidget=sg,p.AScreenPassExtensionPlugin=pd,p.AViewerPlugin=q0,p.AViewerPluginAsync=UB,p.AViewerPluginSync=ei,p.AddEquation=yk,p.AddOperation=Hk,p.AdditiveAnimationBlendMode=CN,p.AdditiveBlending=fk,p.AlphaFormat=TF,p.AlwaysCompare=cG,p.AlwaysDepth=Ok,p.AlwaysStencilFunc=tG,p.AmbientLight=ff,p.AmbientLightProbe=h2,p.AnimationClip=Yl,p.AnimationLoader=i2,p.AnimationMixer=vw,p.AnimationObjectGroup=M2,p.AnimationUtils=ZP,p.ArcCurve=Bb,p.ArrayCamera=hb,p.ArrowHelper=H2,p.AssetExporter=zC,p.AssetExporterPlugin=OM,p.AssetImporter=SC,p.AssetManager=ZC,p.AsyncCompress=KE,p.AsyncDecompress=wU,p.AsyncDeflate=qE,p.AsyncGunzip=ZE,p.AsyncGzip=KE,p.AsyncInflate=By,p.AsyncUnzipInflate=DU,p.AsyncUnzlib=eC,p.AsyncZipDeflate=TU,p.AsyncZlib=_U,p.Audio=fw,p.AudioAnalyser=g2,p.AudioContext=kv,p.AudioListener=d2,p.AudioLoader=l2,p.AxesHelper=W2,p.BackSide=hk,p.BaseImporterPlugin=Ec,p.BasicDepthPacking=RN,p.BasicShadowMap=sk,p.Bone=vh,p.BooleanKeyframeTrack=Hl,p.Box2=zv,p.Box3=Yi,p.Box3B=Vs,p.Box3Helper=V2,p.BoxGeometry=Bi,p.BoxHelper=Q2,p.BoxSelectionWidget=$1,p.BufferAttribute=At,p.BufferGeometry=ht,p.BufferGeometry2=kL,p.BufferGeometryLoader=Ov,p.ByteType=vF,p.Cache=Bn,p.Camera=Ol,p.CameraHelper=z2,p.CameraHelper2=ag,p.CameraViewPlugin=pQ,p.CanvasSnapshot=S1,p.CanvasSnipperPlugin=Kz,p.CanvasTexture=jm,p.CapsuleGeometry=qm,p.CatmullRomCurve3=Lb,p.CineonToneMapping=Yk,p.CircleGeometry=Ym,p.ClampToEdgeWrapping=sF,p.Clock=_f,p.Color=fe,p.ColorKeyframeTrack=Iv,p.ColorManagement=cr,p.Compress=vg,p.CompressedArrayTexture=Db,p.CompressedTexture=qo,p.CompressedTextureLoader=rw,p.ConeGeometry=Km,p.CopyShader=yc,p.CubeCamera=vm,p.CubeReflectionMapping=$k,p.CubeRefractionMapping=eF,p.CubeTexture=Os,p.CubeTextureLoader=r2,p.CubeUVReflectionMapping=rF,p.CubicBezierCurve=fv,p.CubicBezierCurve3=Ob,p.CubicInterpolant=ew,p.CullFaceBack=ik,p.CullFaceFront=rk,p.CullFaceFrontBack=nk,p.CullFaceNone=tk,p.Curve=os,p.CurvePath=Fb,p.CustomBlending=vk,p.CustomContextMenu=n0,p.CustomToneMapping=Jk,p.CylinderGeometry=kr,p.Cylindrical=D2,p.DRACOLoader2=MC,p.Damper=rc,p.Data3DTexture=Wc,p.DataArrayTexture=Hc,p.DataTexture=pa,p.DataTextureLoader=Rv,p.DataUtils=Ur,p.DecodeUTF8=CU,p.Decompress=iC,p.DecrementStencilOp=jN,p.DecrementWrapStencilOp=WN,p.DefaultLoadingManager=Pv,p.Deflate=Ta,p.DepthFormat=DF,p.DepthNormalMaterial=H3,p.DepthStencilFormat=BF,p.DepthTexture=nv,p.DeviceOrientationControlsPlugin=fz,p.DirectionalLight=Ch,p.DirectionalLightHelper=G2,p.DirectionalLightHelper2=tE,p.DiscreteInterpolant=tw,p.DisplayP3ColorSpace=FN,p.DodecahedronGeometry=Jm,p.DoubleSide=uk,p.Dropzone=lx,p.DstAlphaFactor=Pk,p.DstColorFactor=Dk,p.DynamicCopyUsage=AG,p.DynamicDrawUsage=uG,p.DynamicReadUsage=mG,p.EXRExporter2=i_,p.EasingFunctions=Kf,p.EdgesGeometry=Nb,p.EffectComposer=vE,p.EffectComposer2=yE,p.EllipseCurve=Hm,p.EncodeUTF8=MU,p.EqualCompare=nG,p.EqualDepth=Nk,p.EqualStencilFunc=KN,p.EquirectangularReflectionMapping=tF,p.EquirectangularRefractionMapping=iF,p.Euler=Di,p.EventDispatcher=zi,p.ExtendedCopyPass=gy,p.ExtendedRenderPass=fy,p.ExtendedShaderMaterial=lE,p.ExtendedShaderPass=Nh,p.ExtrudeGeometry=sf,p.FileLoader=bi,p.FileTransferPlugin=Jz,p.Float16BufferAttribute=_A,p.Float32BufferAttribute=Ne,p.Float64BufferAttribute=bA,p.FloatType=xF,p.FnCaller=ga,p.Fog=Bm,p.FogExp2=Dm,p.FragmentClippingMode=yd,p.FrameFadeBlendPass=aM,p.FramebufferTexture=wP,p.FrontSide=ck,p.Frustum=Xn,p.FullScreenQuad=dE,p.GBufferMaterial=s_,p.GLBufferAttribute=R2,p.GLSL1=yG,p.GLSL3=_G,p.GLStatsJS=ax,p.GLTFExporter2=FC,p.GLTFKHRMaterialVariantsPlugin=s5,p.GLTFLightExtrasExtension=Hy,p.GLTFLoader2=CC,p.GLTFMaterialExtrasExtension=Wy,p.GLTFMaterialsAlphaMapExtension=ad,p.GLTFMaterialsBumpMapExtension=od,p.GLTFMaterialsDisplacementMapExtension=ld,p.GLTFMaterialsLightMapExtension=cd,p.GLTFMeshOptDecodePlugin=Hz,p.GLTFObject3DExtrasExtension=Xy,p.GLTFViewerConfigExtension=qy,p.GLTFWriter2=OC,p.GenericBlendTexturePass=mE,p.GreaterCompare=aG,p.GreaterDepth=zk,p.GreaterEqualCompare=lG,p.GreaterEqualDepth=Gk,p.GreaterEqualStencilFunc=eG,p.GreaterStencilFunc=ZN,p.GridHelper=F2,p.Group=fn,p.Gunzip=_g,p.Gzip=vg,p.HVBlurHelper=Cx,p.HalfFloatType=EF,p.HemisphereLight=mf,p.HemisphereLightHelper=k2,p.HemisphereLightProbe=c2,p.IcosahedronGeometry=af,p.ImageBitmapLoader=hw,p.ImageLoader=bp,p.ImageUtils=Qc,p.Importer=Pr,p.IncrementStencilOp=VN,p.IncrementWrapStencilOp=HN,p.Inflate=On,p.InstancedBufferAttribute=Xo,p.InstancedBufferGeometry=Uv,p.InstancedInterleavedBuffer=Ep,p.InstancedMesh=pp,p.Int16BufferAttribute=vA,p.Int32BufferAttribute=yA,p.Int8BufferAttribute=fA,p.IntType=bF,p.InterleavedBuffer=ph,p.InterleavedBufferAttribute=Vr,p.Interpolant=xh,p.InterpolateDiscrete=vN,p.InterpolateLinear=yN,p.InterpolateSmooth=_N,p.InvertStencilOp=XN,p.JSONMaterialLoader=Yp,p.KHR_TEXTURE_BASISU=b_,p.KTX2LoadPlugin=jz,p.KTX2Loader2=BM,p.KTXLoadPlugin=Dz,p.KeepStencilOp=zN,p.KeyframeTrack=zs,p.LOD=gb,p.LatheGeometry=gp,p.Layers=No,p.LegacyPhongMaterial=cE,p.LessCompare=rG,p.LessDepth=kk,p.LessEqualCompare=sG,p.LessEqualDepth=Fk,p.LessEqualStencilFunc=JN,p.LessStencilFunc=YN,p.Light=Jo,p.LightProbe=Af,p.Line=Tr,p.Line3=ww,p.LineBasicMaterial=Ji,p.LineBasicMaterial2=OL,p.LineCurve=Xm,p.LineCurve3=kb,p.LineDashedMaterial=Zb,p.LineLoop=cv,p.LineMaterial2=mc,p.LineSegments=qn,p.LinearEncoding=IN,p.LinearFilter=pF,p.LinearInterpolant=Tv,p.LinearMipMapLinearFilter=gF,p.LinearMipMapNearestFilter=mF,p.LinearMipmapLinearFilter=fF,p.LinearMipmapNearestFilter=dF,p.LinearSRGBColorSpace=kN,p.LinearToSRGB=zw,p.LinearToneMapping=Xk,p.Loader=$i,p.LoaderUtils=Qs,p.LoadingManager=df,p.LoopOnce=fN,p.LoopPingPong=AN,p.LoopRepeat=gN,p.LuminanceAlphaFormat=RF,p.LuminanceFormat=PF,p.MOUSE=$3,p.MTLLoader2=vy,p.Material=Ki,p.MaterialConfiguratorBasePlugin=KM,p.MaterialExtender=Gp,p.MaterialLoader=xp,p.MaterialManager=QC,p.MaterialPreviewGenerator=Mx,p.MathUtils=Zt,p.Matrix3=Bt,p.Matrix4=et,p.MaxEquation=xk,p.Mesh=Fe,p.Mesh2=hE,p.MeshBasicMaterial=Pn,p.MeshBasicMaterial2=UL,p.MeshDepthMaterial=np,p.MeshDistanceMaterial=iv,p.MeshLambertMaterial=Ev,p.MeshMatcapMaterial=Jb,p.MeshNormalMaterial=xv,p.MeshPhongMaterial=Vl,p.MeshPhysicalMaterial=_p,p.MeshStandardMaterial=fa,p.MeshStandardMaterial2=LL,p.MeshToonMaterial=Kb,p.MetaImporter=Bf,p.MinEquation=wk,p.MirroredRepeatWrapping=aF,p.MixOperation=jk,p.MultiplyBlending=Ak,p.MultiplyOperation=Vk,p.NearestFilter=oF,p.NearestMipMapLinearFilter=uF,p.NearestMipMapNearestFilter=cF,p.NearestMipmapLinearFilter=hF,p.NearestMipmapNearestFilter=lF,p.NeverCompare=iG,p.NeverDepth=Uk,p.NeverStencilFunc=qN,p.NoBlending=dk,p.NoColorSpace=UN,p.NoToneMapping=Wk,p.NormalAnimationBlendMode=EN,p.NormalBlending=mk,p.NotEqualCompare=oG,p.NotEqualDepth=Qk,p.NotEqualStencilFunc=$N,p.NumberKeyframeTrack=Wl,p.OBJLoader2=ME,p.Object3D=It,p.Object3DWidgetsPlugin=jQ,p.ObjectLoader=vf,p.ObjectPicker=xx,p.ObjectSpaceNormalMap=LN,p.OctahedronGeometry=eo,p.OneFactor=Ck,p.OneMinusDstAlphaFactor=Rk,p.OneMinusDstColorFactor=Bk,p.OneMinusSrcAlphaFactor=Ik,p.OneMinusSrcColorFactor=Sk,p.OrbitControls=Z0,p.OrbitControls2=bL,p.OrthographicCamera=ua,p.PCFShadowMap=ak,p.PCFSoftShadowMap=ok,p.PLYLoadPlugin=Cz,p.PMREMGenerator=ZA,p.Pass=qp,p.Path=fp,p.PerspectiveCamera=Qi,p.PerspectiveCamera0=oE,p.PerspectiveCamera2=Oh,p.PhysicalMaterial=xa,p.PickingPlugin=fd,p.PipelinePassPlugin=wc,p.Plane=ks,p.PlaneGeometry=as,p.PlaneHelper=j2,p.PointLight=Kl,p.PointLightHelper=U2,p.PointLightHelper2=nE,p.PointerDragHelper=Pw,p.PointerLockControlsPlugin=gz,p.Points=Gl,p.PointsMaterial=da,p.PolarGridHelper=N2,p.PolyhedronGeometry=Yo,p.PopmotionPlugin=vd,p.PositionalAudio=f2,p.ProgressiveBlendPass=nM,p.PropertyBinding=Ht,p.PropertyMixer=Aw,p.QuadraticBezierCurve=gv,p.QuadraticBezierCurve3=Av,p.Quaternion=Ct,p.QuaternionKeyframeTrack=to,p.QuaternionLinearInterpolant=iw,p.RED_GREEN_RGTC2_Format=dN,p.RED_RGTC1_Format=uN,p.REVISION=Z3,p.RGBADepthPacking=DN,p.RGBAFormat=IF,p.RGBAIntegerFormat=FF,p.RGBA_ASTC_10x10_Format=oN,p.RGBA_ASTC_10x5_Format=nN,p.RGBA_ASTC_10x6_Format=sN,p.RGBA_ASTC_10x8_Format=aN,p.RGBA_ASTC_12x10_Format=lN,p.RGBA_ASTC_12x12_Format=cN,p.RGBA_ASTC_4x4_Format=KF,p.RGBA_ASTC_5x4_Format=JF,p.RGBA_ASTC_5x5_Format=ZF,p.RGBA_ASTC_6x5_Format=$F,p.RGBA_ASTC_6x6_Format=eN,p.RGBA_ASTC_8x5_Format=tN,p.RGBA_ASTC_8x6_Format=iN,p.RGBA_ASTC_8x8_Format=rN,p.RGBA_BPTC_Format=hN,p.RGBA_ETC2_EAC_Format=YF,p.RGBA_PVRTC_2BPPV1_Format=WF,p.RGBA_PVRTC_4BPPV1_Format=HF,p.RGBA_S3TC_DXT1_Format=GF,p.RGBA_S3TC_DXT3_Format=zF,p.RGBA_S3TC_DXT5_Format=QF,p.RGBEPNGLoader=_C,p.RGBM16ColorSpace=NN,p.RGB_ETC1_Format=XF,p.RGB_ETC2_Format=qF,p.RGB_PVRTC_2BPPV1_Format=jF,p.RGB_PVRTC_4BPPV1_Format=VF,p.RGB_S3TC_DXT1_Format=NF,p.RGFormat=OF,p.RGIntegerFormat=kF,p.RawShaderMaterial=Yb,p.Ray=Va,p.Raycaster=wf,p.RectAreaLight=gf,p.RedFormat=LF,p.RedIntegerFormat=UF,p.ReinhardToneMapping=qk,p.RenderPass=py,p.RenderTargetManager=bE,p.RepeatWrapping=nF,p.ReplaceStencilOp=QN,p.ReverseSubtractEquation=bk,p.Rhino3dmLoader2=eu,p.RingGeometry=of,p.SIGNED_RED_GREEN_RGTC2_Format=mN,p.SIGNED_RED_RGTC1_Format=pN,p.SRGBColorSpace=ON,p.SRGBToLinear=nR,p.STLLoadPlugin=Sz,p.Scene=Nl,p.SceneUiConfigPlugin=pM,p.SelectionWidget=J1,p.Serialization=$t,p.ShaderChunk=Ft,p.ShaderLib=Vi,p.ShaderMaterial=yr,p.ShaderMaterial2=cy,p.ShaderPass=dy,p.ShadowMaterial=qb,p.Shape=zl,p.ShapeGeometry=lf,p.ShapePath=X2,p.ShapeUtils=ma,p.ShortType=yF,p.SimpleEventDispatcher=jv,p.SimpleJSONExporter=NC,p.SimpleJSONLoader=Ay,p.SimpleTextExporter=GC,p.SimplifyModifierPlugin=bd,p.Skeleton=yh,p.SkeletonHelper=L2,p.SkinnedMesh=Nm,p.Source=Zr,p.Sphere=zr,p.SphereGeometry=Gs,p.Spherical=ic,p.SphericalHarmonics3=ow,p.SplineCurve=vv,p.SpotLight=Eh,p.SpotLightHelper=B2,p.SpotLightHelper2=aE,p.Sprite=Om,p.SpriteMaterial=ap,p.SrcAlphaFactor=Tk,p.SrcAlphaSaturateFactor=Lk,p.SrcColorFactor=Mk,p.StaticCopyUsage=gG,p.StaticDrawUsage=hG,p.StaticReadUsage=dG,p.StereoCamera=u2,p.StreamCopyUsage=vG,p.StreamDrawUsage=pG,p.StreamReadUsage=fG,p.StringKeyframeTrack=Xl,p.SubtractEquation=_k,p.SubtractiveBlending=gk,p.SwitchNodeBasePlugin=ZM,p.TOUCH=ek,p.TYPED_ARRAYS=Lw,p.TangentSpaceNormalMap=BN,p.TetrahedronGeometry=cf,p.Texture=Ti,p.TextureLoader=Ko,p.ThreeFirstPersonControlsPlugin=Az,p.ThreeSerialization=Kt,p.TorusGeometry=wh,p.TorusKnotGeometry=hf,p.TransformAnimationPlugin=cQ,p.TransformControls=ll,p.TransformControlsGizmo=W1,p.TransformControlsPlane=X1,p.Triangle=tn,p.TriangleFanDrawMode=TN,p.TriangleStripDrawMode=SN,p.TrianglesDrawMode=MN,p.TubeGeometry=uf,p.TwoPassDoubleSide=pk,p.USDZLoadPlugin=wz,p.UVMapping=Zk,p.UiConfigMethods=P1,p.UiConfigRendererBase=HB,p.UiConfigTypeMap=Th,p.Uint16BufferAttribute=ih,p.Uint32BufferAttribute=Ku,p.Uint8BufferAttribute=gA,p.Uint8ClampedBufferAttribute=AA,p.Uniform=bf,p.UniformsGroup=P2,p.UniformsLib=qe,p.UniformsUtils=Dn,p.UnlitLineMaterial=Xp,p.UnlitMaterial=kh,p.UnsignedByteType=AF,p.UnsignedInt248Type=SF,p.UnsignedIntType=wF,p.UnsignedShort4444Type=CF,p.UnsignedShort5551Type=MF,p.UnsignedShortType=_F,p.Unzip=BU,p.UnzipInflate=RU,p.UnzipPassThrough=uC,p.Unzlib=xg,p.VSMShadowMap=lk,p.Vector2=ne,p.Vector3=P,p.Vector4=bt,p.VectorKeyframeTrack=ql,p.VideoTexture=bP,p.ViewHelper2=T0,p.ViewerUiConfigPlugin=hM,p.WebGL1Renderer=ub,p.WebGL3DRenderTarget=hA,p.WebGLArrayRenderTarget=Ga,p.WebGLCoordinateSystem=wG,p.WebGLCubeRenderTarget=oh,p.WebGLMultipleRenderTargets=rm,p.WebGLRenderTarget=Gr,p.WebGLRenderer=sp,p.WebGLUtils=cb,p.WebGPUCoordinateSystem=xG,p.WireframeGeometry=pf,p.WrapAroundEnding=xN,p.ZeroCurvatureEnding=bN,p.ZeroFactor=Ek,p.ZeroSlopeEnding=wN,p.ZeroStencilOp=GN,p.Zip=IU,p.ZipDeflate=SU,p.ZipLoader=pC,p.ZipPassThrough=nd,p.Zlib=Uy,p._SRGBAFormat=bG,p._testFinish=a5,p._testStart=o5,p.absMax=rx,p.aesGcmDecrypt=Jw,p.aesGcmEncrypt=Kw,p.animate=j0,p.animateAsync=b1,p.animateCameraToViewLinear=x1,p.animateCameraToViewSpherical=w1,p.animateTarget=DB,p.arrayBufferToBase64=If,p.autoCenterObject3D=l5,p.autoGPUInstanceMeshes=Ex,p.autoScaleObject3D=c5,p.base64ToArrayBuffer=Hv,p.bindToValue=Tp,p.blobToDataURL=Xv,p.blobToImage=vR,p.cLinearToRGBM=LB,p.cRGBMToLinear=BB,p.canvasFlipY=Zv,p.clearBit=CR,p.cloneScriptTag=Bw,p.colorToDataUrl=sR,p.compress=JE,p.compressSync=yg,p.computeMikkTSpaceTangents=YR,p.computeMorphedAttributes=eD,p.computeScreenSpaceBoundingBox=p0,p.convertArrayBufferToStringsInMeta=c0,p.convertStringsToArrayBuffersInMeta=hx,p.copyMaterialUserData=l0,p.copyObject3DUserData=Df,p.copyProps=jw,p.copyTextureUserData=o0,p.copyUserData=Mp,p.createCanvasElement=Rw,p.createDiv=$o,p.createImage=Dw,p.createRenderTargetKey=_E,p.createScriptFromURL=q2,p.createStyles=Mh,p.css=kw,p.dataTextureFromColor=HR,p.dataTextureFromVec4=WR,p.decompress=xU,p.decompressSync=EU,p.deepAccessObject=oR,p.deepCloneAttribute=KR,p.deflate=YE,p.deflateSync=id,p.deinterleaveAttribute=kf,p.deinterleaveGeometry=ZR,p.downloadBlob=Cp,p.downloadFile=Nw,p.embedUrlRefs=wR,p.escapeRegExp=Ow,p.estimateBytesUsed=$R,p.findLastIndex=Ww,p.generateUUID=hs,p.generateUiConfig=Ih,p.generateUiFolder=Zf,p.generateValueConfig=Y0,p.getEmptyMeta=nc,p.getEncodingComponents=d0,p.getFileHandle=cR,p.getFilenameFromPath=Z2,p.getKeyByValue=lR,p.getNewFileHandle=hR,p.getOrCall=sr,p.getPropertyDescriptor=Qw,p.getTexelDecoding=g0,p.getTexelDecoding2=XR,p.getTexelDecodingFunction=f0,p.getTexelEncoding=qR,p.getTexelEncodingFunction=yx,p.getTextureColorSpaceFromMap=m0,p.getTextureDataType=s0,p.getTypedArray=Uw,p.getUrlQueryParam=SR,p.glbEncryptionPreparser=xC,p.glbEncryptionProcessor=wC,p.glsl=ro,p.gunzip=$E,p.gunzipSync=bg,p.gzip=JE,p.gzipSync=yg,p.halfFloatToRgbe=vx,p.html=tR,p.htmlToCanvas=xR,p.htmlToPng=ER,p.htmlToSvg=e0,p.iCameraCommons=Un,p.iGeometryCommons=Ln,p.iLightCommons=_r,p.iMaterialCommons=Qe,p.iObjectCommons=Wt,p.imageBitmapToBase64=Zw,p.imageBitmapToBlob=fR,p.imageBitmapToCanvas=Jv,p.imageDataToCanvas=gR,p.imageToCanvas=ex,p.imageUrlToImageData=$w,p.includesAll=Hw,p.inflate=Ly,p.inflateSync=Kh,p.interleaveAttributes=JR,p.isInScene=Sh,p.isPropertyWritable=Vw,p.isWebpExportSupported=AR,p.jsonToBlob=u0,p.lerp=Jf,p.lerpAngle=W0,p.localToWorldQuaternion=sD,p.longestCommonPrefix=eR,p.makeColorSvg=yR,p.makeColorSvgCircle=tx,p.makeGLBFile=gx,p.makeSamplerUi=Hi,p.makeSetterFor=H0,p.makeTextSvg=_R,p.matDefine=Uf,p.matDefineBool=Sp,p.mergeAttributes=Of,p.mergeBufferAttributes=nD,p.mergeBufferGeometries=rD,p.mergeGeometries=_x,p.mergeGroups=tD,p.mergeVertices=bx,p.metaFromResources=h0,p.metaToResources=Lf,p.mobileAndTabletCheck=rR,p.now=nn,p.objectHasOwn=An,p.objectMap=qw,p.objectMap2=qv,p.onChange=st,p.onChange2=Ir,p.onChange3=yi,p.onChangeDispatchEvent=Yw,p.overrideThreeCache=Ax,p.parseFileExtension=Wv,p.pathJoin=IR,p.prettyScrollbar=iR,p.readFile=uR,p.remoteWorkerURL=PR,p.replaceAll=sn,p.sRGBEncoding=PN,p.safeReplaceString=$2,p.safeSetProperty=el,p.serializable=Kv,p.serialize=$,p.serializeTextureInExtras=ux,p.setInnerHTMLWithScripts=Y2,p.setThreeRendererMode=JL,p.setUrlQueryParam=TR,p.shaderReplaceString=ri,p.shaderUtils=i0,p.snapObject=w0,p.sortPasses=gE,p.sphericalFromCameraView=X0,p.strFromU8=rd,p.strToU8=pl,p.svgToCanvas=$v,p.svgToPng=ix,p.svgUrl=Fw,p.texImageToCanvas=cx,p.textureDataToImageData=a0,p.textureToBlob=kR,p.textureToCanvas=Pf,p.textureToDataUrl=OR,p.threeConstMappings=y0,p.timeout=cs,p.toCamelCase=J2,p.toCreasedNormals=iD,p.toIndexedGeometry=v0,p.toTitleCase=K2,p.toTrianglesDrawMode=A0,p.uiButton=ci,p.uiColor=Hs,p.uiConfig=ur,p.uiConfigMaterialExtension=k1,p.uiContainer=K0,p.uiDropdown=js,p.uiFolderContainer=ti,p.uiImage=_a,p.uiInput=Lt,p.uiMonitor=lc,p.uiNumber=vn,p.uiPanelContainer=Xr,p.uiSlider=Rt,p.uiToggle=De,p.uiVector=an,p.uniform=tl,p.unzip=LU,p.unzipSync=Ny,p.unzlib=tC,p.unzlibSync=co,p.updateBit=t0,p.updateMaterialDefines=al,p.upgradeTexture=hy,p.upgradeWebGLRenderer=uE,p.uploadFile=Gw,p.uuidV4=MR,p.vLinearToRGBM=C1,p.vRGBMToLinear=E1,p.verifyPermission=mR,p.windowDialogWrapper=nx,p.worldToLocalQuaternion=wx,p.wrapThisFunction=aR,p.wrapThisFunction2=Xw,p.writeFile=dR,p.zip=PU,p.zipSync=hC,p.zlib=bU,p.zlibSync=wg,Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})})})(U_,U_.exports);var Tt=U_.exports;/**
 * @license
 * @threepipe/plugin-tweakpane v0.4.1
 * Copyright 2022-2024 repalash <palash@shaders.app>
 * Apache-2.0 License
 * See ./dependencies.txt for any bundled third-party dependencies and licenses.
 */function aS(ee,D,p,K){var W,re=arguments.length,ue=re<3?D:K;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")ue=Reflect.decorate(ee,D,p,K);else for(var de=ee.length-1;de>=0;de--)(W=ee[de])&&(ue=(re<3?W(ue):re>3?W(D,p,ue):W(D,p))||ue);return re>3&&ue&&Object.defineProperty(D,p,ue),ue}const u5="tp";function vo(ee){return D=>p=>{if(!D&&p===void 0)return{succeeded:!1,value:void 0};if(D&&p===void 0)return{succeeded:!0,value:void 0};const K=ee(p);return K!==void 0?{succeeded:!0,value:K}:{succeeded:!1,value:void 0}}}function oS(ee){return{custom:D=>vo(D)(ee),boolean:vo(D=>typeof D=="boolean"?D:void 0)(ee),number:vo(D=>typeof D=="number"?D:void 0)(ee),string:vo(D=>typeof D=="string"?D:void 0)(ee),function:vo(D=>typeof D=="function"?D:void 0)(ee),constant:D=>vo(p=>p===D?D:void 0)(ee),raw:vo(D=>D)(ee),object:D=>vo(p=>{var K;if((K=p)!==null&&typeof K=="object")return function(W,re){return Object.keys(re).reduce((ue,de)=>{if(ue===void 0)return;const ve=(0,re[de])(W[de]);return ve.succeeded?Object.assign(Object.assign({},ue),{[de]:ve.value}):void 0},{})}(p,D)})(ee),array:D=>vo(p=>{var K;if(Array.isArray(p))return K=D,p.reduce((W,re)=>{if(W===void 0)return;const ue=K(re);return ue.succeeded&&ue.value!==void 0?[...W,ue.value]:void 0},[])})(ee)}}const lS={optional:oS(!0),required:oS(!1)};function cu(ee){return D=>D.toFixed(Math.max(Math.min(ee,20),0))}function bS(ee){return[ee[0],ee[1],ee[2]]}function p5(ee){return D=>function(p,K){const W=cu(K==="float"?2:0);return`rgb(${bS(p.getComponents("rgb",K)).map(re=>W(re)).join(", ")})`}(D,ee)}function d5(ee){return D=>function(p,K){const W=cu(2),re=cu(K==="float"?2:0);return`rgba(${p.getComponents("rgb",K).map((ue,de)=>(de===3?W:re)(ue)).join(", ")})`}(D,ee)}function m5(ee){return D=>function(p,K){const W=cu(K==="float"?2:0),re=["r","g","b"];return`{${bS(p.getComponents("rgb",K)).map((ue,de)=>`${re[de]}: ${W(ue)}`).join(", ")}}`}(D,ee)}function f5(ee){return D=>function(p,K){const W=cu(2),re=cu(K==="float"?2:0),ue=["r","g","b","a"];return`{${p.getComponents("rgb",K).map((de,ve)=>`${ue[ve]}: ${(ve===3?W:re)(de)}`).join(", ")}}`}(D,ee)}function cS(ee){const D=new Image;return D.crossOrigin="anonymous",D.src=ee,D}["int","float"].reduce((ee,D)=>[...ee,{format:{alpha:!1,mode:"rgb",notation:"func",type:D},stringifier:p5(D)},{format:{alpha:!0,mode:"rgb",notation:"func",type:D},stringifier:d5(D)},{format:{alpha:!1,mode:"rgb",notation:"object",type:D},stringifier:m5(D)},{format:{alpha:!0,mode:"rgb",notation:"object",type:D},stringifier:f5(D)}],[]);const Sc=(hS="img",(ee,D)=>[u5,"-",hS,"v",ee?`_${ee}`:"",D?`-${D}`:""].join(""));var hS;class g5{constructor(D,p){this.element=D.createElement("div"),this.element.classList.add(Sc()),p.viewProps.bindClassModifiers(this.element),this.input=D.createElement("input"),this.input.classList.add(Sc("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",p.extensions.join(",")),this.image_=D.createElement("img"),this.image_.id="tpimg_"+Math.random().toString(36).slice(2),this.image_.classList.add(Sc("image")),this.image_.classList.add(Sc(`image_${p.imageFit}`)),this.image_.crossOrigin="anonymous",this.image_.onclick=K=>{p.clickCallback?p.clickCallback(K,this.input):this.input.click()},this.element.classList.add(Sc("area_root")),this.element.appendChild(this.image_),this.element.appendChild(this.input)}changeImage(D){this.image_.src=D}changeDraggingState(D){const p=this.element;D?p==null||p.classList.add(Sc("area_dragging")):p==null||p.classList.remove(Sc("area_dragging"))}}let L_=null;class A5{constructor(D,p){this.value=p.value,this.viewProps=p.viewProps,this.view=new g5(D,{viewProps:this.viewProps,extensions:p.extensions,imageFit:p.imageFit,clickCallback:p.clickCallback}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragStart=this.onDragStart.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragstart",this.onDragStart),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose(()=>{this.view.input.removeEventListener("change",this.onFile),this.view.element.removeEventListener("drop",this.onDrop),this.view.element.removeEventListener("dragstart",this.onDragStart),this.view.element.removeEventListener("dragover",this.onDragOver),this.view.element.removeEventListener("dragleave",this.onDragLeave)}),this.value.emitter.on("change",()=>this.handleValueChange()),this.handleValueChange()}onFile(D){const p=(D==null?void 0:D.target).files;if(!p||!p.length)return;const K=p[0];this.setValue(K)}onDrop(D){D.preventDefault();try{const{dataTransfer:p}=D,K=p==null?void 0:p.files[0];if(K)this.setValue(K);else{const W=p==null?void 0:p.getData("img-id");if(W){const re=document.getElementById(W);this.setValue(re)}else{const re=p==null?void 0:p.getData("url");if(!re)throw new Error("No url");this.setValue(re)}}}catch(p){console.error("Could not parse the dropped image",p)}finally{this.view.changeDraggingState(!1)}}onDragStart(D){var p,K;(p=D.dataTransfer)===null||p===void 0||p.setData("img-id",this.view.image_.id),(K=D.dataTransfer)===null||K===void 0||K.setDragImage(this.view.image_,0,0)}onDragOver(D){D.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(D){D instanceof HTMLImageElement?this.updateImage(D.src):typeof D!="string"&&D?this.setValue(D):(D!=="placeholder"&&D||(D=this.handlePlaceholderImage().src),this.updateImage(D))}updateImage(D){this.view.changeImage(D)}setValue(D){if(D instanceof HTMLImageElement)this.value.setRawValue(D);else if(D instanceof File){const p=URL.createObjectURL(D)+"#"+D.name;D.src=p;const K=cS(p);this.value.setRawValue(K||D)}else D?this.value.setRawValue(cS(D)):this.value.setRawValue(this.handlePlaceholderImage())}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return L_||(L_=function(){const D=document.createElement("canvas");D.width=320,D.height=50;const p=D.getContext("2d");p.fillStyle="#00000004",p.fillRect(0,0,D.width,D.height),p.fillStyle="#eee",p.font='1.25rem "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace',p.textAlign="center",p.textBaseline="middle",p.fillText("No image",.5*D.width,.5*D.height);const K=new Image;return K.src=D.toDataURL("image/png",.8),K.isPlaceholder=!0,K}()),L_}}const v5=[".jpg",".png",".gif"],y5={id:"input-image",type:"input",css:".tp-imgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-imgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-imgv:hover{background-color:var(--in-bg-h)}.tp-imgv:focus{background-color:var(--in-bg-f)}.tp-imgv:active{background-color:var(--in-bg-a)}.tp-imgv:disabled{opacity:.5}:root{--tp-plugin-image-dragging-color: hsla(230, 100%, 66%, 1.00)}.tp-imgv{cursor:pointer;display:inline-flex;height:auto !important;max-height:calc(var(--bld-us)*3);border-radius:4px;position:relative}.tp-imgv.tp-v-disabled{opacity:.5}.tp-imgv_input{width:0;height:0;pointer-events:none;visibility:hidden}.tp-imgv_image{width:100%;height:-moz-max-content;height:max-content;max-height:calc(var(--bld-us)*3);border:0}.tp-imgv_image_contain{-o-object-fit:contain;object-fit:contain}.tp-imgv_image_cover{-o-object-fit:cover;object-fit:cover}.tp-imgv_area_root{transition:opacity .16s ease-in-out}.tp-imgv_area_dragging{border:2px dashed var(--tp-plugin-image-dragging-color);border-radius:4px;opacity:.6}",accept(ee,D){if(!(ee instanceof HTMLImageElement||typeof ee=="string"))return null;const p=lS,K=function(W,re){const ue=lS.required.object(re)(W);return ue.succeeded?ue.value:void 0}(D,{view:p.required.constant("input-image"),acceptUrl:p.optional.boolean,clickCallback:p.optional.function,imageFit:p.optional.custom(W=>W==="contain"||W==="cover"?W:void 0),extensions:p.optional.array(p.required.string)});return K?{initialValue:ee,params:K}:null},binding:{reader:ee=>D=>D.src!==void 0?D.src===""?"placeholder":D.src:D,writer:ee=>(D,p)=>{D.write(p)}},controller(ee){var D,p;return new A5(ee.document,{value:ee.value,imageFit:(D=ee.params.imageFit)!==null&&D!==void 0?D:"cover",clickCallback:ee.params.clickCallback,viewProps:ee.viewProps,extensions:(p=ee.params.extensions)!==null&&p!==void 0?p:v5})}};var _5=Object.freeze({__proto__:null,plugin:y5});/**
 * @license
 * uiconfig-tweakpane v0.0.8
 * Copyright 2022-2023 repalash <palash@shaders.app>
 * MIT License
 *//**
 * @license
 * ts-browser-helpers v0.5.0
 * Copyright 2022-2023 repalash <palash@shaders.app>
 * MIT License
 */const b5=(ee,...D)=>String.raw({raw:ee},...D);function w5(ee,D,p=!0,K=!1){const W=function(re,ue){let de;do de=Object.getOwnPropertyDescriptor(re,ue);while(!de&&(re=Object.getPrototypeOf(re)));return de}(ee,D);return!!(W!=null&&W.set)||p&&(W==null?void 0:W.writable)!==!1&&(W==null?void 0:W.get)===void 0||K&&!W}function Zs(ee,...D){return typeof ee=="function"&&(ee=ee(...D)),ee}var wS={};(function(ee){class D{constructor(u){const[g,x]=u.split("-"),O=g.split(".");this.major=parseInt(O[0],10),this.minor=parseInt(O[1],10),this.patch=parseInt(O[2],10),this.prerelease=x??null}toString(){const u=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[u,this.prerelease].join("-"):u}}class p{constructor(u){this.controller_=u}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(u){this.controller_.viewProps.set("disabled",u)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(u){this.controller_.viewProps.set("hidden",u)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class K{constructor(u){this.target=u}}class W extends K{constructor(u,g,x,O){super(u),this.value=g,this.presetKey=x,this.last=O==null||O}}class re extends K{constructor(u,g,x){super(u),this.value=g,this.presetKey=x}}class ue extends K{constructor(u,g){super(u),this.expanded=g}}class de extends K{constructor(u,g){super(u),this.index=g}}function ve(A){return A}function Ze(A){return A==null}function Xe(A,u){if(A.length!==u.length)return!1;for(let g=0;g<A.length;g++)if(A[g]!==u[g])return!1;return!0}function tt(A,u){let g=A;do{const x=Object.getOwnPropertyDescriptor(g,u);if(x&&(x.set!==void 0||x.writable===!0))return!0;g=Object.getPrototypeOf(g)}while(g!==null);return!1}const vi={alreadydisposed:()=>"View has been already disposed",invalidparams:A=>`Invalid parameters for '${A.name}'`,nomatchingcontroller:A=>`No matching controller for '${A.key}'`,nomatchingview:A=>`No matching view for '${JSON.stringify(A.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:A=>`Property '${A.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class yt{static alreadyDisposed(){return new yt({type:"alreadydisposed"})}static notBindable(){return new yt({type:"notbindable"})}static propertyNotFound(u){return new yt({type:"propertynotfound",context:{name:u}})}static shouldNeverHappen(){return new yt({type:"shouldneverhappen"})}constructor(u){var g;this.message=(g=vi[u.type](u.context))!==null&&g!==void 0?g:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=u.type}}class zt{constructor(u,g,x){this.obj_=u,this.key_=g,this.presetKey_=x??g}static isBindable(u){return u!==null&&(typeof u=="object"||typeof u=="function")}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(u){this.obj_[this.key_]=u}writeProperty(u,g){const x=this.read();if(!zt.isBindable(x))throw yt.notBindable();if(!(u in x))throw yt.propertyNotFound(u);x[u]=g}}class _t extends p{get label(){return this.controller_.props.get("label")}set label(u){this.controller_.props.set("label",u)}get title(){var u;return(u=this.controller_.valueController.props.get("title"))!==null&&u!==void 0?u:""}set title(u){this.controller_.valueController.props.set("title",u)}on(u,g){const x=g.bind(this);return this.controller_.valueController.emitter.on(u,()=>{x(new K(this))}),this}}class Nt{constructor(){this.observers_={}}on(u,g){let x=this.observers_[u];return x||(x=this.observers_[u]=[]),x.push({handler:g}),this}off(u,g){const x=this.observers_[u];return x&&(this.observers_[u]=x.filter(O=>O.handler!==g)),this}emit(u,g){const x=this.observers_[u];x&&x.forEach(O=>{O.handler(g)})}}const Ci="tp";function Ie(A){return(u,g)=>[Ci,"-",A,"v",u?`_${u}`:"",g?`-${g}`:""].join("")}function $e(A,u){return g=>u(A(g))}function dt(A){return A.rawValue}function Qt(A,u){A.emitter.on("change",$e(dt,u)),u(A.rawValue)}function ii(A,u,g){Qt(A.value(u),g)}function Oi(A,u,g){g?A.classList.add(u):A.classList.remove(u)}function Si(A,u){return g=>{Oi(A,u,g)}}function Rr(A,u){Qt(A,g=>{u.textContent=g??""})}const $s=Ie("btn");class Da{constructor(u,g){this.element=u.createElement("div"),this.element.classList.add($s()),g.viewProps.bindClassModifiers(this.element);const x=u.createElement("button");x.classList.add($s("b")),g.viewProps.bindDisabled(x),this.element.appendChild(x),this.buttonElement=x;const O=u.createElement("div");O.classList.add($s("t")),Rr(g.props.value("title"),O),this.buttonElement.appendChild(O)}}class Td{constructor(u,g){this.emitter=new Nt,this.onClick_=this.onClick_.bind(this),this.props=g.props,this.viewProps=g.viewProps,this.view=new Da(u,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class jg{constructor(u,g){var x;this.constraint_=g==null?void 0:g.constraint,this.equals_=(x=g==null?void 0:g.equals)!==null&&x!==void 0?x:(O,H)=>O===H,this.emitter=new Nt,this.rawValue_=u}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(u){this.setRawValue(u,{forceEmit:!1,last:!0})}setRawValue(u,g){const x=g??{forceEmit:!1,last:!0},O=this.constraint_?this.constraint_.constrain(u):u,H=this.rawValue_;(!this.equals_(H,O)||x.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=O,this.emitter.emit("change",{options:x,previousRawValue:H,rawValue:O,sender:this}))}}class Id{constructor(u){this.emitter=new Nt,this.value_=u}get rawValue(){return this.value_}set rawValue(u){this.setRawValue(u,{forceEmit:!1,last:!0})}setRawValue(u,g){const x=g??{forceEmit:!1,last:!0},O=this.value_;(O!==u||x.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=u,this.emitter.emit("change",{options:x,previousRawValue:O,rawValue:this.value_,sender:this}))}}function gr(A,u){const g=u==null?void 0:u.constraint,x=u==null?void 0:u.equals;return g||x?new jg(A,u):new Id(A)}class Vt{constructor(u){this.emitter=new Nt,this.valMap_=u;for(const g in this.valMap_)this.valMap_[g].emitter.on("change",()=>{this.emitter.emit("change",{key:g,sender:this})})}static createCore(u){return Object.keys(u).reduce((g,x)=>Object.assign(g,{[x]:gr(u[x])}),{})}static fromObject(u){const g=this.createCore(u);return new Vt(g)}get(u){return this.valMap_[u].rawValue}set(u,g){this.valMap_[u].rawValue=g}value(u){return this.valMap_[u]}}function Hg(A,u){return Object.keys(u).reduce((g,x)=>{if(g===void 0)return;const O=(0,u[x])(A[x]);return O.succeeded?Object.assign(Object.assign({},g),{[x]:O.value}):void 0},{})}function Wg(A,u){return A.reduce((g,x)=>{if(g===void 0)return;const O=u(x);return O.succeeded&&O.value!==void 0?[...g,O.value]:void 0},[])}function Xg(A){return A!==null&&typeof A=="object"}function Fn(A){return u=>g=>{if(!u&&g===void 0)return{succeeded:!1,value:void 0};if(u&&g===void 0)return{succeeded:!0,value:void 0};const x=A(g);return x!==void 0?{succeeded:!0,value:x}:{succeeded:!1,value:void 0}}}function Ic(A){return{custom:u=>Fn(u)(A),boolean:Fn(u=>typeof u=="boolean"?u:void 0)(A),number:Fn(u=>typeof u=="number"?u:void 0)(A),string:Fn(u=>typeof u=="string"?u:void 0)(A),function:Fn(u=>typeof u=="function"?u:void 0)(A),constant:u=>Fn(g=>g===u?u:void 0)(A),raw:Fn(u=>u)(A),object:u=>Fn(g=>{if(Xg(g))return Hg(g,u)})(A),array:u=>Fn(g=>{if(Array.isArray(g))return Wg(g,u)})(A)}}const Ri={optional:Ic(!0),required:Ic(!1)};function xr(A,u){const g=Ri.required.object(u)(A);return g.succeeded?g.value:void 0}function hu(A){console.warn([`Missing '${A.key}' of ${A.target} in ${A.place}.`,"Please rebuild plugins with the latest core package."].join(" "))}function qg(A){return A&&A.parentElement&&A.parentElement.removeChild(A),null}class uu{constructor(u){this.value_=u}static create(u){return[new uu(u),(g,x)=>{u.setRawValue(g,x)}]}get emitter(){return this.value_.emitter}get rawValue(){return this.value_.rawValue}}const Pd=Ie("");function pu(A,u){return Si(A,Pd(void 0,u))}class Zn extends Vt{constructor(u){var g;super(u),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=uu.create(gr(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(g=this.get("parent"))===null||g===void 0||g.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(u){var g,x,O;const H=u??{};return new Zn(Vt.createCore({disabled:(g=H.disabled)!==null&&g!==void 0&&g,disposed:!1,hidden:(x=H.hidden)!==null&&x!==void 0&&x,parent:(O=H.parent)!==null&&O!==void 0?O:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(u){Qt(this.globalDisabled_,pu(u,"disabled")),ii(this,"hidden",pu(u,"hidden"))}bindDisabled(u){Qt(this.globalDisabled_,g=>{u.disabled=g})}bindTabIndex(u){Qt(this.globalDisabled_,g=>{u.tabIndex=g?-1:0})}handleDispose(u){this.value("disposed").emitter.on("change",g=>{g&&u()})}getGlobalDisabled_(){const u=this.get("parent");return!!u&&u.globalDisabled.rawValue||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(u){var g;const x=u.previousRawValue;x==null||x.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(g=this.get("parent"))===null||g===void 0||g.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}function gl(){return["veryfirst","first","last","verylast"]}const du=Ie(""),mu={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class _o{constructor(u){this.parent_=null,this.blade=u.blade,this.view=u.view,this.viewProps=u.viewProps;const g=this.view.element;this.blade.value("positions").emitter.on("change",()=>{gl().forEach(x=>{g.classList.remove(du(void 0,mu[x]))}),this.blade.get("positions").forEach(x=>{g.classList.add(du(void 0,mu[x]))})}),this.viewProps.handleDispose(()=>{qg(g)})}get parent(){return this.parent_}set parent(u){this.parent_=u,"parent"in this.viewProps.valMap_?this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null):hu({key:"parent",target:Zn.name,place:"BladeController.parent"})}}const Nn="http://www.w3.org/2000/svg";function vs(A){A.offsetHeight}function Yg(A,u){const g=A.style.transition;A.style.transition="none",u(),A.style.transition=g}function fu(A){return A.ontouchstart!==void 0}function $n(){return globalThis}function Rd(){return $n().document}function Dd(A){const u=A.ownerDocument.defaultView;return u&&"document"in u?A.getContext("2d",{willReadFrequently:!0}):null}const Bd={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function bo(A,u){const g=A.createElementNS(Nn,"svg");return g.innerHTML=Bd[u],g}function gu(A,u,g){A.insertBefore(u,A.children[g])}function wo(A){A.parentElement&&A.parentElement.removeChild(A)}function ys(A){for(;A.children.length>0;)A.removeChild(A.children[0])}function Ba(A){for(;A.childNodes.length>0;)A.removeChild(A.childNodes[0])}function _s(A){return A.relatedTarget?A.relatedTarget:"explicitOriginalTarget"in A?A.explicitOriginalTarget:null}const ea=Ie("lbl");function xo(A,u){const g=A.createDocumentFragment();return u.split(`
`).map(x=>A.createTextNode(x)).forEach((x,O)=>{O>0&&g.appendChild(A.createElement("br")),g.appendChild(x)}),g}class Ar{constructor(u,g){this.element=u.createElement("div"),this.element.classList.add(ea()),g.viewProps.bindClassModifiers(this.element);const x=u.createElement("div");x.classList.add(ea("l")),ii(g.props,"label",H=>{Ze(H)?this.element.classList.add(ea(void 0,"nol")):(this.element.classList.remove(ea(void 0,"nol")),Ba(x),x.appendChild(xo(u,H)))}),this.element.appendChild(x),this.labelElement=x;const O=u.createElement("div");O.classList.add(ea("v")),this.element.appendChild(O),this.valueElement=O}}class ai extends _o{constructor(u,g){const x=g.valueController.viewProps;super(Object.assign(Object.assign({},g),{view:new Ar(u,{props:g.props,viewProps:x}),viewProps:x})),this.props=g.props,this.valueController=g.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const bs={id:"button",type:"blade",accept(A){const u=Ri,g=xr(A,{title:u.required.string,view:u.required.constant("button"),label:u.optional.string});return g?{params:g}:null},controller:A=>new ai(A.document,{blade:A.blade,props:Vt.fromObject({label:A.params.label}),valueController:new Td(A.document,{props:Vt.fromObject({title:A.params.title}),viewProps:A.viewProps})}),api:A=>A.controller instanceof ai&&A.controller.valueController instanceof Td?new _t(A.controller):null};class Ai extends _o{constructor(u){super(u),this.value=u.value}}function es(){return new Vt({positions:gr([],{equals:Xe})})}class Gn extends Vt{constructor(u){super(u)}static create(u){const g={completed:!0,expanded:u,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},x=Vt.createCore(g);return new Gn(x)}get styleExpanded(){var u;return(u=this.get("temporaryExpanded"))!==null&&u!==void 0?u:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const u=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Ze(u)?`${u}px`:"auto"}bindExpandedClass(u,g){const x=()=>{this.styleExpanded?u.classList.add(g):u.classList.remove(g)};ii(this,"expanded",x),ii(this,"temporaryExpanded",x)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function Et(A,u){let g=0;return Yg(u,()=>{A.set("expandedHeight",null),A.set("temporaryExpanded",!0),vs(u),g=u.clientHeight,A.set("temporaryExpanded",null),vs(u)}),g}function Eo(A,u){u.style.height=A.styleHeight}function Er(A,u){A.value("expanded").emitter.on("beforechange",()=>{if(A.set("completed",!1),Ze(A.get("expandedHeight"))){const g=Et(A,u);g>0&&A.set("expandedHeight",g)}A.set("shouldFixHeight",!0),vs(u)}),A.emitter.on("change",()=>{Eo(A,u)}),Eo(A,u),u.addEventListener("transitionend",g=>{g.propertyName==="height"&&A.cleanUpTransition()})}class Al extends p{constructor(u,g){super(u),this.rackApi_=g}}function oi(A,u){return A.addBlade(Object.assign(Object.assign({},u),{view:"button"}))}function Ld(A,u){return A.addBlade(Object.assign(Object.assign({},u),{view:"folder"}))}function Ud(A,u){const g=u??{};return A.addBlade(Object.assign(Object.assign({},g),{view:"separator"}))}function Pc(A,u){return A.addBlade(Object.assign(Object.assign({},u),{view:"tab"}))}class vl{constructor(u){this.emitter=new Nt,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=u}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(u){for(const g of this.allItems())if(u(g))return g;return null}includes(u){return this.cache_.has(u)}add(u,g){if(this.includes(u))throw yt.shouldNeverHappen();const x=g!==void 0?g:this.items_.length;this.items_.splice(x,0,u),this.cache_.add(u);const O=this.extract_(u);O&&(O.emitter.on("add",this.onSubListAdd_),O.emitter.on("remove",this.onSubListRemove_),O.allItems().forEach(H=>{this.cache_.add(H)})),this.emitter.emit("add",{index:x,item:u,root:this,target:this})}remove(u){const g=this.items_.indexOf(u);if(g<0)return;this.items_.splice(g,1),this.cache_.delete(u);const x=this.extract_(u);x&&(x.emitter.off("add",this.onSubListAdd_),x.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:g,item:u,root:this,target:this})}onSubListAdd_(u){this.cache_.add(u.item),this.emitter.emit("add",{index:u.index,item:u.item,root:this,target:u.target})}onSubListRemove_(u){this.cache_.delete(u.item),this.emitter.emit("remove",{index:u.index,item:u.item,root:this,target:u.target})}}class un extends p{constructor(u){super(u),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new Nt,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(u){this.controller_.props.set("label",u)}on(u,g){const x=g.bind(this);return this.emitter_.on(u,O=>{x(O.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(u){const g=u.sender.target.read();this.emitter_.emit("change",{event:new W(this,g,this.controller_.binding.target.presetKey,u.options.last)})}}class qt extends ai{constructor(u,g){super(u,g),this.binding=g.binding}}class di extends p{constructor(u){super(u),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new Nt,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(u){this.controller_.props.set("label",u)}on(u,g){const x=g.bind(this);return this.emitter_.on(u,O=>{x(O.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(u){const g=u.sender.target.read();this.emitter_.emit("update",{event:new re(this,g,this.controller_.binding.target.presetKey)})}}class ts extends ai{constructor(u,g){super(u,g),this.binding=g.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function Au(A){return A instanceof mi?A.apiSet_:A instanceof Al?A.rackApi_.apiSet_:null}function En(A,u){const g=A.find(x=>x.controller_===u);if(!g)throw yt.shouldNeverHappen();return g}function Od(A,u,g){if(!zt.isBindable(A))throw yt.notBindable();return new zt(A,u,g)}class mi extends p{constructor(u,g){super(u),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new Nt,this.apiSet_=new vl(Au),this.pool_=g;const x=this.controller_.rack;x.emitter.on("add",this.onRackAdd_),x.emitter.on("remove",this.onRackRemove_),x.emitter.on("inputchange",this.onRackInputChange_),x.emitter.on("monitorupdate",this.onRackMonitorUpdate_),x.children.forEach(O=>{this.setUpApi_(O)})}get children(){return this.controller_.rack.children.map(u=>En(this.apiSet_,u))}addInput(u,g,x){const O=x??{},H=this.controller_.view.element.ownerDocument,ce=this.pool_.createInput(H,Od(u,g,O.presetKey),O),We=new un(ce);return this.add(We,O.index)}addMonitor(u,g,x){const O=x??{},H=this.controller_.view.element.ownerDocument,ce=this.pool_.createMonitor(H,Od(u,g),O),We=new di(ce);return this.add(We,O.index)}addFolder(u){return Ld(this,u)}addButton(u){return oi(this,u)}addSeparator(u){return Ud(this,u)}addTab(u){return Pc(this,u)}add(u,g){this.controller_.rack.add(u.controller_,g);const x=this.apiSet_.find(O=>O.controller_===u.controller_);return x&&this.apiSet_.remove(x),this.apiSet_.add(u),u}remove(u){this.controller_.rack.remove(u.controller_)}addBlade(u){const g=this.controller_.view.element.ownerDocument,x=this.pool_.createBlade(g,u),O=this.pool_.createBladeApi(x);return this.add(O,u.index)}on(u,g){const x=g.bind(this);return this.emitter_.on(u,O=>{x(O.event)}),this}setUpApi_(u){this.apiSet_.find(g=>g.controller_===u)||this.apiSet_.add(this.pool_.createBladeApi(u))}onRackAdd_(u){this.setUpApi_(u.bladeController)}onRackRemove_(u){if(u.isRoot){const g=En(this.apiSet_,u.bladeController);this.apiSet_.remove(g)}}onRackInputChange_(u){const g=u.bladeController;if(g instanceof qt){const x=En(this.apiSet_,g),O=g.binding;this.emitter_.emit("change",{event:new W(x,O.target.read(),O.target.presetKey,u.options.last)})}else if(g instanceof Ai){const x=En(this.apiSet_,g);this.emitter_.emit("change",{event:new W(x,g.value.rawValue,void 0,u.options.last)})}}onRackMonitorUpdate_(u){if(!(u.bladeController instanceof ts))throw yt.shouldNeverHappen();const g=En(this.apiSet_,u.bladeController),x=u.bladeController.binding;this.emitter_.emit("update",{event:new re(g,x.target.read(),x.target.presetKey)})}}class vu extends Al{constructor(u,g){super(u,new mi(u.rackController,g)),this.emitter_=new Nt,this.controller_.foldable.value("expanded").emitter.on("change",x=>{this.emitter_.emit("fold",{event:new ue(this,x.sender.rawValue)})}),this.rackApi_.on("change",x=>{this.emitter_.emit("change",{event:x})}),this.rackApi_.on("update",x=>{this.emitter_.emit("update",{event:x})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(u){this.controller_.foldable.set("expanded",u)}get title(){return this.controller_.props.get("title")}set title(u){this.controller_.props.set("title",u)}get children(){return this.rackApi_.children}addInput(u,g,x){return this.rackApi_.addInput(u,g,x)}addMonitor(u,g,x){return this.rackApi_.addMonitor(u,g,x)}addFolder(u){return this.rackApi_.addFolder(u)}addButton(u){return this.rackApi_.addButton(u)}addSeparator(u){return this.rackApi_.addSeparator(u)}addTab(u){return this.rackApi_.addTab(u)}add(u,g){return this.rackApi_.add(u,g)}remove(u){this.rackApi_.remove(u)}addBlade(u){return this.rackApi_.addBlade(u)}on(u,g){const x=g.bind(this);return this.emitter_.on(u,O=>{x(O.event)}),this}}class yu extends _o{constructor(u){super({blade:u.blade,view:u.view,viewProps:u.rackController.viewProps}),this.rackController=u.rackController}}class ta{constructor(u,g){const x=Ie(g.viewName);this.element=u.createElement("div"),this.element.classList.add(x()),g.viewProps.bindClassModifiers(this.element)}}function Co(A,u){for(let g=0;g<A.length;g++){const x=A[g];if(x instanceof qt&&x.binding===u)return x}return null}function Mo(A,u){for(let g=0;g<A.length;g++){const x=A[g];if(x instanceof ts&&x.binding===u)return x}return null}function kd(A,u){for(let g=0;g<A.length;g++){const x=A[g];if(x instanceof Ai&&x.value===u)return x}return null}function La(A){return A instanceof ia?A.rack:A instanceof yu?A.rackController.rack:null}function Fd(A){const u=La(A);return u?u.bcSet_:null}class Nd{constructor(u){var g,x;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new Nt,this.blade_=(g=u.blade)!==null&&g!==void 0?g:null,(x=this.blade_)===null||x===void 0||x.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=u.viewProps,this.bcSet_=new vl(Fd),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(u,g){var x;(x=u.parent)===null||x===void 0||x.remove(u),tt(u,"parent")?u.parent=this:(u.parent_=this,hu({key:"parent",target:"BladeController",place:"BladeRack.add"})),this.bcSet_.add(u,g)}remove(u){tt(u,"parent")?u.parent=null:(u.parent_=null,hu({key:"parent",target:"BladeController",place:"BladeRack.remove"})),this.bcSet_.remove(u)}find(u){return this.bcSet_.allItems().filter(g=>g instanceof u)}onSetAdd_(u){this.updatePositions_();const g=u.target===u.root;if(this.emitter.emit("add",{bladeController:u.item,index:u.index,isRoot:g,sender:this}),!g)return;const x=u.item;if(x.viewProps.emitter.on("change",this.onChildViewPropsChange_),x.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),x.viewProps.handleDispose(this.onChildDispose_),x instanceof qt)x.binding.emitter.on("change",this.onChildInputChange_);else if(x instanceof ts)x.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(x instanceof Ai)x.value.emitter.on("change",this.onChildValueChange_);else{const O=La(x);if(O){const H=O.emitter;H.on("layout",this.onDescendantLayout_),H.on("inputchange",this.onDescendantInputChange_),H.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(u){this.updatePositions_();const g=u.target===u.root;if(this.emitter.emit("remove",{bladeController:u.item,isRoot:g,sender:this}),!g)return;const x=u.item;if(x instanceof qt)x.binding.emitter.off("change",this.onChildInputChange_);else if(x instanceof ts)x.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(x instanceof Ai)x.value.emitter.off("change",this.onChildValueChange_);else{const O=La(x);if(O){const H=O.emitter;H.off("layout",this.onDescendantLayout_),H.off("inputchange",this.onDescendantInputChange_),H.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const u=this.bcSet_.items.filter(O=>!O.viewProps.get("hidden")),g=u[0],x=u[u.length-1];this.bcSet_.items.forEach(O=>{const H=[];O===g&&(H.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||H.push("veryfirst")),O===x&&(H.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||H.push("verylast")),O.blade.set("positions",H)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(u){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(u=>u.viewProps.get("disposed")).forEach(u=>{this.bcSet_.remove(u)})}onChildInputChange_(u){const g=Co(this.find(qt),u.sender);if(!g)throw yt.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:g,options:u.options,sender:this})}onChildMonitorUpdate_(u){const g=Mo(this.find(ts),u.sender);if(!g)throw yt.alreadyDisposed();this.emitter.emit("monitorupdate",{bladeController:g,sender:this})}onChildValueChange_(u){const g=kd(this.find(Ai),u.sender);if(!g)throw yt.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:g,options:u.options,sender:this})}onDescendantLayout_(u){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(u){this.emitter.emit("inputchange",{bladeController:u.bladeController,options:u.options,sender:this})}onDescendantMonitorUpdate_(u){this.emitter.emit("monitorupdate",{bladeController:u.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class ia extends _o{constructor(u,g){super(Object.assign(Object.assign({},g),{view:new ta(u,{viewName:"brk",viewProps:g.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const x=new Nd({blade:g.root?void 0:g.blade,viewProps:g.viewProps});x.emitter.on("add",this.onRackAdd_),x.emitter.on("remove",this.onRackRemove_),this.rack=x,this.viewProps.handleDispose(()=>{for(let O=this.rack.children.length-1;O>=0;O--)this.rack.children[O].viewProps.set("disposed",!0)})}onRackAdd_(u){u.isRoot&&gu(this.view.element,u.bladeController.view.element,u.index)}onRackRemove_(u){u.isRoot&&wo(u.bladeController.view.element)}}const Rc=Ie("cnt");class _u{constructor(u,g){var x;this.className_=Ie((x=g.viewName)!==null&&x!==void 0?x:"fld"),this.element=u.createElement("div"),this.element.classList.add(this.className_(),Rc()),g.viewProps.bindClassModifiers(this.element),this.foldable_=g.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),ii(this.foldable_,"completed",Si(this.element,this.className_(void 0,"cpl")));const O=u.createElement("button");O.classList.add(this.className_("b")),ii(g.props,"title",li=>{Ze(li)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),g.viewProps.bindDisabled(O),this.element.appendChild(O),this.buttonElement=O;const H=u.createElement("div");H.classList.add(this.className_("i")),this.element.appendChild(H);const ce=u.createElement("div");ce.classList.add(this.className_("t")),Rr(g.props.value("title"),ce),this.buttonElement.appendChild(ce),this.titleElement=ce;const We=u.createElement("div");We.classList.add(this.className_("m")),this.buttonElement.appendChild(We);const Mt=g.containerElement;Mt.classList.add(this.className_("c")),this.element.appendChild(Mt),this.containerElement=Mt}}class So extends yu{constructor(u,g){var x;const O=Gn.create((x=g.expanded)===null||x===void 0||x),H=new ia(u,{blade:g.blade,root:g.root,viewProps:g.viewProps});super(Object.assign(Object.assign({},g),{rackController:H,view:new _u(u,{containerElement:H.view.element,foldable:O,props:g.props,viewName:g.root?"rot":void 0,viewProps:g.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=g.props,this.foldable=O,Er(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const bu={id:"folder",type:"blade",accept(A){const u=Ri,g=xr(A,{title:u.required.string,view:u.required.constant("folder"),expanded:u.optional.boolean});return g?{params:g}:null},controller:A=>new So(A.document,{blade:A.blade,expanded:A.params.expanded,props:Vt.fromObject({title:A.params.title}),viewProps:A.viewProps}),api:A=>A.controller instanceof So?new vu(A.controller,A.pool):null};class Ua extends Ai{constructor(u,g){const x=g.valueController.viewProps;super(Object.assign(Object.assign({},g),{value:g.valueController.value,view:new Ar(u,{props:g.props,viewProps:x}),viewProps:x})),this.props=g.props,this.valueController=g.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class Dc extends p{}const wu=Ie("spr");class Gd{constructor(u,g){this.element=u.createElement("div"),this.element.classList.add(wu()),g.viewProps.bindClassModifiers(this.element);const x=u.createElement("hr");x.classList.add(wu("r")),this.element.appendChild(x)}}class Bc extends _o{constructor(u,g){super(Object.assign(Object.assign({},g),{view:new Gd(u,{viewProps:g.viewProps})}))}}const xu={id:"separator",type:"blade",accept(A){const u=xr(A,{view:Ri.required.constant("separator")});return u?{params:u}:null},controller:A=>new Bc(A.document,{blade:A.blade,viewProps:A.viewProps}),api:A=>A.controller instanceof Bc?new Dc(A.controller):null},Oa=Ie("tbi");class zd{constructor(u,g){this.element=u.createElement("div"),this.element.classList.add(Oa()),g.viewProps.bindClassModifiers(this.element),ii(g.props,"selected",H=>{H?this.element.classList.add(Oa(void 0,"sel")):this.element.classList.remove(Oa(void 0,"sel"))});const x=u.createElement("button");x.classList.add(Oa("b")),g.viewProps.bindDisabled(x),this.element.appendChild(x),this.buttonElement=x;const O=u.createElement("div");O.classList.add(Oa("t")),Rr(g.props.value("title"),O),this.buttonElement.appendChild(O),this.titleElement=O}}class Qd{constructor(u,g){this.emitter=new Nt,this.onClick_=this.onClick_.bind(this),this.props=g.props,this.viewProps=g.viewProps,this.view=new zd(u,{props:g.props,viewProps:g.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Eu{constructor(u,g){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new Qd(u,{props:g.itemProps,viewProps:Zn.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new ia(u,{blade:es(),viewProps:Zn.create()}),this.props=g.props,ii(this.props,"selected",x=>{this.itemController.props.set("selected",x),this.contentController.viewProps.set("hidden",!x)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class Cu{constructor(u,g){this.controller_=u,this.rackApi_=g}get title(){var u;return(u=this.controller_.itemController.props.get("title"))!==null&&u!==void 0?u:""}set title(u){this.controller_.itemController.props.set("title",u)}get selected(){return this.controller_.props.get("selected")}set selected(u){this.controller_.props.set("selected",u)}get children(){return this.rackApi_.children}addButton(u){return this.rackApi_.addButton(u)}addFolder(u){return this.rackApi_.addFolder(u)}addSeparator(u){return this.rackApi_.addSeparator(u)}addTab(u){return this.rackApi_.addTab(u)}add(u,g){this.rackApi_.add(u,g)}remove(u){this.rackApi_.remove(u)}addInput(u,g,x){return this.rackApi_.addInput(u,g,x)}addMonitor(u,g,x){return this.rackApi_.addMonitor(u,g,x)}addBlade(u){return this.rackApi_.addBlade(u)}}class Mu extends Al{constructor(u,g){super(u,new mi(u.rackController,g)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new Nt,this.pageApiMap_=new Map,this.rackApi_.on("change",x=>{this.emitter_.emit("change",{event:x})}),this.rackApi_.on("update",x=>{this.emitter_.emit("update",{event:x})}),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(x=>{this.setUpPageApi_(x)})}get pages(){return this.controller_.pageSet.items.map(u=>{const g=this.pageApiMap_.get(u);if(!g)throw yt.shouldNeverHappen();return g})}addPage(u){const g=this.controller_.view.element.ownerDocument,x=new Eu(g,{itemProps:Vt.fromObject({selected:!1,title:u.title}),props:Vt.fromObject({selected:!1})});this.controller_.add(x,u.index);const O=this.pageApiMap_.get(x);if(!O)throw yt.shouldNeverHappen();return O}removePage(u){this.controller_.remove(u)}on(u,g){const x=g.bind(this);return this.emitter_.on(u,O=>{x(O.event)}),this}setUpPageApi_(u){const g=this.rackApi_.apiSet_.find(O=>O.controller_===u.contentController);if(!g)throw yt.shouldNeverHappen();const x=new Cu(u,g);this.pageApiMap_.set(u,x)}onPageAdd_(u){this.setUpPageApi_(u.item)}onPageRemove_(u){if(!this.pageApiMap_.get(u.item))throw yt.shouldNeverHappen();this.pageApiMap_.delete(u.item)}onSelect_(u){this.emitter_.emit("select",{event:new de(this,u.rawValue)})}}const Su=-1;class Vd{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=gr(!0),this.selectedIndex=gr(Su),this.items_=[]}add(u,g){const x=g??this.items_.length;this.items_.splice(x,0,u),u.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(u){const g=this.items_.indexOf(u);g<0||(this.items_.splice(g,1),u.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0)return this.selectedIndex.rawValue=Su,void(this.empty.rawValue=!0);const u=this.items_.findIndex(g=>g.rawValue);u<0?(this.items_.forEach((g,x)=>{g.rawValue=x===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((g,x)=>{g.rawValue=x===u}),this.selectedIndex.rawValue=u),this.empty.rawValue=!1}onItemSelectedChange_(u){if(u.rawValue){const g=this.items_.findIndex(x=>x===u.sender);this.items_.forEach((x,O)=>{x.rawValue=O===g}),this.selectedIndex.rawValue=g}else this.keepSelection_()}}const To=Ie("tab");class jd{constructor(u,g){this.element=u.createElement("div"),this.element.classList.add(To(),Rc()),g.viewProps.bindClassModifiers(this.element),Qt(g.empty,Si(this.element,To(void 0,"nop")));const x=u.createElement("div");x.classList.add(To("t")),this.element.appendChild(x),this.itemsElement=x;const O=u.createElement("div");O.classList.add(To("i")),this.element.appendChild(O);const H=g.contentsElement;H.classList.add(To("c")),this.element.appendChild(H),this.contentsElement=H}}class Tu extends yu{constructor(u,g){const x=new ia(u,{blade:g.blade,viewProps:g.viewProps}),O=new Vd;super({blade:g.blade,rackController:x,view:new jd(u,{contentsElement:x.view.element,empty:O.empty,viewProps:g.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new vl(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=O}get pageSet(){return this.pageSet_}add(u,g){this.pageSet_.add(u,g)}remove(u){this.pageSet_.remove(this.pageSet_.items[u])}onPageAdd_(u){const g=u.item;gu(this.view.itemsElement,g.itemController.view.element,u.index),g.itemController.viewProps.set("parent",this.viewProps),this.rackController.rack.add(g.contentController,u.index),this.tab.add(g.props.value("selected"))}onPageRemove_(u){const g=u.item;wo(g.itemController.view.element),g.itemController.viewProps.set("parent",null),this.rackController.rack.remove(g.contentController),this.tab.remove(g.props.value("selected"))}}const Iu={id:"tab",type:"blade",accept(A){const u=Ri,g=xr(A,{pages:u.required.array(u.required.object({title:u.required.string})),view:u.required.constant("tab")});return g&&g.pages.length!==0?{params:g}:null},controller(A){const u=new Tu(A.document,{blade:A.blade,viewProps:A.viewProps});return A.params.pages.forEach(g=>{const x=new Eu(A.document,{itemProps:Vt.fromObject({selected:!1,title:g.title}),props:Vt.fromObject({selected:!1})});u.add(x)}),u},api:A=>A.controller instanceof Tu?new Mu(A.controller,A.pool):null};function Hd(A,u){const g=A.accept(u.params);if(!g)return null;const x=Ri.optional.boolean(u.params.disabled).value,O=Ri.optional.boolean(u.params.hidden).value;return A.controller({blade:es(),document:u.document,params:Object.assign(Object.assign({},g.params),{disabled:x,hidden:O}),viewProps:Zn.create({disabled:x,hidden:O})})}class Wd{constructor(){this.disabled=!1,this.emitter=new Nt}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class Lc{constructor(u,g){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=u,this.emitter=new Nt,this.interval_=g,this.setTimer_()}get disabled(){return this.disabled_}set disabled(u){this.disabled_=u,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const u=this.doc_.defaultView;u&&u.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const u=this.doc_.defaultView;u&&(this.timerId_=u.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Kg{constructor(u){this.onValueChange_=this.onValueChange_.bind(this),this.reader=u.reader,this.writer=u.writer,this.emitter=new Nt,this.value=u.value,this.value.emitter.on("change",this.onValueChange_),this.target=u.target,this.read()}read(){const u=this.target.read();u!==void 0&&(this.value.rawValue=this.reader(u))}write_(u){this.writer(this.target,u)}onValueChange_(u){this.write_(u.rawValue),this.emitter.emit("change",{options:u.options,rawValue:u.rawValue,sender:this})}}function Pu(A,u){for(;A.length<u;)A.push(void 0)}function Xd(A){const u=[];return Pu(u,A),gr(u)}function qd(A){const u=A.indexOf(void 0);return u<0?A:A.slice(0,u)}function Ru(A,u){const g=[...qd(A),u];return g.length>A.length?g.splice(0,g.length-A.length):Pu(g,A.length),g}class Du{constructor(u){this.onTick_=this.onTick_.bind(this),this.reader_=u.reader,this.target=u.target,this.emitter=new Nt,this.value=u.value,this.ticker=u.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const u=this.target.read();if(u===void 0)return;const g=this.value.rawValue,x=this.reader_(u);this.value.rawValue=Ru(g,x),this.emitter.emit("update",{rawValue:x,sender:this})}onTick_(u){this.read()}}class yl{constructor(u){this.constraints=u}constrain(u){return this.constraints.reduce((g,x)=>x.constrain(g),u)}}function Kr(A,u){if(A instanceof u)return A;if(A instanceof yl){const g=A.constraints.reduce((x,O)=>x||(O instanceof u?O:null),null);if(g)return g}return null}class Cn{constructor(u){this.values=Vt.fromObject({max:u.max,min:u.min})}constrain(u){const g=this.values.get("max"),x=this.values.get("min");return Math.min(Math.max(u,x),g)}}class ka{constructor(u){this.values=Vt.fromObject({options:u})}get options(){return this.values.get("options")}constrain(u){const g=this.values.get("options");return g.length===0||g.filter(x=>x.value===u).length>0?u:g[0].value}}class Fa{constructor(u){this.values=Vt.fromObject({max:u.max,min:u.min})}get maxValue(){return this.values.get("max")}get minValue(){return this.values.get("min")}constrain(u){const g=this.values.get("max"),x=this.values.get("min");let O=u;return Ze(x)||(O=Math.max(O,x)),Ze(g)||(O=Math.min(O,g)),O}}class ws{constructor(u,g=0){this.step=u,this.origin=g}constrain(u){const g=this.origin%this.step;return g+Math.round((u-g)/this.step)*this.step}}const Io=Ie("lst");class Bu{constructor(u,g){this.onValueChange_=this.onValueChange_.bind(this),this.props_=g.props,this.element=u.createElement("div"),this.element.classList.add(Io()),g.viewProps.bindClassModifiers(this.element);const x=u.createElement("select");x.classList.add(Io("s")),ii(this.props_,"options",H=>{ys(x),H.forEach((ce,We)=>{const Mt=u.createElement("option");Mt.dataset.index=String(We),Mt.textContent=ce.text,Mt.value=String(ce.value),x.appendChild(Mt)})}),g.viewProps.bindDisabled(x),this.element.appendChild(x),this.selectElement=x;const O=u.createElement("div");O.classList.add(Io("m")),O.appendChild(bo(u,"dropdown")),this.element.appendChild(O),g.value.emitter.on("change",this.onValueChange_),this.value_=g.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class Po{constructor(u,g){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=g.props,this.value=g.value,this.viewProps=g.viewProps,this.view=new Bu(u,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(u){const g=u.currentTarget.selectedOptions.item(0);if(!g)return;const x=Number(g.dataset.index);this.value.rawValue=this.props.get("options")[x].value}}const Yd=Ie("pop");class Kd{constructor(u,g){this.element=u.createElement("div"),this.element.classList.add(Yd()),g.viewProps.bindClassModifiers(this.element),Qt(g.shows,Si(this.element,Yd(void 0,"v")))}}class Uc{constructor(u,g){this.shows=gr(!1),this.viewProps=g.viewProps,this.view=new Kd(u,{shows:this.shows,viewProps:this.viewProps})}}const Oc=Ie("txt");class ra{constructor(u,g){this.onChange_=this.onChange_.bind(this),this.element=u.createElement("div"),this.element.classList.add(Oc()),g.viewProps.bindClassModifiers(this.element),this.props_=g.props,this.props_.emitter.on("change",this.onChange_);const x=u.createElement("input");x.classList.add(Oc("i")),x.type="text",g.viewProps.bindDisabled(x),this.element.appendChild(x),this.inputElement=x,g.value.emitter.on("change",this.onChange_),this.value_=g.value,this.refresh()}refresh(){const u=this.props_.get("formatter");this.inputElement.value=u(this.value_.rawValue)}onChange_(){this.refresh()}}class xs{constructor(u,g){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=g.parser,this.props=g.props,this.value=g.value,this.viewProps=g.viewProps,this.view=new ra(u,{props:g.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(u){const g=u.currentTarget.value,x=this.parser_(g);Ze(x)||(this.value.rawValue=x),this.view.refresh()}}function Jd(A){return String(A)}function pn(A){return A!=="false"&&!!A}function Lu(A){return Jd(A)}class Xi{constructor(u){this.text=u}evaluate(){return Number(this.text)}toString(){return this.text}}const it={"**":(A,u)=>Math.pow(A,u),"*":(A,u)=>A*u,"/":(A,u)=>A/u,"%":(A,u)=>A%u,"+":(A,u)=>A+u,"-":(A,u)=>A-u,"<<":(A,u)=>A<<u,">>":(A,u)=>A>>u,">>>":(A,u)=>A>>>u,"&":(A,u)=>A&u,"^":(A,u)=>A^u,"|":(A,u)=>A|u};class wi{constructor(u,g,x){this.left=g,this.operator=u,this.right=x}evaluate(){const u=it[this.operator];if(!u)throw new Error(`unexpected binary operator: '${this.operator}`);return u(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Uu={"+":A=>A,"-":A=>-A,"~":A=>~A};class _l{constructor(u,g){this.operator=u,this.expression=g}evaluate(){const u=Uu[this.operator];if(!u)throw new Error(`unexpected unary operator: '${this.operator}`);return u(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function na(A){return(u,g)=>{for(let x=0;x<A.length;x++){const O=A[x](u,g);if(O!=="")return O}return""}}function Ro(A,u){var g;const x=A.substr(u).match(/^\s+/);return(g=x&&x[0])!==null&&g!==void 0?g:""}function Jg(A,u){const g=A.substr(u,1);return g.match(/^[1-9]$/)?g:""}function bl(A,u){var g;const x=A.substr(u).match(/^[0-9]+/);return(g=x&&x[0])!==null&&g!==void 0?g:""}function Zg(A,u){const g=bl(A,u);if(g!=="")return g;const x=A.substr(u,1);if(x!=="-"&&x!=="+")return"";const O=bl(A,u+=1);return O===""?"":x+O}function Ou(A,u){const g=A.substr(u,1);if(u+=1,g.toLowerCase()!=="e")return"";const x=Zg(A,u);return x===""?"":g+x}function Zd(A,u){const g=A.substr(u,1);if(g==="0")return g;const x=Jg(A,u);return u+=x.length,x===""?"":x+bl(A,u)}function $g(A,u){const g=Zd(A,u);if(u+=g.length,g==="")return"";const x=A.substr(u,1);if(u+=x.length,x!==".")return"";const O=bl(A,u);return g+x+O+Ou(A,u+=O.length)}function eA(A,u){const g=A.substr(u,1);if(u+=g.length,g!==".")return"";const x=bl(A,u);return u+=x.length,x===""?"":g+x+Ou(A,u)}function tA(A,u){const g=Zd(A,u);return u+=g.length,g===""?"":g+Ou(A,u)}const kc=na([$g,eA,tA]);function iA(A,u){var g;const x=A.substr(u).match(/^[01]+/);return(g=x&&x[0])!==null&&g!==void 0?g:""}function ku(A,u){const g=A.substr(u,2);if(u+=g.length,g.toLowerCase()!=="0b")return"";const x=iA(A,u);return x===""?"":g+x}function Fu(A,u){var g;const x=A.substr(u).match(/^[0-7]+/);return(g=x&&x[0])!==null&&g!==void 0?g:""}function Es(A,u){const g=A.substr(u,2);if(u+=g.length,g.toLowerCase()!=="0o")return"";const x=Fu(A,u);return x===""?"":g+x}function Fc(A,u){var g;const x=A.substr(u).match(/^[0-9a-f]+/i);return(g=x&&x[0])!==null&&g!==void 0?g:""}function zi(A,u){const g=A.substr(u,2);if(u+=g.length,g.toLowerCase()!=="0x")return"";const x=Fc(A,u);return x===""?"":g+x}const Dr=na([ku,Es,zi]),$d=na([Dr,kc]);function Na(A,u){const g=$d(A,u);return u+=g.length,g===""?null:{evaluable:new Xi(g),cursor:u}}function Do(A,u){const g=A.substr(u,1);if(u+=g.length,g!=="(")return null;const x=Bo(A,u);if(!x)return null;u=x.cursor,u+=Ro(A,u).length;const O=A.substr(u,1);return u+=O.length,O!==")"?null:{evaluable:x.evaluable,cursor:u}}function dn(A,u){var g;return(g=Na(A,u))!==null&&g!==void 0?g:Do(A,u)}function ki(A,u){const g=dn(A,u);if(g)return g;const x=A.substr(u,1);if(u+=x.length,x!=="+"&&x!=="-"&&x!=="~")return null;const O=ki(A,u);return O?{cursor:u=O.cursor,evaluable:new _l(x,O.evaluable)}:null}function Nu(A,u,g){g+=Ro(u,g).length;const x=A.filter(O=>u.startsWith(O,g))[0];return x?(g+=x.length,{cursor:g+=Ro(u,g).length,operator:x}):null}function rA(A,u){return(g,x)=>{const O=A(g,x);if(!O)return null;x=O.cursor;let H=O.evaluable;for(;;){const ce=Nu(u,g,x);if(!ce)break;x=ce.cursor;const We=A(g,x);if(!We)return null;x=We.cursor,H=new wi(ce.operator,H,We.evaluable)}return H?{cursor:x,evaluable:H}:null}}const nA=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((A,u)=>rA(A,u),ki);function Bo(A,u){return u+=Ro(A,u).length,nA(A,u)}function sA(A){const u=Bo(A,0);return u?u.cursor+Ro(A,u.cursor).length!==A.length?null:u.evaluable:null}function Cs(A){var u;const g=sA(A);return(u=g==null?void 0:g.evaluate())!==null&&u!==void 0?u:null}function em(A){if(typeof A=="number")return A;if(typeof A=="string"){const u=Cs(A);if(!Ze(u))return u}return 0}function aA(A){return String(A)}function Cr(A){return u=>u.toFixed(Math.max(Math.min(A,20),0))}const oA=Cr(0);function Nc(A){return oA(A)+"%"}function tm(A){return String(A)}function Gu(A){return A}function wl({primary:A,secondary:u,forward:g,backward:x}){let O=!1;function H(ce){O||(O=!0,ce(),O=!1)}A.emitter.on("change",ce=>{H(()=>{u.setRawValue(g(A,u),ce.options)})}),u.emitter.on("change",ce=>{H(()=>{A.setRawValue(x(A,u),ce.options)}),H(()=>{u.setRawValue(g(A,u),ce.options)})}),H(()=>{u.setRawValue(g(A,u),{forceEmit:!1,last:!0})})}function Br(A,u){const g=A*(u.altKey?.1:1)*(u.shiftKey?10:1);return u.upKey?+g:u.downKey?-g:0}function Lo(A){return{altKey:A.altKey,downKey:A.key==="ArrowDown",shiftKey:A.shiftKey,upKey:A.key==="ArrowUp"}}function Mn(A){return{altKey:A.altKey,downKey:A.key==="ArrowLeft",shiftKey:A.shiftKey,upKey:A.key==="ArrowRight"}}function lA(A){return A==="ArrowUp"||A==="ArrowDown"}function Jr(A){return lA(A)||A==="ArrowLeft"||A==="ArrowRight"}function Gt(A,u){var g,x;const O=u.ownerDocument.defaultView,H=u.getBoundingClientRect();return{x:A.pageX-(((g=O&&O.scrollX)!==null&&g!==void 0?g:0)+H.left),y:A.pageY-(((x=O&&O.scrollY)!==null&&x!==void 0?x:0)+H.top)}}class Zt{constructor(u){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=u,this.emitter=new Nt,u.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),u.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),u.addEventListener("touchend",this.onTouchEnd_),u.addEventListener("mousedown",this.onMouseDown_)}computePosition_(u){const g=this.elem_.getBoundingClientRect();return{bounds:{width:g.width,height:g.height},point:u?{x:u.x,y:u.y}:null}}onMouseDown_(u){var g;u.preventDefault(),(g=u.currentTarget)===null||g===void 0||g.focus();const x=this.elem_.ownerDocument;x.addEventListener("mousemove",this.onDocumentMouseMove_),x.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:u.altKey,data:this.computePosition_(Gt(u,this.elem_)),sender:this,shiftKey:u.shiftKey})}onDocumentMouseMove_(u){this.emitter.emit("move",{altKey:u.altKey,data:this.computePosition_(Gt(u,this.elem_)),sender:this,shiftKey:u.shiftKey})}onDocumentMouseUp_(u){const g=this.elem_.ownerDocument;g.removeEventListener("mousemove",this.onDocumentMouseMove_),g.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:u.altKey,data:this.computePosition_(Gt(u,this.elem_)),sender:this,shiftKey:u.shiftKey})}onTouchStart_(u){u.preventDefault();const g=u.targetTouches.item(0),x=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:u.altKey,data:this.computePosition_(g?{x:g.clientX-x.left,y:g.clientY-x.top}:void 0),sender:this,shiftKey:u.shiftKey}),this.lastTouch_=g}onTouchMove_(u){const g=u.targetTouches.item(0),x=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:u.altKey,data:this.computePosition_(g?{x:g.clientX-x.left,y:g.clientY-x.top}:void 0),sender:this,shiftKey:u.shiftKey}),this.lastTouch_=g}onTouchEnd_(u){var g;const x=(g=u.targetTouches.item(0))!==null&&g!==void 0?g:this.lastTouch_,O=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:u.altKey,data:this.computePosition_(x?{x:x.clientX-O.left,y:x.clientY-O.top}:void 0),sender:this,shiftKey:u.shiftKey})}}function ne(A,u,g,x,O){return x+(A-u)/(g-u)*(O-x)}function Bt(A){return String(A.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function qi(A,u,g){return Math.min(Math.max(A,u),g)}function zu(A,u){return(A%u+u)%u}const Sn=Ie("txt");class Uo{constructor(u,g){this.onChange_=this.onChange_.bind(this),this.props_=g.props,this.props_.emitter.on("change",this.onChange_),this.element=u.createElement("div"),this.element.classList.add(Sn(),Sn(void 0,"num")),g.arrayPosition&&this.element.classList.add(Sn(void 0,g.arrayPosition)),g.viewProps.bindClassModifiers(this.element);const x=u.createElement("input");x.classList.add(Sn("i")),x.type="text",g.viewProps.bindDisabled(x),this.element.appendChild(x),this.inputElement=x,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=g.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Sn()),this.inputElement.classList.add(Sn("i"));const O=u.createElement("div");O.classList.add(Sn("k")),this.element.appendChild(O),this.knobElement=O;const H=u.createElementNS(Nn,"svg");H.classList.add(Sn("g")),this.knobElement.appendChild(H);const ce=u.createElementNS(Nn,"path");ce.classList.add(Sn("gb")),H.appendChild(ce),this.guideBodyElem_=ce;const We=u.createElementNS(Nn,"path");We.classList.add(Sn("gh")),H.appendChild(We),this.guideHeadElem_=We;const Mt=u.createElement("div");Mt.classList.add(Ie("tt")()),this.knobElement.appendChild(Mt),this.tooltipElem_=Mt,g.value.emitter.on("change",this.onChange_),this.value=g.value,this.refresh()}onDraggingChange_(u){if(u.rawValue===null)return void this.element.classList.remove(Sn(void 0,"drg"));this.element.classList.add(Sn(void 0,"drg"));const g=u.rawValue/this.props_.get("draggingScale"),x=g+(g>0?-1:g<0?1:0),O=qi(-x,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${x+O},0 L${x},4 L${x+O},8`,`M ${g},-1 L${g},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${g},4`);const H=this.props_.get("formatter");this.tooltipElem_.textContent=H(this.value.rawValue),this.tooltipElem_.style.left=`${g}px`}refresh(){const u=this.props_.get("formatter");this.inputElement.value=u(this.value.rawValue)}onChange_(){this.refresh()}}class Ms{constructor(u,g){var x;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=g.baseStep,this.parser_=g.parser,this.props=g.props,this.sliderProps_=(x=g.sliderProps)!==null&&x!==void 0?x:null,this.value=g.value,this.viewProps=g.viewProps,this.dragging_=gr(null),this.view=new Uo(u,{arrayPosition:g.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const O=new Zt(this.view.knobElement);O.emitter.on("down",this.onPointerDown_),O.emitter.on("move",this.onPointerMove_),O.emitter.on("up",this.onPointerUp_)}constrainValue_(u){var g,x;const O=(g=this.sliderProps_)===null||g===void 0?void 0:g.get("minValue"),H=(x=this.sliderProps_)===null||x===void 0?void 0:x.get("maxValue");let ce=u;return O!==void 0&&(ce=Math.max(ce,O)),H!==void 0&&(ce=Math.min(ce,H)),ce}onInputChange_(u){const g=u.currentTarget.value,x=this.parser_(g);Ze(x)||(this.value.rawValue=this.constrainValue_(x)),this.view.refresh()}onInputKeyDown_(u){const g=Br(this.baseStep_,Lo(u));g!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+g),{forceEmit:!1,last:!1})}onInputKeyUp_(u){Br(this.baseStep_,Lo(u))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(u){if(!u.point)return null;const g=u.point.x-u.bounds.width/2;return this.constrainValue_(this.originRawValue_+g*this.props.get("draggingScale"))}onPointerMove_(u){const g=this.computeDraggingValue_(u.data);g!==null&&(this.value.setRawValue(g,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(u){const g=this.computeDraggingValue_(u.data);g!==null&&(this.value.setRawValue(g,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Gc=Ie("sld");class xl{constructor(u,g){this.onChange_=this.onChange_.bind(this),this.props_=g.props,this.props_.emitter.on("change",this.onChange_),this.element=u.createElement("div"),this.element.classList.add(Gc()),g.viewProps.bindClassModifiers(this.element);const x=u.createElement("div");x.classList.add(Gc("t")),g.viewProps.bindTabIndex(x),this.element.appendChild(x),this.trackElement=x;const O=u.createElement("div");O.classList.add(Gc("k")),this.trackElement.appendChild(O),this.knobElement=O,g.value.emitter.on("change",this.onChange_),this.value=g.value,this.update_()}update_(){const u=qi(ne(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${u}%`}onChange_(){this.update_()}}class Oo{constructor(u,g){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=g.baseStep,this.value=g.value,this.viewProps=g.viewProps,this.props=g.props,this.view=new xl(u,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Zt(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(u,g){u.point&&this.value.setRawValue(ne(qi(u.point.x,0,u.bounds.width),0,u.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),g)}onPointerDownOrMove_(u){this.handlePointerEvent_(u.data,{forceEmit:!1,last:!1})}onPointerUp_(u){this.handlePointerEvent_(u.data,{forceEmit:!0,last:!0})}onKeyDown_(u){const g=Br(this.baseStep_,Mn(u));g!==0&&this.value.setRawValue(this.value.rawValue+g,{forceEmit:!1,last:!1})}onKeyUp_(u){Br(this.baseStep_,Mn(u))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const El=Ie("sldtxt");class cA{constructor(u,g){this.element=u.createElement("div"),this.element.classList.add(El());const x=u.createElement("div");x.classList.add(El("s")),this.sliderView_=g.sliderView,x.appendChild(this.sliderView_.element),this.element.appendChild(x);const O=u.createElement("div");O.classList.add(El("t")),this.textView_=g.textView,O.appendChild(this.textView_.element),this.element.appendChild(O)}}class Qu{constructor(u,g){this.value=g.value,this.viewProps=g.viewProps,this.sliderC_=new Oo(u,{baseStep:g.baseStep,props:g.sliderProps,value:g.value,viewProps:this.viewProps}),this.textC_=new Ms(u,{baseStep:g.baseStep,parser:g.parser,props:g.textProps,sliderProps:g.sliderProps,value:g.value,viewProps:g.viewProps}),this.view=new cA(u,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function Cl(A,u){A.write(u)}function zc(A){const u=Ri;return Array.isArray(A)?u.required.array(u.required.object({text:u.required.string,value:u.required.raw}))(A).value:typeof A=="object"?u.required.raw(A).value:void 0}function im(A){if(A==="inline"||A==="popup")return A}function sa(A){const u=Ri;return u.required.object({max:u.optional.number,min:u.optional.number,step:u.optional.number})(A).value}function cr(A){if(Array.isArray(A))return A;const u=[];return Object.keys(A).forEach(g=>{u.push({text:g,value:A[g]})}),u}function aa(A){return Ze(A)?null:new ka(cr(A))}function Qc(A){const u=A?Kr(A,ws):null;return u?u.step:null}function Vc(A,u){const g=A&&Kr(A,ws);return g?Bt(g.step):Math.max(Bt(u),2)}function Zr(A){const u=Qc(A);return u??1}function oa(A,u){var g;const x=A&&Kr(A,ws),O=Math.abs((g=x==null?void 0:x.step)!==null&&g!==void 0?g:u);return O===0?.1:Math.pow(10,Math.floor(Math.log10(O))-1)}const jc=Ie("ckb");class Ti{constructor(u,g){this.onValueChange_=this.onValueChange_.bind(this),this.element=u.createElement("div"),this.element.classList.add(jc()),g.viewProps.bindClassModifiers(this.element);const x=u.createElement("label");x.classList.add(jc("l")),this.element.appendChild(x);const O=u.createElement("input");O.classList.add(jc("i")),O.type="checkbox",x.appendChild(O),this.inputElement=O,g.viewProps.bindDisabled(this.inputElement);const H=u.createElement("div");H.classList.add(jc("w")),x.appendChild(H);const ce=bo(u,"check");H.appendChild(ce),g.value.emitter.on("change",this.onValueChange_),this.value=g.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class bt{constructor(u,g){this.onInputChange_=this.onInputChange_.bind(this),this.value=g.value,this.viewProps=g.viewProps,this.view=new Ti(u,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(u){const g=u.currentTarget;this.value.rawValue=g.checked}}function Gr(A){const u=[],g=aa(A.options);return g&&u.push(g),new yl(u)}const Hc={id:"input-bool",type:"input",accept:(A,u)=>{if(typeof A!="boolean")return null;const g=xr(u,{options:Ri.optional.custom(zc)});return g?{initialValue:A,params:g}:null},binding:{reader:A=>pn,constraint:A=>Gr(A.params),writer:A=>Cl},controller:A=>{const u=A.document,g=A.value,x=A.constraint,O=x&&Kr(x,ka);return O?new Po(u,{props:new Vt({options:O.values.value("options")}),value:g,viewProps:A.viewProps}):new bt(u,{value:g,viewProps:A.viewProps})}},Ga=Ie("col");class Wc{constructor(u,g){this.element=u.createElement("div"),this.element.classList.add(Ga()),g.foldable.bindExpandedClass(this.element,Ga(void 0,"expanded")),ii(g.foldable,"completed",Si(this.element,Ga(void 0,"cpl")));const x=u.createElement("div");x.classList.add(Ga("h")),this.element.appendChild(x);const O=u.createElement("div");O.classList.add(Ga("s")),x.appendChild(O),this.swatchElement=O;const H=u.createElement("div");if(H.classList.add(Ga("t")),x.appendChild(H),this.textElement=H,g.pickerLayout==="inline"){const ce=u.createElement("div");ce.classList.add(Ga("p")),this.element.appendChild(ce),this.pickerElement=ce}else this.pickerElement=null}}function hA(A,u,g){const x=qi(A/255,0,1),O=qi(u/255,0,1),H=qi(g/255,0,1),ce=Math.max(x,O,H),We=Math.min(x,O,H),Mt=ce-We;let li=0,rr=0;const Or=(We+ce)/2;return Mt!==0&&(rr=Mt/(1-Math.abs(ce+We-1)),li=x===ce?(O-H)/Mt:O===ce?2+(H-x)/Mt:4+(x-O)/Mt,li=li/6+(li<0?1:0)),[360*li,100*rr,100*Or]}function rm(A,u,g){const x=(A%360+360)%360,O=qi(u/100,0,1),H=qi(g/100,0,1),ce=(1-Math.abs(2*H-1))*O,We=ce*(1-Math.abs(x/60%2-1)),Mt=H-ce/2;let li,rr,Or;return[li,rr,Or]=x>=0&&x<60?[ce,We,0]:x>=60&&x<120?[We,ce,0]:x>=120&&x<180?[0,ce,We]:x>=180&&x<240?[0,We,ce]:x>=240&&x<300?[We,0,ce]:[ce,0,We],[255*(li+Mt),255*(rr+Mt),255*(Or+Mt)]}function Ct(A,u,g){const x=qi(A/255,0,1),O=qi(u/255,0,1),H=qi(g/255,0,1),ce=Math.max(x,O,H),We=ce-Math.min(x,O,H);let Mt;return Mt=We===0?0:ce===x?((O-H)/We%6+6)%6*60:ce===O?60*((H-x)/We+2):60*((x-O)/We+4),[Mt,100*(ce===0?0:We/ce),100*ce]}function P(A,u,g){const x=zu(A,360),O=qi(u/100,0,1),H=qi(g/100,0,1),ce=H*O,We=ce*(1-Math.abs(x/60%2-1)),Mt=H-ce;let li,rr,Or;return[li,rr,Or]=x>=0&&x<60?[ce,We,0]:x>=60&&x<120?[We,ce,0]:x>=120&&x<180?[0,ce,We]:x>=180&&x<240?[0,We,ce]:x>=240&&x<300?[We,0,ce]:[ce,0,We],[255*(li+Mt),255*(rr+Mt),255*(Or+Mt)]}function Vu(A,u,g){const x=g+u*(100-Math.abs(2*g-100))/200;return[A,x!==0?u*(100-Math.abs(2*g-100))/x:0,g+u*(100-Math.abs(2*g-100))/200]}function nm(A,u,g){const x=100-Math.abs(g*(200-u)/100-100);return[A,x!==0?u*g/x:0,g*(200-u)/200]}function Yi(A){return[A[0],A[1],A[2]]}function is(A,u){return[A[0],A[1],A[2],u]}const Ss={hsl:{hsl:(A,u,g)=>[A,u,g],hsv:Vu,rgb:rm},hsv:{hsl:nm,hsv:(A,u,g)=>[A,u,g],rgb:P},rgb:{hsl:hA,hsv:Ct,rgb:(A,u,g)=>[A,u,g]}};function Ts(A,u){return[u==="float"?1:A==="rgb"?255:360,u==="float"?1:A==="rgb"?255:100,u==="float"?1:A==="rgb"?255:100]}function ko(A,u){return A===u?u:zu(A,u)}function Fo(A,u,g){var x;const O=Ts(u,g);return[u==="rgb"?qi(A[0],0,O[0]):ko(A[0],O[0]),qi(A[1],0,O[1]),qi(A[2],0,O[2]),qi((x=A[3])!==null&&x!==void 0?x:1,0,1)]}function za(A,u,g,x){const O=Ts(u,g),H=Ts(u,x);return A.map((ce,We)=>ce/O[We]*H[We])}function la(A,u,g){const x=za(A,u.mode,u.type,"int");return za(Ss[u.mode][g.mode](...x),g.mode,"int",g.type)}function zn(A,u){return typeof A=="object"&&!Ze(A)&&u in A&&typeof A[u]=="number"}class kt{static black(u="int"){return new kt([0,0,0],"rgb",u)}static fromObject(u,g="int"){const x="a"in u?[u.r,u.g,u.b,u.a]:[u.r,u.g,u.b];return new kt(x,"rgb",g)}static toRgbaObject(u,g="int"){return u.toRgbaObject(g)}static isRgbColorObject(u){return zn(u,"r")&&zn(u,"g")&&zn(u,"b")}static isRgbaColorObject(u){return this.isRgbColorObject(u)&&zn(u,"a")}static isColorObject(u){return this.isRgbColorObject(u)}static equals(u,g){if(u.mode!==g.mode)return!1;const x=u.comps_,O=g.comps_;for(let H=0;H<x.length;H++)if(x[H]!==O[H])return!1;return!0}constructor(u,g,x="int"){this.mode=g,this.type=x,this.comps_=Fo(u,g,x)}getComponents(u,g="int"){return is(la(Yi(this.comps_),{mode:this.mode,type:this.type},{mode:u??this.mode,type:g}),this.comps_[3])}toRgbaObject(u="int"){const g=this.getComponents("rgb",u);return{r:g[0],g:g[1],b:g[2],a:g[3]}}}const Tn=Ie("colp");class Xc{constructor(u,g){this.alphaViews_=null,this.element=u.createElement("div"),this.element.classList.add(Tn()),g.viewProps.bindClassModifiers(this.element);const x=u.createElement("div");x.classList.add(Tn("hsv"));const O=u.createElement("div");O.classList.add(Tn("sv")),this.svPaletteView_=g.svPaletteView,O.appendChild(this.svPaletteView_.element),x.appendChild(O);const H=u.createElement("div");H.classList.add(Tn("h")),this.hPaletteView_=g.hPaletteView,H.appendChild(this.hPaletteView_.element),x.appendChild(H),this.element.appendChild(x);const ce=u.createElement("div");if(ce.classList.add(Tn("rgb")),this.textView_=g.textView,ce.appendChild(this.textView_.element),this.element.appendChild(ce),g.alphaViews){this.alphaViews_={palette:g.alphaViews.palette,text:g.alphaViews.text};const We=u.createElement("div");We.classList.add(Tn("a"));const Mt=u.createElement("div");Mt.classList.add(Tn("ap")),Mt.appendChild(this.alphaViews_.palette.element),We.appendChild(Mt);const li=u.createElement("div");li.classList.add(Tn("at")),li.appendChild(this.alphaViews_.text.element),We.appendChild(li),this.element.appendChild(We)}}get allFocusableElements(){const u=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(g=>g.inputElement)];return this.alphaViews_&&u.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),u}}function qc(A){return A==="int"?"int":A==="float"?"float":void 0}function Is(A){const u=Ri;return xr(A,{alpha:u.optional.boolean,color:u.optional.object({alpha:u.optional.boolean,type:u.optional.custom(qc)}),expanded:u.optional.boolean,picker:u.optional.custom(im)})}function Ps(A){return A?.1:1}function Qa(A){var u;return(u=A.color)===null||u===void 0?void 0:u.type}function Ml(A,u){return A.alpha===u.alpha&&A.mode===u.mode&&A.notation===u.notation&&A.type===u.type}function $r(A,u){const g=A.match(/^(.+)%$/);return Math.min(g?.01*parseFloat(g[1])*u:parseFloat(A),u)}const zr={deg:A=>A,grad:A=>360*A/400,rad:A=>360*A/(2*Math.PI),turn:A=>360*A};function rs(A){const u=A.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!u)return parseFloat(A);const g=parseFloat(u[1]),x=u[2];return zr[x](g)}function Yc(A){const u=A.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!u)return null;const g=[$r(u[1],255),$r(u[2],255),$r(u[3],255)];return isNaN(g[0])||isNaN(g[1])||isNaN(g[2])?null:g}function Sl(A){return u=>{const g=Yc(u);return g?new kt(g,"rgb",A):null}}function Rs(A){const u=A.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!u)return null;const g=[$r(u[1],255),$r(u[2],255),$r(u[3],255),$r(u[4],1)];return isNaN(g[0])||isNaN(g[1])||isNaN(g[2])||isNaN(g[3])?null:g}function Kc(A){return u=>{const g=Rs(u);return g?new kt(g,"rgb",A):null}}function Tl(A){const u=A.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!u)return null;const g=[rs(u[1]),$r(u[2],100),$r(u[3],100)];return isNaN(g[0])||isNaN(g[1])||isNaN(g[2])?null:g}function Jc(A){return u=>{const g=Tl(u);return g?new kt(g,"hsl",A):null}}function Va(A){const u=A.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!u)return null;const g=[rs(u[1]),$r(u[2],100),$r(u[3],100),$r(u[4],1)];return isNaN(g[0])||isNaN(g[1])||isNaN(g[2])||isNaN(g[3])?null:g}function et(A){return u=>{const g=Va(u);return g?new kt(g,"hsl",A):null}}function ja(A){const u=A.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(u)return[parseInt(u[1]+u[1],16),parseInt(u[2]+u[2],16),parseInt(u[3]+u[3],16)];const g=A.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return g?[parseInt(g[1],16),parseInt(g[2],16),parseInt(g[3],16)]:null}function Qn(A){const u=ja(A);return u?new kt(u,"rgb","int"):null}function sm(A){const u=A.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(u)return[parseInt(u[1]+u[1],16),parseInt(u[2]+u[2],16),parseInt(u[3]+u[3],16),ne(parseInt(u[4]+u[4],16),0,255,0,1)];const g=A.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return g?[parseInt(g[1],16),parseInt(g[2],16),parseInt(g[3],16),ne(parseInt(g[4],16),0,255,0,1)]:null}function uA(A){const u=sm(A);return u?new kt(u,"rgb","int"):null}function Ds(A){const u=A.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!u)return null;const g=[parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3])];return isNaN(g[0])||isNaN(g[1])||isNaN(g[2])?null:g}function Il(A){return u=>{const g=Ds(u);return g?new kt(g,"rgb",A):null}}function en(A){const u=A.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!u)return null;const g=[parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3]),parseFloat(u[4])];return isNaN(g[0])||isNaN(g[1])||isNaN(g[2])||isNaN(g[3])?null:g}function ju(A){return u=>{const g=en(u);return g?new kt(g,"rgb",A):null}}const am=[{parser:ja,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:sm,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:Yc,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:Rs,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Tl,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Va,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Ds,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:en,result:{alpha:!0,mode:"rgb",notation:"object"}}];function Di(A){return am.reduce((u,{parser:g,result:x})=>u||(g(A)?x:null),null)}function No(A,u="int"){const g=Di(A);return g?g.notation==="hex"&&u!=="float"?Object.assign(Object.assign({},g),{type:"int"}):g.notation==="func"?Object.assign(Object.assign({},g),{type:u}):null:null}const om={int:[Qn,uA,Sl("int"),Kc("int"),Jc("int"),et("int"),Il("int"),ju("int")],float:[Sl("float"),Kc("float"),Jc("float"),et("float"),Il("float"),ju("float")]};function lm(A){const u=om[A];return g=>{if(typeof g!="string")return kt.black(A);const x=u.reduce((O,H)=>O||H(g),null);return x??kt.black(A)}}function ca(A){const u=om[A];return g=>u.reduce((x,O)=>x||O(g),null)}function ns(A){const u=qi(Math.floor(A),0,255).toString(16);return u.length===1?`0${u}`:u}function Pl(A,u="#"){return`${u}${Yi(A.getComponents("rgb")).map(ns).join("")}`}function Ha(A,u="#"){const g=A.getComponents("rgb");return`${u}${[g[0],g[1],g[2],255*g[3]].map(ns).join("")}`}function cm(A,u){const g=Cr(u==="float"?2:0);return`rgb(${Yi(A.getComponents("rgb",u)).map(x=>g(x)).join(", ")})`}function pA(A){return u=>cm(u,A)}function Rl(A,u){const g=Cr(2),x=Cr(u==="float"?2:0);return`rgba(${A.getComponents("rgb",u).map((O,H)=>(H===3?g:x)(O)).join(", ")})`}function hm(A){return u=>Rl(u,A)}function um(A){const u=[Cr(0),Nc,Nc];return`hsl(${Yi(A.getComponents("hsl")).map((g,x)=>u[x](g)).join(", ")})`}function dA(A){const u=[Cr(0),Nc,Nc,Cr(2)];return`hsla(${A.getComponents("hsl").map((g,x)=>u[x](g)).join(", ")})`}function Hu(A,u){const g=Cr(u==="float"?2:0),x=["r","g","b"];return`{${Yi(A.getComponents("rgb",u)).map((O,H)=>`${x[H]}: ${g(O)}`).join(", ")}}`}function It(A){return u=>Hu(u,A)}function In(A,u){const g=Cr(2),x=Cr(u==="float"?2:0),O=["r","g","b","a"];return`{${A.getComponents("rgb",u).map((H,ce)=>{const We=ce===3?g:x;return`${O[ce]}: ${We(H)}`}).join(", ")}}`}function Bs(A){return u=>In(u,A)}const Wu=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Pl},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Ha},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:um},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:dA},...["int","float"].reduce((A,u)=>[...A,{format:{alpha:!1,mode:"rgb",notation:"func",type:u},stringifier:pA(u)},{format:{alpha:!0,mode:"rgb",notation:"func",type:u},stringifier:hm(u)},{format:{alpha:!1,mode:"rgb",notation:"object",type:u},stringifier:It(u)},{format:{alpha:!0,mode:"rgb",notation:"object",type:u},stringifier:Bs(u)}],[])];function Vn(A){return Wu.reduce((u,g)=>u||(Ml(g.format,A)?g.stringifier:null),null)}const ss=Ie("apl");class Go{constructor(u,g){this.onValueChange_=this.onValueChange_.bind(this),this.value=g.value,this.value.emitter.on("change",this.onValueChange_),this.element=u.createElement("div"),this.element.classList.add(ss()),g.viewProps.bindClassModifiers(this.element),g.viewProps.bindTabIndex(this.element);const x=u.createElement("div");x.classList.add(ss("b")),this.element.appendChild(x);const O=u.createElement("div");O.classList.add(ss("c")),x.appendChild(O),this.colorElem_=O;const H=u.createElement("div");H.classList.add(ss("m")),this.element.appendChild(H),this.markerElem_=H;const ce=u.createElement("div");ce.classList.add(ss("p")),this.markerElem_.appendChild(ce),this.previewElem_=ce,this.update_()}update_(){const u=this.value.rawValue,g=u.getComponents("rgb"),x=new kt([g[0],g[1],g[2],0],"rgb"),O=new kt([g[0],g[1],g[2],255],"rgb"),H=["to right",Rl(x),Rl(O)];this.colorElem_.style.background=`linear-gradient(${H.join(",")})`,this.previewElem_.style.backgroundColor=Rl(u);const ce=ne(g[3],0,1,0,100);this.markerElem_.style.left=`${ce}%`}onValueChange_(){this.update_()}}class pm{constructor(u,g){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=g.value,this.viewProps=g.viewProps,this.view=new Go(u,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Zt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(u,g){if(!u.point)return;const x=u.point.x/u.bounds.width,O=this.value.rawValue,[H,ce,We]=O.getComponents("hsv");this.value.setRawValue(new kt([H,ce,We,x],"hsv"),g)}onPointerDown_(u){this.handlePointerEvent_(u.data,{forceEmit:!1,last:!1})}onPointerMove_(u){this.handlePointerEvent_(u.data,{forceEmit:!1,last:!1})}onPointerUp_(u){this.handlePointerEvent_(u.data,{forceEmit:!0,last:!0})}onKeyDown_(u){const g=Br(Ps(!0),Mn(u));if(g===0)return;const x=this.value.rawValue,[O,H,ce,We]=x.getComponents("hsv");this.value.setRawValue(new kt([O,H,ce,We+g],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(u){Br(Ps(!0),Mn(u))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const ha=Ie("coltxt");function Xu(A){const u=A.createElement("select"),g=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];return u.appendChild(g.reduce((x,O)=>{const H=A.createElement("option");return H.textContent=O.text,H.value=O.value,x.appendChild(H),x},A.createDocumentFragment())),u}class qu{constructor(u,g){this.element=u.createElement("div"),this.element.classList.add(ha()),g.viewProps.bindClassModifiers(this.element);const x=u.createElement("div");x.classList.add(ha("m")),this.modeElem_=Xu(u),this.modeElem_.classList.add(ha("ms")),x.appendChild(this.modeSelectElement),g.viewProps.bindDisabled(this.modeElem_);const O=u.createElement("div");O.classList.add(ha("mm")),O.appendChild(bo(u,"dropdown")),x.appendChild(O),this.element.appendChild(x);const H=u.createElement("div");H.classList.add(ha("w")),this.element.appendChild(H),this.textsElem_=H,this.textViews_=g.textViews,this.applyTextViews_(),Qt(g.colorMode,ce=>{this.modeElem_.value=ce})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(u){this.textViews_=u,this.applyTextViews_()}applyTextViews_(){ys(this.textsElem_);const u=this.element.ownerDocument;this.textViews_.forEach(g=>{const x=u.createElement("div");x.classList.add(ha("c")),x.appendChild(g.element),this.textsElem_.appendChild(x)})}}function Zc(A){return Cr(A==="float"?2:0)}function tn(A,u,g){const x=Ts(A,u)[g];return new Cn({min:0,max:x})}function Yu(A,u,g){return new Ms(A,{arrayPosition:g===0?"fst":g===2?"lst":"mid",baseStep:Ps(!1),parser:u.parser,props:Vt.fromObject({draggingScale:u.colorType==="float"?.01:1,formatter:Zc(u.colorType)}),value:gr(0,{constraint:tn(u.colorMode,u.colorType,g)}),viewProps:u.viewProps})}class Ki{constructor(u,g){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=g.colorType,this.parser_=g.parser,this.value=g.value,this.viewProps=g.viewProps,this.colorMode=gr(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(u),this.view=new qu(u,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(u){const g={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},x=[Yu(u,g,0),Yu(u,g,1),Yu(u,g,2)];return x.forEach((O,H)=>{wl({primary:this.value,secondary:O.value,forward:ce=>ce.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[H],backward:(ce,We)=>{const Mt=this.colorMode.rawValue,li=ce.rawValue.getComponents(Mt,this.colorType_);return li[H]=We.rawValue,new kt(is(Yi(li),li[3]),Mt,this.colorType_)}})}),x}onModeSelectChange_(u){const g=u.currentTarget;this.colorMode.rawValue=g.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const $c=Ie("hpl");class dm{constructor(u,g){this.onValueChange_=this.onValueChange_.bind(this),this.value=g.value,this.value.emitter.on("change",this.onValueChange_),this.element=u.createElement("div"),this.element.classList.add($c()),g.viewProps.bindClassModifiers(this.element),g.viewProps.bindTabIndex(this.element);const x=u.createElement("div");x.classList.add($c("c")),this.element.appendChild(x);const O=u.createElement("div");O.classList.add($c("m")),this.element.appendChild(O),this.markerElem_=O,this.update_()}update_(){const u=this.value.rawValue,[g]=u.getComponents("hsv");this.markerElem_.style.backgroundColor=cm(new kt([g,100,100],"hsv"));const x=ne(g,0,360,0,100);this.markerElem_.style.left=`${x}%`}onValueChange_(){this.update_()}}class jn{constructor(u,g){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=g.value,this.viewProps=g.viewProps,this.view=new dm(u,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Zt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(u,g){if(!u.point)return;const x=ne(qi(u.point.x,0,u.bounds.width),0,u.bounds.width,0,360),O=this.value.rawValue,[,H,ce,We]=O.getComponents("hsv");this.value.setRawValue(new kt([x,H,ce,We],"hsv"),g)}onPointerDown_(u){this.handlePointerEvent_(u.data,{forceEmit:!1,last:!1})}onPointerMove_(u){this.handlePointerEvent_(u.data,{forceEmit:!1,last:!1})}onPointerUp_(u){this.handlePointerEvent_(u.data,{forceEmit:!0,last:!0})}onKeyDown_(u){const g=Br(Ps(!1),Mn(u));if(g===0)return;const x=this.value.rawValue,[O,H,ce,We]=x.getComponents("hsv");this.value.setRawValue(new kt([O+g,H,ce,We],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(u){Br(Ps(!1),Mn(u))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const zo=Ie("svp"),eh=64;class fe{constructor(u,g){this.onValueChange_=this.onValueChange_.bind(this),this.value=g.value,this.value.emitter.on("change",this.onValueChange_),this.element=u.createElement("div"),this.element.classList.add(zo()),g.viewProps.bindClassModifiers(this.element),g.viewProps.bindTabIndex(this.element);const x=u.createElement("canvas");x.height=eh,x.width=eh,x.classList.add(zo("c")),this.element.appendChild(x),this.canvasElement=x;const O=u.createElement("div");O.classList.add(zo("m")),this.element.appendChild(O),this.markerElem_=O,this.update_()}update_(){const u=Dd(this.canvasElement);if(!u)return;const g=this.value.rawValue.getComponents("hsv"),x=this.canvasElement.width,O=this.canvasElement.height,H=u.getImageData(0,0,x,O),ce=H.data;for(let li=0;li<O;li++)for(let rr=0;rr<x;rr++){const Or=ne(rr,0,x,0,100),Za=ne(li,0,O,100,0),$a=P(g[0],Or,Za),Wo=4*(li*x+rr);ce[Wo]=$a[0],ce[Wo+1]=$a[1],ce[Wo+2]=$a[2],ce[Wo+3]=255}u.putImageData(H,0,0);const We=ne(g[1],0,100,0,100);this.markerElem_.style.left=`${We}%`;const Mt=ne(g[2],0,100,100,0);this.markerElem_.style.top=`${Mt}%`}onValueChange_(){this.update_()}}class Lr{constructor(u,g){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=g.value,this.viewProps=g.viewProps,this.view=new fe(u,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Zt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(u,g){if(!u.point)return;const x=ne(u.point.x,0,u.bounds.width,0,100),O=ne(u.point.y,0,u.bounds.height,100,0),[H,,,ce]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new kt([H,x,O,ce],"hsv"),g)}onPointerDown_(u){this.handlePointerEvent_(u.data,{forceEmit:!1,last:!1})}onPointerMove_(u){this.handlePointerEvent_(u.data,{forceEmit:!1,last:!1})}onPointerUp_(u){this.handlePointerEvent_(u.data,{forceEmit:!0,last:!0})}onKeyDown_(u){Jr(u.key)&&u.preventDefault();const[g,x,O,H]=this.value.rawValue.getComponents("hsv"),ce=Ps(!1),We=Br(ce,Mn(u)),Mt=Br(ce,Lo(u));We===0&&Mt===0||this.value.setRawValue(new kt([g,x+We,O+Mt,H],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(u){const g=Ps(!1),x=Br(g,Mn(u)),O=Br(g,Lo(u));x===0&&O===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Pn{constructor(u,g){this.value=g.value,this.viewProps=g.viewProps,this.hPaletteC_=new jn(u,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Lr(u,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=g.supportsAlpha?{palette:new pm(u,{value:this.value,viewProps:this.viewProps}),text:new Ms(u,{parser:Cs,baseStep:.1,props:Vt.fromObject({draggingScale:.01,formatter:Cr(2)}),value:gr(0,{constraint:new Cn({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&wl({primary:this.value,secondary:this.alphaIcs_.text.value,forward:x=>x.rawValue.getComponents()[3],backward:(x,O)=>{const H=x.rawValue.getComponents();return H[3]=O.rawValue,new kt(H,x.rawValue.mode)}}),this.textC_=new Ki(u,{colorType:g.colorType,parser:Cs,value:this.value,viewProps:this.viewProps}),this.view=new Xc(u,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:g.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view,viewProps:this.viewProps})}get textController(){return this.textC_}}const Hn=Ie("colsw");class mA{constructor(u,g){this.onValueChange_=this.onValueChange_.bind(this),g.value.emitter.on("change",this.onValueChange_),this.value=g.value,this.element=u.createElement("div"),this.element.classList.add(Hn()),g.viewProps.bindClassModifiers(this.element);const x=u.createElement("div");x.classList.add(Hn("sw")),this.element.appendChild(x),this.swatchElem_=x;const O=u.createElement("button");O.classList.add(Hn("b")),g.viewProps.bindDisabled(O),this.element.appendChild(O),this.buttonElement=O,this.update_()}update_(){const u=this.value.rawValue;this.swatchElem_.style.backgroundColor=Ha(u)}onValueChange_(){this.update_()}}class rn{constructor(u,g){this.value=g.value,this.viewProps=g.viewProps,this.view=new mA(u,{value:this.value,viewProps:this.viewProps})}}class Wa{constructor(u,g){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=g.value,this.viewProps=g.viewProps,this.foldable_=Gn.create(g.expanded),this.swatchC_=new rn(u,{value:this.value,viewProps:this.viewProps});const x=this.swatchC_.view.buttonElement;x.addEventListener("blur",this.onButtonBlur_),x.addEventListener("click",this.onButtonClick_),this.textC_=new xs(u,{parser:g.parser,props:Vt.fromObject({formatter:g.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Wc(u,{foldable:this.foldable_,pickerLayout:g.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=g.pickerLayout==="popup"?new Uc(u,{viewProps:this.viewProps}):null;const O=new Pn(u,{colorType:g.colorType,supportsAlpha:g.supportsAlpha,value:this.value,viewProps:this.viewProps});O.view.allFocusableElements.forEach(H=>{H.addEventListener("blur",this.onPopupChildBlur_),H.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=O,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(O.view.element),wl({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:H=>H.rawValue,backward:(H,ce)=>ce.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Er(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(u){if(!this.popC_)return;const g=this.view.element,x=u.relatedTarget;x&&g.contains(x)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(u){if(!this.popC_)return;const g=this.popC_.view.element,x=_s(u);x&&g.contains(x)||x&&x===this.swatchC_.view.buttonElement&&!fu(g.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(u){this.popC_?u.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&u.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function Ur(A,u){return kt.isColorObject(A)?kt.fromObject(A,u):kt.black(u)}function ir(A){return Yi(A.getComponents("rgb")).reduce((u,g)=>u<<8|255&Math.floor(g),0)}function th(A){return A.getComponents("rgb").reduce((u,g,x)=>u<<8|255&Math.floor(x===3?255*g:g),0)>>>0}function At(A){return new kt([A>>16&255,A>>8&255,255&A],"rgb")}function fA(A){return new kt([A>>24&255,A>>16&255,A>>8&255,ne(255&A,0,255,0,1)],"rgb")}function gA(A){return typeof A!="number"?kt.black():At(A)}function AA(A){return typeof A!="number"?kt.black():fA(A)}function vA(A){const u=Vn(A);return u?(g,x)=>{Cl(g,u(x))}:null}function ih(A){const u=A?th:ir;return(g,x)=>{Cl(g,u(x))}}function yA(A,u,g){const x=u.toRgbaObject(g);A.writeProperty("r",x.r),A.writeProperty("g",x.g),A.writeProperty("b",x.b),A.writeProperty("a",x.a)}function Ku(A,u,g){const x=u.toRgbaObject(g);A.writeProperty("r",x.r),A.writeProperty("g",x.g),A.writeProperty("b",x.b)}function _A(A,u){return(g,x)=>{A?yA(g,x,u):Ku(g,x,u)}}function Ne(A){var u;return!(!(A!=null&&A.alpha)&&!(!((u=A==null?void 0:A.color)===null||u===void 0)&&u.alpha))}function bA(A){return A?u=>Ha(u,"0x"):u=>Pl(u,"0x")}function wA(A){return"color"in A||"view"in A&&A.view==="color"}const Rn={id:"input-color-number",type:"input",accept:(A,u)=>{if(typeof A!="number"||!wA(u))return null;const g=Is(u);return g?{initialValue:A,params:g}:null},binding:{reader:A=>Ne(A.params)?AA:gA,equals:kt.equals,writer:A=>ih(Ne(A.params))},controller:A=>{const u=Ne(A.params),g="expanded"in A.params?A.params.expanded:void 0,x="picker"in A.params?A.params.picker:void 0;return new Wa(A.document,{colorType:"int",expanded:g!=null&&g,formatter:bA(u),parser:ca("int"),pickerLayout:x??"popup",supportsAlpha:u,value:A.value,viewProps:A.viewProps})}};function Ju(A){return kt.isRgbaColorObject(A)}function Xa(A){return u=>Ur(u,A)}function mn(A,u){return g=>A?In(g,u):Hu(g,u)}const Dl={id:"input-color-object",type:"input",accept:(A,u)=>{if(!kt.isColorObject(A))return null;const g=Is(u);return g?{initialValue:A,params:g}:null},binding:{reader:A=>Xa(Qa(A.params)),equals:kt.equals,writer:A=>_A(Ju(A.initialValue),Qa(A.params))},controller:A=>{var u;const g=kt.isRgbaColorObject(A.initialValue),x="expanded"in A.params?A.params.expanded:void 0,O="picker"in A.params?A.params.picker:void 0,H=(u=Qa(A.params))!==null&&u!==void 0?u:"int";return new Wa(A.document,{colorType:H,expanded:x!=null&&x,formatter:mn(g,H),parser:ca(H),pickerLayout:O??"popup",supportsAlpha:g,value:A.value,viewProps:A.viewProps})}},vr={id:"input-color-string",type:"input",accept:(A,u)=>{if(typeof A!="string"||"view"in u&&u.view==="text")return null;const g=No(A,Qa(u));if(!g||!Vn(g))return null;const x=Is(u);return x?{initialValue:A,params:x}:null},binding:{reader:A=>{var u;return lm((u=Qa(A.params))!==null&&u!==void 0?u:"int")},equals:kt.equals,writer:A=>{const u=No(A.initialValue,Qa(A.params));if(!u)throw yt.shouldNeverHappen();const g=vA(u);if(!g)throw yt.notBindable();return g}},controller:A=>{const u=No(A.initialValue,Qa(A.params));if(!u)throw yt.shouldNeverHappen();const g=Vn(u);if(!g)throw yt.shouldNeverHappen();const x="expanded"in A.params?A.params.expanded:void 0,O="picker"in A.params?A.params.picker:void 0;return new Wa(A.document,{colorType:u.type,expanded:x!=null&&x,formatter:g,parser:ca(u.type),pickerLayout:O??"popup",supportsAlpha:u.alpha,value:A.value,viewProps:A.viewProps})}};class ht{constructor(u){this.components=u.components,this.asm_=u.assembly}constrain(u){const g=this.asm_.toComponents(u).map((x,O)=>{var H,ce;return(ce=(H=this.components[O])===null||H===void 0?void 0:H.constrain(x))!==null&&ce!==void 0?ce:x});return this.asm_.fromComponents(g)}}const Zu=Ie("pndtxt");class qa{constructor(u,g){this.textViews=g.textViews,this.element=u.createElement("div"),this.element.classList.add(Zu()),this.textViews.forEach(x=>{const O=u.createElement("div");O.classList.add(Zu("a")),O.appendChild(x.element),this.element.appendChild(O)})}}function rh(A,u,g){return new Ms(A,{arrayPosition:g===0?"fst":g===u.axes.length-1?"lst":"mid",baseStep:u.axes[g].baseStep,parser:u.parser,props:u.axes[g].textProps,value:gr(0,{constraint:u.axes[g].constraint}),viewProps:u.viewProps})}class nh{constructor(u,g){this.value=g.value,this.viewProps=g.viewProps,this.acs_=g.axes.map((x,O)=>rh(u,g,O)),this.acs_.forEach((x,O)=>{wl({primary:this.value,secondary:x.value,forward:H=>g.assembly.toComponents(H.rawValue)[O],backward:(H,ce)=>{const We=g.assembly.toComponents(H.rawValue);return We[O]=ce.rawValue,g.assembly.fromComponents(We)}})}),this.view=new qa(u,{textViews:this.acs_.map(x=>x.view)})}}function Ya(A,u){return"step"in A&&!Ze(A.step)?new ws(A.step,u):null}function Ka(A){return Ze(A.max)||Ze(A.min)?Ze(A.max)&&Ze(A.min)?null:new Fa({max:A.max,min:A.min}):new Cn({max:A.max,min:A.min})}function Qo(A){const u=Kr(A,Cn);if(u)return[u.values.get("min"),u.values.get("max")];const g=Kr(A,Fa);return g?[g.minValue,g.maxValue]:[void 0,void 0]}function $u(A,u){const g=[],x=Ya(A,u);x&&g.push(x);const O=Ka(A);O&&g.push(O);const H=aa(A.options);return H&&g.push(H),new yl(g)}const sh={id:"input-number",type:"input",accept:(A,u)=>{if(typeof A!="number")return null;const g=Ri,x=xr(u,{format:g.optional.function,max:g.optional.number,min:g.optional.number,options:g.optional.custom(zc),step:g.optional.number});return x?{initialValue:A,params:x}:null},binding:{reader:A=>em,constraint:A=>$u(A.params,A.initialValue),writer:A=>Cl},controller:A=>{var u;const g=A.value,x=A.constraint,O=x&&Kr(x,ka);if(O)return new Po(A.document,{props:new Vt({options:O.values.value("options")}),value:g,viewProps:A.viewProps});const H=(u="format"in A.params?A.params.format:void 0)!==null&&u!==void 0?u:Cr(Vc(x,g.rawValue)),ce=x&&Kr(x,Cn);return ce?new Qu(A.document,{baseStep:Zr(x),parser:Cs,sliderProps:new Vt({maxValue:ce.values.value("max"),minValue:ce.values.value("min")}),textProps:Vt.fromObject({draggingScale:oa(x,g.rawValue),formatter:H}),value:g,viewProps:A.viewProps}):new Ms(A.document,{baseStep:Zr(x),parser:Cs,props:Vt.fromObject({draggingScale:oa(x,g.rawValue),formatter:H}),value:g,viewProps:A.viewProps})}};class Wn{constructor(u=0,g=0){this.x=u,this.y=g}getComponents(){return[this.x,this.y]}static isObject(u){if(Ze(u))return!1;const g=u.x,x=u.y;return typeof g=="number"&&typeof x=="number"}static equals(u,g){return u.x===g.x&&u.y===g.y}toObject(){return{x:this.x,y:this.y}}}const Bl={toComponents:A=>A.getComponents(),fromComponents:A=>new Wn(...A)},Ls=Ie("p2d");class mm{constructor(u,g){this.element=u.createElement("div"),this.element.classList.add(Ls()),g.viewProps.bindClassModifiers(this.element),Qt(g.expanded,Si(this.element,Ls(void 0,"expanded")));const x=u.createElement("div");x.classList.add(Ls("h")),this.element.appendChild(x);const O=u.createElement("button");O.classList.add(Ls("b")),O.appendChild(bo(u,"p2dpad")),g.viewProps.bindDisabled(O),x.appendChild(O),this.buttonElement=O;const H=u.createElement("div");if(H.classList.add(Ls("t")),x.appendChild(H),this.textElement=H,g.pickerLayout==="inline"){const ce=u.createElement("div");ce.classList.add(Ls("p")),this.element.appendChild(ce),this.pickerElement=ce}else this.pickerElement=null}}const Us=Ie("p2dp");class fm{constructor(u,g){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=g.invertsY,this.maxValue_=g.maxValue,this.element=u.createElement("div"),this.element.classList.add(Us()),g.layout==="popup"&&this.element.classList.add(Us(void 0,"p")),g.viewProps.bindClassModifiers(this.element);const x=u.createElement("div");x.classList.add(Us("p")),g.viewProps.bindTabIndex(x),this.element.appendChild(x),this.padElement=x;const O=u.createElementNS(Nn,"svg");O.classList.add(Us("g")),this.padElement.appendChild(O),this.svgElem_=O;const H=u.createElementNS(Nn,"line");H.classList.add(Us("ax")),H.setAttributeNS(null,"x1","0"),H.setAttributeNS(null,"y1","50%"),H.setAttributeNS(null,"x2","100%"),H.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(H);const ce=u.createElementNS(Nn,"line");ce.classList.add(Us("ax")),ce.setAttributeNS(null,"x1","50%"),ce.setAttributeNS(null,"y1","0"),ce.setAttributeNS(null,"x2","50%"),ce.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(ce);const We=u.createElementNS(Nn,"line");We.classList.add(Us("l")),We.setAttributeNS(null,"x1","50%"),We.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(We),this.lineElem_=We;const Mt=u.createElement("div");Mt.classList.add(Us("m")),this.padElement.appendChild(Mt),this.markerElem_=Mt,g.value.emitter.on("change",this.onValueChange_),this.value=g.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[u,g]=this.value.rawValue.getComponents(),x=this.maxValue_,O=ne(u,-x,+x,0,100),H=ne(g,-x,+x,0,100),ce=this.invertsY_?100-H:H;this.lineElem_.setAttributeNS(null,"x2",`${O}%`),this.lineElem_.setAttributeNS(null,"y2",`${ce}%`),this.markerElem_.style.left=`${O}%`,this.markerElem_.style.top=`${ce}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Ll(A,u,g){return[Br(u[0],Mn(A)),Br(u[1],Lo(A))*(g?1:-1)]}class ah{constructor(u,g){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=g.value,this.viewProps=g.viewProps,this.baseSteps_=g.baseSteps,this.maxValue_=g.maxValue,this.invertsY_=g.invertsY,this.view=new fm(u,{invertsY:this.invertsY_,layout:g.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Zt(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(u,g){if(!u.point)return;const x=this.maxValue_,O=ne(u.point.x,0,u.bounds.width,-x,+x),H=ne(this.invertsY_?u.bounds.height-u.point.y:u.point.y,0,u.bounds.height,-x,+x);this.value.setRawValue(new Wn(O,H),g)}onPointerDown_(u){this.handlePointerEvent_(u.data,{forceEmit:!1,last:!1})}onPointerMove_(u){this.handlePointerEvent_(u.data,{forceEmit:!1,last:!1})}onPointerUp_(u){this.handlePointerEvent_(u.data,{forceEmit:!0,last:!0})}onPadKeyDown_(u){Jr(u.key)&&u.preventDefault();const[g,x]=Ll(u,this.baseSteps_,this.invertsY_);g===0&&x===0||this.value.setRawValue(new Wn(this.value.rawValue.x+g,this.value.rawValue.y+x),{forceEmit:!1,last:!1})}onPadKeyUp_(u){const[g,x]=Ll(u,this.baseSteps_,this.invertsY_);g===0&&x===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Fe{constructor(u,g){var x,O;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=g.value,this.viewProps=g.viewProps,this.foldable_=Gn.create(g.expanded),this.popC_=g.pickerLayout==="popup"?new Uc(u,{viewProps:this.viewProps}):null;const H=new ah(u,{baseSteps:[g.axes[0].baseStep,g.axes[1].baseStep],invertsY:g.invertsY,layout:g.pickerLayout,maxValue:g.maxValue,value:this.value,viewProps:this.viewProps});H.view.allFocusableElements.forEach(ce=>{ce.addEventListener("blur",this.onPopupChildBlur_),ce.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=H,this.textC_=new nh(u,{assembly:Bl,axes:g.axes,parser:g.parser,value:this.value,viewProps:this.viewProps}),this.view=new mm(u,{expanded:this.foldable_.value("expanded"),pickerLayout:g.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(x=this.view.buttonElement)===null||x===void 0||x.addEventListener("blur",this.onPadButtonBlur_),(O=this.view.buttonElement)===null||O===void 0||O.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),wl({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:ce=>ce.rawValue,backward:(ce,We)=>We.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Er(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(u){if(!this.popC_)return;const g=this.view.element,x=u.relatedTarget;x&&g.contains(x)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(u){if(!this.popC_)return;const g=this.popC_.view.element,x=_s(u);x&&g.contains(x)||x&&x===this.view.buttonElement&&!fu(g.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(u){this.popC_?u.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&u.key==="Escape"&&this.view.buttonElement.focus()}}class Vo{constructor(u=0,g=0,x=0){this.x=u,this.y=g,this.z=x}getComponents(){return[this.x,this.y,this.z]}static isObject(u){if(Ze(u))return!1;const g=u.x,x=u.y,O=u.z;return typeof g=="number"&&typeof x=="number"&&typeof O=="number"}static equals(u,g){return u.x===g.x&&u.y===g.y&&u.z===g.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const Ul={toComponents:A=>A.getComponents(),fromComponents:A=>new Vo(...A)};function Bi(A){return Vo.isObject(A)?new Vo(A.x,A.y,A.z):new Vo}function Ja(A,u){A.writeProperty("x",u.x),A.writeProperty("y",u.y),A.writeProperty("z",u.z)}function Qr(A,u){return new ht({assembly:Ul,components:[Ns("x"in A?A.x:void 0,u.x),Ns("y"in A?A.y:void 0,u.y),Ns("z"in A?A.z:void 0,u.z)]})}function ep(A,u){return{baseStep:Zr(u),constraint:u,textProps:Vt.fromObject({draggingScale:oa(u,A),formatter:Cr(Vc(u,A))})}}const gm={id:"input-point3d",type:"input",accept:(A,u)=>{if(!Vo.isObject(A))return null;const g=Ri,x=xr(u,{x:g.optional.custom(sa),y:g.optional.custom(sa),z:g.optional.custom(sa)});return x?{initialValue:A,params:x}:null},binding:{reader:A=>Bi,constraint:A=>Qr(A.params,A.initialValue),equals:Vo.equals,writer:A=>Ja},controller:A=>{const u=A.value,g=A.constraint;if(!(g instanceof ht))throw yt.shouldNeverHappen();return new nh(A.document,{assembly:Ul,axes:[ep(u.rawValue.x,g.components[0]),ep(u.rawValue.y,g.components[1]),ep(u.rawValue.z,g.components[2])],parser:Cs,value:u,viewProps:A.viewProps})}};class Dn{constructor(u=0,g=0,x=0,O=0){this.x=u,this.y=g,this.z=x,this.w=O}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(u){if(Ze(u))return!1;const g=u.x,x=u.y,O=u.z,H=u.w;return typeof g=="number"&&typeof x=="number"&&typeof O=="number"&&typeof H=="number"}static equals(u,g){return u.x===g.x&&u.y===g.y&&u.z===g.z&&u.w===g.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const Am={toComponents:A=>A.getComponents(),fromComponents:A=>new Dn(...A)};function xA(A){return Dn.isObject(A)?new Dn(A.x,A.y,A.z,A.w):new Dn}function yr(A,u){A.writeProperty("x",u.x),A.writeProperty("y",u.y),A.writeProperty("z",u.z),A.writeProperty("w",u.w)}function Ol(A,u){return new ht({assembly:Am,components:[Ns("x"in A?A.x:void 0,u.x),Ns("y"in A?A.y:void 0,u.y),Ns("z"in A?A.z:void 0,u.z),Ns("w"in A?A.w:void 0,u.w)]})}function Qi(A,u){return{baseStep:Zr(u),constraint:u,textProps:Vt.fromObject({draggingScale:oa(u,A),formatter:Cr(Vc(u,A))})}}const jo={id:"input-point4d",type:"input",accept:(A,u)=>{if(!Dn.isObject(A))return null;const g=Ri,x=xr(u,{x:g.optional.custom(sa),y:g.optional.custom(sa),z:g.optional.custom(sa),w:g.optional.custom(sa)});return x?{initialValue:A,params:x}:null},binding:{reader:A=>xA,constraint:A=>Ol(A.params,A.initialValue),equals:Dn.equals,writer:A=>yr},controller:A=>{const u=A.value,g=A.constraint;if(!(g instanceof ht))throw yt.shouldNeverHappen();return new nh(A.document,{assembly:Am,axes:u.rawValue.getComponents().map((x,O)=>Qi(x,g.components[O])),parser:Cs,value:u,viewProps:A.viewProps})}};function Ho(A){const u=[],g=aa(A.options);return g&&u.push(g),new yl(u)}const vm={id:"input-string",type:"input",accept:(A,u)=>{if(typeof A!="string")return null;const g=xr(u,{options:Ri.optional.custom(zc)});return g?{initialValue:A,params:g}:null},binding:{reader:A=>tm,constraint:A=>Ho(A.params),writer:A=>Cl},controller:A=>{const u=A.document,g=A.value,x=A.constraint,O=x&&Kr(x,ka);return O?new Po(u,{props:new Vt({options:O.values.value("options")}),value:g,viewProps:A.viewProps}):new xs(u,{parser:H=>H,props:Vt.fromObject({formatter:Gu}),value:g,viewProps:A.viewProps})}},Os={monitor:{defaultInterval:200,defaultLineCount:3}},oh=Ie("mll");class tp{constructor(u,g){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=g.formatter,this.element=u.createElement("div"),this.element.classList.add(oh()),g.viewProps.bindClassModifiers(this.element);const x=u.createElement("textarea");x.classList.add(oh("i")),x.style.height=`calc(var(--bld-us) * ${g.lineCount})`,x.readOnly=!0,g.viewProps.bindDisabled(x),this.element.appendChild(x),this.textareaElem_=x,g.value.emitter.on("change",this.onValueUpdate_),this.value=g.value,this.update_()}update_(){const u=this.textareaElem_,g=u.scrollTop===u.scrollHeight-u.clientHeight,x=[];this.value.rawValue.forEach(O=>{O!==void 0&&x.push(this.formatter_(O))}),u.textContent=x.join(`
`),g&&(u.scrollTop=u.scrollHeight)}onValueUpdate_(){this.update_()}}class ip{constructor(u,g){this.value=g.value,this.viewProps=g.viewProps,this.view=new tp(u,{formatter:g.formatter,lineCount:g.lineCount,value:this.value,viewProps:this.viewProps})}}const ym=Ie("sgl");class ks{constructor(u,g){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=g.formatter,this.element=u.createElement("div"),this.element.classList.add(ym()),g.viewProps.bindClassModifiers(this.element);const x=u.createElement("input");x.classList.add(ym("i")),x.readOnly=!0,x.type="text",g.viewProps.bindDisabled(x),this.element.appendChild(x),this.inputElement=x,g.value.emitter.on("change",this.onValueUpdate_),this.value=g.value,this.update_()}update_(){const u=this.value.rawValue,g=u[u.length-1];this.inputElement.value=g!==void 0?this.formatter_(g):""}onValueUpdate_(){this.update_()}}class Fs{constructor(u,g){this.value=g.value,this.viewProps=g.viewProps,this.view=new ks(u,{formatter:g.formatter,value:this.value,viewProps:this.viewProps})}}const lh={id:"monitor-bool",type:"monitor",accept:(A,u)=>{if(typeof A!="boolean")return null;const g=xr(u,{lineCount:Ri.optional.number});return g?{initialValue:A,params:g}:null},binding:{reader:A=>pn},controller:A=>{var u;return A.value.rawValue.length===1?new Fs(A.document,{formatter:Lu,value:A.value,viewProps:A.viewProps}):new ip(A.document,{formatter:Lu,lineCount:(u=A.params.lineCount)!==null&&u!==void 0?u:Os.monitor.defaultLineCount,value:A.value,viewProps:A.viewProps})}},Xn=Ie("grl");class _m{constructor(u,g){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=u.createElement("div"),this.element.classList.add(Xn()),g.viewProps.bindClassModifiers(this.element),this.formatter_=g.formatter,this.props_=g.props,this.cursor_=g.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const x=u.createElementNS(Nn,"svg");x.classList.add(Xn("g")),x.style.height=`calc(var(--bld-us) * ${g.lineCount})`,this.element.appendChild(x),this.svgElem_=x;const O=u.createElementNS(Nn,"polyline");this.svgElem_.appendChild(O),this.lineElem_=O;const H=u.createElement("div");H.classList.add(Xn("t"),Ie("tt")()),this.element.appendChild(H),this.tooltipElem_=H,g.value.emitter.on("change",this.onValueUpdate_),this.value=g.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const u=this.svgElem_.getBoundingClientRect(),g=this.value.rawValue.length-1,x=this.props_.get("minValue"),O=this.props_.get("maxValue"),H=[];this.value.rawValue.forEach((rr,Or)=>{if(rr===void 0)return;const Za=ne(Or,0,g,0,u.width),$a=ne(rr,x,O,u.height,0);H.push([Za,$a].join(","))}),this.lineElem_.setAttributeNS(null,"points",H.join(" "));const ce=this.tooltipElem_,We=this.value.rawValue[this.cursor_.rawValue];if(We===void 0)return void ce.classList.remove(Xn("t","a"));const Mt=ne(this.cursor_.rawValue,0,g,0,u.width),li=ne(We,x,O,u.height,0);ce.style.left=`${Mt}px`,ce.style.top=`${li}px`,ce.textContent=`${this.formatter_(We)}`,ce.classList.contains(Xn("t","a"))||(ce.classList.add(Xn("t","a"),Xn("t","in")),vs(ce),ce.classList.remove(Xn("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class EA{constructor(u,g){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=g.props,this.value=g.value,this.viewProps=g.viewProps,this.cursor_=gr(-1),this.view=new _m(u,{cursor:this.cursor_,formatter:g.formatter,lineCount:g.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),fu(u)){const x=new Zt(this.view.element);x.emitter.on("down",this.onGraphPointerDown_),x.emitter.on("move",this.onGraphPointerMove_),x.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(u){const g=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(ne(u.offsetX,0,g.width,0,this.value.rawValue.length))}onGraphPointerDown_(u){this.onGraphPointerMove_(u)}onGraphPointerMove_(u){u.data.point?this.cursor_.rawValue=Math.floor(ne(u.data.point.x,0,u.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function as(A){return"format"in A&&!Ze(A.format)?A.format:Cr(2)}function CA(A){var u;return A.value.rawValue.length===1?new Fs(A.document,{formatter:as(A.params),value:A.value,viewProps:A.viewProps}):new ip(A.document,{formatter:as(A.params),lineCount:(u=A.params.lineCount)!==null&&u!==void 0?u:Os.monitor.defaultLineCount,value:A.value,viewProps:A.viewProps})}function MA(A){var u,g,x;return new EA(A.document,{formatter:as(A.params),lineCount:(u=A.params.lineCount)!==null&&u!==void 0?u:Os.monitor.defaultLineCount,props:Vt.fromObject({maxValue:(g="max"in A.params?A.params.max:null)!==null&&g!==void 0?g:100,minValue:(x="min"in A.params?A.params.min:null)!==null&&x!==void 0?x:0}),value:A.value,viewProps:A.viewProps})}function bm(A){return"view"in A&&A.view==="graph"}const SA={id:"monitor-number",type:"monitor",accept:(A,u)=>{if(typeof A!="number")return null;const g=Ri,x=xr(u,{format:g.optional.function,lineCount:g.optional.number,max:g.optional.number,min:g.optional.number,view:g.optional.string});return x?{initialValue:A,params:x}:null},binding:{defaultBufferSize:A=>bm(A)?64:1,reader:A=>em},controller:A=>bm(A.params)?MA(A):CA(A)},TA={id:"monitor-string",type:"monitor",accept:(A,u)=>{if(typeof A!="string")return null;const g=Ri,x=xr(u,{lineCount:g.optional.number,multiline:g.optional.boolean});return x?{initialValue:A,params:x}:null},binding:{reader:A=>tm},controller:A=>{var u;const g=A.value;return g.rawValue.length>1||"multiline"in A.params&&A.params.multiline?new ip(A.document,{formatter:Gu,lineCount:(u=A.params.lineCount)!==null&&u!==void 0?u:Os.monitor.defaultLineCount,value:g,viewProps:A.viewProps}):new Fs(A.document,{formatter:Gu,value:g,viewProps:A.viewProps})}};function IA(A,u){var g;const x=A.accept(u.target.read(),u.params);if(Ze(x))return null;const O=Ri,H={target:u.target,initialValue:x.initialValue,params:x.params},ce=A.binding.reader(H),We=A.binding.constraint?A.binding.constraint(H):void 0,Mt=gr(ce(x.initialValue),{constraint:We,equals:A.binding.equals}),li=new Kg({reader:ce,target:u.target,value:Mt,writer:A.binding.writer(H)}),rr=O.optional.boolean(u.params.disabled).value,Or=O.optional.boolean(u.params.hidden).value,Za=A.controller({constraint:We,document:u.document,initialValue:x.initialValue,params:x.params,value:li.value,viewProps:Zn.create({disabled:rr,hidden:Or})});return new qt(u.document,{binding:li,blade:es(),props:Vt.fromObject({label:"label"in u.params?(g=O.optional.string(u.params.label).value)!==null&&g!==void 0?g:null:u.target.key}),valueController:Za})}function PA(A,u){return u===0?new Wd:new Lc(A,u??Os.monitor.defaultInterval)}function RA(A,u){var g,x,O;const H=Ri,ce=A.accept(u.target.read(),u.params);if(Ze(ce))return null;const We={target:u.target,initialValue:ce.initialValue,params:ce.params},Mt=A.binding.reader(We),li=(x=(g=H.optional.number(u.params.bufferSize).value)!==null&&g!==void 0?g:A.binding.defaultBufferSize&&A.binding.defaultBufferSize(ce.params))!==null&&x!==void 0?x:1,rr=H.optional.number(u.params.interval).value,Or=new Du({reader:Mt,target:u.target,ticker:PA(u.document,rr),value:Xd(li)}),Za=H.optional.boolean(u.params.disabled).value,$a=H.optional.boolean(u.params.hidden).value,Wo=A.controller({document:u.document,params:ce.params,value:Or.value,viewProps:Zn.create({disabled:Za,hidden:$a})});return new ts(u.document,{binding:Or,blade:es(),props:Vt.fromObject({label:"label"in u.params?(O=H.optional.string(u.params.label).value)!==null&&O!==void 0?O:null:u.target.key}),valueController:Wo})}class DA{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(u){u.type==="blade"?this.pluginsMap_.blades.unshift(u):u.type==="input"?this.pluginsMap_.inputs.unshift(u):u.type==="monitor"&&this.pluginsMap_.monitors.unshift(u)}createInput(u,g,x){if(Ze(g.read()))throw new yt({context:{key:g.key},type:"nomatchingcontroller"});const O=this.pluginsMap_.inputs.reduce((H,ce)=>H??IA(ce,{document:u,target:g,params:x}),null);if(O)return O;throw new yt({context:{key:g.key},type:"nomatchingcontroller"})}createMonitor(u,g,x){const O=this.pluginsMap_.monitors.reduce((H,ce)=>H??RA(ce,{document:u,params:x,target:g}),null);if(O)return O;throw new yt({context:{key:g.key},type:"nomatchingcontroller"})}createBlade(u,g){const x=this.pluginsMap_.blades.reduce((O,H)=>O??Hd(H,{document:u,params:g}),null);if(!x)throw new yt({type:"nomatchingview",context:{params:g}});return x}createBladeApi(u){if(u instanceof qt)return new un(u);if(u instanceof ts)return new di(u);if(u instanceof ia)return new mi(u,this);const g=this.pluginsMap_.blades.reduce((x,O)=>x??O.api({controller:u,pool:this}),null);if(!g)throw yt.shouldNeverHappen();return g}}function BA(){const A=new DA;return[NA,gm,jo,vm,sh,vr,Dl,Rn,Hc,lh,TA,SA,bs,bu,xu,Iu].forEach(u=>{A.register(u)}),A}function LA(A){return Wn.isObject(A)?new Wn(A.x,A.y):new Wn}function UA(A,u){A.writeProperty("x",u.x),A.writeProperty("y",u.y)}function Ns(A,u){if(!A)return;const g=[],x=Ya(A,u);x&&g.push(x);const O=Ka(A);return O&&g.push(O),new yl(g)}function OA(A,u){return new ht({assembly:Bl,components:[Ns("x"in A?A.x:void 0,u.x),Ns("y"in A?A.y:void 0,u.y)]})}function wm(A,u){const[g,x]=A?Qo(A):[];if(!Ze(g)||!Ze(x))return Math.max(Math.abs(g??0),Math.abs(x??0));const O=Zr(A);return Math.max(10*Math.abs(O),10*Math.abs(u))}function kA(A,u){const g=u instanceof ht?u.components[0]:void 0,x=u instanceof ht?u.components[1]:void 0,O=wm(g,A.x),H=wm(x,A.y);return Math.max(O,H)}function xm(A,u){return{baseStep:Zr(u),constraint:u,textProps:Vt.fromObject({draggingScale:oa(u,A),formatter:Cr(Vc(u,A))})}}function FA(A){if(!("y"in A))return!1;const u=A.y;return!!u&&"inverted"in u&&!!u.inverted}const NA={id:"input-point2d",type:"input",accept:(A,u)=>{if(!Wn.isObject(A))return null;const g=Ri,x=xr(u,{expanded:g.optional.boolean,picker:g.optional.custom(im),x:g.optional.custom(sa),y:g.optional.object({inverted:g.optional.boolean,max:g.optional.number,min:g.optional.number,step:g.optional.number})});return x?{initialValue:A,params:x}:null},binding:{reader:A=>LA,constraint:A=>OA(A.params,A.initialValue),equals:Wn.equals,writer:A=>UA},controller:A=>{const u=A.document,g=A.value,x=A.constraint;if(!(x instanceof ht))throw yt.shouldNeverHappen();const O="expanded"in A.params?A.params.expanded:void 0,H="picker"in A.params?A.params.picker:void 0;return new Fe(u,{axes:[xm(g.rawValue.x,x.components[0]),xm(g.rawValue.y,x.components[1])],expanded:O!=null&&O,invertsY:FA(A.params),maxValue:kA(g.rawValue,x),parser:Cs,pickerLayout:H??"popup",value:g,viewProps:A.viewProps})}};class Em extends p{constructor(u){super(u),this.emitter_=new Nt,this.controller_.valueController.value.emitter.on("change",g=>{this.emitter_.emit("change",{event:new W(this,g.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(u){this.controller_.props.set("label",u)}get options(){return this.controller_.valueController.props.get("options")}set options(u){this.controller_.valueController.props.set("options",u)}get value(){return this.controller_.valueController.value.rawValue}set value(u){this.controller_.valueController.value.rawValue=u}on(u,g){const x=g.bind(this);return this.emitter_.on(u,O=>{x(O.event)}),this}}class Cm extends p{constructor(u){super(u),this.emitter_=new Nt,this.controller_.valueController.value.emitter.on("change",g=>{this.emitter_.emit("change",{event:new W(this,g.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(u){this.controller_.props.set("label",u)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(u){this.controller_.valueController.sliderController.props.set("maxValue",u)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(u){this.controller_.valueController.sliderController.props.set("minValue",u)}get value(){return this.controller_.valueController.value.rawValue}set value(u){this.controller_.valueController.value.rawValue=u}on(u,g){const x=g.bind(this);return this.emitter_.on(u,O=>{x(O.event)}),this}}class Mm extends p{constructor(u){super(u),this.emitter_=new Nt,this.controller_.valueController.value.emitter.on("change",g=>{this.emitter_.emit("change",{event:new W(this,g.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(u){this.controller_.props.set("label",u)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(u){this.controller_.valueController.props.set("formatter",u)}get value(){return this.controller_.valueController.value.rawValue}set value(u){this.controller_.valueController.value.rawValue=u}on(u,g){const x=g.bind(this);return this.emitter_.on(u,O=>{x(O.event)}),this}}const GA={id:"list",type:"blade",accept(A){const u=Ri,g=xr(A,{options:u.required.custom(zc),value:u.required.raw,view:u.required.constant("list"),label:u.optional.string});return g?{params:g}:null},controller(A){const u=new ka(cr(A.params.options)),g=gr(A.params.value,{constraint:u}),x=new Po(A.document,{props:new Vt({options:u.values.value("options")}),value:g,viewProps:A.viewProps});return new Ua(A.document,{blade:A.blade,props:Vt.fromObject({label:A.params.label}),valueController:x})},api:A=>A.controller instanceof Ua&&A.controller.valueController instanceof Po?new Em(A.controller):null};function zA(A){return A.reduce((u,g)=>Object.assign(u,{[g.presetKey]:g.read()}),{})}function QA(A,u){A.forEach(g=>{const x=u[g.target.presetKey];x!==void 0&&g.writer(g.target,g.reader(x))})}class VA extends vu{constructor(u,g){super(u,g)}get element(){return this.controller_.view.element}importPreset(u){QA(this.controller_.rackController.rack.find(qt).map(g=>g.binding),u),this.refresh()}exportPreset(){return zA(this.controller_.rackController.rack.find(qt).map(u=>u.binding.target))}refresh(){this.controller_.rackController.rack.find(qt).forEach(u=>{u.binding.read()}),this.controller_.rackController.rack.find(ts).forEach(u=>{u.binding.read()})}}class jA extends So{constructor(u,g){super(u,{expanded:g.expanded,blade:g.blade,props:g.props,root:!0,viewProps:g.viewProps})}}const HA={id:"slider",type:"blade",accept(A){const u=Ri,g=xr(A,{max:u.required.number,min:u.required.number,view:u.required.constant("slider"),format:u.optional.function,label:u.optional.string,value:u.optional.number});return g?{params:g}:null},controller(A){var u,g;const x=(u=A.params.value)!==null&&u!==void 0?u:0,O=new Cn({max:A.params.max,min:A.params.min}),H=new Qu(A.document,{baseStep:1,parser:Cs,sliderProps:new Vt({maxValue:O.values.value("max"),minValue:O.values.value("min")}),textProps:Vt.fromObject({draggingScale:oa(void 0,x),formatter:(g=A.params.format)!==null&&g!==void 0?g:aA}),value:gr(x,{constraint:O}),viewProps:A.viewProps});return new Ua(A.document,{blade:A.blade,props:Vt.fromObject({label:A.params.label}),valueController:H})},api:A=>A.controller instanceof Ua&&A.controller.valueController instanceof Qu?new Cm(A.controller):null},WA={id:"text",type:"blade",accept(A){const u=Ri,g=xr(A,{parse:u.required.function,value:u.required.raw,view:u.required.constant("text"),format:u.optional.function,label:u.optional.string});return g?{params:g}:null},controller(A){var u;const g=new xs(A.document,{parser:A.params.parse,props:Vt.fromObject({formatter:(u=A.params.format)!==null&&u!==void 0?u:x=>String(x)}),value:gr(A.params.value),viewProps:A.viewProps});return new Ua(A.document,{blade:A.blade,props:Vt.fromObject({label:A.params.label}),valueController:g})},api:A=>A.controller instanceof Ua&&A.controller.valueController instanceof xs?new Mm(A.controller):null};function XA(A){const u=A.createElement("div");return u.classList.add(Ie("dfw")()),A.body&&A.body.appendChild(u),u}function Sm(A,u,g){if(A.querySelector(`style[data-tp-style=${u}]`))return;const x=A.createElement("style");x.dataset.tpStyle=u,x.textContent=g,A.head.appendChild(x)}class qA extends VA{constructor(u){var g,x;const O=u??{},H=(g=O.document)!==null&&g!==void 0?g:Rd(),ce=BA();super(new jA(H,{expanded:O.expanded,blade:es(),props:Vt.fromObject({title:O.title}),viewProps:Zn.create()}),ce),this.pool_=ce,this.containerElem_=(x=O.container)!==null&&x!==void 0?x:XA(H),this.containerElem_.appendChild(this.element),this.doc_=H,this.usesDefaultWrapper_=!O.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw yt.alreadyDisposed();return this.doc_}dispose(){const u=this.containerElem_;if(!u)throw yt.alreadyDisposed();if(this.usesDefaultWrapper_){const g=u.parentElement;g&&g.removeChild(u)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(u){("plugin"in u?[u.plugin]:"plugins"in u?u.plugins:[]).forEach(g=>{this.pool_.register(g),this.embedPluginStyle_(g)})}embedPluginStyle_(u){u.css&&Sm(this.document,`plugin-${u.id}`,u.css)}setUpDefaultPlugins_(){Sm(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{padding-bottom:var(--cnt-v-p);padding-left:4px;padding-top:var(--cnt-v-p)}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(u=>{this.embedPluginStyle_(u)}),this.registerPlugin({plugins:[HA,GA,Iu,WA]})}}const YA=new D("3.1.9");ee.BladeApi=p,ee.ButtonApi=_t,ee.FolderApi=vu,ee.InputBindingApi=un,ee.ListApi=Em,ee.MonitorBindingApi=di,ee.Pane=qA,ee.SeparatorApi=Dc,ee.SliderApi=Cm,ee.TabApi=Mu,ee.TabPageApi=Cu,ee.TextApi=Mm,ee.TpChangeEvent=W,ee.VERSION=YA,Object.defineProperty(ee,"__esModule",{value:!0})})(wS);/**
 * @license
 * uiconfig.js v0.0.8
 * Copyright 2022-2023 repalash <palash@shaders.app>
 * MIT License
 *//**
 * @license
 * ts-browser-helpers v0.5.0
 * Copyright 2022-2023 repalash <palash@shaders.app>
 * MIT License
 */class x5{constructor(){this._eventListeners={},this.dispatchEvent=this.dispatchEvent.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.hasEventListener=this.hasEventListener.bind(this)}addEventListener(D,p){const K=this._eventListeners;K[D]===void 0&&(K[D]=[]),K[D].includes(p)||K[D].push(p)}hasEventListener(D,p){const K=this._eventListeners;return K[D]!==void 0&&K[D].includes(p)}removeEventListener(D,p){const K=this._eventListeners[D];if(K!==void 0){const W=K.indexOf(p);W!==-1&&K.splice(W,1)}}dispatchEvent(D){const p=this._eventListeners[D.type];if(p!==void 0){D.target=this;const K=p.slice(0);for(let W=0,re=K.length;W<re;W++)K[W].call(this,D)}}}async function E5(ee){return new Promise(D=>setTimeout(D,Math.max(0,ee)))}function C5(ee,D,p=!0,K=!1){const W=function(re,ue){let de;do de=Object.getOwnPropertyDescriptor(re,ue);while(!de&&(re=Object.getPrototypeOf(re)));return de}(ee,D);return!!(W!=null&&W.set)||p&&(W==null?void 0:W.writable)!==!1&&(W==null?void 0:W.get)===void 0||K&&!W}function Cd(ee,...D){return typeof ee=="function"&&(ee=ee(...D)),ee}let Vg;const M5=new Uint8Array(16);function S5(){if(!Vg&&(Vg=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Vg))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Vg(M5)}const Yr=[];for(let ee=0;ee<256;++ee)Yr.push((ee+256).toString(16).slice(1));var uS={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function T5(ee,D,p){if(uS.randomUUID&&!D&&!ee)return uS.randomUUID();const K=(ee=ee||{}).random||(ee.rng||S5)();return K[6]=15&K[6]|64,K[8]=63&K[8]|128,function(W,re=0){return(Yr[W[re+0]]+Yr[W[re+1]]+Yr[W[re+2]]+Yr[W[re+3]]+"-"+Yr[W[re+4]]+Yr[W[re+5]]+"-"+Yr[W[re+6]]+Yr[W[re+7]]+"-"+Yr[W[re+8]]+Yr[W[re+9]]+"-"+Yr[W[re+10]]+Yr[W[re+11]]+Yr[W[re+12]]+Yr[W[re+13]]+Yr[W[re+14]]+Yr[W[re+15]]).toLowerCase()}(K)}function ou(ee,D,p,K){return new(p||(p=Promise))(function(W,re){function ue(Ze){try{ve(K.next(Ze))}catch(Xe){re(Xe)}}function de(Ze){try{ve(K.throw(Ze))}catch(Xe){re(Xe)}}function ve(Ze){var Xe;Ze.done?W(Ze.value):(Xe=Ze.value,Xe instanceof p?Xe:new p(function(tt){tt(Xe)})).then(ue,de)}ve((K=K.apply(ee,[])).next())})}class I5{constructor(D){this._renderer=D}getBinding(D){let p=Cd(D.property);const K=Cd(D.path);if(!p||typeof p[0]!="object"||!p[1])return[void 0,""];if(typeof p[1]=="string"&&K&&K.length&&(p=[p[0],p[1]+"."+K]),typeof p[1]=="string"&&p[1].includes(".")){const W=p[1].split(".");let re=p[0];const ue=W.pop()||"";for(const de of W)if(re=Array.isArray(re)?re[parseInt(de)]:re[de],!re)return console.warn("Cannot determine property, invalid property path",D,p),[void 0,""];p=[re,ue]}return Array.isArray(p[0])&&typeof p[1]=="string"&&(p[1]=parseInt(p[1])),p}getValue(D){const[p,K]=this.getBinding(D);return p?p[K]:void 0}dispatchOnChangeSync(D,p,...K){var W,re,ue;const de=[{type:"change",last:(W=p.last)===null||W===void 0||W,config:(re=p.config)!==null&&re!==void 0?re:D,configPath:[D,...p.configPath||[]],target:D,value:p.value,lastValue:p.lastValue},...K];typeof D.onChange=="function"?D.onChange(...de):Array.isArray(D.onChange)?D.onChange.flat().forEach(ve=>typeof ve=="function"&&(ve==null?void 0:ve(...de))):D.onChange&&console.error("Invalid onChange type, must be a function or array of functions",D.onChange),(ue=D.parentOnChange)===null||ue===void 0||ue.call(D,...de)}setValue(D,p,K,W){return ou(this,void 0,void 0,function*(){return this.runAtEvent(D,()=>{var re;const[ue,de]=this.getBinding(D),ve=(re=K.lastValue)!==null&&re!==void 0?re:ue[de];return!!(ue&&p!==ve&&function(Ze,Xe,tt,vi=!0,yt=!1){return!(!Ze||!C5(Ze,Xe,vi,yt)||(Ze[Xe]=tt,0))}(ue,de,p,!0,!0)||W)&&(this.dispatchOnChangeSync(D,Object.assign(Object.assign({},K),{value:p,lastValue:ve})),!0)})})}dispatchOnChange(D,p){return ou(this,void 0,void 0,function*(){return this.runAtEvent(D,()=>{this.dispatchOnChangeSync(D,p)})})}getLabel(D){var p;return((p=Cd(D.label))!==null&&p!==void 0?p:this.getBinding(D)[1])+""}getChildren(D){var p;return((p=D.children)!==null&&p!==void 0?p:[]).map(K=>Cd(K)).flat(2).filter(K=>K)}clickButton(D,p){return ou(this,void 0,void 0,function*(){return this.runAtEvent(D,()=>ou(this,void 0,void 0,function*(){var K,W;const re=this.getBinding(D),ue=(K=re[0])!==null&&K!==void 0?K:D,de=ue[re[1]||"onClick"];typeof de=="function"?de.call(ue,...(W=p==null?void 0:p.args)!==null&&W!==void 0?W:[]):de&&console.warn("Invalid action type for button",de),this.dispatchOnChange(D,{})}))})}runAtEvent(D,p){var K;return ou(this,void 0,void 0,function*(){const W=(K=Cd(D.dispatchMode))!==null&&K!==void 0?K:"postFrame";return W==="immediate"?p():new Promise(re=>{const ue=()=>ou(this,void 0,void 0,function*(){this._renderer.removeEventListener(W,ue),re(yield p())});this._renderer.addEventListener(W,ue)})})}initUiConfig(D){D&&(D.type||(console.warn("No type for config",D),D.type="input"),D.uuid||(D.uuid=T5()),D.property===void 0&&(D.binding?D.property=D.binding:D.value===void 0?(D.getValue||D.setValue)&&Object.defineProperty(D,"value",{get:()=>D.getValue&&D.getValue(),set:p=>D.setValue&&D.setValue(p)}):(D.getValue||D.setValue)&&console.warn("getValue/setValue is ignored since value is provided",D),D.property===void 0&&D.value!==void 0&&(D.property=[D,"value"])))}}class P5 extends x5{constructor(D=document.body,p=!0,K){super(),this.config={type:"panel",label:"Configuration",children:[]},this._refreshQueue={preRender:[],postRender:[],preFrame:[],postFrame:[]},this._lastModeTime={preRender:0,postRender:0,preFrame:0,postFrame:0},this.methods=K||new I5(this);const W=this._createUiContainer();if(D.appendChild(W),p){this.addEventListener("preFrame",()=>this.refreshQueue("preFrame")),this.addEventListener("postFrame",()=>this.refreshQueue("postFrame")),this.addEventListener("preRender",()=>this.refreshQueue("preRender")),this.addEventListener("postRender",()=>this.refreshQueue("postRender"));const re=()=>{this.dispatchEvent({type:"preFrame"}),this.dispatchEvent({type:"preRender"}),this.dispatchEvent({type:"postRender"}),this.dispatchEvent({type:"postFrame"}),requestAnimationFrame(re)};requestAnimationFrame(re)}}refreshQueue(D){const p=this._refreshQueue[D],K=[],W=(typeof performance>"u"?Date:performance).now(),re=W-this._lastModeTime[D];p.forEach(ue=>{ue[1]>.001?(ue[1]-=re,K.push(ue)):this._refreshUiConfigObject(ue[0])}),this._refreshQueue[D]=K,this._lastModeTime[D]=W}_addToRefreshQueue(D,p,K){const W=p.uuid,re=this._refreshQueue[D],ue=re.find(de=>de[2]===W);ue?ue[1]=Math.max(ue[1],K):re.push([p,K,W]),this._refreshQueue[D]=re}dispose(){}appendChild(D,p){D&&(Object.assign(D,p),this.config.children.push(D),this.refreshRoot())}removeChild(D){const p=this.config.children.indexOf(D);p!==-1&&(this.config.children.splice(p,1),this.disposeUiConfig(D),this.refreshRoot())}refreshRoot(D=!0,p="postFrame",K=0){var W,re;(re=(W=this.config).uiRefresh)===null||re===void 0||re.call(W,D,p,K)}disposeUiConfig(D,p=!0){var K,W;D&&(D.uiRef&&(p&&((W=(K=D.uiRef).dispose)===null||W===void 0||W.call(K)),D.uiRef=void 0),D.uiRefType=void 0,D.uiRefresh=void 0)}addToRefreshQueue(D,p,K,W){const re=K?this._flattenUiConfig(p):[p];for(const ue of re)D==="immediate"?E5(W).then(()=>this._refreshUiConfigObject(ue)):this._addToRefreshQueue(D,ue,W)}_createUiContainer(){return function({innerHTML:D="",id:p,classList:K,addToBody:W=!0,elementTag:re="div"}){const ue=document.createElement(re);return p&&(ue.id=p),ue.innerHTML=D,K&&ue.classList.add(...K),W&&document.body.appendChild(ue),ue}({id:"uiConfigContainer",addToBody:!1})}_flattenUiConfig(D,p){var K;return p=p??[],D&&D.uiRef&&(p.push(D),(K=D.children)===null||K===void 0||K.forEach(W=>{typeof W!="function"&&W&&(Array.isArray(W)?W.forEach(re=>p=this._flattenUiConfig(re,p)):p=this._flattenUiConfig(W,p))})),p}}function R5(ee,D,p,K){return new(p||(p=Promise))(function(W,re){function ue(Ze){try{ve(K.next(Ze))}catch(Xe){re(Xe)}}function de(Ze){try{ve(K.throw(Ze))}catch(Xe){re(Xe)}}function ve(Ze){var Xe;Ze.done?W(Ze.value):(Xe=Ze.value,Xe instanceof p?Xe:new p(function(tt){tt(Xe)})).then(ue,de)}ve((K=K.apply(ee,[])).next())})}const D5=(ee,D,p)=>{var K,W;const re=ee.controller_,ue=(W=(K=re.parent)===null||K===void 0?void 0:K.children)===null||W===void 0?void 0:W.indexOf(re);return(!((ve,Ze)=>Ze.controller_.rackController.rack===ve.controller_.parent)(ee,D)||ue!==p)&&(D.add(ee,p),!0)},pS=(ee,D,p,K)=>{var W,re,ue;let de=D.uiRef;de!=null&&de.controller_.viewProps.get("disposed")&&(de=void 0);const ve=de==null?void 0:de.expanded;if(!de){const zt=ee.addFolder({title:""});de=zt,de.on("fold",_t=>{var Nt,Ci,Ie;let $e=zt.expanded;(function(dt,Qt,ii,Oi=!0,Si=!1){!dt||!w5(dt,Qt,Oi,Si)||(dt[Qt]=ii)})(D,"expanded",$e,!0),$e=(Nt=Zs(D.expanded))!==null&&Nt!==void 0?Nt:$e,$e!==zt.expanded&&(zt.expanded=$e),(Ci=D.uiRefresh)===null||Ci===void 0||Ci.call(D,!0,"postFrame"),$e&&((Ie=D.onExpand)===null||Ie===void 0||Ie.call(D,D))})}if(!de)return de;de.expanded=(re=(W=Zs(D.expanded))!==null&&W!==void 0?W:ve)!==null&&re!==void 0&&re;const Ze=p.methods.getChildren(D);let Xe=0;for(const zt of Ze){zt.parentOnChange=(Nt,...Ci)=>{p.methods.dispatchOnChangeSync(D,Object.assign({},Nt),...Ci)},zt.property!==void 0||zt.value!==void 0||zt.getValue!==void 0||zt.setValue!==void 0||zt.type==="button"||D.property===void 0&&D.value===void 0||(zt.property=D.property!==void 0?D.property:[D,"value"]);let _t=zt.uiRef;_t&&_t.controller_.viewProps.get("disposed")&&p.disposeUiConfig(zt,!1),_t=zt.uiRef,_t||(p.renderUiObject(zt,de),_t=zt.uiRef),_t&&D5(_t,de,Xe++)&&p.renderUiObject(zt,de)}let tt=de.children;for(;tt.length>Xe;){const zt=tt[tt.length-1];de.remove(zt),tt=de.children;const _t=zt.srcUiConfig;_t&&(_t.parentOnChange=void 0,Array.isArray(_t.property)&&(_t.property===D.property||_t.property[0]===D&&_t.property[1]==="value")&&delete _t.property)}de.controller_.props.set("title",p.methods.getLabel(D));const vi=de.controller_.view.containerElement,yt=Zs(D.domChildren,[]);if((yt==null?void 0:yt.length)!==void 0){const zt=[];for(let _t=0;_t<vi.children.length;_t++){const Nt=vi.children[_t];!((ue=Nt.dataset)===null||ue===void 0)&&ue.tpCustomDOM&&zt.push(Nt)}for(const _t of zt)vi.removeChild(_t);for(const _t of yt)_t.parentElement!==vi&&(vi.appendChild(_t),_t.dataset.tpCustomDOM="true");de.controller_.foldable.cleanUpTransition()}return de},Js=(ee,D,p,K)=>{var W,re;K=K??{};const ue=Object.assign({label:p.methods.getLabel(D)},K);let de=D.uiRef;de!=null&&de.controller_.viewProps.get("disposed")&&(de=void 0);let ve=D.__proxy;var Ze,Xe;if(ve||(ve=D.__proxy={}),Ze=ve,Xe="value_",(Object.hasOwn?Object.hasOwn(Ze,Xe):Ze.hasOwnProperty(Xe))||(ve.value=p.methods.getValue(D)),!de)try{if(!ue.view&&Zs(D.readOnly)){const[tt,vi]=p.methods.getBinding(D);de=tt?ee.addMonitor(tt,vi,ue):void 0}else de=ee.addInput(ve,"value",ue).on("change",tt=>{var vi,yt;ve.listedOnChange!==!1&&p.methods.setValue(D,(vi=ve.value_)!==null&&vi!==void 0?vi:ve.value,{last:(yt=tt.last)===null||yt===void 0||yt},ve.forceOnChange||!1)})}catch(tt){if(!tt.message.startsWith("No matching controller for"))throw tt;de=void 0}if(de){for(const[tt,vi]of Object.entries(ue)){const yt=de.controller_.props.value(tt);yt!==void 0&&yt.rawValue!==vi&&de.controller_.props.set(tt,vi)}D.type==="slider"&&(ue.min!==void 0&&de.controller_.valueController.sliderController.props.set("minValue",ue.min),ue.max!==void 0&&de.controller_.valueController.sliderController.props.set("maxValue",ue.max)),(W=(de==null?void 0:de.controller_.valueController.view).inputElement)===null||W===void 0||W.setAttribute("placeholder",(re=Zs(D.placeholder))!==null&&re!==void 0?re:""),de.refresh()}return de},Md=(ee,D,p,K)=>{var W,re,ue;D.__proxy||(D.__proxy={}),D.__proxy.forceOnChange=!0;const de=Zs(D.bounds);if(!de||de.length<1)return Js(ee,D,p,Object.assign({},K??{}));const ve=((W=de.length)!==null&&W!==void 0?W:0)>=2?de[1]:1,Ze=((re=de.length)!==null&&re!==void 0?re:0)>=1?de[0]:0,Xe={min:Ze,max:ve,step:(ue=D.stepSize)!==null&&ue!==void 0?ue:(ve-Ze)/100},tt={x:Xe,y:Xe};return D.type!=="vec3"&&D.type!=="vec4"||(tt.z=Xe),D.type==="vec4"&&(tt.w=Xe),Js(ee,D,p,Object.assign(Object.assign({},tt),K??{}))};class B5 extends P5{constructor(D=document.body,{expanded:p=!0,autoPostFrame:K=!0}={}){super(D,K),this.THREE=window.THREE,this.typeGenerators=Object.assign({},L5),this._root&&(this._root.expanded=p)}_createUiContainer(){const D=function({innerHTML:p="",id:K,classList:W,addToBody:re=!0,elementTag:ue="div"}){const de=document.createElement(ue);return K&&(de.id=K),de.innerHTML=p,W&&de.classList.add(...W),re&&document.body.appendChild(de),de}({id:"tweakpaneUiContainer",addToBody:!1});return function(p,K=document.head){const W=document.createElement("style");W.type="text/css",W.innerText=p,K==null||K.appendChild(W)}(b5`
          :root{
            --tweakpane-ui-container-width: 300px;
          }
          @media only screen and (min-width: 1500px) {
            :root{
              --tweakpane-ui-container-width: 300px;
            }
          }
          @media only screen and (min-width: 2500px) {
            :root{
              --tweakpane-ui-container-width: 500px;
            }
          }
          #tweakpaneUiContainer {
            position: fixed;
            top: 1rem;
            padding-right: 4px;
            padding-bottom: 20px;
            right: 1rem;
            width: var(--tweakpane-ui-container-width);
            height: auto;
            overflow-y: scroll;
            z-index: 100;
            pointer-events: auto;
            max-height: calc(100% - 3rem);
            border-radius: 0.5rem;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji";
          }
        `),this._root=new wS.Pane({title:"Configuration",container:D}),D}appendChild(D,p){D&&(super.appendChild(D,p),this.renderUiConfig(D))}renderUiConfig(D){this.renderUiObject(D)}renderUiObject(D,p){var K,W,re,ue;if(p=p??this._root,!D.type)return;this.methods.initUiConfig(D),D.uiRef&&D.uiRefType!==D.type&&this.disposeUiConfig(D);const de=D.type?(W=(K=this.typeGenerators)[D.type])===null||W===void 0?void 0:W.call(K,p,D,this):void 0;de&&(de.hidden=(re=Zs(D.hidden))!==null&&re!==void 0&&re,de.disabled=(ue=Zs(D.disabled))!==null&&ue!==void 0&&ue,de.srcUiConfig=D),D.uiRef=de,D.uiRefType=de?D.type:void 0,D.__uiParent=p,D.uiRefresh=(ve=!1,Ze="postFrame",Xe=0)=>this.addToRefreshQueue(Ze,D,ve,Xe),de==null||de.controller_.viewProps.handleDispose(()=>{D.uiRef=void 0,D.uiRefType=void 0,D.uiRefresh=void 0})}_refreshUiConfigObject(D){D.__uiParent||console.error("No parent for ui object",D),this.renderUiObject(D,D.__uiParent)}}const L5={panel:pS,folder:pS,input:Js,number:Js,slider:(ee,D,p,K)=>{var W,re;const ue=Zs(D.bounds),de=((W=ue==null?void 0:ue.length)!==null&&W!==void 0?W:0)>=2?ue[1]:1,ve=((re=ue==null?void 0:ue.length)!==null&&re!==void 0?re:0)>=1?ue[0]:0,Ze=Zs(D.stepSize)||void 0;return Js(ee,D,p,Object.assign({min:ve,max:de,step:Ze},K??{}))},dropdown:(ee,D,p,K)=>{const W=p.methods.getChildren(D),re=Object.fromEntries(W.map(ue=>{var de;const ve=p.methods.getLabel(ue);return[ve,(de=ue.value)!==null&&de!==void 0?de:ve]}));return Js(ee,D,p,Object.assign({options:re},K??{}))},checkbox:Js,toggle:Js,button:(ee,D,p,K)=>{let W=D.uiRef;return W!=null&&W.controller_.viewProps.get("disposed")&&(W=void 0),W||(W=ee.addButton({title:""}),W.on("click",()=>R5(void 0,void 0,void 0,function*(){return p.methods.clickButton(D)}))),W&&(W.title=p.methods.getLabel(D)||"click me"),W},vec:Md,vector:Md,vec2:Md,vec3:Md,vec4:Md,color:(ee,D,p,K)=>{if(p.THREE){if(!D.__proxy){D.__proxy={forceOnChange:!0};const W="srgb",re=new p.THREE.Color;Object.defineProperty(D.__proxy,"value",{get:()=>{const ue=D.__proxy.value_;return ue?re.set(ue).getHex(W):0},set:ue=>{D.__proxy.value_=p.methods.getValue(D);const de=D.__proxy.value_,ve=re.setHex(ue,W);de!=null&&de.isColor?de.copy(ve):typeof de=="number"?D.__proxy.value_=ve.getHex():typeof de=="string"&&(D.__proxy.value_="#"+ve.getHexString())}})}return D.__proxy.value_=p.methods.getValue(D),(K=K??{}).view="color",Zs(D.inlinePicker)&&(K.picker="inline"),Js(ee,D,p,K)}console.error("tpColorInputGenerator requires THREE to be set in the renderer")},monitor:(ee,D,p,K)=>(D.readOnly=!0,Js(ee,D,p,K)),dummy:(ee,D,p,K)=>Js(ee,D,p,K)},tr={placeholderVal:"placeholder",renderTarImage:Tt.makeTextSvg("Render Target"),dataTexImage:Tt.makeTextSvg("Data Texture"),lutCubeTexImage:Tt.makeTextSvg("CUBE Texture"),compressedTexImage:Tt.makeTextSvg("Compressed Texture"),textureMap:{},imageMap:{},tempMap:{}},Ra=(ee,D,p)=>{var K,W,re;if(ee&&ee.isTexture){if(ee.isDataTexture)ee.needsUpdate=!0;else{const ue=p.methods.getBinding(D)[1]+"",de=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(ue);ee.colorSpace=de?Tt.LinearSRGBColorSpace:Tt.SRGBColorSpace,ee.wrapS=Tt.RepeatWrapping,ee.wrapT=Tt.RepeatWrapping,ee.flipY=((K=D.__proxy.value_)==null?void 0:K.flipY)??!0}ee.image&&((W=ee.image.id)!=null&&W.length||(ee.image.id=Tt.generateUUID()),tr.textureMap[ee.image.id]||(tr.textureMap[ee.image.id]=ee))}D.__proxy.value_=ee,p.methods.setValue(D,ee,{last:!0},!1),(re=D.uiRefresh)==null||re.call(D,!1,"postFrame")},U5=ee=>(D,p,K,W)=>(p.__proxy||(p.__proxy={listedOnChange:!1},Object.defineProperty(p.__proxy,"value",{get:()=>{var de;p.__proxy.value_=K.methods.getValue(p);const re=function(ve,Ze){let Xe;if(ve!=null&&ve.get&&(ve=ve.get()),!ve)return tr.placeholderVal;if(ve.isCompressedTexture&&!ve.image.tp_src&&(ve.image.tp_src=tr.compressedTexImage),ve.isTexture?(ve.image&&!ve.image.tp_src&&(ve.image instanceof ImageBitmap||ve.image instanceof HTMLImageElement||ve.image instanceof HTMLVideoElement?ve.image.tp_src=Tt.imageBitmapToBase64(ve.image,160):ve.isRenderTargetTexture?ve._target&&(ve.tp_src=Ze.renderManager.renderTargetToDataUrl(ve._target,void 0,void 0,Array.isArray(ve._target.texture)?ve._target.texture.indexOf(ve):void 0),setTimeout(()=>ve.tp_src&&delete ve.tp_src,1e3)):ve.image.tp_src=Tt.textureToDataUrl(ve,160,!1,"image/png",90),ve.image.tp_src||ve.tp_src||(ve.isRenderTargetTexture?ve.image.tp_src=tr.renderTarImage:ve.isDataTexture&&(ve.image.tp_src=tr.dataTexImage))),ve.image&&(Xe=ve.image.tp_src_uuid,Xe=Xe?tr.imageMap[Xe]:void 0,Xe||(Xe=ve.image.tp_src||ve.image.src)),ve.tp_src&&(Xe=ve.tp_src)):typeof ve=="string"?Xe=ve:ve.domainMin?(Xe=ve.texture,ve.texture.image&&!ve.texture.image.tp_src&&(ve.texture.image.tp_src=tr.lutCubeTexImage),ve.texture.image&&(Xe=ve.texture.image.tp_src_uuid,Xe=Xe?tr.imageMap[Xe]:void 0,Xe||(Xe=ve.texture.image.tp_src||ve.texture.image.src))):ve&&console.error("unknown value",ve),Xe||(Xe=tr.placeholderVal),ve.image&&!ve.image.tp_src_uuid){const tt=Tt.generateUUID();ve.image.tp_src_uuid=tt,tr.tempMap[Xe]=tt}return typeof Xe=="string"&&(Xe=tr.imageMap[Xe]??Xe),Xe}(p.__proxy.value_,ee);typeof re=="string"||(de=re.id)!=null&&de.length||(re.id=Tt.generateUUID());const ue=typeof re=="string"?re:re.id??re;return tr.textureMap[ue]||(tr.textureMap[ue]=p.__proxy.value_),re},set:re=>{Tt.getOrCall(p.readOnly)||(p.__proxy.value_=K.methods.getValue(p),function(ue,de,ve,Ze,Xe){var vi,yt,zt,_t,Nt,Ci,Ie;if(typeof ue=="string")return void(typeof de=="string"&&Ra(ue,ve,Xe));if((ue=ue||tr.placeholderVal).isPlaceholder||ue===tr.placeholderVal)return void(de&&Ra(typeof de=="string"?"":null,ve,Xe));let tt=ue.tp_src_uuid;if(tt||(tt=ue.src??ue.tp_src,tt=tr.tempMap[tt]??tt,delete tr.tempMap[tt],ue.tp_src_uuid=tt),tt&&(tr.imageMap[tt]=ue),typeof de!="string"){if(!(de===ue||de&&(de.image===ue||((vi=de.image)==null?void 0:vi.src)===ue.src||((yt=de.image)==null?void 0:yt.tp_src)===ue.tp_src&&ue.tp_src!=null||((zt=de.image)==null?void 0:zt.tp_src)===ue.src&&ue.src!=null||((_t=de.image)==null?void 0:_t.src)===ue.tp_src&&ue.tp_src!=null)))if(ue instanceof File)Ze.assetManager.importer.importSingle({file:ue,path:ue.src}).then($e=>{var Qt,ii,Oi;if(!$e)return;$e.isDataTexture&&($e.needsUpdate=!0);const dt=(Oi=(ii=(Qt=ue.src)==null?void 0:Qt.split("?"))==null?void 0:ii[0])==null?void 0:Oi.split(".").pop();$e.userData&&($e.userData.mimeType||($e.userData.mimeType="image/"+(["jpg","jpeg"].includes(dt)?"jpeg":"png"))),Ra($e,ve,Xe)});else if(ue.isTexture)Ra(ue,ve,Xe);else{let $e=tr.textureMap[ue.id]||tr.textureMap[ue.src]||tr.textureMap[ue.tp_src];if($e)return void Ra($e,ve,Xe);$e=new Tt.Texture(ue),Tt.upgradeTexture.call($e),$e.assetType="texture",$e.needsUpdate=!0;const dt=(Ie=(Ci=(Nt=ue.src)==null?void 0:Nt.split("?"))==null?void 0:Ci[0])==null?void 0:Ie.split(".").pop();$e.userData.mimeType||($e.userData.mimeType="image/"+(["jpg","jpeg"].includes(dt)?"jpeg":"png")),Ra($e,ve,Xe)}}else Ra(tt,ve,Xe)}(re,p.__proxy.value_,p,ee,K))}})),p.__proxy.value_=K.methods.getValue(p),(W=W??{}).extensions=[".jpg",".png",".svg",".hdr",".exr",".jpeg",".bmp",".gif",".webp",".cube"],W.imageFit===void 0&&(W.imageFit="contain"),W.clickCallback===void 0&&(W.clickCallback=(re,ue)=>{var zt;const de=re==null?void 0:re.target,ve=de==null?void 0:de.getBoundingClientRect();if(!ve)return void ue.click();const Ze=p.uiRef.controller_.valueController.value.rawValue,Xe=Ze===tr.placeholderVal||(Ze==null?void 0:Ze.isPlaceholder),tt=Xe?{}:{"download image":()=>function(_t,Nt,Ci){Tt.CustomContextMenu.Remove();const Ie=_t.__proxy.value_;if(!Ie)return;let $e=Ie.image??_t.uiRef.controller_.valueController.value.rawValue;Ie.__rootBlob&&!Ie.__rootBlob.objectUrl&&(Ie.__rootBlob.objectUrl=URL.createObjectURL(Ie.__rootBlob));let dt=Ie.__rootBlob?Ie.__rootBlob.objectUrl:Ie.userData.rootPath||($e==null?void 0:$e.src),Qt=!1;$e&&($e instanceof ImageBitmap||$e instanceof HTMLImageElement||$e instanceof HTMLVideoElement)&&!dt&&($e=Tt.imageBitmapToBase64($e));let ii=Ie.__rootBlob?Ie.__rootBlob.name||"image."+(Ie.__rootBlob.ext||"png"):null;if(!dt&&Ie.isRenderTargetTexture){const Si=Ie._target;if(!(Si!=null&&Si.isWebGLRenderTarget))return void console.error("Render target not supported",$e,Ie,Si,_t);{const Rr=Ci.renderManager.exportRenderTarget(Si);if(!Rr)return void console.error("cannot export render target",$e,Ie,Si,_t);ii="renderTarget."+(Rr.ext||"png"),dt=URL.createObjectURL(Rr),Qt=!0}}if(!dt&&Ie.isDataTexture){if(Ie.type!==Tt.HalfFloatType&&Ie.type!==Tt.FloatType)return void console.error("Only Float and HalfFloat Data texture export is supported",$e,Ie,_t);const Si=new Tt.EXRExporter2().parse(void 0,Ie),Rr=new Blob([Si],{type:"image/x-exr"});if(!Rr)return void console.error("cannot export data texture",$e,Ie,_t);ii="dataTexture.exr",dt=URL.createObjectURL(Rr)}if(!dt)return void console.error("cannot export image",$e,Ie,_t);const Oi=document.createElement("a");document.body.appendChild(Oi),Oi.style.display="none",Oi.href=dt,Oi.download=ii||(dt.startsWith("data:")?"image.png":dt.split("/").pop()??"image.png"),Oi.target="_blank",Oi.click(),Qt&&setTimeout(()=>{document.body.removeChild(Oi),URL.revokeObjectURL(dt)},1e3)}(p,0,ee)},vi=Tt.getOrCall(p.readOnly);Xe||vi||Object.assign(tt,{"remove image":()=>function(_t,Nt){_t.uiRef.controller_.valueController.value.setRawValue("");const Ci=typeof _t.__proxy.value_=="string";Ra(Ci?"":null,_t,Nt)}(p,K)}),vi||Object.assign(tt,{"set/replace image":()=>ue.click(),"from url":async()=>async function(_t,Nt,Ci){let Ie="";if(Ie=await _t.prompt("Load texture: Enter Image/Texture URL",Ie,!0),!Ie||!Ie.startsWith("http")&&!Ie.startsWith("data:image"))return void(Ie!==null&&await _t.alert("Loading Image: Invalid URL"));Ie=Ie.trim(),typeof Nt.__proxy.value_=="string"?Ra(Ie,Nt,_t):Ci.assetManager.importer.importSingle(Ie).then($e=>{$e?Ra($e,Nt,_t):console.warn("Failed to load texture",Ie)})}(K,p,ee)});const yt=Tt.CustomContextMenu.Create({...tt,cancel:()=>{}},2,ve.height+8,!1,!0);(zt=de.parentElement)==null||zt.appendChild(yt),ve.y>.7*document.body.clientHeight&&(yt.style.top="auto",yt.style.bottom=ve.height+8+"px")}),W.view="input-image",K.typeGenerators.input(D,p,K,W));let lu=class extends B5{constructor(ee=!1,D=!0,p=document.body,K){super(p,{expanded:ee,autoPostFrame:!1}),this.enabled=!0,this._plugins=[],this._preRender=()=>this.refreshQueue("preRender"),this._postRender=()=>this.refreshQueue("postRender"),this._postFrame=W=>{this.dispatchEvent(W),this.refreshQueue("postFrame")},this._preFrame=()=>this.refreshQueue("preFrame"),this.alert=async W=>this._viewer?this._viewer.dialog.alert(W):window==null?void 0:window.alert(W),this.confirm=async W=>this._viewer?this._viewer.dialog.confirm(W):window==null?void 0:window.confirm(W),this.prompt=async(W,re,ue=!0)=>this._viewer?this._viewer.dialog.prompt(W,re,ue):window==null?void 0:window.prompt(W,re),this.THREE={Color:Tt.Color,Vector4:Tt.Vector4,Vector3:Tt.Vector3,Vector2:Tt.Vector2},this._root.registerPlugin(_5),D&&Tt.createStyles('#tweakpaneUiContainer{height:calc(100% - 6rem);max-height:calc(100% - 6rem);pointer-events:none}#tweakpaneUiContainer>div{pointer-events:auto}:root{--tp-blade-unit-size:26px;--tp-font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji";--tp-element-border-radius:0.25rem;--tp-base-background-color:#0e0e0e;--tp-container-background-color:rgba(32,32,32,.2);--tp-container-background-color-hover:rgba(32,32,32,.3);--tp-container-background-color-active:rgba(50,50,50,.8);--tp-container-background-color-focus:#323232;--tp-container-foreground-color:hsla(0,0%,90%,.9);--tp-label-foreground-color:hsla(0,0%,85%,.9)}:root .tpTheme-blue{--tp-base-background-color:#28223c;--tp-base-shadow-color:rgba(0,0,0,.2);--tp-button-background-color:#c7c9d1;--tp-button-background-color-active:#f1f1f4;--tp-button-background-color-focus:#e3e4e8;--tp-button-background-color-hover:#d5d6dd;--tp-button-foreground-color:#161822;--tp-container-background-color:rgba(31,34,51,.65);--tp-container-background-color-active:rgba(59,66,99,.65);--tp-container-background-color-focus:rgba(50,55,83,.65);--tp-container-background-color-hover:rgba(40,45,67,.65);--tp-container-foreground-color:#e9e9ed;--tp-groove-foreground-color:#101218;--tp-input-background-color:#101218;--tp-input-background-color-active:#2a304b;--tp-input-background-color-focus:#21253b;--tp-input-background-color-hover:#1b1d28;--tp-input-foreground-color:#c7c9d1;--tp-monitor-background-color:#101218;--tp-monitor-foreground-color:#6c7189;--tp-label-foreground-color:#e4e2ed}:root .tpTheme-white{--tp-base-background-color:#e4e5e7;--tp-base-shadow-color:rgba(0,0,0,.1);--tp-button-background-color:#d6d7db;--tp-button-background-color-active:#adafb8;--tp-button-background-color-focus:#bbbcc4;--tp-button-background-color-hover:#c8cad0;--tp-button-foreground-color:#454754;--tp-container-background-color:rgba(196,199,212,.1);--tp-container-background-color-active:rgba(167,171,190,.32);--tp-container-background-color-focus:rgba(167,171,190,.28);--tp-container-background-color-hover:rgba(167,171,190,.24);--tp-container-foreground-color:#454754;--tp-groove-foreground-color:rgba(43,46,59,.1);--tp-input-background-color:rgba(65,69,88,.1);--tp-input-background-color-active:rgba(108,115,147,.22);--tp-input-background-color-focus:rgba(108,115,147,.18);--tp-input-background-color-hover:rgba(108,115,147,.14);--tp-input-foreground-color:#2e3038;--tp-label-foreground-color:#17181c;--tp-monitor-background-color:rgba(65,69,88,.1);--tp-monitor-foreground-color:rgba(69,71,84,.5)}.tp-fldv{background-blend-mode:luminosity;margin-bottom:.25rem;margin-top:.25rem;position:relative}.tp-fldv .tp-fldv{margin-bottom:.5rem;margin-top:.5rem}.tp-fldv_b{font-size:.9rem!important;height:calc(var(--bld-us)*1.5 + 4px)!important;transition:background-color .5s ease}.tp-fldv_b+.tp-brkv .tp-fldv_b{font-size:.7rem!important;height:calc(var(--bld-us)*1.1 + 4px)!important}.tp-lblv_l{flex-basis:20%!important;flex-grow:1!important;font-size:.75rem!important;font-weight:500!important}.tp-lblv_v{flex-basis:50%!important;flex-grow:1!important}.tp-txtv_i{font-size:.75rem!important}.tp-fldv_t,.tp-txtv_i{font-weight:500!important}.tp-fldv_t{padding-left:1.5rem!important}.tp-fldv_m{left:.75rem;opacity:1!important;right:auto!important}.pluginOptionsButton{background:transparent;border:none;color:var(--tp-container-foreground-color,#eee);font-size:.9rem;height:min-content;padding-left:.5rem;padding-right:.5rem;position:absolute;right:0;top:.75rem}.tp-sldv_k:after{background-color:var(--tp-input-foreground-color,#bbbcc4)}.tp-btnv_b{height:calc(var(--tp-blade-unit-size)*1.15)}.tp-btnv_b,.tp-lstv_s,.tp-p2dv_b{font-weight:500!important}.tp-rotv{font-size:13px!important}',p),this.colorMode=K??(localStorage?localStorage.getItem("tpTheme"):"blue")??"blue"}onAdded(ee){this._viewer=ee,this.typeGenerators.image=U5(this._viewer),ee.addEventListener("preRender",this._preRender),ee.addEventListener("postRender",this._postRender),ee.addEventListener("preFrame",this._preFrame),ee.addEventListener("postFrame",this._postFrame)}onRemove(ee){this._viewer=void 0,ee.removeEventListener("preRender",this._preRender),ee.removeEventListener("postRender",this._postRender),ee.removeEventListener("preFrame",this._preFrame),ee.removeEventListener("postFrame",this._postFrame),this.dispose()}setupPlugins(...ee){ee.forEach(D=>this.setupPluginUi(D))}setupPluginUi(ee,D){var W;const p=ee.prototype?(W=this._viewer)==null?void 0:W.getPlugin(ee):ee;if(!p)return void console.warn("plugin not found:",ee);this._plugins.push(p),p.uiConfig&&p.uiConfig.hidden===void 0&&(p.uiConfig.hidden=!1);const K=p.uiConfig;return this.appendChild(K,D),this._setupPluginSerializationContext(K,p),K}_setupPluginSerializationContext(ee,D){if(!(ee!=null&&ee.uiRef)||!D.toJSON)return;D._defaultState=typeof D.toJSON=="function"?D.toJSON():null,D.resetDefaults=async()=>{var W,re;D._defaultState&&(await((W=D.fromJSON)==null?void 0:W.call(D,D._defaultState)),(re=ee.uiRefresh)==null||re.call(ee,!0,"postFrame"))};const p=ee.uiRef.controller_.view.element,K=Tt.createDiv({innerHTML:"&#8942;",classList:["pluginOptionsButton"],elementTag:"button"});K.onclick=W=>{const re={};typeof D.toJSON=="function"&&(re["download preset"]=async()=>{if(!this._viewer)return;const de=this._viewer.exportPluginConfig(D);await Tt.downloadBlob(new Blob([JSON.stringify(de,null,2)],{type:"application/json"}),"preset."+D.constructor.PluginType+".json")}),typeof D.fromJSON=="function"&&(re["upload preset"]=async()=>{var tt,vi;const de=await Tt.uploadFile(!1,!1);if(de.length===0)return;const ve=de[0],Ze=await ve.text(),Xe=JSON.parse(Ze);await((tt=this._viewer)==null?void 0:tt.importPluginConfig(Xe,D)),(vi=ee.uiRefresh)==null||vi.call(ee,!0,"postFrame")},D._defaultState&&(re["reset defaults"]=()=>{var de;return(de=D.resetDefaults)==null?void 0:de.call(D)}));const ue=Tt.CustomContextMenu.Create(re,p.clientWidth-120,12);p.append(ue),W.preventDefault()},p.appendChild(K)}refreshPluginsEnabled(){this._plugins.forEach(ee=>{var p;const D=ee.uiConfig;D&&(Tt.getOrCall(D.hidden)!==!0?(p=D.uiRefresh)==null||p.call(D,!0,"postFrame"):D.uiRef&&(D.uiRef.hidden=!0))})}_colorModeChanged(){document.body.classList.remove("tpTheme-black","tpTheme-white","tpTheme-blue"),document.body.classList.add("tpTheme-"+this.colorMode),localStorage&&localStorage.setItem("tpTheme",this.colorMode)}};lu.PluginType="TweakpaneUi",aS([Tt.onChange(lu.prototype._colorModeChanged),Tt.uiDropdown("Color Mode",["black","white","blue"].map(ee=>({label:ee})))],lu.prototype,"colorMode",void 0),lu=aS([Tt.uiFolderContainer("Tweakpane UI")],lu);async function O5(){var Nt,Ci;const ee=new Tt.ThreeViewer({canvas:document.getElementById("threepipe-canvas"),msaa:!1,renderScale:"auto",dropzone:{allowedExtensions:["png","jpeg","jpg","webp","svg","hdr","exr"],autoImport:!0,addOptions:{disposeSceneObjects:!1,autoSetBackground:!1,autoSetEnvironment:!0}},plugins:[Tt.LoadingScreenPlugin,Tt.PickingPlugin,Tt.PopmotionPlugin,Tt.CameraViewPlugin,Tt.TransformAnimationPlugin,new Tt.TransformControlsPlugin(!1),Tt.CanvasSnapshotPlugin,Tt.ContactShadowGroundPlugin]}),D=ee.addPluginSync(new lu(!0)),p=await ee.load("./models/tabletop_macbook_iphone.glb");if(!p)return;const K=p.getObjectByName("macbook"),W=p.getObjectByName("iphone"),re=K.getObjectByName("Bevels_2");re.name="Macbook Screen",D.setupPluginUi(Tt.CanvasSnapshotPlugin,{expanded:!1}),D.appendChild(re.uiConfig,{expanded:!1}),D.appendChild(W.uiConfig,{expanded:!1}),D.setupPluginUi(Tt.CameraViewPlugin,{expanded:!1}),D.appendChild(ee.scene.mainCamera.uiConfig),D.setupPluginUi(Tt.TransformControlsPlugin,{expanded:!0}),ee.assetManager.addEventListener("loadAsset",Ie=>{var ii,Oi,Si;if(!((ii=Ie.data)!=null&&ii.isTexture))return;const $e=Ie.data;$e.colorSpace=Tt.SRGBColorSpace;const dt=(Oi=ee.scene.getObjectByName("Object_7"))==null?void 0:Oi.material,Qt=(Si=ee.scene.getObjectByName("xXDHkMplTIDAXLN"))==null?void 0:Si.material;console.log(dt,Qt),!(!dt||!Qt)&&(dt.color.set(0,0,0),dt.emissive.set(1,1,1),dt.roughness=.2,dt.metalness=.8,dt.map=null,dt.emissiveMap=$e,Qt.emissiveMap=$e,dt.setDirty(),Qt.setDirty())});const ue=()=>window.matchMedia("(max-width: 768px)").matches,de=Ie=>ue()?Ie+"2":Ie,ve=ee.getPlugin(Tt.TransformAnimationPlugin),Ze=ee.getPlugin(Tt.CameraViewPlugin),Xe=ee.getPlugin(Tt.PickingPlugin);Xe.widgetEnabled=!1,Xe.hoverEnabled=!0,await((Nt=ve.animateTransform(re,"closed",50))==null?void 0:Nt.promise),await((Ci=ve.animateTransform(W,"facedown",50))==null?void 0:Ci.promise),await Ze.animateToView(de("start"),50);const tt={focused:"",hover:"",animating:!1},vi={focused:"",hover:""};async function yt(){var dt,Qt,ii,Oi,Si,Rr;if(tt.animating)return;const Ie=vi;if(Ie.focused===tt.focused&&Ie.hover===tt.hover)return;tt.animating=!0;const $e=tt.focused;if(Object.assign(tt,Ie),tt.focused)await Promise.all([(dt=ve.animateTransform(re,tt.focused==="macbook"?"open":"closed",500))==null?void 0:dt.promise,(Qt=ve.animateTransform(W,tt.focused==="iphone"?"floating":"facedown",500))==null?void 0:Qt.promise,Ze.animateToView(de(tt.focused==="macbook"?"macbook":"iphone"),500)]);else if(tt.hover)await Promise.all([(ii=ve.animateTransform(re,tt.hover==="macbook"?"hover":"closed",250))==null?void 0:ii.promise,(Oi=ve.animateTransform(W,tt.hover==="iphone"?"tilted":"facedown",250))==null?void 0:Oi.promise]);else{const $s=$e?500:250;await Promise.all([(Si=ve.animateTransform(re,"closed",$s))==null?void 0:Si.promise,(Rr=ve.animateTransform(W,"facedown",$s))==null?void 0:Rr.promise,$e?Ze.animateToView(de("front"),$s):null])}tt.animating=!1}async function zt(Ie){for(Object.assign(vi,Ie);tt.animating;)await Tt.timeout(50);await yt()}function _t(Ie){let $e="";return Ie.traverseAncestors(dt=>{dt===K&&($e="macbook"),dt===W&&($e="iphone")}),$e}Xe.addEventListener("hoverObjectChanged",async Ie=>{const $e=Ie.object;if(!$e){tt.hover&&!tt.focused&&await zt({hover:"",focused:""});return}if(tt.focused)return;const dt=_t($e);await zt({hover:dt,focused:""})}),Xe.addEventListener("hitObject",async Ie=>{const $e=Ie.intersects.selectedObject;if(!$e){tt.focused&&await zt({hover:"",focused:""});return}const dt=_t($e);Ie.intersects.selectedObject=dt==="macbook"?K:W,await zt({focused:dt,hover:""})}),document.addEventListener("keydown",Ie=>{Ie.key==="Escape"&&tt.focused&&zt({hover:"",focused:""})})}O5();
